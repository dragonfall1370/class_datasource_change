

/*
with
email_dup as ( select id, email from candidate can where can.email like '%\__' )
, email as ( select id, email from candidate where email in ( select *//*id, external_id, email,*//* regexp_replace(email, E'_.$', '', 'g') as email_new from candidate can where can.email like '%\__' ) )
, email_all as (select id, email from email_dup union all select * from email )



-- CHECKING ALL INFO
select     can.id as ID, can.insert_timestamp, can.external_id
        , can.first_name as FirstName, middle_name as MiddleName, can.last_name as LastName, can.candidate_owner_json
        , can.email, can.email2, can.work_email as WorkEmail
        , can.note as Note
        , phone as PrimaryPhone , phone2 as Mobile, work_phone as WorkPhone, home_phone as HomePhone--, preferred_phone, preferred_mobile_phone, preferred_work_phone, preferred_home_phone
        , desired_job_type_json
        , edu_details_json --, edu_details_json::json->0->>'schoolName' as SchoolName, edu_details_json::json->0->>'institutionName' as InstitutionName, edu_details_json::json->0->>'degreeName' as DegreeName, edu_details_json::json->0->>'course' as Course, edu_details_json::json->0->>'major' as Major
        , ind.name as industry
        , fe.name as FunctionalExpertise --, sfe.name as sfe
        , experience as WorkHistory --,experience_details_json::json->0->>'currentEmployer' as currentEmployer, experience_details_json::json->0->>'jobTitle' as jobTitle
        , can.experience_details_json --, can.experience_details_json::json->0->>'jobTitle' as jobTitle, can.experience_details_json::json->0->>'currentEmployer' as currentEmployer
-- select count(*) -- 66942-- select * -- select distinct linked_in_profile
from candidate can
left join email_all e on e.id = can.id
left join common_location cl on cl.id = can.current_location_id
left join (select ci.candidate_id, string_agg(v.name, ', ') as name from candidate_industry ci left join vertical v on ci.vertical_id = v.id GROUP BY ci.candidate_id) ind on ind.candidate_id = can.id
left join candidate_source cs on cs.id = can.candidate_source_id
left join (select can.id, string_agg(distinct (fe.name), ', ') as name --FunctionalExpertise
                from candidate can
                left join candidate_functional_expertise cfe on cfe.candidate_id = can.id
                left join functional_expertise fe on fe.id = cfe.functional_expertise_id
                where fe.name is not null GROUP BY can.id
                ) fe on fe.id = can.id --cfe.functional_expertise_id
where e.id is not null
--can.id in (91669)
--can.external_id is not null
--and  can.last_name = 'Orbaneja' or can.first_name = 'Miguel' or
--first_name = 'Matthew' and last_name = 'Osborne
--and (can.candidate_owner_json is null or can.candidate_owner_json = '[]')
--can.external_id is not null 
--`can.external_id in ('123240')
--can.email like 'Joellelee_93@hotmail.com%'
limit 100
*/




/*
1. update candidate owner
2. xoa id thua
3. update email
*/
with earliest as ( 
       SELECT id ,tmp_userid, insert_timestamp, row_number() OVER (PARTITION BY tmp_userid ORDER BY insert_timestamp asc) AS rn FROM candidate 
       where tmp_userid in ('97731','97887','98052','10216','10371','10478','10532','10556','10609','10647','10922','11180','11391','11570','11768','11959','11990','12053','12150','12167','12285','12286','12406','12417','12429','12552','12650','12818','12879','12941','13044','13089','13217','13255','13601','13645','13656','13690','13703','13938','13999','14030','14235','14309','14379','14470','14600','14619','14732','15221','15306','15318','15374','15396','15408','15420','15594','15624','15879','15942','15966','15968','16118','16148','16366','16657','16668','16756','17161','17166','17258','17459','17484','17581','17758','17864','18008','18053','18276','18489','18615','18643','18832','18835','18853','18926','19294','19323','19495','19497','19530','19617','19653','19681','19745','19769','19812','19862','19944','19978','20049','20107','20133','20142','20371','20384','20388','20425','20450','20523','20532','20596','20627','20695','20750','20866','20867','20983','21100','21171','21464','21477','21584','21646','21679','21713','21929','21937','21941','22061','22226','22261','22281','22299','22321','22624','22731','22786','22966','23079','23118','23158','23213','23289','23322','23371','23541','23566','23708','23748','23844','23873','24127','24585','24616','24675','24701','24712','24826','24853','24904','24947','24951','24953','24986','25001','25012','25065','25197','25215','25235','25241','25261','25267','25513','25741','25752','25931','26056','26135','26240','26244','26394','26396','26518','26575','26641','26708','26725','26911','27139','27362','27603','27611','27725','27798','28003','28015','28027','28173','28404','28413','28414','28448','28497','28514','28699','28704','28707','28734','28747','28754','28799','28938','29192','29332','29370','29505','29541','29569','29610','29630','29637','29663','29726','29981','30017','30080','30141','30207','30221','30230','30237','30270','30334','30349','30364','30381','30441','30586','30707','30776','31043','31054','31087','31589','31664','31733','31839','31852','32076','32136','32296','32575','32592','32608','32613','32685','32689','32757','32816','32839','33088','33123','33320','33395','33400','33587','33718','33778','33958','34013','34035','34063','34091','34174','34494','34657','34737','34752','34812','34824','34844','34902','34963','35032','35044','35107','35247','35286','35392','35718','35814','35817','35828','35838','35947','36004','36041','36045','36229','36427','36650','36661','36748','36781','36811','37011','37075','37172','37229','37291','37337','37425','37519','37559','37719','37917','37929','37969','37990','38590','38606','38674','38738','38779','38849','38895','39064','39075','39158','39202','39225','39317','39325','39514','39548','39550','39565','39709','39739','39837','39979','40240','40274','40282','40314','40321','40396','40416','40479','40485','40575','40633','40714','40751','40788','40789','40795','40827','40875','40882','40889','40925','40985','41040','41132','41306','41542','41589','41696','41720','41901','42000','42143','42243','42347','42408','42491','42550','42628','42665','42696','42707','42782','42823','42844','42848','42954','42957','43116','43163','43165','43174','43351','43385','43436','43451','43698','43868','43982','43985','44069','44253','44403','44861','44926','45201','45340','45374','45587','45653','45814','45906','45948','46293','46434','46621','46691','46700','46900','47092','47462','47586','47617','47681','47867','48034','48081','48146','48207','48518','48722','48796','48942','48943','49202','49221','49381','49530','49569','49576','49606','49745','49887','49998','50298','50471','50951','51064','51326','51603','52324','52383','52422','53196','53486','53546','53754','53864','53951','54118','54314','54389','54568','54590','54635','54706','54742','54794','55072','55073','55092','55336','55405','55547','55685','55821','55931','55956','56128','56132','56218','56388','56454','56466','56614','56738','57042','57052','57206','57219','57442','57501','57516','57523','57701','57727','57756','57809','58280','58287','58294','58479','58625','58735','59082','59083','59165','59542','59578','59775','59819','59938','60343','60448','60551','60604','60633','60743','61200','61202','61246','61293','61491','61652','61721','61872','61903','61918','61947','61969','61978','62056','62114','62142','62147','62423','62534','62589','62612','62679','62887','62973','63084','63190','63286','63300','63545','63588','63810','63894','64184','64195','64230','64419','64452','64584','64909','64920','65043','65658','65698','65843','65898','65952','66218','66256','66308','66340','66358','66368','66385','66444','66498','66571','66584','66593','66625','66816','66867','66874','66889','66890','66897','66944','67049','67067','67081','67173','67204','67390','67392','67404','67412','67566','67860','67908','67939','68014','68062','68099','68102','68112','68127','68133','68182','68184','68238','68307','68911','68968','69008','69009','69010','69022','69023','69144','69197','69215','69452','69512','69673','69674','69714','69789','69840','69855','70047','70230','70374','70419','70479','70498','70555','70620','70733','70756','70797','70973','71126','71157','71200','71204','71225','71230','71233','71252','71256','71296','71316','71335','71387','71483','71489','71490','71492','71506','71512','71518','71560','71603','71607','71782','71783','71878','71897','71941','71948','71951','71960','72152','72154','72202','72218','72272','72302','72307','72346','72358','72365','72487','72507','72513','72532','72634','72739','72741','72900','72920','72982','73014','73016','73084','73188','73195','73197','73204','73408','73410','73415','73444','73452','73552','73554','73557','73559','73560','73563','73567','73570','73572','73582','73616','73618','73628','73629','73636','73639','73641','73643','73644','73786','73787','73788','73936','73938','73939','73941','73951','73952','73997','73999','74000','74020','74025','74026','74029','74047','74048','74106','74110','74171','74175','74270','74276','74298','74329','74343','74345','74391','74398','74602','74675','74689','74697','74760','74781','74782','74917','74959','74992','74993','75013','75019','75079','75087','75210','75222','75224','75360','75381','75382','75383','75632','75641','75648','75660','75704','75705','75707','75752','75755','75756','75757','75850','75870','75897','75938','75996','75999','76001','76004','76006','76007','76010','76036','76038','76040','76041','76042','76044','76045','76046','76058','76060','76063','76070','76071','76072','76093','76097','76162','76163','76207','76213','76219','76220','76221','76263','76291','76295','76296','76300','76314','76316','76318','76338','76339','76412','76559','76569','76591','76654','76739','76745','76747','76751','76753','76775','76804','76822','76824','76826','76828','76838','76840','76857','76860','76861','76910','76912','76917','76936','76953','76956','76959','76973','76975','76977','77047','77057','77062','77072','77081','77082','77084','77092','77093','77095','77097','77100','77101','77102','77103','77104','77105','77106','77108','77111','77112','77114','77115','77116','77118','77120','77153','77157','77172','77176','77200','77203','77236','77237','77239','77245','77252','77265','77281','77282','77287','77288','77289','77293','77295','77323','77326','77330','77351','77357','77366','77369','77381','77395','77407','77408','77410','77412','77416','77469','77474','77475','77476','77481','77538','77546','77547','77548','77549','77561','77574','77638','77650','77654','77658','77660','77666','77763','77770','77794','77813','77815','77818','77866','77869','77881','77915','77936','78011','78022','78033','78042','78057','78064','78077','78084','78086','78110','78113','78117','78175','78177','78178','78185','78189','78191','78202','78252','78258','78309','78337','78346','78356','78372','78377','78381','78386','78388','78393','78398','78465','78468','78469','78470','78471','78472','78473','78474','78475','78509','78521','78560','78561','78567','78571','78572','78577','78605','78613','78618','78624','78655','78683','78709','78712','78716','78721','78724','78746','78844','78873','78901','78912','78917','78947','78950','78952','78971','78972','78984','79004','79024','79042','79060','79077','79083','79085','79101','79104','79108','79110','79129','79141','79151','79156','79160','79166','79167','79199','79200','79202','79210','79248','79250','79266','79288','79293','79307','79312','79316','79322','79329','79368','79386','79475','79487','79497','79498','79506','79509','79513','79533','79537','79539','79546','79571','79575','79576','79615','79623','79648','79656','79663','79702','79711','79718','79723','79735','79740','79748','79754','79756','79762','79764','79792','79801','79834','79835','79849','79863','79883','79889','79893','79907','79965','79967','79996','80031','80034','80035','80037','80050','80064','80072','80080','80081','80098','80108','80112','80126','80173','80174','80178','80184','80202','80211','80221','80222','80228','80237','80241','80243','80290','80293','80310','80312','80314','80320','80323','80328','80373','80382','80383','80399','80418','80419','80427','80448','80451','80455','80459','80467','80477','80482','80513','80514','80526','80582','80584','80592','80593','80597','80606','80610','80618','80621','80638','80640','80647','80649','80652','80689','80692','80700','80705','80708','80730','80740','80762','80766','80787','80788','80805','80818','80821','80826','80828','80829','80835','80837','80838','80895','80901','80909','80912','80919','80922','80983','80985','80988','80989','80990','80992','81005','81011','81017','81023','81033','81036','81039','81041','81065','81068','81070','81075','81085','81118','81124','81131','81142','81148','81162','81174','81188','81193','81199','81200','81206','81269','81270','81272','81302','81321','81325','81331','81332','81365','81367','81369','81372','81374','81376','81387','81410','81418','81426','81467','81496','81498','81499','81500','81502','81504','81510','81567','81583','81587','81592','81595','81608','81610','81612','81620','81659','81699','81701','81702','81742','81743','81746','81751','81752','81754','81758','81759','81770','81772','81782','81785','81793','81796','81798','81860','81861','81864','81869','81896','81909','81911','81913','81915','81917','81924','81926','81928','81929','81955','81956','81975','81987','81988','81990','82020','82033','82034','82045','82048','82096','82100','82102','82129','82140','82144','82250','82373','85454','85559','85744','85792','85831','85834','85854','85925','85928','86021','86200','86438','86447','86585','86870','87043','87472','87544','87684','87729','88015','88085','88180','88208','88304','88325','88515','90070','90470','90498','90511','90530','90564','90668','90961','90993','91051','91427','91542','91581','91647','91861','91982','92034','92072','92190','92279','92350','92373','92386','92404','92581','92602','92655','92851','93101','93145','93560','93830','93956','94201','94303','94348','94541','94788','94831','94872','94942','94963','95014','95041','95164','95216','95243','95409','95414','95456','95494','95688','95704','95713','95808','96121','96351','96367','96548','96574','96677','96874','96913','96936','97000','97144','97321','97447','97567','97731','97887','98052','98136','98186','98237','98263','98330','98391','98435','98512','98551','98712','98774','99122','99196','99246','99535','99564','99615','99664','99700','100006','100116','100149','100271','100384','101237','101353','101575','101676','101849','102022','102163','102188','102216','102314','103529','103864','103876','103986','104430','104500','105416','106047','106235','106279','106291','106362','106474','106510','106542','106940','106982','107296','107565','107605','107708','108027','108054','108095','108173','108233','108422','108514','109105','109541','109730','109771','111420','111675','112004','112072','112073','112081','112117','112119','112122','112126','112127','112128','112132','112134','112139','112141','112146','112147','112149','112151','112152','112154','112156','112157','112158','112160','112197','112198','112200','112203','112204','112209','112232','112293','112296','112315','112332','112335','112337','112348','112396','112400','112417','112424','112430','112476','112491','112504','112697','112939','113187','114125','114470','114884','115243','115457','115501','118124','118355','120992','121092','121108','121504','121724','122330','123192','123453','123521','123526','123527','123530','123532','123553','123588','123662','123664','123681','123682','123684','123685','123686','123713','123938','123946','123964','124054','124074','124076','124200','124265','124268','124398','124440','124482','124483','124484','124485','124486','124489','124490','124500','124558','124793','124794','124796','124819','124843','124844','124870','124872','124884','124897','124903','124932','124940','124941','124948','124949','125084','125087','125095','125097','125109','125405','125541','126376','126474','126500','126671','127716','126700','126728','126785','126809','126811','126997','127186','127318','127369','127370','127516','127672','127853','128078','128186','128409','128504','128508','128520','128819','128951','128986','129294','129899','130130','130645','131117','131165','131172','131335','131593','131646','131660','131813','132270','132275','132388','132530','133033','133191','133283','133292','133646','133669','133794','134384','134594','134617','134631','134834','134870','134981','134995','135492','135769','135829','136271','136799','137209','137304','138539','139106','139107','139108','139111','139125','139154','139158','139197','139246','139247','139248','139272','139293','139374','139378','139435','139494','139517','139518','139560','139641','139654','139670','139695','139710','139724','139731','139829','139835','139842','139864','139872','139878','139884','139935','139942','139976','139977','139978','139979','139991','140021','140022','140024','140025','140026','140027','140028','140588','140742','141285','141305','141394','141577','141580','142180','142218','142327','142823','142961','143100','143231','143681','144535','144539','144547','144773','144782','144981','145108','146359','146435','146676','147197','147209','147272','147369','147590','147925','148022','148101','149729','150758','151643','152317','153297','155586','155807','156945','157014','157133','157308','157326','157751','157756','157965','158436','158558','159582','160314','160497','160668','161343','163751','')
       ORDER BY tmp_userid asc )
--select distinct tmp_userid from earliest
--select count(*) from earliest
--select * from earliest where rn > 1

-- REMOVE DUPLICATED CANDIDATE
--update candidate set deleted_timestamp = now()
--where id in (select id from earliest where rn > 1)

-- UPDATE DUPLICATED CANDIDATE EMAIL
--alter table candidate add column tmp_email_old varchar(400)
--update candidate set tmp_email_old = email
select     can.id as ID, can.insert_timestamp, can.tmp_userid, can.external_id
        , can.first_name as FirstName, middle_name as MiddleName, can.last_name as LastName      , can.email, can.email2, can.work_email as WorkEmail , regexp_replace(email, E'_.$', '', 'g') as email_new
from candidate can
--update candidate set email = regexp_replace(email, E'_.$', '', 'g')
where id in (select id from earliest where rn = 1)


-- COMBINE CANDIDATE OWNER
--create temporary column tmp_candidate_owner_json which compbined all owners
alter table candidate add column tmp_candidate_owner_json text

update candidate set tmp_candidate_owner_json = t.owner_new
from 
       ( 
       select tmp_userid, concat('[', string_agg( replace(replace(candidate_owner_json,'[',''),']','') ,',') ,']') as owner_new 
       from candidate /*where tmp_userid in ('97731','97887','98052'*/
       where tmp_userid in ('97731','97887','98052','10216','10371','10478','10532','10556','10609','10647','10922','11180','11391','11570','11768','11959','11990','12053','12150','12167','12285','12286','12406','12417','12429','12552','12650','12818','12879','12941','13044','13089','13217','13255','13601','13645','13656','13690','13703','13938','13999','14030','14235','14309','14379','14470','14600','14619','14732','15221','15306','15318','15374','15396','15408','15420','15594','15624','15879','15942','15966','15968','16118','16148','16366','16657','16668','16756','17161','17166','17258','17459','17484','17581','17758','17864','18008','18053','18276','18489','18615','18643','18832','18835','18853','18926','19294','19323','19495','19497','19530','19617','19653','19681','19745','19769','19812','19862','19944','19978','20049','20107','20133','20142','20371','20384','20388','20425','20450','20523','20532','20596','20627','20695','20750','20866','20867','20983','21100','21171','21464','21477','21584','21646','21679','21713','21929','21937','21941','22061','22226','22261','22281','22299','22321','22624','22731','22786','22966','23079','23118','23158','23213','23289','23322','23371','23541','23566','23708','23748','23844','23873','24127','24585','24616','24675','24701','24712','24826','24853','24904','24947','24951','24953','24986','25001','25012','25065','25197','25215','25235','25241','25261','25267','25513','25741','25752','25931','26056','26135','26240','26244','26394','26396','26518','26575','26641','26708','26725','26911','27139','27362','27603','27611','27725','27798','28003','28015','28027','28173','28404','28413','28414','28448','28497','28514','28699','28704','28707','28734','28747','28754','28799','28938','29192','29332','29370','29505','29541','29569','29610','29630','29637','29663','29726','29981','30017','30080','30141','30207','30221','30230','30237','30270','30334','30349','30364','30381','30441','30586','30707','30776','31043','31054','31087','31589','31664','31733','31839','31852','32076','32136','32296','32575','32592','32608','32613','32685','32689','32757','32816','32839','33088','33123','33320','33395','33400','33587','33718','33778','33958','34013','34035','34063','34091','34174','34494','34657','34737','34752','34812','34824','34844','34902','34963','35032','35044','35107','35247','35286','35392','35718','35814','35817','35828','35838','35947','36004','36041','36045','36229','36427','36650','36661','36748','36781','36811','37011','37075','37172','37229','37291','37337','37425','37519','37559','37719','37917','37929','37969','37990','38590','38606','38674','38738','38779','38849','38895','39064','39075','39158','39202','39225','39317','39325','39514','39548','39550','39565','39709','39739','39837','39979','40240','40274','40282','40314','40321','40396','40416','40479','40485','40575','40633','40714','40751','40788','40789','40795','40827','40875','40882','40889','40925','40985','41040','41132','41306','41542','41589','41696','41720','41901','42000','42143','42243','42347','42408','42491','42550','42628','42665','42696','42707','42782','42823','42844','42848','42954','42957','43116','43163','43165','43174','43351','43385','43436','43451','43698','43868','43982','43985','44069','44253','44403','44861','44926','45201','45340','45374','45587','45653','45814','45906','45948','46293','46434','46621','46691','46700','46900','47092','47462','47586','47617','47681','47867','48034','48081','48146','48207','48518','48722','48796','48942','48943','49202','49221','49381','49530','49569','49576','49606','49745','49887','49998','50298','50471','50951','51064','51326','51603','52324','52383','52422','53196','53486','53546','53754','53864','53951','54118','54314','54389','54568','54590','54635','54706','54742','54794','55072','55073','55092','55336','55405','55547','55685','55821','55931','55956','56128','56132','56218','56388','56454','56466','56614','56738','57042','57052','57206','57219','57442','57501','57516','57523','57701','57727','57756','57809','58280','58287','58294','58479','58625','58735','59082','59083','59165','59542','59578','59775','59819','59938','60343','60448','60551','60604','60633','60743','61200','61202','61246','61293','61491','61652','61721','61872','61903','61918','61947','61969','61978','62056','62114','62142','62147','62423','62534','62589','62612','62679','62887','62973','63084','63190','63286','63300','63545','63588','63810','63894','64184','64195','64230','64419','64452','64584','64909','64920','65043','65658','65698','65843','65898','65952','66218','66256','66308','66340','66358','66368','66385','66444','66498','66571','66584','66593','66625','66816','66867','66874','66889','66890','66897','66944','67049','67067','67081','67173','67204','67390','67392','67404','67412','67566','67860','67908','67939','68014','68062','68099','68102','68112','68127','68133','68182','68184','68238','68307','68911','68968','69008','69009','69010','69022','69023','69144','69197','69215','69452','69512','69673','69674','69714','69789','69840','69855','70047','70230','70374','70419','70479','70498','70555','70620','70733','70756','70797','70973','71126','71157','71200','71204','71225','71230','71233','71252','71256','71296','71316','71335','71387','71483','71489','71490','71492','71506','71512','71518','71560','71603','71607','71782','71783','71878','71897','71941','71948','71951','71960','72152','72154','72202','72218','72272','72302','72307','72346','72358','72365','72487','72507','72513','72532','72634','72739','72741','72900','72920','72982','73014','73016','73084','73188','73195','73197','73204','73408','73410','73415','73444','73452','73552','73554','73557','73559','73560','73563','73567','73570','73572','73582','73616','73618','73628','73629','73636','73639','73641','73643','73644','73786','73787','73788','73936','73938','73939','73941','73951','73952','73997','73999','74000','74020','74025','74026','74029','74047','74048','74106','74110','74171','74175','74270','74276','74298','74329','74343','74345','74391','74398','74602','74675','74689','74697','74760','74781','74782','74917','74959','74992','74993','75013','75019','75079','75087','75210','75222','75224','75360','75381','75382','75383','75632','75641','75648','75660','75704','75705','75707','75752','75755','75756','75757','75850','75870','75897','75938','75996','75999','76001','76004','76006','76007','76010','76036','76038','76040','76041','76042','76044','76045','76046','76058','76060','76063','76070','76071','76072','76093','76097','76162','76163','76207','76213','76219','76220','76221','76263','76291','76295','76296','76300','76314','76316','76318','76338','76339','76412','76559','76569','76591','76654','76739','76745','76747','76751','76753','76775','76804','76822','76824','76826','76828','76838','76840','76857','76860','76861','76910','76912','76917','76936','76953','76956','76959','76973','76975','76977','77047','77057','77062','77072','77081','77082','77084','77092','77093','77095','77097','77100','77101','77102','77103','77104','77105','77106','77108','77111','77112','77114','77115','77116','77118','77120','77153','77157','77172','77176','77200','77203','77236','77237','77239','77245','77252','77265','77281','77282','77287','77288','77289','77293','77295','77323','77326','77330','77351','77357','77366','77369','77381','77395','77407','77408','77410','77412','77416','77469','77474','77475','77476','77481','77538','77546','77547','77548','77549','77561','77574','77638','77650','77654','77658','77660','77666','77763','77770','77794','77813','77815','77818','77866','77869','77881','77915','77936','78011','78022','78033','78042','78057','78064','78077','78084','78086','78110','78113','78117','78175','78177','78178','78185','78189','78191','78202','78252','78258','78309','78337','78346','78356','78372','78377','78381','78386','78388','78393','78398','78465','78468','78469','78470','78471','78472','78473','78474','78475','78509','78521','78560','78561','78567','78571','78572','78577','78605','78613','78618','78624','78655','78683','78709','78712','78716','78721','78724','78746','78844','78873','78901','78912','78917','78947','78950','78952','78971','78972','78984','79004','79024','79042','79060','79077','79083','79085','79101','79104','79108','79110','79129','79141','79151','79156','79160','79166','79167','79199','79200','79202','79210','79248','79250','79266','79288','79293','79307','79312','79316','79322','79329','79368','79386','79475','79487','79497','79498','79506','79509','79513','79533','79537','79539','79546','79571','79575','79576','79615','79623','79648','79656','79663','79702','79711','79718','79723','79735','79740','79748','79754','79756','79762','79764','79792','79801','79834','79835','79849','79863','79883','79889','79893','79907','79965','79967','79996','80031','80034','80035','80037','80050','80064','80072','80080','80081','80098','80108','80112','80126','80173','80174','80178','80184','80202','80211','80221','80222','80228','80237','80241','80243','80290','80293','80310','80312','80314','80320','80323','80328','80373','80382','80383','80399','80418','80419','80427','80448','80451','80455','80459','80467','80477','80482','80513','80514','80526','80582','80584','80592','80593','80597','80606','80610','80618','80621','80638','80640','80647','80649','80652','80689','80692','80700','80705','80708','80730','80740','80762','80766','80787','80788','80805','80818','80821','80826','80828','80829','80835','80837','80838','80895','80901','80909','80912','80919','80922','80983','80985','80988','80989','80990','80992','81005','81011','81017','81023','81033','81036','81039','81041','81065','81068','81070','81075','81085','81118','81124','81131','81142','81148','81162','81174','81188','81193','81199','81200','81206','81269','81270','81272','81302','81321','81325','81331','81332','81365','81367','81369','81372','81374','81376','81387','81410','81418','81426','81467','81496','81498','81499','81500','81502','81504','81510','81567','81583','81587','81592','81595','81608','81610','81612','81620','81659','81699','81701','81702','81742','81743','81746','81751','81752','81754','81758','81759','81770','81772','81782','81785','81793','81796','81798','81860','81861','81864','81869','81896','81909','81911','81913','81915','81917','81924','81926','81928','81929','81955','81956','81975','81987','81988','81990','82020','82033','82034','82045','82048','82096','82100','82102','82129','82140','82144','82250','82373','85454','85559','85744','85792','85831','85834','85854','85925','85928','86021','86200','86438','86447','86585','86870','87043','87472','87544','87684','87729','88015','88085','88180','88208','88304','88325','88515','90070','90470','90498','90511','90530','90564','90668','90961','90993','91051','91427','91542','91581','91647','91861','91982','92034','92072','92190','92279','92350','92373','92386','92404','92581','92602','92655','92851','93101','93145','93560','93830','93956','94201','94303','94348','94541','94788','94831','94872','94942','94963','95014','95041','95164','95216','95243','95409','95414','95456','95494','95688','95704','95713','95808','96121','96351','96367','96548','96574','96677','96874','96913','96936','97000','97144','97321','97447','97567','97731','97887','98052','98136','98186','98237','98263','98330','98391','98435','98512','98551','98712','98774','99122','99196','99246','99535','99564','99615','99664','99700','100006','100116','100149','100271','100384','101237','101353','101575','101676','101849','102022','102163','102188','102216','102314','103529','103864','103876','103986','104430','104500','105416','106047','106235','106279','106291','106362','106474','106510','106542','106940','106982','107296','107565','107605','107708','108027','108054','108095','108173','108233','108422','108514','109105','109541','109730','109771','111420','111675','112004','112072','112073','112081','112117','112119','112122','112126','112127','112128','112132','112134','112139','112141','112146','112147','112149','112151','112152','112154','112156','112157','112158','112160','112197','112198','112200','112203','112204','112209','112232','112293','112296','112315','112332','112335','112337','112348','112396','112400','112417','112424','112430','112476','112491','112504','112697','112939','113187','114125','114470','114884','115243','115457','115501','118124','118355','120992','121092','121108','121504','121724','122330','123192','123453','123521','123526','123527','123530','123532','123553','123588','123662','123664','123681','123682','123684','123685','123686','123713','123938','123946','123964','124054','124074','124076','124200','124265','124268','124398','124440','124482','124483','124484','124485','124486','124489','124490','124500','124558','124793','124794','124796','124819','124843','124844','124870','124872','124884','124897','124903','124932','124940','124941','124948','124949','125084','125087','125095','125097','125109','125405','125541','126376','126474','126500','126671','127716','126700','126728','126785','126809','126811','126997','127186','127318','127369','127370','127516','127672','127853','128078','128186','128409','128504','128508','128520','128819','128951','128986','129294','129899','130130','130645','131117','131165','131172','131335','131593','131646','131660','131813','132270','132275','132388','132530','133033','133191','133283','133292','133646','133669','133794','134384','134594','134617','134631','134834','134870','134981','134995','135492','135769','135829','136271','136799','137209','137304','138539','139106','139107','139108','139111','139125','139154','139158','139197','139246','139247','139248','139272','139293','139374','139378','139435','139494','139517','139518','139560','139641','139654','139670','139695','139710','139724','139731','139829','139835','139842','139864','139872','139878','139884','139935','139942','139976','139977','139978','139979','139991','140021','140022','140024','140025','140026','140027','140028','140588','140742','141285','141305','141394','141577','141580','142180','142218','142327','142823','142961','143100','143231','143681','144535','144539','144547','144773','144782','144981','145108','146359','146435','146676','147197','147209','147272','147369','147590','147925','148022','148101','149729','150758','151643','152317','153297','155586','155807','156945','157014','157133','157308','157326','157751','157756','157965','158436','158558','159582','160314','160497','160668','161343','163751','')
       group by tmp_userid ) t
where t.tmp_userid = candidate.tmp_userid

-- backup current owner to tmp_candidate_owner_json_old
alter table candidate add column tmp_candidate_owner_json_old text
update candidate set tmp_candidate_owner_json_old = candidate_owner_json

--update new owner
update candidate set candidate_owner_json = replace(tmp_candidate_owner_json,',]',']')
--where id = 197274 --97731
where tmp_userid in ('97731','97887','98052','10216','10371','10478','10532','10556','10609','10647','10922','11180','11391','11570','11768','11959','11990','12053','12150','12167','12285','12286','12406','12417','12429','12552','12650','12818','12879','12941','13044','13089','13217','13255','13601','13645','13656','13690','13703','13938','13999','14030','14235','14309','14379','14470','14600','14619','14732','15221','15306','15318','15374','15396','15408','15420','15594','15624','15879','15942','15966','15968','16118','16148','16366','16657','16668','16756','17161','17166','17258','17459','17484','17581','17758','17864','18008','18053','18276','18489','18615','18643','18832','18835','18853','18926','19294','19323','19495','19497','19530','19617','19653','19681','19745','19769','19812','19862','19944','19978','20049','20107','20133','20142','20371','20384','20388','20425','20450','20523','20532','20596','20627','20695','20750','20866','20867','20983','21100','21171','21464','21477','21584','21646','21679','21713','21929','21937','21941','22061','22226','22261','22281','22299','22321','22624','22731','22786','22966','23079','23118','23158','23213','23289','23322','23371','23541','23566','23708','23748','23844','23873','24127','24585','24616','24675','24701','24712','24826','24853','24904','24947','24951','24953','24986','25001','25012','25065','25197','25215','25235','25241','25261','25267','25513','25741','25752','25931','26056','26135','26240','26244','26394','26396','26518','26575','26641','26708','26725','26911','27139','27362','27603','27611','27725','27798','28003','28015','28027','28173','28404','28413','28414','28448','28497','28514','28699','28704','28707','28734','28747','28754','28799','28938','29192','29332','29370','29505','29541','29569','29610','29630','29637','29663','29726','29981','30017','30080','30141','30207','30221','30230','30237','30270','30334','30349','30364','30381','30441','30586','30707','30776','31043','31054','31087','31589','31664','31733','31839','31852','32076','32136','32296','32575','32592','32608','32613','32685','32689','32757','32816','32839','33088','33123','33320','33395','33400','33587','33718','33778','33958','34013','34035','34063','34091','34174','34494','34657','34737','34752','34812','34824','34844','34902','34963','35032','35044','35107','35247','35286','35392','35718','35814','35817','35828','35838','35947','36004','36041','36045','36229','36427','36650','36661','36748','36781','36811','37011','37075','37172','37229','37291','37337','37425','37519','37559','37719','37917','37929','37969','37990','38590','38606','38674','38738','38779','38849','38895','39064','39075','39158','39202','39225','39317','39325','39514','39548','39550','39565','39709','39739','39837','39979','40240','40274','40282','40314','40321','40396','40416','40479','40485','40575','40633','40714','40751','40788','40789','40795','40827','40875','40882','40889','40925','40985','41040','41132','41306','41542','41589','41696','41720','41901','42000','42143','42243','42347','42408','42491','42550','42628','42665','42696','42707','42782','42823','42844','42848','42954','42957','43116','43163','43165','43174','43351','43385','43436','43451','43698','43868','43982','43985','44069','44253','44403','44861','44926','45201','45340','45374','45587','45653','45814','45906','45948','46293','46434','46621','46691','46700','46900','47092','47462','47586','47617','47681','47867','48034','48081','48146','48207','48518','48722','48796','48942','48943','49202','49221','49381','49530','49569','49576','49606','49745','49887','49998','50298','50471','50951','51064','51326','51603','52324','52383','52422','53196','53486','53546','53754','53864','53951','54118','54314','54389','54568','54590','54635','54706','54742','54794','55072','55073','55092','55336','55405','55547','55685','55821','55931','55956','56128','56132','56218','56388','56454','56466','56614','56738','57042','57052','57206','57219','57442','57501','57516','57523','57701','57727','57756','57809','58280','58287','58294','58479','58625','58735','59082','59083','59165','59542','59578','59775','59819','59938','60343','60448','60551','60604','60633','60743','61200','61202','61246','61293','61491','61652','61721','61872','61903','61918','61947','61969','61978','62056','62114','62142','62147','62423','62534','62589','62612','62679','62887','62973','63084','63190','63286','63300','63545','63588','63810','63894','64184','64195','64230','64419','64452','64584','64909','64920','65043','65658','65698','65843','65898','65952','66218','66256','66308','66340','66358','66368','66385','66444','66498','66571','66584','66593','66625','66816','66867','66874','66889','66890','66897','66944','67049','67067','67081','67173','67204','67390','67392','67404','67412','67566','67860','67908','67939','68014','68062','68099','68102','68112','68127','68133','68182','68184','68238','68307','68911','68968','69008','69009','69010','69022','69023','69144','69197','69215','69452','69512','69673','69674','69714','69789','69840','69855','70047','70230','70374','70419','70479','70498','70555','70620','70733','70756','70797','70973','71126','71157','71200','71204','71225','71230','71233','71252','71256','71296','71316','71335','71387','71483','71489','71490','71492','71506','71512','71518','71560','71603','71607','71782','71783','71878','71897','71941','71948','71951','71960','72152','72154','72202','72218','72272','72302','72307','72346','72358','72365','72487','72507','72513','72532','72634','72739','72741','72900','72920','72982','73014','73016','73084','73188','73195','73197','73204','73408','73410','73415','73444','73452','73552','73554','73557','73559','73560','73563','73567','73570','73572','73582','73616','73618','73628','73629','73636','73639','73641','73643','73644','73786','73787','73788','73936','73938','73939','73941','73951','73952','73997','73999','74000','74020','74025','74026','74029','74047','74048','74106','74110','74171','74175','74270','74276','74298','74329','74343','74345','74391','74398','74602','74675','74689','74697','74760','74781','74782','74917','74959','74992','74993','75013','75019','75079','75087','75210','75222','75224','75360','75381','75382','75383','75632','75641','75648','75660','75704','75705','75707','75752','75755','75756','75757','75850','75870','75897','75938','75996','75999','76001','76004','76006','76007','76010','76036','76038','76040','76041','76042','76044','76045','76046','76058','76060','76063','76070','76071','76072','76093','76097','76162','76163','76207','76213','76219','76220','76221','76263','76291','76295','76296','76300','76314','76316','76318','76338','76339','76412','76559','76569','76591','76654','76739','76745','76747','76751','76753','76775','76804','76822','76824','76826','76828','76838','76840','76857','76860','76861','76910','76912','76917','76936','76953','76956','76959','76973','76975','76977','77047','77057','77062','77072','77081','77082','77084','77092','77093','77095','77097','77100','77101','77102','77103','77104','77105','77106','77108','77111','77112','77114','77115','77116','77118','77120','77153','77157','77172','77176','77200','77203','77236','77237','77239','77245','77252','77265','77281','77282','77287','77288','77289','77293','77295','77323','77326','77330','77351','77357','77366','77369','77381','77395','77407','77408','77410','77412','77416','77469','77474','77475','77476','77481','77538','77546','77547','77548','77549','77561','77574','77638','77650','77654','77658','77660','77666','77763','77770','77794','77813','77815','77818','77866','77869','77881','77915','77936','78011','78022','78033','78042','78057','78064','78077','78084','78086','78110','78113','78117','78175','78177','78178','78185','78189','78191','78202','78252','78258','78309','78337','78346','78356','78372','78377','78381','78386','78388','78393','78398','78465','78468','78469','78470','78471','78472','78473','78474','78475','78509','78521','78560','78561','78567','78571','78572','78577','78605','78613','78618','78624','78655','78683','78709','78712','78716','78721','78724','78746','78844','78873','78901','78912','78917','78947','78950','78952','78971','78972','78984','79004','79024','79042','79060','79077','79083','79085','79101','79104','79108','79110','79129','79141','79151','79156','79160','79166','79167','79199','79200','79202','79210','79248','79250','79266','79288','79293','79307','79312','79316','79322','79329','79368','79386','79475','79487','79497','79498','79506','79509','79513','79533','79537','79539','79546','79571','79575','79576','79615','79623','79648','79656','79663','79702','79711','79718','79723','79735','79740','79748','79754','79756','79762','79764','79792','79801','79834','79835','79849','79863','79883','79889','79893','79907','79965','79967','79996','80031','80034','80035','80037','80050','80064','80072','80080','80081','80098','80108','80112','80126','80173','80174','80178','80184','80202','80211','80221','80222','80228','80237','80241','80243','80290','80293','80310','80312','80314','80320','80323','80328','80373','80382','80383','80399','80418','80419','80427','80448','80451','80455','80459','80467','80477','80482','80513','80514','80526','80582','80584','80592','80593','80597','80606','80610','80618','80621','80638','80640','80647','80649','80652','80689','80692','80700','80705','80708','80730','80740','80762','80766','80787','80788','80805','80818','80821','80826','80828','80829','80835','80837','80838','80895','80901','80909','80912','80919','80922','80983','80985','80988','80989','80990','80992','81005','81011','81017','81023','81033','81036','81039','81041','81065','81068','81070','81075','81085','81118','81124','81131','81142','81148','81162','81174','81188','81193','81199','81200','81206','81269','81270','81272','81302','81321','81325','81331','81332','81365','81367','81369','81372','81374','81376','81387','81410','81418','81426','81467','81496','81498','81499','81500','81502','81504','81510','81567','81583','81587','81592','81595','81608','81610','81612','81620','81659','81699','81701','81702','81742','81743','81746','81751','81752','81754','81758','81759','81770','81772','81782','81785','81793','81796','81798','81860','81861','81864','81869','81896','81909','81911','81913','81915','81917','81924','81926','81928','81929','81955','81956','81975','81987','81988','81990','82020','82033','82034','82045','82048','82096','82100','82102','82129','82140','82144','82250','82373','85454','85559','85744','85792','85831','85834','85854','85925','85928','86021','86200','86438','86447','86585','86870','87043','87472','87544','87684','87729','88015','88085','88180','88208','88304','88325','88515','90070','90470','90498','90511','90530','90564','90668','90961','90993','91051','91427','91542','91581','91647','91861','91982','92034','92072','92190','92279','92350','92373','92386','92404','92581','92602','92655','92851','93101','93145','93560','93830','93956','94201','94303','94348','94541','94788','94831','94872','94942','94963','95014','95041','95164','95216','95243','95409','95414','95456','95494','95688','95704','95713','95808','96121','96351','96367','96548','96574','96677','96874','96913','96936','97000','97144','97321','97447','97567','97731','97887','98052','98136','98186','98237','98263','98330','98391','98435','98512','98551','98712','98774','99122','99196','99246','99535','99564','99615','99664','99700','100006','100116','100149','100271','100384','101237','101353','101575','101676','101849','102022','102163','102188','102216','102314','103529','103864','103876','103986','104430','104500','105416','106047','106235','106279','106291','106362','106474','106510','106542','106940','106982','107296','107565','107605','107708','108027','108054','108095','108173','108233','108422','108514','109105','109541','109730','109771','111420','111675','112004','112072','112073','112081','112117','112119','112122','112126','112127','112128','112132','112134','112139','112141','112146','112147','112149','112151','112152','112154','112156','112157','112158','112160','112197','112198','112200','112203','112204','112209','112232','112293','112296','112315','112332','112335','112337','112348','112396','112400','112417','112424','112430','112476','112491','112504','112697','112939','113187','114125','114470','114884','115243','115457','115501','118124','118355','120992','121092','121108','121504','121724','122330','123192','123453','123521','123526','123527','123530','123532','123553','123588','123662','123664','123681','123682','123684','123685','123686','123713','123938','123946','123964','124054','124074','124076','124200','124265','124268','124398','124440','124482','124483','124484','124485','124486','124489','124490','124500','124558','124793','124794','124796','124819','124843','124844','124870','124872','124884','124897','124903','124932','124940','124941','124948','124949','125084','125087','125095','125097','125109','125405','125541','126376','126474','126500','126671','127716','126700','126728','126785','126809','126811','126997','127186','127318','127369','127370','127516','127672','127853','128078','128186','128409','128504','128508','128520','128819','128951','128986','129294','129899','130130','130645','131117','131165','131172','131335','131593','131646','131660','131813','132270','132275','132388','132530','133033','133191','133283','133292','133646','133669','133794','134384','134594','134617','134631','134834','134870','134981','134995','135492','135769','135829','136271','136799','137209','137304','138539','139106','139107','139108','139111','139125','139154','139158','139197','139246','139247','139248','139272','139293','139374','139378','139435','139494','139517','139518','139560','139641','139654','139670','139695','139710','139724','139731','139829','139835','139842','139864','139872','139878','139884','139935','139942','139976','139977','139978','139979','139991','140021','140022','140024','140025','140026','140027','140028','140588','140742','141285','141305','141394','141577','141580','142180','142218','142327','142823','142961','143100','143231','143681','144535','144539','144547','144773','144782','144981','145108','146359','146435','146676','147197','147209','147272','147369','147590','147925','148022','148101','149729','150758','151643','152317','153297','155586','155807','156945','157014','157133','157308','157326','157751','157756','157965','158436','158558','159582','160314','160497','160668','161343','163751','')

select    can.id as ID, can.insert_timestamp, can.tmp_userid, can.external_id
        , can.first_name as FirstName, middle_name as MiddleName, can.last_name as LastName, can.candidate_owner_json, tmp_candidate_owner_json
from candidate can
where tmp_userid in ('97731','97887','98052','10216','10371','10478','10532','10556','10609','10647','10922','11180','11391','11570','11768','11959','11990','12053','12150','12167','12285','12286','12406','12417','12429','12552','12650','12818','12879','12941','13044','13089','13217','13255','13601','13645','13656','13690','13703','13938','13999','14030','14235','14309','14379','14470','14600','14619','14732','15221','15306','15318','15374','15396','15408','15420','15594','15624','15879','15942','15966','15968','16118','16148','16366','16657','16668','16756','17161','17166','17258','17459','17484','17581','17758','17864','18008','18053','18276','18489','18615','18643','18832','18835','18853','18926','19294','19323','19495','19497','19530','19617','19653','19681','19745','19769','19812','19862','19944','19978','20049','20107','20133','20142','20371','20384','20388','20425','20450','20523','20532','20596','20627','20695','20750','20866','20867','20983','21100','21171','21464','21477','21584','21646','21679','21713','21929','21937','21941','22061','22226','22261','22281','22299','22321','22624','22731','22786','22966','23079','23118','23158','23213','23289','23322','23371','23541','23566','23708','23748','23844','23873','24127','24585','24616','24675','24701','24712','24826','24853','24904','24947','24951','24953','24986','25001','25012','25065','25197','25215','25235','25241','25261','25267','25513','25741','25752','25931','26056','26135','26240','26244','26394','26396','26518','26575','26641','26708','26725','26911','27139','27362','27603','27611','27725','27798','28003','28015','28027','28173','28404','28413','28414','28448','28497','28514','28699','28704','28707','28734','28747','28754','28799','28938','29192','29332','29370','29505','29541','29569','29610','29630','29637','29663','29726','29981','30017','30080','30141','30207','30221','30230','30237','30270','30334','30349','30364','30381','30441','30586','30707','30776','31043','31054','31087','31589','31664','31733','31839','31852','32076','32136','32296','32575','32592','32608','32613','32685','32689','32757','32816','32839','33088','33123','33320','33395','33400','33587','33718','33778','33958','34013','34035','34063','34091','34174','34494','34657','34737','34752','34812','34824','34844','34902','34963','35032','35044','35107','35247','35286','35392','35718','35814','35817','35828','35838','35947','36004','36041','36045','36229','36427','36650','36661','36748','36781','36811','37011','37075','37172','37229','37291','37337','37425','37519','37559','37719','37917','37929','37969','37990','38590','38606','38674','38738','38779','38849','38895','39064','39075','39158','39202','39225','39317','39325','39514','39548','39550','39565','39709','39739','39837','39979','40240','40274','40282','40314','40321','40396','40416','40479','40485','40575','40633','40714','40751','40788','40789','40795','40827','40875','40882','40889','40925','40985','41040','41132','41306','41542','41589','41696','41720','41901','42000','42143','42243','42347','42408','42491','42550','42628','42665','42696','42707','42782','42823','42844','42848','42954','42957','43116','43163','43165','43174','43351','43385','43436','43451','43698','43868','43982','43985','44069','44253','44403','44861','44926','45201','45340','45374','45587','45653','45814','45906','45948','46293','46434','46621','46691','46700','46900','47092','47462','47586','47617','47681','47867','48034','48081','48146','48207','48518','48722','48796','48942','48943','49202','49221','49381','49530','49569','49576','49606','49745','49887','49998','50298','50471','50951','51064','51326','51603','52324','52383','52422','53196','53486','53546','53754','53864','53951','54118','54314','54389','54568','54590','54635','54706','54742','54794','55072','55073','55092','55336','55405','55547','55685','55821','55931','55956','56128','56132','56218','56388','56454','56466','56614','56738','57042','57052','57206','57219','57442','57501','57516','57523','57701','57727','57756','57809','58280','58287','58294','58479','58625','58735','59082','59083','59165','59542','59578','59775','59819','59938','60343','60448','60551','60604','60633','60743','61200','61202','61246','61293','61491','61652','61721','61872','61903','61918','61947','61969','61978','62056','62114','62142','62147','62423','62534','62589','62612','62679','62887','62973','63084','63190','63286','63300','63545','63588','63810','63894','64184','64195','64230','64419','64452','64584','64909','64920','65043','65658','65698','65843','65898','65952','66218','66256','66308','66340','66358','66368','66385','66444','66498','66571','66584','66593','66625','66816','66867','66874','66889','66890','66897','66944','67049','67067','67081','67173','67204','67390','67392','67404','67412','67566','67860','67908','67939','68014','68062','68099','68102','68112','68127','68133','68182','68184','68238','68307','68911','68968','69008','69009','69010','69022','69023','69144','69197','69215','69452','69512','69673','69674','69714','69789','69840','69855','70047','70230','70374','70419','70479','70498','70555','70620','70733','70756','70797','70973','71126','71157','71200','71204','71225','71230','71233','71252','71256','71296','71316','71335','71387','71483','71489','71490','71492','71506','71512','71518','71560','71603','71607','71782','71783','71878','71897','71941','71948','71951','71960','72152','72154','72202','72218','72272','72302','72307','72346','72358','72365','72487','72507','72513','72532','72634','72739','72741','72900','72920','72982','73014','73016','73084','73188','73195','73197','73204','73408','73410','73415','73444','73452','73552','73554','73557','73559','73560','73563','73567','73570','73572','73582','73616','73618','73628','73629','73636','73639','73641','73643','73644','73786','73787','73788','73936','73938','73939','73941','73951','73952','73997','73999','74000','74020','74025','74026','74029','74047','74048','74106','74110','74171','74175','74270','74276','74298','74329','74343','74345','74391','74398','74602','74675','74689','74697','74760','74781','74782','74917','74959','74992','74993','75013','75019','75079','75087','75210','75222','75224','75360','75381','75382','75383','75632','75641','75648','75660','75704','75705','75707','75752','75755','75756','75757','75850','75870','75897','75938','75996','75999','76001','76004','76006','76007','76010','76036','76038','76040','76041','76042','76044','76045','76046','76058','76060','76063','76070','76071','76072','76093','76097','76162','76163','76207','76213','76219','76220','76221','76263','76291','76295','76296','76300','76314','76316','76318','76338','76339','76412','76559','76569','76591','76654','76739','76745','76747','76751','76753','76775','76804','76822','76824','76826','76828','76838','76840','76857','76860','76861','76910','76912','76917','76936','76953','76956','76959','76973','76975','76977','77047','77057','77062','77072','77081','77082','77084','77092','77093','77095','77097','77100','77101','77102','77103','77104','77105','77106','77108','77111','77112','77114','77115','77116','77118','77120','77153','77157','77172','77176','77200','77203','77236','77237','77239','77245','77252','77265','77281','77282','77287','77288','77289','77293','77295','77323','77326','77330','77351','77357','77366','77369','77381','77395','77407','77408','77410','77412','77416','77469','77474','77475','77476','77481','77538','77546','77547','77548','77549','77561','77574','77638','77650','77654','77658','77660','77666','77763','77770','77794','77813','77815','77818','77866','77869','77881','77915','77936','78011','78022','78033','78042','78057','78064','78077','78084','78086','78110','78113','78117','78175','78177','78178','78185','78189','78191','78202','78252','78258','78309','78337','78346','78356','78372','78377','78381','78386','78388','78393','78398','78465','78468','78469','78470','78471','78472','78473','78474','78475','78509','78521','78560','78561','78567','78571','78572','78577','78605','78613','78618','78624','78655','78683','78709','78712','78716','78721','78724','78746','78844','78873','78901','78912','78917','78947','78950','78952','78971','78972','78984','79004','79024','79042','79060','79077','79083','79085','79101','79104','79108','79110','79129','79141','79151','79156','79160','79166','79167','79199','79200','79202','79210','79248','79250','79266','79288','79293','79307','79312','79316','79322','79329','79368','79386','79475','79487','79497','79498','79506','79509','79513','79533','79537','79539','79546','79571','79575','79576','79615','79623','79648','79656','79663','79702','79711','79718','79723','79735','79740','79748','79754','79756','79762','79764','79792','79801','79834','79835','79849','79863','79883','79889','79893','79907','79965','79967','79996','80031','80034','80035','80037','80050','80064','80072','80080','80081','80098','80108','80112','80126','80173','80174','80178','80184','80202','80211','80221','80222','80228','80237','80241','80243','80290','80293','80310','80312','80314','80320','80323','80328','80373','80382','80383','80399','80418','80419','80427','80448','80451','80455','80459','80467','80477','80482','80513','80514','80526','80582','80584','80592','80593','80597','80606','80610','80618','80621','80638','80640','80647','80649','80652','80689','80692','80700','80705','80708','80730','80740','80762','80766','80787','80788','80805','80818','80821','80826','80828','80829','80835','80837','80838','80895','80901','80909','80912','80919','80922','80983','80985','80988','80989','80990','80992','81005','81011','81017','81023','81033','81036','81039','81041','81065','81068','81070','81075','81085','81118','81124','81131','81142','81148','81162','81174','81188','81193','81199','81200','81206','81269','81270','81272','81302','81321','81325','81331','81332','81365','81367','81369','81372','81374','81376','81387','81410','81418','81426','81467','81496','81498','81499','81500','81502','81504','81510','81567','81583','81587','81592','81595','81608','81610','81612','81620','81659','81699','81701','81702','81742','81743','81746','81751','81752','81754','81758','81759','81770','81772','81782','81785','81793','81796','81798','81860','81861','81864','81869','81896','81909','81911','81913','81915','81917','81924','81926','81928','81929','81955','81956','81975','81987','81988','81990','82020','82033','82034','82045','82048','82096','82100','82102','82129','82140','82144','82250','82373','85454','85559','85744','85792','85831','85834','85854','85925','85928','86021','86200','86438','86447','86585','86870','87043','87472','87544','87684','87729','88015','88085','88180','88208','88304','88325','88515','90070','90470','90498','90511','90530','90564','90668','90961','90993','91051','91427','91542','91581','91647','91861','91982','92034','92072','92190','92279','92350','92373','92386','92404','92581','92602','92655','92851','93101','93145','93560','93830','93956','94201','94303','94348','94541','94788','94831','94872','94942','94963','95014','95041','95164','95216','95243','95409','95414','95456','95494','95688','95704','95713','95808','96121','96351','96367','96548','96574','96677','96874','96913','96936','97000','97144','97321','97447','97567','97731','97887','98052','98136','98186','98237','98263','98330','98391','98435','98512','98551','98712','98774','99122','99196','99246','99535','99564','99615','99664','99700','100006','100116','100149','100271','100384','101237','101353','101575','101676','101849','102022','102163','102188','102216','102314','103529','103864','103876','103986','104430','104500','105416','106047','106235','106279','106291','106362','106474','106510','106542','106940','106982','107296','107565','107605','107708','108027','108054','108095','108173','108233','108422','108514','109105','109541','109730','109771','111420','111675','112004','112072','112073','112081','112117','112119','112122','112126','112127','112128','112132','112134','112139','112141','112146','112147','112149','112151','112152','112154','112156','112157','112158','112160','112197','112198','112200','112203','112204','112209','112232','112293','112296','112315','112332','112335','112337','112348','112396','112400','112417','112424','112430','112476','112491','112504','112697','112939','113187','114125','114470','114884','115243','115457','115501','118124','118355','120992','121092','121108','121504','121724','122330','123192','123453','123521','123526','123527','123530','123532','123553','123588','123662','123664','123681','123682','123684','123685','123686','123713','123938','123946','123964','124054','124074','124076','124200','124265','124268','124398','124440','124482','124483','124484','124485','124486','124489','124490','124500','124558','124793','124794','124796','124819','124843','124844','124870','124872','124884','124897','124903','124932','124940','124941','124948','124949','125084','125087','125095','125097','125109','125405','125541','126376','126474','126500','126671','127716','126700','126728','126785','126809','126811','126997','127186','127318','127369','127370','127516','127672','127853','128078','128186','128409','128504','128508','128520','128819','128951','128986','129294','129899','130130','130645','131117','131165','131172','131335','131593','131646','131660','131813','132270','132275','132388','132530','133033','133191','133283','133292','133646','133669','133794','134384','134594','134617','134631','134834','134870','134981','134995','135492','135769','135829','136271','136799','137209','137304','138539','139106','139107','139108','139111','139125','139154','139158','139197','139246','139247','139248','139272','139293','139374','139378','139435','139494','139517','139518','139560','139641','139654','139670','139695','139710','139724','139731','139829','139835','139842','139864','139872','139878','139884','139935','139942','139976','139977','139978','139979','139991','140021','140022','140024','140025','140026','140027','140028','140588','140742','141285','141305','141394','141577','141580','142180','142218','142327','142823','142961','143100','143231','143681','144535','144539','144547','144773','144782','144981','145108','146359','146435','146676','147197','147209','147272','147369','147590','147925','148022','148101','149729','150758','151643','152317','153297','155586','155807','156945','157014','157133','157308','157326','157751','157756','157965','158436','158558','159582','160314','160497','160668','161343','163751','')




--alter table candidate add column tmp_userid varchar(100);
select     can.id as ID, can.insert_timestamp, can.tmp_userid, can.external_id
        , can.first_name as FirstName, middle_name as MiddleName, can.last_name as LastName, can.candidate_owner_json
        , can.email, can.email2, can.work_email as WorkEmail
        , can.note as Note
        , phone as PrimaryPhone , phone2 as Mobile, work_phone as WorkPhone, home_phone as HomePhone--, preferred_phone, preferred_mobile_phone, preferred_work_phone, preferred_home_phone
        , desired_job_type_json
        , edu_details_json --, edu_details_json::json->0->>'schoolName' as SchoolName, edu_details_json::json->0->>'institutionName' as InstitutionName, edu_details_json::json->0->>'degreeName' as DegreeName, edu_details_json::json->0->>'course' as Course, edu_details_json::json->0->>'major' as Major
        , ind.name as industry
        , fe.name as FunctionalExpertise --, sfe.name as sfe
        , experience as WorkHistory --,experience_details_json::json->0->>'currentEmployer' as currentEmployer, experience_details_json::json->0->>'jobTitle' as jobTitle
        , can.experience_details_json --, can.experience_details_json::json->0->>'jobTitle' as jobTitle, can.experience_details_json::json->0->>'currentEmployer' as currentEmployer
        , doc.uploaded_filename
-- select count(*) -- 66942-- select * -- select distinct linked_in_profile
from candidate can
--left join email_all e on e.id = can.id
--left join common_location cl on cl.id = can.current_location_id
left join (select ci.candidate_id, string_agg(v.name, ', ') as name from candidate_industry ci left join vertical v on ci.vertical_id = v.id GROUP BY ci.candidate_id) ind on ind.candidate_id = can.id
left join candidate_source cs on cs.id = can.candidate_source_id
left join (select can.id, string_agg(distinct (fe.name), ', ') as name --FunctionalExpertise
                from candidate can
                left join candidate_functional_expertise cfe on cfe.candidate_id = can.id
                left join functional_expertise fe on fe.id = cfe.functional_expertise_id
                where fe.name is not null GROUP BY can.id) fe on fe.id = can.id --cfe.functional_expertise_id
left join (select can.id as ID, /*can.external_id, can.first_name as FirstName, can.last_name as LastName,*/ string_agg(distinct (cd.uploaded_filename), ', ') as uploaded_filename
              from candidate can
              left join candidate_document cd on cd.candidate_id = can.id
              where cd.candidate_id is not null --and candidate_id in (152924,152925)
              group by can.id) doc on doc.id = can.id
left join ( SELECT * from earliest where rn = 1) earliest on earliest.id = can.id     
where earliest.id is not null --and can.tmp_userid in ('214676','163663','217788','216988') --('10216','10371','10478','10532','10556','10609','10647','10922','11180','11391','11570','11768','11959','11990','12053','12150','12167','12285','12286','12406','12417','12429','12552','12650','12818','12879','12941','13044','13089','13217','13255','13601','13645','13656','13690','13703','13938','13999','14030','14235','14309','14379','14470','14600','14619','14732','15221','15306','15318','15374','15396','15408','15420','15594','15624','15879','15942','15966','15968','16118','16148','16366','16657','16668','16756','17161','17166','17258','17459','17484','17581','17758','17864','18008','18053','18276','18489','18615','18643','18832','18835','18853','18926','19294','19323','19495','19497','19530','19617','19653','19681','19745','19769','19812','19862','19944','19978','20049','20107','20133','20142','20371','20384','20388','20425','20450','20523','20532','20596','20627','20695','20750','20866','20867','20983','21100','21171','21464','21477','21584','21646','21679','21713','21929','21937','21941','22061','22226','22261','22281','22299','22321','22624','22731','22786','22966','23079','23118','23158','23213','23289','23322','23371','23541','23566','23708','23748','23844','23873','24127','24585','24616','24675','24701','24712','24826','24853','24904','24947','24951','24953','24986','25001','25012','25065','25197','25215','25235','25241','25261','25267','25513','25741','25752','25931','26056','26135','26240','26244','26394','26396','26518','26575','26641','26708','26725','26911','27139','27362','27603','27611','27725','27798','28003','28015','28027','28173','28404','28413','28414','28448','28497','28514','28699','28704','28707','28734','28747','28754','28799','28938','29192','29332','29370','29505','29541','29569','29610','29630','29637','29663','29726','29981','30017','30080','30141','30207','30221','30230','30237','30270','30334','30349','30364','30381','30441','30586','30707','30776','31043','31054','31087','31589','31664','31733','31839','31852','32076','32136','32296','32575','32592','32608','32613','32685','32689','32757','32816','32839','33088','33123','33320','33395','33400','33587','33718','33778','33958','34013','34035','34063','34091','34174','34494','34657','34737','34752','34812','34824','34844','34902','34963','35032','35044','35107','35247','35286','35392','35718','35814','35817','35828','35838','35947','36004','36041','36045','36229','36427','36650','36661','36748','36781','36811','37011','37075','37172','37229','37291','37337','37425','37519','37559','37719','37917','37929','37969','37990','38590','38606','38674','38738','38779','38849','38895','39064','39075','39158','39202','39225','39317','39325','39514','39548','39550','39565','39709','39739','39837','39979','40240','40274','40282','40314','40321','40396','40416','40479','40485','40575','40633','40714','40751','40788','40789','40795','40827','40875','40882','40889','40925','40985','41040','41132','41306','41542','41589','41696','41720','41901','42000','42143','42243','42347','42408','42491','42550','42628','42665','42696','42707','42782','42823','42844','42848','42954','42957','43116','43163','43165','43174','43351','43385','43436','43451','43698','43868','43982','43985','44069','44253','44403','44861','44926','45201','45340','45374','45587','45653','45814','45906','45948','46293','46434','46621','46691','46700','46900','47092','47462','47586','47617','47681','47867','48034','48081','48146','48207','48518','48722','48796','48942','48943','49202','49221','49381','49530','49569','49576','49606','49745','49887','49998','50298','50471','50951','51064','51326','51603','52324','52383','52422','53196','53486','53546','53754','53864','53951','54118','54314','54389','54568','54590','54635','54706','54742','54794','55072','55073','55092','55336','55405','55547','55685','55821','55931','55956','56128','56132','56218','56388','56454','56466','56614','56738','57042','57052','57206','57219','57442','57501','57516','57523','57701','57727','57756','57809','58280','58287','58294','58479','58625','58735','59082','59083','59165','59542','59578','59775','59819','59938','60343','60448','60551','60604','60633','60743','61200','61202','61246','61293','61491','61652','61721','61872','61903','61918','61947','61969','61978','62056','62114','62142','62147','62423','62534','62589','62612','62679','62887','62973','63084','63190','63286','63300','63545','63588','63810','63894','64184','64195','64230','64419','64452','64584','64909','64920','65043','65658','65698','65843','65898','65952','66218','66256','66308','66340','66358','66368','66385','66444','66498','66571','66584','66593','66625','66816','66867','66874','66889','66890','66897','66944','67049','67067','67081','67173','67204','67390','67392','67404','67412','67566','67860','67908','67939','68014','68062','68099','68102','68112','68127','68133','68182','68184','68238','68307','68911','68968','69008','69009','69010','69022','69023','69144','69197','69215','69452','69512','69673','69674','69714','69789','69840','69855','70047','70230','70374','70419','70479','70498','70555','70620','70733','70756','70797','70973','71126','71157','71200','71204','71225','71230','71233','71252','71256','71296','71316','71335','71387','71483','71489','71490','71492','71506','71512','71518','71560','71603','71607','71782','71783','71878','71897','71941','71948','71951','71960','72152','72154','72202','72218','72272','72302','72307','72346','72358','72365','72487','72507','72513','72532','72634','72739','72741','72900','72920','72982','73014','73016','73084','73188','73195','73197','73204','73408','73410','73415','73444','73452','73552','73554','73557','73559','73560','73563','73567','73570','73572','73582','73616','73618','73628','73629','73636','73639','73641','73643','73644','73786','73787','73788','73936','73938','73939','73941','73951','73952','73997','73999','74000','74020','74025','74026','74029','74047','74048','74106','74110','74171','74175','74270','74276','74298','74329','74343','74345','74391','74398','74602','74675','74689','74697','74760','74781','74782','74917','74959','74992','74993','75013','75019','75079','75087','75210','75222','75224','75360','75381','75382','75383','75632','75641','75648','75660','75704','75705','75707','75752','75755','75756','75757','75850','75870','75897','75938','75996','75999','76001','76004','76006','76007','76010','76036','76038','76040','76041','76042','76044','76045','76046','76058','76060','76063','76070','76071','76072','76093','76097','76162','76163','76207','76213','76219','76220','76221','76263','76291','76295','76296','76300','76314','76316','76318','76338','76339','76412','76559','76569','76591','76654','76739','76745','76747','76751','76753','76775','76804','76822','76824','76826','76828','76838','76840','76857','76860','76861','76910','76912','76917','76936','76953','76956','76959','76973','76975','76977','77047','77057','77062','77072','77081','77082','77084','77092','77093','77095','77097','77100','77101','77102','77103','77104','77105','77106','77108','77111','77112','77114','77115','77116','77118','77120','77153','77157','77172','77176','77200','77203','77236','77237','77239','77245','77252','77265','77281','77282','77287','77288','77289','77293','77295','77323','77326','77330','77351','77357','77366','77369','77381','77395','77407','77408','77410','77412','77416','77469','77474','77475','77476','77481','77538','77546','77547','77548','77549','77561','77574','77638','77650','77654','77658','77660','77666','77763','77770','77794','77813','77815','77818','77866','77869','77881','77915','77936','78011','78022','78033','78042','78057','78064','78077','78084','78086','78110','78113','78117','78175','78177','78178','78185','78189','78191','78202','78252','78258','78309','78337','78346','78356','78372','78377','78381','78386','78388','78393','78398','78465','78468','78469','78470','78471','78472','78473','78474','78475','78509','78521','78560','78561','78567','78571','78572','78577','78605','78613','78618','78624','78655','78683','78709','78712','78716','78721','78724','78746','78844','78873','78901','78912','78917','78947','78950','78952','78971','78972','78984','79004','79024','79042','79060','79077','79083','79085','79101','79104','79108','79110','79129','79141','79151','79156','79160','79166','79167','79199','79200','79202','79210','79248','79250','79266','79288','79293','79307','79312','79316','79322','79329','79368','79386','79475','79487','79497','79498','79506','79509','79513','79533','79537','79539','79546','79571','79575','79576','79615','79623','79648','79656','79663','79702','79711','79718','79723','79735','79740','79748','79754','79756','79762','79764','79792','79801','79834','79835','79849','79863','79883','79889','79893','79907','79965','79967','79996','80031','80034','80035','80037','80050','80064','80072','80080','80081','80098','80108','80112','80126','80173','80174','80178','80184','80202','80211','80221','80222','80228','80237','80241','80243','80290','80293','80310','80312','80314','80320','80323','80328','80373','80382','80383','80399','80418','80419','80427','80448','80451','80455','80459','80467','80477','80482','80513','80514','80526','80582','80584','80592','80593','80597','80606','80610','80618','80621','80638','80640','80647','80649','80652','80689','80692','80700','80705','80708','80730','80740','80762','80766','80787','80788','80805','80818','80821','80826','80828','80829','80835','80837','80838','80895','80901','80909','80912','80919','80922','80983','80985','80988','80989','80990','80992','81005','81011','81017','81023','81033','81036','81039','81041','81065','81068','81070','81075','81085','81118','81124','81131','81142','81148','81162','81174','81188','81193','81199','81200','81206','81269','81270','81272','81302','81321','81325','81331','81332','81365','81367','81369','81372','81374','81376','81387','81410','81418','81426','81467','81496','81498','81499','81500','81502','81504','81510','81567','81583','81587','81592','81595','81608','81610','81612','81620','81659','81699','81701','81702','81742','81743','81746','81751','81752','81754','81758','81759','81770','81772','81782','81785','81793','81796','81798','81860','81861','81864','81869','81896','81909','81911','81913','81915','81917','81924','81926','81928','81929','81955','81956','81975','81987','81988','81990','82020','82033','82034','82045','82048','82096','82100','82102','82129','82140','82144','82250','82373','85454','85559','85744','85792','85831','85834','85854','85925','85928','86021','86200','86438','86447','86585','86870','87043','87472','87544','87684','87729','88015','88085','88180','88208','88304','88325','88515','90070','90470','90498','90511','90530','90564','90668','90961','90993','91051','91427','91542','91581','91647','91861','91982','92034','92072','92190','92279','92350','92373','92386','92404','92581','92602','92655','92851','93101','93145','93560','93830','93956','94201','94303','94348','94541','94788','94831','94872','94942','94963','95014','95041','95164','95216','95243','95409','95414','95456','95494','95688','95704','95713','95808','96121','96351','96367','96548','96574','96677','96874','96913','96936','97000','97144','97321','97447','97567','97731','97887','98052','98136','98186','98237','98263','98330','98391','98435','98512','98551','98712','98774','99122','99196','99246','99535','99564','99615','99664','99700','100006','100116','100149','100271','100384','101237','101353','101575','101676','101849','102022','102163','102188','102216','102314','103529','103864','103876','103986','104430','104500','105416','106047','106235','106279','106291','106362','106474','106510','106542','106940','106982','107296','107565','107605','107708','108027','108054','108095','108173','108233','108422','108514','109105','109541','109730','109771','111420','111675','112004','112072','112073','112081','112117','112119','112122','112126','112127','112128','112132','112134','112139','112141','112146','112147','112149','112151','112152','112154','112156','112157','112158','112160','112197','112198','112200','112203','112204','112209','112232','112293','112296','112315','112332','112335','112337','112348','112396','112400','112417','112424','112430','112476','112491','112504','112697','112939','113187','114125','114470','114884','115243','115457','115501','118124','118355','120992','121092','121108','121504','121724','122330','123192','123453','123521','123526','123527','123530','123532','123553','123588','123662','123664','123681','123682','123684','123685','123686','123713','123938','123946','123964','124054','124074','124076','124200','124265','124268','124398','124440','124482','124483','124484','124485','124486','124489','124490','124500','124558','124793','124794','124796','124819','124843','124844','124870','124872','124884','124897','124903','124932','124940','124941','124948','124949','125084','125087','125095','125097','125109','125405','125541','126376','126474','126500','126671','127716','126700','126728','126785','126809','126811','126997','127186','127318','127369','127370','127516','127672','127853','128078','128186','128409','128504','128508','128520','128819','128951','128986','129294','129899','130130','130645','131117','131165','131172','131335','131593','131646','131660','131813','132270','132275','132388','132530','133033','133191','133283','133292','133646','133669','133794','134384','134594','134617','134631','134834','134870','134981','134995','135492','135769','135829','136271','136799','137209','137304','138539','139106','139107','139108','139111','139125','139154','139158','139197','139246','139247','139248','139272','139293','139374','139378','139435','139494','139517','139518','139560','139641','139654','139670','139695','139710','139724','139731','139829','139835','139842','139864','139872','139878','139884','139935','139942','139976','139977','139978','139979','139991','140021','140022','140024','140025','140026','140027','140028','140588','140742','141285','141305','141394','141577','141580','142180','142218','142327','142823','142961','143100','143231','143681','144535','144539','144547','144773','144782','144981','145108','146359','146435','146676','147197','147209','147272','147369','147590','147925','148022','148101','149729','150758','151643','152317','153297','155586','155807','156945','157014','157133','157308','157326','157751','157756','157965','158436','158558','159582','160314','160497','160668','161343','163751','')
--where e.id is not null
--can.id in (91669)
--can.external_id is not null
--and  can.last_name = 'Orbaneja' or can.first_name = 'Miguel' or
--first_name = 'Matthew' and last_name = 'Osborne
--and (can.candidate_owner_json is null or can.candidate_owner_json = '[]')
--can.external_id is not null 
--`can.external_id in ('123240')
--can.email like 'Joellelee_93@hotmail.com%'
--limit 100 


select id ,tmp_userid, insert_timestamp from candidate where tmp_userid in ('97731','97887','98052' over (partition by name, format)
