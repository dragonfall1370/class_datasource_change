/*
with tmp_1(userID, email) as 
(select userID, REPLACE(ISNULL(email,'') + ',' + ISNULL(email2,'') + ',' + ISNULL(email3,''), ',,', ',') as email
from bullhorn1.BH_UserContact
 )
 --select * from tmp_1
 --select userID, email, CHARINDEX(email,',',0) from tmp_1
 , tmp_2(userID, email) as (
select userID, CASE WHEN CHARINDEX(',',email,1) = 1 THEN RIGHT(email, len(email)-1)
	ELSE email END as email
from tmp_1
)
 , tmp_3(userID, email) as (
select userID, CASE WHEN CHARINDEX(',',email,len(email)) = len(email) 
	THEN LEFT(email, CASE WHEN len(email) < 1 THEN 0 ELSE len(email) - 1 END)
	ELSE email END as email
from tmp_2
)

, Note as (
select jobPostingID
, concat('BH Job ID:',JP.jobPostingID,char(10)
, 'Position type: ',JP.type,char(10)
, 'Employment Type: ',JP.employmentType,char(10)
, 'Priority: ',JP.type,char(10)
, iif(JP.salary = '' or JP.salary is NULL,'',concat('Salary: ',JP.salary,char(10)))
, iif(JP.feeArrangement = '' or JP.feeArrangement is NULL,'',concat('Fee arrangement: ',JP.feeArrangement,char(10)))
, iif(JP.publishedCategoryID = '' or JP.publishedCategoryID is NULL,'',concat('Publish Category: ',JP.publishedCategoryID,' - ',CL.occupation,char(10)))
, iif(cast(JP.skills as varchar(max))= '' or JP.skills is NULL,'',concat('Required skills: ',JP.skills,char(10)))
, iif(JP.yearsRequired = '' or JP.yearsRequired is NULL,'',concat('Years required: ',JP.yearsRequired,char(10)))
, iif(CC.address1 = '' or CC.address1 is NULL,'',concat('Company address: ',CC.address1)) 
) as AdditionalNote
from bullhorn1.BH_JobPosting JP
left join bullhorn1.BH_CategoryList CL on JP.publishedCategoryID = CL.categoryID
left join bullhorn1.BH_ClientCorporation CC on JP.clientCorporationID = CC.clientCorporationID)


-- Add placement information under job posting 
, tmp_4 as (select jobPostingID
, concat('Status: ',PL.status,char(10)
, iif(PL.reportTo = '' or PL.reportTo is NULL,'',concat('Report to: ',PL.reportTo,char(10)))
, iif(PL.costCenter = '' or PL.costCenter is NULL,'',concat('Cost Center: ',PL.costCenter,char(10)))
, iif(PL.billingUserID = '' or PL.billingUserID is NULL,'',concat('Billing User: ',PL.billingUserID,' - ',UC.firstName,' ',UC.lastName))
, iif(cast(PL.dateBegin as varchar(10)) = '' or PL.dateBegin is NULL,'',concat('Start Date: ',convert(varchar(10),PL.dateBegin,120),char(10)))
, iif(cast(PL.dateEnd as varchar(10)) = '' or PL.dateEnd is NULL,'',concat('Scheduled End: ',convert(varchar(10),PL.dateBegin,120),char(10)))
, iif(PL.employeeType = '' or PL.employeeType is NULL,'',concat('Employee type: ',PL.employeeType,char(10)))
, iif(PL.fee = '' or PL.fee is NULL,'',concat('Placement Fee(%): ',PL.fee,char(10)))
, iif(PL.daysGuaranteed = '' or PL.daysGuaranteed is NULL,'',concat('Days Guaranteed: ',PL.daysGuaranteed,char(10)))
, iif(PL.daysProRated = '' or PL.daysProRated is NULL,'',concat('Days Pro-Rated: ',PL.daysProRated,char(10)))
, iif(cast(PL.dateClientEffective as varchar(10)) = '' or PL.dateClientEffective is NULL,'',concat('Effective Date: ',convert(varchar(10),PL.dateClientEffective,120),char(10)))
, iif(PL.clientBillRate = '' or PL.clientBillRate is NULL,'',concat('Bill Rate: ',PL.clientBillRate,char(10)))
, iif(PL.payRate = '' or PL.payRate is NULL,'',concat('Pay Rate: ',PL.payRate,char(10)))
, iif(PL.salaryUnit = '' or PL.salaryUnit is NULL,'',concat('Pay Unit: ',PL.salaryUnit,char(10)))
, iif(PL.clientOvertimeRate = '' or PL.clientOvertimeRate is NULL,'',concat('Overtime Bill Rate: ',PL.clientOvertimeRate,char(10)))
, iif(cast(PL.dateEffective as varchar(10)) = '' or PL.dateEffective is NULL,'',concat('Effective Date (pay rate info): ',convert(varchar(10),PL.dateEffective,120),char(10)))
, iif(PL.overtimeRate = '' or PL.overtimeRate is NULL,'',concat('Overtime Pay Rate: ',PL.overtimeRate,char(10)))
, iif(cast(PL.dateAdded as varchar(10)) = '' or PL.dateAdded is NULL,'',concat('Date added: ',convert(varchar(10),PL.dateAdded,120),' | ',PL.comments))
) as PlacementNote
from bullhorn1.BH_Placement PL
left join bullhorn1.BH_UserContact UC on PL.billingUserID = UC.userID)

, PlacementNote (jobPostingID, PlacementNote) as (SELECT
     jobPostingID,
     STUFF(
         (SELECT DISTINCT ' || ' + PlacementNote
          from  tmp_4
          WHERE jobPostingID = a.jobPostingID
          FOR XML PATH (''))
          , 1, 4, '')  AS URLList
FROM tmp_4 as a
GROUP BY a.jobPostingID)
*/

--JOB DUPLICATION REGCONITION
with job (JobNumber,ContactId,JobTitle,startdate,rn) as (
	SELECT  a.JobNumber as JobNumber
		, a.ContactId as ContactId
		, Coalesce(NULLIF(a.JobTitle, ''), 'Job Title') as JobTitle
		, CONVERT(VARCHAR(10),a.startdate,120) as startdate
		, ROW_NUMBER() OVER(PARTITION BY a.ContactId,a.JobTitle,CONVERT(VARCHAR(10),a.startdate,120) ORDER BY a.ContactId) AS rn 
	from vacancies a )
--select * from job

--SELECT top 100
select
	  j.JobNumber as 'position-externalId'
	--, Coalesce(NULLIF(j.ContactId, ''), '99999') as 'position-contactId'
	,Coalesce(cl.ContactId, '99999') as 'position-contactId'
	--, j.JobTitle as 'position-title'
	--, Coalesce(NULLIF(j.JobTitle, ''), 'Job Title') as 'position-title'
	, case when job.rn > 1 then concat(job.JobTitle,' ',rn) else job.JobTitle end as 'position-title'
	
	, owner.email as 'job-owners'
	
	--, j.PermanentJob as 'position-type' -- PERMANENT,INTERIM_PROJECT_CONSULTING,TEMPORARY,CONTRACT,TEMPORARY_TO_PERMANENT
	, case
		when j.PermanentJob is null then 'PERMANENT'
		when j.PermanentJob = '' then  'PERMANENT'
		when j.PermanentJob like '%active%' then 'PERMANENT'
		when j.PermanentJob like '%AD%' then 'PERMANENT'
		when j.PermanentJob like '%AM%' then 'PERMANENT'
		when j.PermanentJob like '%Contract%' then 'CONTRACT'
		when j.PermanentJob like '%Contract - 12 month fixed%' then 'CONTRACT'
		when j.PermanentJob like '%Corp/Finance%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%Financial PR%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%Freelance%' then 'TEMPORARY'
		when j.PermanentJob like '%Med ed%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%Part Time%' then 'TEMPORARY'
		when j.PermanentJob like '%perm%' then 'PERMANENT'
		when j.PermanentJob like '%Permamaent %' then 'PERMANENT'
		when j.PermanentJob like '%Permamant %' then 'PERMANENT'
		when j.PermanentJob like '%Permanent%' then 'PERMANENT'
		when j.PermanentJob like '%PR%' then 'PERMANENT'
		when j.PermanentJob like '%speculative%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%Team Leader%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%Team Member %' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%telesales%' then 'INTERIM_PROJECT_CONSULTING'
		when j.PermanentJob like '%temp to permanent%' then 'TEMPORARY_TO_PERMANENT'
		when j.PermanentJob like '%Temporary%' then 'TEMPORARY'
		when j.PermanentJob like '%writing and account handl%' then 'INTERIM_PROJECT_CONSULTING'
	end as 'position-type'
	
	,  case when (j.FullTimeJob = 'Full Time' or j.FullTimeJob = '' or j.FullTimeJob is null) then 'FULL_TIME'
		when j.FullTimeJob = 'Part Time' then 'PART_TIME' 
		end as 'position-employmentType' --FULL_TIME,PART_TIME,CASUAL
	
	
	, coalesce(NULLIF( CONVERT(VARCHAR(10),j.startdate,120) , '' ), CONVERT(VARCHAR(10),j.regdate,120) ) as 'position-startDate'
	--, case when j.startdate is null then CONVERT(VARCHAR(10),j.regdate,120) else CONVERT(VARCHAR(10),j.startdate,120) end as 'position-startdate'
	--, case when cast(j.JobStatus as nvarchar(max)) in ('Closed','Filled') then (cast(getdate() -1 as nvarchar(max))) else cast(j.JobStatus as nvarchar(max)) end as 'position-enddate'
	, case when j.JobStatus in ('Closed','Filled','Withdrawn') then CONVERT(VARCHAR(10),getdate() - 1,120) else '' end as 'position-enddate'
	
	, Coalesce(NULLIF(j.VacanciesCount, ''), '1') as 'position-headcount'
	
	, j.Salary1 as 'position-actualSalary'
	, left(cast(j.VacancyDetails as varchar(max)),32000) as 'position-publicDescription'
	--, left(cast(j.description as varchar(max)),32000) as 'position-internalDescription'

	
	, at.filename as 'position-document'
	
	, concat (
		  case when (j.VacancyId = '' OR j.VacancyId is NULL) THEN '' ELSE concat ('Job Id: ',j.VacancyId,char(10)) END
		, case when (j.VacancyType = '' OR j.VacancyType is NULL) THEN '' ELSE concat ('Job Type: ',j.VacancyType,char(10)) END
		, Coalesce('Job Status: ' + NULLIF(j.JobStatus, '') + char(10), '')
		, Coalesce('Job Owner: ' + NULLIF(j.UserName, '') + char(10), '')
		, case when (j.CompanyId = '' OR j.CompanyId is NULL) THEN '' ELSE concat ('CompanyId: ',j.CompanyId,char(10)) END
		, Coalesce('Company Name: ' + NULLIF(j.Company, '') + char(10), '')  
                , Coalesce('Contact Name: ' + NULLIF(j.DisplayName, '') + char(10), '')
		, case when (j.Department = '' OR j.Department is NULL) THEN '' ELSE concat ('Department: ',j.Department,char(10)) END
		, 'Contact Phone: ' + ltrim(Stuff( Coalesce(' ' + NULLIF(CL.DirectTel, ''), '')
                        + Coalesce(', ' + NULLIF(CL.MobileTel, ''), '')
                        + Coalesce(', ' + NULLIF(CL.WorkTel, ''), '')
                        + Coalesce(', ' + NULLIF(CL.HomeTel, ''), '')
                        , 1, 1, '') ) + char(10)
		, case when (j.Location = '' OR j.Location is NULL) THEN '' ELSE concat ('Location: ',j.Location,char(10)) END
		, case when (j.SubLocation = '' OR j.SubLocation is NULL) THEN '' ELSE concat ('SubLocation: ',j.SubLocation,char(10)) END
		, case when (j.Postcode = '' OR j.Postcode is NULL) THEN '' ELSE concat ('Postcode: ',j.Postcode,char(10)) END
		, case when (j.Currency1 = '' OR j.Currency1 is NULL) THEN '' ELSE concat ('Currency1: ',j.Currency1,char(10)) END
		, case when (j.Fee = '' OR j.Fee is NULL) THEN '' ELSE concat ('Fee: ',j.Fee,char(10)) END
		, case when (j.Benefits = '' OR j.Benefits is NULL) THEN '' ELSE concat ('Benefits: ',j.Benefits,char(10)) END
		, case when (j.Sector = '' OR j.Sector is NULL) THEN '' ELSE concat ('Sector: ',j.Sector,char(10)) END
		, case when (j.Segment = '' OR j.Segment is NULL) THEN '' ELSE concat ('Segment: ',j.Segment,char(10)) END
		, case when (j.discipline = '' OR j.discipline is NULL) THEN '' ELSE concat ('Discipline: ',j.discipline,char(10)) END
		, case when (j.ProgressStage = '' OR j.ProgressStage is NULL) THEN '' ELSE concat ('ProgressStage: ',j.ProgressStage,char(10)) END
		, case when j.HasSkills = 'false' then concat('HasSkills: No',char(10)) when j.HasSkills = 'true' then concat('HasSkills: Yes',char(10)) end
		, case when j.signedoff = 'false' then concat('SignedOff: No',char(10)) when j.signedoff = 'true' then concat('SignedOff: Yes',char(10)) end
	) as 'position-note'

-- SELECT owner.email -- select count(*) --8214
--select jobstatus,regdate,startdate,enddate -- select distinct jobstatus 
from vacancies j
left join (SELECT id, filename = STUFF((SELECT DISTINCT ', '  + 'job_' + replace(filename,',','') from Attachments WHERE id = a.id FOR XML PATH ('')), 1, 1, '') FROM Attachments a GROUP BY id) at on j.jobnumber = at.Id
--left join Contacts CL on j.ContactId = CL.ContactId
left join (select b.* from Contacts b where b.descriptor = 1 ) CL on CL.contactid = j.contactid
left join job on job.JobNumber = j.JobNumber
left join (
        select v.JobNumber ,v.username --,u.email
                , Coalesce(' ' + NULLIF(u.email, ''), '') + Coalesce(', ' + NULLIF(iif(v.username2 = v.username,'', va2.email), ''), '') as email
        --select count (*)
        from vacancies v
        left join users u on u.username = v.username
        left join ( select distinct v2.username2, u2.email from vacancies v2 left join users u2 on u2.username = v2.username2 where v2.username2 <> '' and v2.username2 is not null ) va2 on va2.username2 = v.username2
        --where v.username <> '' or v.username2 <> '' and 
        --where v.username = 'Felice Hurst'
        --where v.username2 in ('Nikki Samson')
        ) owner on owner.JobNumber = j.JobNumber
where
cl.ContactId in ('931589-8428-1522','727963-4522-11229','369022-7670-1648','143566-3462-852')
--j.JobNumber = 'V/Admi/24603/156' --j.VacancyId = '1650'
--where j.Department is not null
--where j.username = 'Felice Hurst'
--and j.contactid in ('42465','704038-8394-758','C/698033/2004323','875680-4281-644','','989815-7976-11318','150155-3378-5243','633954-7039-6124','309919-8037-8175','813887-3575-7296','C/460733/208','897161-3729-689','234871-1833-6293','153843-1074-7120','775476-7447-12185','150155-3378-5243','862913-5115-688','184548-1536-13191','331939-5032-7229','Maur/23496/220','712642-8955-12216','Alic/59254/252','786458-8778-7305','857951-5035-6333','261740-2015-737','44213','466004-1064-617','875011-6431-5335','377264-5142-8227','Emma/86793/224','869268-1841-6185','858805-9594-1437','C/460733/208','C/26609/29','44395','C/338301/2004302','929861-2693-8164','166977-7446-5235','','797975-2016-11264','802722-4331-693','222205-4442-1394','653950-9643-12144','464348-8329-6216','446301-1898-7254','C/29762/262','210467-3385-5315','55029/275','C/20518/13','246350-9350-10258','43139','45110/105','83585/240','848655-5899-5297','125423-7297-8168','385285-4110-13284','','C/29762/262','570020-8287-9209','570020-8287-9209','315850-1298-12342','707572-7220-1280','','669564-2132-5256','194458-4652-10285','C/552053/211','151296-1459-850','601657-5644-8164','597037-5656-1274','794451-8840-1211','788974-8515-7194','748479-1107-726','C/54186/70','151296-1459-850','C/99450/328','844227-7485-11236','932109-6473-5308','905874-4684-6136','833946-3135-8226','150155-3378-5243','782418-4605-10284','331939-5032-7229','515263-9255-5145','624139-1309-8193','Loui/44068/190','954255-1501-5104','','802722-4331-693','755084-5179-14106','422020-9749-5231','570020-8287-9209','146378-3743-7109','434094-5242-12158','283770-9064-10224','469215-6890-5206','173778-5641-6248','Maur/20326/170','864516-3500-7255','617682-7330-7136','Alic/95525/126','988659-6639-7227','366539-1386-8148','510662-1113-687','611486-8646-1281','C/688830/299','43044','C/12343/12','Maur/79529/167','874779-8778-942','330916-1501-5143','624139-1309-8193','C/460733/208','Maur/86571/167','611486-8646-1281','Maur/83677/182','628959-2985-5244','43181','991754-5074-5171','994035-2389-648','210467-3385-5315','586110-2808-990','734168-6536-1175','330916-1501-5143','541125-7426-10323','437249-7283-13213','624139-1309-8193','44861','979042-6373-5228','45110/105','150155-3378-5243','882833-2043-5286','265570-3846-822','828664-1444-9209','10351/272','339526-6836-8121','890307-1609-8267','44998','970415-6244-11207','C/915897/2004334','C/492542/2004316','309919-8037-8175','308079-3903-78','C/717576/2004309','330916-1501-5143','453559-9624-934','48496/253','652005-4917-6345','C/31046/14','C/30847/78','125423-7297-8168','C/64016/27','160621-4940-12132','509367-3516-11179','','151068-4443-752','494256/yy348','419575-7387-9200','674550-5587-870','Alic/35498/212','Alic/99686/157','125423-7297-8168','782418-4605-10284','995278-6529-6187','141357-2081-747','Maur/91185/205','712642-8955-12216','464348-8329-6216','315850-1298-12342','936010-8851-8221','951862-9868-1139','586061-3622-14280','329477-5855-7129','366539-1386-8148','166977-7446-5235','839866-5490-6340','','','191419-9985-15177','C/29762/262','C/54186/70','44237','844227-7485-11236','','172132-3644-5214','402528-6802-1014','946597-9952-10244','254232-8915-6285','461789-2768-7268','Maur/93964/219','425897-8849-6177','402528-6802-1014','169374-4981-785','586110-2808-990','657676-3901-5172','802722-4331-693','584263-5332-14147','42417','392105-5421-5161','330916-1501-5143','125423-7297-8168','21464/280','448576-2613-6271','899529-7021-6277','150155-3378-5243','C/29762/262','','802722-4331-693','448576-2613-6271','','537293-3294-5220','788948-1717-7114','Alic/50594/128','549430-6529-7255','724429-1205-10330','864516-3500-7255','323125-4997-6263','146972-2912-12291','150155-3378-5243','43139','743057-8765-13141','869268-1841-6185','150155-3378-5243','316818-2273-6135','468821-5797-10323','','','283770-9064-10224','144497-8898-6170','645929-3498-5172','838620-7885-1253','44145','C/20518/13','180994-8217-8113','864516-3500-7255','210467-3385-5315','623792-1610-5290','979042-6373-5228','79960/237','742572-2199-5172','864516-3500-7255','759151-9325-1325','469215-6890-5206','478949-5358-6339','124225-2905-10158','753741-4001-640','792797-7631-5188','C/54186/70','928231-8527-9121','384729-1416-5263','687649-2831-6263','151068-4443-752','125423-7297-8168','150155-3378-5243','775476-7447-12185','554247-4878-6257','125423-7297-8168','611486-8646-1281','','43952','331939-5032-7229','366539-1386-8148','172132-3644-5214','125423-7297-8168','125423-7297-8168','755084-5179-14106','723929-0545','906631-2604-13161','979042-6373-5228','596319-4930-858','889578-5490-1134','611486-8646-1281','151296-1459-850','','44213','C/957584/292','616108-9667-1177','172132-3644-5214','150155-3378-5243','','802722-4331-693','C/29762/262','246514-8442-7268','221718-9470-726','C/20518/13','755084-5179-14106','741437-3312-746','','976431-7588-10105','476515-2155-6165','Maur/15196/182','597178-3063-10258','Alic/73667/129','151296-1459-850','C/171473/2004306','868649-4203-893','264977-6026-8310','316818-2273-6135','648990-8110-569','714803-4398-793','691307-9854-10249','614692-3007-11307','331939-5032-7229','316818-2273-6135','Alic/45141/169','C/64016/27','169374-4981-785','43170','21464/280','180994-8217-8113','653839-3934-5264','917536-3784-9229','704038-8394-758','991754-5074-5171','611486-8646-1281','449613-8246-723','316818-2273-6135','434094-5242-12158','316818-2273-6135','C/66122/14','425897-8849-6177','838620-7885-1253','400081-3022-1188','43904','','','127760-4211-7298','214121-3741-15224','98662/285','46340/246','502956-5901-12123','640874-7437-8135','125423-7297-8168','183628-3657-6318','59989/245','377264-5142-8227','624139-1309-8193','','904955-7950-13143','624139-1309-8193','46675/292','304446-6287-5166','169374-4981-785','674550-5587-870','720733-6969-6318','868649-4203-893','','98393/250','C/688830/299','125423-7297-8168','77313/292','916331-1695-10306','664619-8923-9286','59989/245','136951-3727-6326','150155-3378-5243','425897-8849-6177','125423-7297-8168','263137-9448-6135','948703-5391-6143','384729-1416-5263','727493-6225-7186','C/29762/262','42579','','C/369685/230','301558-7129-8310','661083-9462-6242','868649-4203-893','44861','988087-5695-6306','','392105-5421-5161','C/29762/262','679438-0518','624139-1309-8193','748479-1107-726','44196','331939-5032-7229','315850-1298-12342','461789-2768-7268','402528-6802-1014','148442-3776-6340','607919-3635-13172','432725-3787-822','315850-1298-12342','802722-4331-693','42465','425897-8849-6177','448576-2613-6271','172132-3644-5214','173778-5641-6248','864516-3500-7255','150155-3378-5243','330916-1501-5143','150155-3378-5243','552921-5356-9124','839452-1303-689','','586110-2808-990','894756-2230-8337','Alic/99686/157','46675/292','309919-8037-8175','624139-1309-8193','897161-3729-689','C/19032/72','C/84083/316','571926-4872-977','798460-4860-12221','392105-5421-5161','742572-2199-5172','254232-8915-6285','531031-2357-8273','507335-4640-5265','805564-9345-10335','802722-4331-693','10351/272','624139-1309-8193','802722-4331-693','','125423-7297-8168','296857-7463-746','886552-7077-5285','316818-2273-6135','624139-1309-8193','','570020-8287-9209','C/20518/13','624139-1309-8193','748479-1107-726','','44719/197','376440-6401-6298','914079-5190-1353','941057-8986-7156','280287-1768-7302','125423-7297-8168','377264-5142-8227','150155-3378-5243','520924-7160-872','194495-5816-6128','838620-7885-1253','252762-7470-8241','Alic/50594/128','946597-9952-10244','C/23522/30','995816-7103-13298','125423-7297-8168','C/688830/299','108317-9304-7150','C/563984/194','580298-4938-7122','','998560-4689-10227','148442-3776-6340','Mn/32025/92','125423-7297-8168','315850-1298-12342','894661-9723-1251','624139-1309-8193','374942-7925-574','979089-2297-6306','894661-9723-1251','642846-4590-1149','366539-1386-8148','476996-7950-10344','','137800-4304-927','938445-1326-75','502956-5901-12123','468650-1777-7137','115488-9900-8337','991754-5074-5171','405111-8176-11203','305544-9465-641','400253-1359-815','986280-3179-11116','308079-3903-78','624139-1309-8193','829211-6845-10257','520924-7160-872','Alic/60544/226','150155-3378-5243','255849-9497-6188','935543-8776-7351','Alic/55631/162','76379/174','C/515330/299','378657-2482-11255','125423-7297-8168','545101-5899-8311','','Maur/20326/170','767207-0545','','44105','283770-9064-10224','805564-9345-10335','','520354-7741-10257','786458-8778-7305','822864-9232-8157','335198-4765-6331','570020-8287-9209','C/460733/208','331939-5032-7229','840239-2893-9232','C/29762/262','989019-1268-5248','','315850-1298-12342','534187-8584-761','633652-7878-5322','986429-4229-117','384729-1416-5263','C/54186/70','Alic/50594/128','108317-9304-7150','146715-2746-576','30196/275','377264-5142-8227','701059-9891-8234','887003-8895-7263','425897-8849-6177','931312-4362-12352','79952/250','839489-8695-13120','125423-7297-8168','920075-7760-6201','279868-5557-576','409051-7066-14251','624139-1309-8193','507398-6598-11124','778879-2761-12255','C/82165/84','405111-8176-11203','954255-1501-5104','523304-7207-5348','832028-2046-893','946597-9952-10244','475415-2918-7211','C/86985/30','520924-7160-872','970470-4783-977','910901-5348-6138','595851-7997-11332','44719/197','330238-2754-13234','','921258-2072-10307','','','864516-3500-7255','870112-2918-11210','','570020-8287-9209','979042-6373-5228','888904-4459-7173','645929-3498-5172','591434-1805-6137','668862-9498-8113','838620-7885-1253','C/29762/262','C/99450/328','221718-9470-726','296857-7463-746','857951-5035-6333','515263-9255-5145','316818-2273-6135','125423-7297-8168','551040-1898-5159','C/72972/20','150155-3378-5243','802722-4331-693','371369-4047-722','377264-5142-8227','645929-3498-5172','928880-6426-5340','','Alic/50594/128','45087','239271-8644-581','44145','C/29762/262','792797-7631-5188','856134-8837-12108','Maur/25520/219','C/688830/299','513317-5215-10334','922624-2281-969','133880-3683-13165','704038-8394-758','C/99450/328','40920/267','464348-8329-6216','478228-9987-990','828383-9213-8157','505740-1318-6290','606130-7062-1281','748830-2788-794','742572-2199-5172','316818-2273-6135','Alic/35498/212','150155-3378-5243','','422020-9749-5231','446900-1730-10230','635103-8700-5305','150155-3378-5243','626443-2220-12174','163168-1722-838','Alic/50594/128','255631-4275-5258','160621-4940-12132','402528-6802-1014','124503-6854-1082','254232-8915-6285','42582','153321-7899-5342','','925379-9889-1169','398415-7962-1153','838620-7885-1253','624139-1309-8193','443142-2879-6236','51070/126','754310-1137-828','150155-3378-5243','570020-8287-9209','43185','999728/yy5','897161-3729-689','C/29762/262','802722-4331-693','973967-1748-5251','324338-7626-6332','551040-1898-5159','659038-7980-12229','959348-8192-7220','510552-5491-11101','624139-1309-8193','36853/202','999316-7348-7186','946213-0538','C/29762/262','330916-1501-5143','481353-8299-6198','Alic/45141/169','596319-4930-858','C/20518/13','808330-4204-13121','427568-3492-87','379846-4790-5116','261740-2015-737','234871-1833-6293','775476-7447-12185','874672-1698-724','624139-1309-8193','','657676-3901-5172','515263-9255-5145','315850-1298-12342','416768-7358-8177','283766-1090-12145','890930-6287-11207','366539-1386-8148','C/73497/92','875011-6431-5335','802722-4331-693','138289-9579-7221','115488-9900-8337','427556-3611-1437','998560-4689-10227','443142-2879-6236','875011-6431-5335','382517-5033-7155','272196-2258-5306','377264-5142-8227','C/98027/76','578344-4584-5154','574580-9645-6324','C/38127/20','151296-1459-850','651185-8447-5109','C/54186/70','645929-3498-5172','897352-3691-7222','823802-1309-82','334204-3706-6153','425897-8849-6177','C/74494/266','166977-7446-5235','150155-3378-5243','904955-7950-13143','279868-5557-576','157771-8039-5264','','481957-6334-5326','125423-7297-8168','408476-7174-12165','173778-5641-6248','192969-4483-5103','356462-9719-13129','','','','125423-7297-8168','840991-2817-1683','C/20518/13','310454-5548-10347','633173-2530-5206','C/70754/175','150155-3378-5243','330916-1501-5143','980710-8561-16307','376440-6401-6298','377264-5142-8227','999316-7348-7186','173778-5641-6248','751091-8777-13142','150155-3378-5243','917536-3784-9229','657676-3901-5172','115488-9900-8337','172132-3644-5214','987356-1109-6340','775476-7447-12185','C/29762/262','862913-5115-688','254232-8915-6285','280245-4365-6261','802722-4331-693','626942-9603-7303','317324-4940-588','690754-9229-7325','419575-7387-9200','316818-2273-6135','','924218-8016-10133','760960-4845-11166','220365-1764-12275','704038-8394-758','','316818-2273-6135','223223-2372-15102','742572-2199-5172','','Alic/50594/128','331939-5032-7229','841172-5061-5194','894756-2230-8337','805387-9031-8298','583051-2484-9111','874779-8778-942','338985-5192-8101','548513-2618-718','921258-2072-10307','425897-8849-6177','782418-4605-10284','653787-6966-11322','C/717576/2004309','Alic/50594/128','110452-3164-11130','473868-2788-5196','316818-2273-6135','331939-5032-7229','146715-2746-576','316818-2273-6135','660971-1937-10257','570866-4575-6171','316818-2273-6135','493966-4845-739','317324-4940-588','C/717576/2004309','570020-8287-9209','468615-1839-7281','570020-8287-9209','475415-2918-7211','297831-6077-12290','','C/59874/280','519381-7954-6130','436657-2638-10111','570866-4575-6171','125423-7297-8168','166649-1294-6276','265570-3846-822','948023-8287-6298','C/402366/240','989815-7976-11318','192969-4483-5103','366539-1386-8148','492504-5104-13255','449613-8246-723','151068-4443-752','394680-7492-11222','51070/126','895504-2958-6339','','815471-9277-5189','938445-1326-75','283945-6277-5250','496809-4825-11237','C/717576/2004309','110193-3320-6187','838620-7885-1253','Maur/20326/170','468650-1777-7137','880400-9845-16293','586110-2808-990','802722-4331-693','624139-1309-8193','425897-8849-6177','748479-1107-726','518464-5772-6130','570866-4575-6171','151694-8447-6153','','570020-8287-9209','645929-3498-5172','125423-7297-8168','46572','405111-8176-11203','478228-9987-990','400253-1359-815','128483-5798-10327','624139-1309-8193','C/82686/54','339767-6434-914','C/717576/2004309','212211-6719-12236','425897-8849-6177','C/66122/14','C/717576/2004309','C/29762/262','Emma/36767/241','624139-1309-8193','392105-5421-5161','806268-4103-5279','858805-9594-1437','43011','','','402528-6802-1014','788079-1671-7288','','748479-1107-726','','975668-3249-864','265570-3846-822','966759-2656-5307','','173702-8531-14244','125423-7297-8168','316818-2273-6135','449613-8246-723','864516-3500-7255','192969-4483-5103','828383-9213-8157','784398-1824-6261','150155-3378-5243','','137800-4304-927','624139-1309-8193','173778-5641-6248','Alic/21021/156','185389-6066-5199','12167/110','975649-2914-5269','','980573-7381-5255','Alic/73667/129','475415-2918-7211','Maur/83677/182','704038-8394-758','806626-2672-6122','46675/292','469601-7957-1183','845612-1238-1159','','221718-9470-726','C/492542/2004316','254232-8915-6285','788948-1717-7114','959348-8192-7220','857951-5035-6333','125423-7297-8168','722815-2760-6352','464348-8329-6216','125423-7297-8168','C/82165/84','C/552053/211','21464/280','714803-4398-793','552920-8528-7205','C/29762/262','490679-0525','845592-4555-6220','624139-1309-8193','C/460733/208','704038-8394-758','C/40524/70','C/698033/2004323','','510093-5063-14290','C/29762/262','Alic/55631/162','434094-5242-12158','377264-5142-8227','124503-6854-1082','839866-5490-6340','913344-6669-10335','169374-4981-785','46675/292','C/29762/262','Alic/50594/128','330916-1501-5143','144497-8898-6170','','Maur/83677/182','C/12435/14','425897-8849-6177','628829-4024-12290','244361-4258-6327','335454-5888-5276','802722-4331-693','541244-9883-16278','44599','838620-7885-1253','10351/272','443142-2879-6236','','125423-7297-8168','C/66122/14','847628-1059-6221','125423-7297-8168','435451-2744-10258','45218','105465-1245-14308','882833-2043-5286','402528-6802-1014','400253-1359-815','283770-9064-10224','C/957584/292','473868-2788-5196','C/492542/2004316','173778-5641-6248','832028-2046-893','Alic/55631/162','306354-7353-6130','Loui/70015/163','946597-9952-10244','146378-3743-7109','734700-1139-11139','857951-5035-6333','','425897-8849-6177','213935-6779-6292','917536-3784-9229','331939-5032-7229','150155-3378-5243','372437-6193-5269','828383-9213-8157','44145','281106-8869-9167','911795-1864-14223','443142-2879-6236','42417','464348-8329-6216','552348-3616-11321','Mn/72432/99','446301-1898-7254','287481-6699-9166','513317-5215-10334','490679-0525','162772-6687-1227','C/492542/2004316','','409980-9753-10153','93158/250','805564-9345-10335','586110-2808-990','425897-8849-6177','72406/253','','980295-8659-1146','611486-8646-1281','720733-6969-6318','','','172132-3644-5214','946597-9952-10244','377264-5142-8227','517035-1729-5304','690754-9229-7325','Mn/32025/92','899529-7021-6277','244361-4258-6327','Maur/93768/218','646509-8118-9335','','125423-7297-8168','151296-1459-850','842699-5241-8133','57167/261','109869-8341-5188','400081-3022-1188','C/999305/2004302','128725-7807-11230','970415-6244-11207','617682-7330-7136','C/11648/77','157771-8039-5264','624139-1309-8193','316818-2273-6135','570020-8287-9209','Maur/90784/195','122210-5795-8308','871081-2637-5172','875011-6431-5335','330916-1501-5143','51070/126','Alic/35498/212','979042-6373-5228','151296-1459-850','43904','425897-8849-6177','C/82165/84','669964-2615-13129','870112-2918-11210','Maur/20326/170','129778-6879-5258','317324-4940-588','93158/250','652403-6514-10131','42465','650531-5888-14311','762527-2858-1598','','975668-3249-864','867698-8931-1154','166649-1294-6276','147499-1296-9106','','909042-8912-1479','839866-5490-6340','866631-2593-6311','160621-4940-12132','C/781150/2004336','145403-5614-5287','714161-4060-7222','125423-7297-8168','308079-3903-78','330916-1501-5143','832028-2046-893','C/29762/262','121730-1024-878','425897-8849-6177','','635103-8700-5305','125423-7297-8168','874672-1698-724','222543-7345-7173','624139-1309-8193','339526-6836-8121','475415-2918-7211','528434-3106-6255','422493-1441-1572','384729-1416-5263','747425-1418-15106','','924218-8016-10133','','','','520924-7160-872','150155-3378-5243','190360-9342-5159','815471-9277-5189','','395119-3189-793','553276-8938-1181','C/552053/211','725039-4513-5168','330916-1501-5143','301558-7129-8310','377264-5142-8227','840239-2893-9232','331939-5032-7229','366539-1386-8148','C/82165/84','C/70754/175','330916-1501-5143','557092-1961-7109','512953-5430-1013','384980-1230-624','552633-9161-821','173778-5641-6248','C/945586/2004335','','','376440-6401-6298','','551040-1898-5159','','551040-1898-5159','125423-7297-8168','823802-1309-82','461789-2768-7268','185389-6066-5199','786458-8778-7305','','882833-2043-5286','624139-1309-8193','922624-2281-969','537293-3294-5220','43170','C/54186/70','841129-5183-1169','425897-8849-6177','815471-9277-5189','Emma/86793/224','381459-2429-7120','551040-1898-5159','C/29762/262','645929-3498-5172','C/194685/212','492707-9619-6291','660971-1937-10257','An/28922/100','36744/238','402528-6802-1014','377264-5142-8227','946597-9952-10244','652005-4917-6345','400253-1359-815','201629-8801-16281','283945-6277-5250','999684-5364-569','','617682-7330-7136','Emma/36767/241','630976-6230-6338','539720-1668-9170','315850-1298-12342','679438-0518','806626-2672-6122','252762-7470-8241','83585/240','597210-1083-6346','150155-3378-5243','C/29762/262','116596-3815-574','','586110-2808-990','611486-8646-1281','44804','762772-4075-11167','C/82165/84','','929861-2693-8164','802722-4331-693','150155-3378-5243','125423-7297-8168','','331939-5032-7229','Rahe/81537/107','847000-5623-1260','876185-3760-1549','589144-1679-7200','281106-8869-9167','316818-2273-6135','762651-3170-11171','C/54186/70','125423-7297-8168','C/54186/70','98393/250','520924-7160-872','624139-1309-8193','','584263-5332-14147','521597-9042-149','185389-6066-5199','554147-1547-10167','44237','800195-6397-7165','946597-9952-10244','874672-1698-724','125423-7297-8168','919457-8777-6342','','','624139-1309-8193','42465','244361-4258-6327','44599','982939-6096-60','331939-5032-7229','933758-5660-13261','44667','C/12343/12','762651-3170-11171','283945-6277-5250','','C/29762/262','753035-6750-1146','502956-5901-12123','805208-4960-5179','814412-9433-13248','254232-8915-6285','85742/288','C/45280/34','233669-4381-8184','','309919-8037-8175','373915-4430-7269','507398-6598-11124','C/64016/27','149190-4985-8268','991754-5074-5171','479574-1229-9259','C/54186/70','747425-1418-15106','909908-2944-9205','409051-7066-14251','829211-6845-10257','537293-3294-5220','320359-2659-6178','784339-2977-10257','464348-8329-6216','150155-3378-5243','358309-6186-12186','805564-9345-10335','712642-8955-12216','958824-8469-10302','468821-5797-10323','683051-7013-633','C/54186/70','652005-4917-6345','331939-5032-7229','468821-5797-10323','C/688830/299','43170','706912-6701-8109','659113-3007-648','935808-5504-11173','221718-9470-726','769450-4807-5270','119950-9492-1211','43170','79960/237','464348-8329-6216','169374-4981-785','520924-7160-872','Alic/50594/128','470216-3588-7110','Alic/50594/128','172132-3644-5214','493966-4845-739','184548-1536-13191','552348-3616-11321','42417','Maur/83677/182','C/66122/14','C/20518/13','862913-5115-688','874672-1698-724','','','43902','C/29762/262','727493-6225-7186','946597-9952-10244','513585-9014-8109','961330-8462-13255','255631-4275-5258','624139-1309-8193','296857-7463-746','209504-8724-1267','316818-2273-6135','C/88693/30','101319-7044-10280','Emma/44983/254','46675/292','C/31046/14','252762-7470-8241','673139-4185-6261','377264-5142-8227','470216-3588-7110','874672-1698-724','252762-7470-8241','802722-4331-693','340597-4273-7205','873286-2517-6272','805564-9345-10335','998560-4689-10227','980573-7381-5255','327893-5260-13315','410868-2575-13143','602571-6224-1549','875011-6431-5335','892781-4040-6341','882833-2043-5286','422720-5747-5202','605606-4538-12166','611486-8646-1281','624139-1309-8193','250077-6868-10342','125423-7297-8168','124225-2905-10158','519381-7954-6130','858089-9975-942','C/83292/147','150155-3378-5243','425897-8849-6177','532344-8391-9292','','C/552053/211','495966-1603-8291','986084-4455-5270','192969-4483-5103','330916-1501-5143','805387-9031-8298','Alic/73667/129','624139-1309-8193','Maur/79529/167','36853/202','43170','330916-1501-5143','C/54186/70','817197-3424-96','C/82165/84','Maur/15196/182','400253-1359-815','372437-6193-5269','150155-3378-5243','331939-5032-7229','815471-9277-5189','45087','478228-9987-990','Maur/23496/220','220365-1764-12275','579852-3564-5214','','316818-2273-6135','','330916-1501-5143','629462-7472-12222','916331-1695-10306','856134-8837-12108','400253-1359-815','','995278-6529-6187','124225-2905-10158','916331-1695-10306','624139-1309-8193','551040-1898-5159','979042-6373-5228','C/54186/70','935808-5504-11173','Maur/20326/170','422020-9749-5231','442097-3338-7284','316818-2273-6135','537293-3294-5220','221718-9470-726','557092-1961-7109','782350-9237-7102','515263-9255-5145','801967-7869-8155','425897-8849-6177','','493966-4845-739','125423-7297-8168','948703-5391-6143','929702-3882-1197','331939-5032-7229','734700-1139-11139','391020-6856-16312','786458-8778-7305','292996-6139-5103','330916-1501-5143','502956-5901-12123','315850-1298-12342','244334-7516-5206','330916-1501-5143','304446-6287-5166','348366-5439-8301','145403-5614-5287','115488-9900-8337','933758-5660-13261','76379/174','Alic/55631/162','756412-6069-637','12167/110','C/29762/262','151296-1459-850','Maur/79529/167','736420-6603-15265','125423-7297-8168','213935-6779-6292','43902','C/552053/211','257512-8983-9322','156810-2970-12333','359427-1410-7218','C/352779/2004348','528247-5799-5130','C/29762/262','152567-1477-844','425897-8849-6177','946597-9952-10244','805564-9345-10335','271586-5701-6150','425897-8849-6177','','150155-3378-5243','43011','652005-4917-6345','Maur/23496/220','975194-8016-7312','C/717576/2004309','125423-7297-8168','927465-4127-1352','150155-3378-5243','938445-1326-75','','122622-5694-9288','C/688830/299','','393953-5579-6347','897161-3729-689','691307-9854-10249','220365-1764-12275','469215-6890-5206','192969-4483-5103','841239-1993-7318','221570-4507-5278','478228-9987-990','44395','C/128675/2004323','36744/238','924218-8016-10133','425897-8849-6177','173778-5641-6248','708336-1398-575','42417','425897-8849-6177','C/86985/30','701853-2312-10110','802722-4331-693','910901-5348-6138','260646-8952-8224','376605-5338-1424','670279-5903-10102','Alic/50594/128','125423-7297-8168','558883-4825-7309','193699-1608-5144','192969-4483-5103','802722-4331-693','668862-9498-8113','611486-8646-1281','624139-1309-8193','40714/78','959501-5081-5305','624139-1309-8193','','616851-5451-10133','975194-8016-7312','858805-9594-1437','468821-5797-10323','645929-3498-5172','316818-2273-6135','392792-6295-1168','790953-9570-12216','942700-6125-1314','','C/20518/13','316818-2273-6135','Maur/23496/220','805564-9345-10335','817618-9655-1168','','425897-8849-6177','669884-4801-929','936010-8851-8221','504614-3764-12200','807598-6856-9205','660971-1937-10257','875011-6431-5335','','C/16208/19','146404-7936-10141','306354-7353-6130','','520924-7160-872','150155-3378-5243','648990-8110-569','373915-4430-7269','','645929-3498-5172','328670-3450-9166','838620-7885-1253','223223-2372-15102','422020-9749-5231','','837604-9375-7270','122622-5694-9288','124225-2905-10158','308079-3903-78','C/54186/70','C/29762/262','','544140-6259-10232','438276-3339-12272','515263-9255-5145','932109-6473-5308','640874-7437-8135','C/573817/2004323','','446900-1730-10230','316818-2273-6135','213935-6779-6292','150155-3378-5243','832028-2046-893','919457-8777-6342','611486-8646-1281','C/68028/266','409051-7066-14251','694700-3435-7221','476515-2155-6165','752952-4045-6228','948703-5391-6143','826736-8849-6116','802722-4331-693','377264-5142-8227','701059-9891-8234','892481-2764-821','','905732-5992-6304','989815-7976-11318','542474-6578-7107','156801-9231-13177','C/717576/2004309','331939-5032-7229','469675-2425-7102','425897-8849-6177','331939-5032-7229','405111-8176-11203','805564-9345-10335','339526-6836-8121','101885-9921-13141','570020-8287-9209','125423-7297-8168','611486-8646-1281','425897-8849-6177','696894-4829-5250','995816-7103-13298','822333-5978-717','858805-9594-1437','796506-6356-1535','624139-1309-8193','571926-4872-977','','151068-4443-752','551040-1898-5159','C/99450/328','951862-9868-1139','492707-9619-6291','903192-4130-891','527839-4623-15244','515263-9255-5145','584263-5332-14147','308079-3903-78','685866-3354-7218','780871-3828-637','45750','151296-1459-850','','10351/272','492707-9619-6291','989815-7976-11318','172132-3644-5214','C/54186/70','611486-8646-1281','920876-9005-12139','485960-5678-5231','Maur/88014/198','916331-1695-10306','','510552-5491-11101','432725-3787-822','805564-9345-10335','864516-3500-7255','425897-8849-6177','','464348-8329-6216','624139-1309-8193','904955-7950-13143','714803-4398-793','Maur/15196/182','995278-6529-6187','C/64016/27','843571-8423-5168','C/12343/12','Alic/45141/169','520924-7160-872','794701-6907-7103','166977-7446-5235','613168-6221-8203','Guy /16834/240','296857-7463-746','687143-1317-7227','150155-3378-5243','515263-9255-5145','515263-9255-5145','913344-6669-10335','124225-2905-10158','366539-1386-8148','43952','511736-1108-8224','402528-6802-1014','129778-6879-5258','42417','','864516-3500-7255','897161-3729-689','425897-8849-6177','C/24307/9','467499-3480-793','C/29762/262','36744/238','478140-4076-1550','626443-2220-12174','823802-1309-82','874672-1698-724','591180-5875-1145','315850-1298-12342','574580-9645-6324','543803-2255-7296','928231-8527-9121','975145-4823-5234','586110-2808-990','148442-3776-6340','874779-8778-942','422720-5747-5202','492888-9818-11277','146715-2746-576','803155-3411-574','15476/275','611486-8646-1281','975668-3249-864','45110/105','','870112-2918-11210','687649-2831-6263','624139-1309-8193','42380','42464','42582','42579','43789','45087','44196','C/46785/309','C/25958/296','Alic/60544/226','C/22296/294','C/77616/293','C/77616/293','44142','C/55401/258','C/77616/293','C/90006/309','Maur/93964/219','C/12819/314','C/44431/293','C/22296/294','Admi/36736/113','44142','Alic/99686/157','Alic/91150/202','43906','Alic/99686/157','Alic/12263/240','Alic/16720/118','Alic/99686/157','Alic/94565/118','44142','42465','An/97145/100','Kayo/99224/114','Kayo/99224/114','44196','Loui/44068/190','Loui/78085/105','42484','Loui/78085/105','Alic/93264/203','Loui/44068/190','Loui/78085/105','Loui/46255/114','Loui/70015/163','Loui/44068/190','Loui/46255/114','Lr/69602/94','Lr/92152/94')
--where j.ContactId = '42465'
--where j.ContactId in('100515-3111-15333','100806-4263-9152','101188-3803-950','101995-6017-6184','102631-7673-14191')
--where j.JobTitle = 'Digital Account Director' and  j.ContactId = '920955-4947-811'
--or j.ContactId = '283766-1090-12145' and j.JobTitle = 'Speculative'
--or j.ContactId = 'C/722027/299' and j.JobTitle = 'Project Manager'

/*left join bullhorn1.BH_Client b on j.clientUserID = b.userID
left join tmp_3 c ON j.userID = c.userID
--left join bullhorn1.BH_UserContact UC on j.userID = UC.userID
left join PlacementNote PN on j.jobPostingID = PN.jobPostingID
left join Note on j.jobPostingID = note.jobPostingID
--where b.isPrimaryOwner = 1;
*/
/*
select jobPostingID, count(jobPostingID)
from bullhorn1.BH_Placement PL
group by jobPostingID having count(jobPostingID) >1
*/

/*
select at.*
from vacancies j
left join ( SELECT distinct id, filename, ref, replace(replace(ref,'\\rsserver\',''),'c:\','') as newref from Attachments ) at on j.jobnumber = at.Id
where at.filename is not null and at.filename <> '' and at.ref <> ''
*/