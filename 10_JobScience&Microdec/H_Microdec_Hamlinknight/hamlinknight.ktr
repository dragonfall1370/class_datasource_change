<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>hamlinknight</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2019/05/06 15:04:11.079</created_date>
    <modified_user>-</modified_user>
    <modified_date>2019/05/06 15:04:11.079</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>Company</note>
      <xloc>288</xloc>
      <yloc>0</yloc>
      <width>62</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Contact</note>
      <xloc>1008</xloc>
      <yloc>0</yloc>
      <width>53</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Job</note>
      <xloc>1552</xloc>
      <yloc>0</yloc>
      <width>29</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Candidate</note>
      <xloc>2432</xloc>
      <yloc>0</yloc>
      <width>65</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Custom location</note>
      <xloc>3248</xloc>
      <yloc>0</yloc>
      <width>98</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Activity type</note>
      <xloc>3888</xloc>
      <yloc>0</yloc>
      <width>77</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Talent Pool</note>
      <xloc>4352</xloc>
      <yloc>0</yloc>
      <width>69</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Distribution list</note>
      <xloc>4496</xloc>
      <yloc>400</yloc>
      <width>91</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Owner</note>
      <xloc>848</xloc>
      <yloc>912</yloc>
      <width>46</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <connection>
    <name>prod_db</name>
    <server>rdbm</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>hamlinknight.vincere.io</database>
    <port>5432</port>
    <username>hoa</username>
    <password>Encrypted 2be98afc86aa7f2e4801cab22db81a6d0</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>source</name>
    <server>localhost</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>final_hamlinknight</database>
    <port>5432</port>
    <username>postgres</username>
    <password>Encrypted 2be98afc86aa7f2e4cb79ff228dc6fa8c</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>company_registration</from>
      <to>update_company_registration</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_address</from>
      <to>Database lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup</from>
      <to>insert_company_address</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup</from>
      <to>update_contact_other_fields</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_other_fields</from>
      <to>contact_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 2</from>
      <to>update_contact_note</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_note</from>
      <to>contact_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_activities</from>
      <to>company_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_lookup 2</from>
      <to>insert_company_activity</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_activities</from>
      <to>contact_lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 3</from>
      <to>insert_contact_activity</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_activities</from>
      <to>job_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_lookup</from>
      <to>insert_job_activities</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_activities</from>
      <to>candidate_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup</from>
      <to>insert_candidate_activities</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Insert industry 2</from>
      <to>company_industry 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_industry</from>
      <to>Insert industry 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_industry 2</from>
      <to>company_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_lookup</from>
      <to>industry 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>industry 2</from>
      <to>insert_udate_company_industry</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4</from>
      <to>insert_company_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_document</from>
      <to>Database lookup 4</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2</from>
      <to>insert_contact_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_document</from>
      <to>Database lookup 4 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2 2 2</from>
      <to>insert_job_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_document</from>
      <to>Database lookup 4 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2 2</from>
      <to>insert_candidate_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_document</from>
      <to>Database lookup 4 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_industry 2 2</from>
      <to>contact_lookup 3 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 3 2</from>
      <to>industry 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>industry 2 2</from>
      <to>insert_udate_contact_industry 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>industry 2 2 2 2</from>
      <to>insert_update_job_industry</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_industry</from>
      <to>job_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_lookup 2</from>
      <to>industry 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_industry 2</from>
      <to>candidate_lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup 2 2</from>
      <to>industry 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>industry 2 2 2</from>
      <to>insert_udate_candidate_industry 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>FE</from>
      <to>Insert FE</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_FE</from>
      <to>candidate_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_FE_no_sub_FE 2</from>
      <to>candidate_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup 2</from>
      <to>fe_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>fe_lookup 2</from>
      <to>insert_candidate_no_sub_FE</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>fe_lookup 2</from>
      <to>sub_fe_lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>sub_fe_lookup 2 2</from>
      <to>insert_candidate_FE 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>fe_lookup</from>
      <to>insert_sub_FE</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>sub_FE</from>
      <to>fe_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_FE</from>
      <to>job_lookup 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_FE_no_sub_FE</from>
      <to>job_lookup 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_lookup 2 3</from>
      <to>fe_lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>fe_lookup 2 2</from>
      <to>insert_job_no_sub_FE</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>fe_lookup 2 2</from>
      <to>sub_fe_lookup 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>sub_fe_lookup 2 2 2</from>
      <to>insert_job_FE</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Candidate Source</from>
      <to>Insert candidate_source</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Candidate Source 2</from>
      <to>lookup Candidate</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Insert candidate_source</from>
      <to>Candidate Source 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup Candidate</from>
      <to>lookup candidate_source</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup candidate_source</from>
      <to>candidate_source_id</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2 2 3</from>
      <to>insert_candidate_document 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_email_subscription</from>
      <to>Database lookup 4 2 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 4</from>
      <to>update_contact_switchboard</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_switch_board</from>
      <to>contact_lookup 4</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2 2 3 2</from>
      <to>insert_candidate_gdpr</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>gdpr</from>
      <to>Database lookup 4 2 2 3 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 3</from>
      <to>insert_company_rating</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_rating</from>
      <to>Database lookup 4 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 3 2</from>
      <to>insert_update_compensation</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_compensation</from>
      <to>Database lookup 2 3 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup 2 3</from>
      <to>update_candidate_salary</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_salary</from>
      <to>candidate_lookup 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 4 2 2 3 2 2</from>
      <to>insert_rate_mode</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>rate_mode</from>
      <to>Database lookup 4 2 2 3 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_location_list</from>
      <to>configurable_form_language_company</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_location_fields</from>
      <to>configurable_form_field_value_company</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2</from>
      <to>insert_company_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_location</from>
      <to>Database lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_location_fields</from>
      <to>configurable_form_field_value_contact</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 2</from>
      <to>insert_contact_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_location</from>
      <to>Database lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_language_company</from>
      <to>company_location_fields</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_field_value_company</from>
      <to>company_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_location_list</from>
      <to>configurable_form_language_contact</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_language_contact</from>
      <to>contact_location_fields</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_field_value_contact</from>
      <to>contact_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_location_fields</from>
      <to>configurable_form_field_value_candidate</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_field_value_candidate</from>
      <to>candidate_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 2 2</from>
      <to>insert_candidate_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_location</from>
      <to>Database lookup 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_location_list</from>
      <to>configurable_form_language_candidate</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_language_candidate</from>
      <to>candidate_location_fields</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_location_fields</from>
      <to>configurable_form_field_value_job</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_field_value_job</from>
      <to>job_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 2 2 2</from>
      <to>insert_job_location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_location</from>
      <to>Database lookup 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_location_list</from>
      <to>configurable_form_language_job</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_language_job</from>
      <to>job_location_fields</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>activity_type</from>
      <to>insert_activity_type</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>label_lookup</from>
      <to>insert_company_ativity_type</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_activity_type</from>
      <to>label_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_activity_type</from>
      <to>label_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>label_lookup 2</from>
      <to>insert_contact_ativity_type</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_activity_type</from>
      <to>label_lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>label_lookup 3</from>
      <to>insert_job_ativity_type</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_activity_type</from>
      <to>label_lookup 4</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>label_lookup 4</from>
      <to>insert_candidate_ativity_type</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>talent_pool_group</from>
      <to>user_account_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>user_account_lookup</from>
      <to>insert_talent_pool_group</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate</from>
      <to>candidate_lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>talent_pool_lookup</from>
      <to>insert_talent_pool_group 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>user_account_lookup 2</from>
      <to>talent_pool_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup 3</from>
      <to>user_account_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_lookup 3</from>
      <to>talent_pool_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>distribution_list</from>
      <to>user_account_lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>user_account_lookup 3</from>
      <to>insert_distribution_list</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact</from>
      <to>contact_lookup 3 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 3 2 2</from>
      <to>talent_pool_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_lookup 3 2 2</from>
      <to>user_account_lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>talent_pool_lookup 2</from>
      <to>insert_distribution_list 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>user_account_lookup 2 2</from>
      <to>talent_pool_lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_hotlist</from>
      <to>configurable_form_language_company 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_language_company 2</from>
      <to>company_hotlist 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_hotlist 2</from>
      <to>configurable_form_field_value_company 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>configurable_form_field_value_company 2</from>
      <to>company_hotlist 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 3</from>
      <to>insert_company_hotlist</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_hotlist 3</from>
      <to>Database lookup 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>new_owner_lookup</from>
      <to>update_company_owner</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company_owner</from>
      <to>new_owner_lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact_owner</from>
      <to>update_contact_owner</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>job_owner</from>
      <to>new_owner_lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>new_owner_lookup 3</from>
      <to>update_job_owner</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>candidate_owner</from>
      <to>update_candidate_owner</to>
      <enabled>N</enabled>
    </hop>
  </order>
  <step>
    <name>Candidate Source</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description source,
	1 as source_type,
	CURRENT_TIMESTAMP AS insert_timestamp,
	11 as payment_style
FROM lookup
WHERE code_type = '102'
AND TRIM(description) NOT IN ('Auto Parsed', 'Instant Job Board', 'Indeed', 'Seek', 'Referral', 'Dova', 'Data Import', 'Github', 'LinkedIn', 'Headhunt', 'Xing', 'LogicMelon', 'Broadbean')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2320</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Candidate Source 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
candidate_source AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '102'
)
SELECT
	ct.person_ref candidate_id,
	cs.description source,
	CURRENT_TIMESTAMP insert_timestamp
FROM candidate_type ct
JOIN candidate_status cst ON ct.status = cst.code
JOIN candidate_source cs ON ct.source = cs.code
WHERE ct.rn = 1
AND cst.code IN ('A1', 'I1')
AND NULLIF(cs.description, '') IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2512</xloc>
      <yloc>768</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>304</xloc>
      <yloc>208</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3328</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3344</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3312</xloc>
      <yloc>832</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3328</xloc>
      <yloc>1152</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>288</xloc>
      <yloc>1056</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 3 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1680</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>992</xloc>
      <yloc>400</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2464</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1584</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2 2 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>email</name>
        <rename>email</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2496</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2 2 3 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2480</xloc>
      <yloc>960</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 2 2 3 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2480</xloc>
      <yloc>1184</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 4 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>229</xloc>
      <yloc>771</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>FE</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH fe_mapping AS (	
	SELECT
		code,
		CASE
		WHEN description = 'Part Time' THEN 'Part time'
		WHEN description = 'Accountant' THEN 'Accountancy / Finance'
		WHEN description = 'Assistant Accountant' THEN 'Accountancy / Finance'
		WHEN description = 'Company Secretary' THEN 'Accountancy / Finance'
		WHEN description = 'Finance Manager' THEN 'Accountancy / Finance'
		WHEN description = 'Financial Accountant' THEN 'Accountancy / Finance'
		WHEN description = 'Financial Analyst' THEN 'Accountancy / Finance'
		WHEN description = 'Bookkeeper' THEN 'Accountancy / Finance'
		WHEN description = 'Financial Controller' THEN 'Accountancy / Finance'
		WHEN description = 'Finance Director' THEN 'Accountancy / Finance'
		WHEN description = 'Mgmt Accountant' THEN 'Accountancy / Finance'
		WHEN description = 'Auditor' THEN 'Accountancy / Finance'
		WHEN description = 'Accounts Assistant' THEN 'Accountancy / Finance'
		WHEN description = 'Purchase Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN description = 'Purchase Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN description = 'Sales Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN description = 'Sales Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN description = 'Payroll Clerk' THEN 'Accountancy / Finance'
		WHEN description = 'Payroll Manager / Supervisor' THEN 'Accountancy / Finance'
		WHEN description = 'Credit Control Mgr / Sup' THEN 'Accountancy / Finance'
		WHEN description = 'Credit Controller' THEN 'Accountancy / Finance'
		WHEN description = 'Legal Cashier' THEN 'Accountancy / Finance'
		WHEN description = 'Counterbalance Driver' THEN 'Construction'
		WHEN description = '360 Driver' THEN 'Construction'
		WHEN description = 'Wallpaper Hanger' THEN 'Construction'
		WHEN description = 'Tiler' THEN 'Construction'
		WHEN description = 'SMSTS - Grst Aid' THEN 'Construction'
		WHEN description = 'SSSTS - G' THEN 'Construction'
		WHEN description = 'CSCS NVQ 3' THEN 'Construction'
		WHEN description = 'JIB' THEN 'Construction'
		WHEN description = 'ECS' THEN 'Construction'
		WHEN description = 'Carpenter' THEN 'Construction'
		WHEN description = 'Plumber' THEN 'Construction'
		WHEN description = 'Plasterer' THEN 'Construction'
		WHEN description = 'Labourer' THEN 'Construction'
		WHEN description = 'Painter' THEN 'Construction'
		WHEN description = 'Electrian' THEN 'Construction'
		WHEN description = 'Demo' THEN 'Construction'
		WHEN description = 'Project Manager' THEN 'Construction'
		WHEN description = 'Site Manager' THEN 'Construction'
		WHEN description = 'Assistant Site Manager' THEN 'Construction'
		WHEN description = 'Improver' THEN 'Construction'
		WHEN description = 'Electrician' THEN 'Construction'
		WHEN description = 'Electricians Mate' THEN 'Construction'
		WHEN description = 'Plumbers Mate' THEN 'Construction'
		WHEN description = 'Pipe Fitter' THEN 'Construction'
		WHEN description = 'Pipe Fitters Mate' THEN 'Construction'
		WHEN description = 'Bricklayer' THEN 'Construction'
		WHEN description = 'Dryliner' THEN 'Construction'
		WHEN description = 'Ceiling Fixer' THEN 'Construction'
		WHEN description = 'Skilled Labourer' THEN 'Construction'
		WHEN description = 'Ganga' THEN 'Construction'
		WHEN description = 'Purchasing Admin' THEN 'Buyer'
		WHEN description = 'Buyer' THEN 'Buyer'
		WHEN description = 'Purchasing Manager' THEN 'Buyer'
		WHEN description = 'Ground Worker' THEN 'Construction'
		WHEN description = 'Engineer' THEN 'Construction'
		WHEN description = 'Steel Fixer' THEN 'Construction'
		WHEN description = 'Welder' THEN 'Construction'
		WHEN description = 'FLTD' THEN 'Construction'
		WHEN description = 'Logistics Mgr / Sup' THEN 'Transport/Logistics'
		WHEN description = 'Export Clerk' THEN 'Transport/Logistics'
		WHEN description = 'Import Clerk' THEN 'Transport/Logistics'
		WHEN description = 'Logistics Administrator' THEN 'Transport/Logistics'
		WHEN description = 'Stock Controller' THEN 'Transport/Logistics'
		WHEN description = 'Planner' THEN 'Transport/Logistics'
		WHEN description = 'Fleet Coordinator / Admin' THEN 'Transport/Logistics'
		WHEN description = 'Materials Planner' THEN 'Transport/Logistics'
		WHEN description = 'Managing Director' THEN 'General (Mgr)'
		WHEN description = 'Operations Mgr / Director' THEN 'General (Mgr)'
		WHEN description = 'General Manager' THEN 'General (Mgr)'
		WHEN description = 'HR Business Partner' THEN 'Human Resources'
		WHEN description = 'HR Assistant' THEN 'Human Resources'
		WHEN description = 'HR Administrator' THEN 'Human Resources'
		WHEN description = 'HR Advisor' THEN 'Human Resources'
		WHEN description = 'HR Director' THEN 'Human Resources'
		WHEN description = 'HR Manager' THEN 'Human Resources'
		WHEN description = 'Health &amp; Safety Manager' THEN 'Human Resources'
		WHEN description = 'Health &amp; Safety Administrator' THEN 'Human Resources'
		WHEN description = 'Resourcing Manager' THEN 'Human Resources'
		WHEN description = 'Recruiter' THEN 'Human Resources'
		WHEN description = 'HR Comps &amp; Bens' THEN 'Human Resources'
		WHEN description = 'Employee Relations Mgr' THEN 'Human Resources'
		WHEN description = 'Shared Services Mgr' THEN 'Human Resources'
		WHEN description = 'Shared Services Advisor' THEN 'Human Resources'
		WHEN description = 'Shared Services Admin' THEN 'Human Resources'
		WHEN description = 'Training Admin' THEN 'Training'
		WHEN description = 'Training Assistant' THEN 'Training'
		WHEN description = 'Training Consultant' THEN 'Training'
		WHEN description = 'Training Co-ordinator' THEN 'Training'
		WHEN description = 'Training Manager' THEN 'Training'
		WHEN description = 'Trainer' THEN 'Training'
		WHEN description = 'IT' THEN 'IT'
		WHEN description = 'Technical Support' THEN 'IT'
		WHEN description = 'IT Development' THEN 'IT'
		WHEN description = 'IT Networks' THEN 'IT'
		WHEN description = 'IT Consultant' THEN 'IT'
		WHEN description = 'Systems Analyst' THEN 'IT'
		WHEN description = 'IT Management' THEN 'IT'
		WHEN description = 'Call Centre Manager' THEN 'Customer Services'
		WHEN description = 'Call Centre Team Leader' THEN 'Customer Services'
		WHEN description = 'Call Centre Assistant' THEN 'Customer Services'
		WHEN description = 'Cust Service Mgr' THEN 'Customer Services'
		WHEN description = 'Cust Services Supervi' THEN 'Customer Services'
		WHEN description = 'Cust Services Assis' THEN 'Customer Services'
		WHEN description = 'Cust Service Admin' THEN 'Customer Services'
		WHEN description = 'Dealership Service Advisor' THEN 'Customer Services'
		WHEN description = 'Financial Advisor' THEN 'Financial'
		WHEN description = 'Pensions Administrator' THEN 'Financial'
		WHEN description = 'Underwriter' THEN 'Financial'
		WHEN description = 'SEO Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'SEO Assistant' THEN 'Sales &amp; Marketing'
		WHEN description = 'Account Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Brand Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Event Admin' THEN 'Sales &amp; Marketing'
		WHEN description = 'Event Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Merchandiser' THEN 'Sales &amp; Marketing'
		WHEN description = 'Marketing Administrator' THEN 'Sales &amp; Marketing'
		WHEN description = 'Marketing Co-ordinator' THEN 'Sales &amp; Marketing'
		WHEN description = 'Marketing Director' THEN 'Sales &amp; Marketing'
		WHEN description = 'Marketing Executive' THEN 'Sales &amp; Marketing'
		WHEN description = 'Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'PR Consultant' THEN 'Sales &amp; Marketing'
		WHEN description = 'PR Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Sales Executive' THEN 'Sales &amp; Marketing'
		WHEN description = 'Sales Negotiator' THEN 'Sales &amp; Marketing'
		WHEN description = 'Sales Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Sales Director' THEN 'Sales &amp; Marketing'
		WHEN description = 'Sales Support Admin' THEN 'Sales &amp; Marketing'
		WHEN description = 'Telesales Clerk' THEN 'Sales &amp; Marketing'
		WHEN description = 'Telesales Supervisor' THEN 'Sales &amp; Marketing'
		WHEN description = 'Online Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'Online Marketing Assistant' THEN 'Sales &amp; Marketing'
		WHEN description = 'E-Commerce Manager' THEN 'Sales &amp; Marketing'
		WHEN description = 'E-Commerce Assistant' THEN 'Sales &amp; Marketing'
		WHEN description = 'Website Assistant' THEN 'Sales &amp; Marketing'
		WHEN description = 'Web Developer' THEN 'Sales &amp; Marketing'
		WHEN description = 'Graphic Designer' THEN 'Sales &amp; Marketing'
		WHEN description = 'Photographer' THEN 'Sales &amp; Marketing'
		WHEN description = 'Videographer' THEN 'Sales &amp; Marketing'
		WHEN description = 'Internal Communications' THEN 'Sales &amp; Marketing'
		WHEN description = 'Administrator' THEN 'Office'
		WHEN description = 'Data Entry Clerk' THEN 'Office'
		WHEN description = 'Data Entry Supervisor' THEN 'Office'
		WHEN description = 'Facilities Manager' THEN 'Office'
		WHEN description = 'Facilities Administrator' THEN 'Office'
		WHEN description = 'Insurance Clerk' THEN 'Office'
		WHEN description = 'Office Junior' THEN 'Office'
		WHEN description = 'Office Manager' THEN 'Office'
		WHEN description = 'Receptionist' THEN 'Office'
		WHEN description = 'Senior Administrator' THEN 'Office'
		WHEN description = 'Swtichboard Operator' THEN 'Office'
		WHEN description = 'Analyst' THEN 'Office'
		WHEN description = 'Audio Secretary' THEN 'Office'
		WHEN description = 'Bi-Lingual Secretary' THEN 'Office'
		WHEN description = 'Junior Secretary' THEN 'Office'
		WHEN description = 'Legal Secretary' THEN 'Office'
		WHEN description = 'Medical Secretary' THEN 'Office'
		WHEN description = 'Personal Assistant' THEN 'Office'
		WHEN description = 'PA Secretary' THEN 'Office'
		WHEN description = 'Operations Administrator' THEN 'Office'
		WHEN description = 'Project Manager' THEN 'Office'
		WHEN description = 'Project Administrator' THEN 'Office'
	END fe
	FROM lookup
	WHERE code_type = '1010'
),
distinct_fe AS (
	SELECT DISTINCT fe
	FROM fe_mapping
	WHERE fe IS NOT NULL
)
SELECT ROW_NUMBER() OVER() id,
fe,
CURRENT_TIMESTAMP insert_timestamp
FROM distinct_fe</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2288</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert FE</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>Y</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>functional_expertise</table>
      <key>
        <name>fe</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>fe</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>id</name>
        <rename>id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2464</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert candidate_source</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>candidate_source</table>
      <key>
        <name>source</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>source</rename>
        <update>Y</update>
      </value>
      <value>
        <name>source_type</name>
        <rename>source_type</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>payment_style</name>
        <rename>payment_style</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2320</xloc>
      <yloc>768</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert industry 2</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>Y</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>industry</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>240</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>activity_type</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description AS event_type,
	ROW_NUMBER() OVER() + 1000 id,
	CURRENT_TIMESTAMP insert_timestamp,
	'#333333' background_color
FROM lookup 
WHERE code_type = '123'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3760</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
check_dup_email AS (
	SELECT ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(email_address)) ORDER BY person_ref) rn_email,
	*
	FROM candidate_type
	WHERE rn = 1
	AND person_ref IS NOT NULL
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
talent_pool AS (
	SELECT 
		object_ref AS  candidate_id,
		CASE
			WHEN savelist_ref IN ('115814', '112854') THEN 'thuntley@hamlinknight.co.uk'
			WHEN savelist_ref IN ('113916', '116598') THEN 'pberry@hamlinknight.co.uk'
			WHEN savelist_ref IN ('116735') THEN 'charlotte.clarke@hamlinknight.co.uk'
			WHEN savelist_ref IN ('114125', '115874', '114210', '116469', '116729') THEN 'cbarnes@hamlinknight.co.uk'
			WHEN savelist_ref IN ('112842') THEN 'suky.rahim@hamlinknight.co.uk'
		END AS consultant,
		CASE
			WHEN savelist_ref = '115814' THEN 'IMMEDIATELY AVAILABLES'
			WHEN savelist_ref = '112854' THEN 'PERM CANDIDATES -TAMS'
			WHEN savelist_ref = '113916' THEN 'PERM CANDIDATES PB'
			WHEN savelist_ref = '116598' THEN 'BEZZA TEMPS'
			WHEN savelist_ref = '116735' THEN 'Charlotte Candidates'
			WHEN savelist_ref = '114125' THEN 'Available Temps'
			WHEN savelist_ref = '115874' THEN 'Nat''s Candidates'
			WHEN savelist_ref = '114210' THEN 'Available Perm'
			WHEN savelist_ref = '116469' THEN 'Person Finder (Quick search results)'
			WHEN savelist_ref = '116729' THEN 'NS Candidates'
			WHEN savelist_ref = '112842' THEN 'temp log candidates'
		END AS group_name
	FROM savelist_entry
	WHERE savelist_ref IN ( '115814', '112854', '113916', '116598', '116735', '114125', '115874', '114210', '116469', '116729', '112842')
)
------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
cde.person_ref AS candidate_id,
tp.consultant,
tp.group_name,
CURRENT_TIMESTAMP insert_timestamp,
-10 user_admin
FROM check_dup_email cde
JOIN candidate_status cst ON cde.status = cst.code
JOIN talent_pool tp ON cde.person_ref = tp.candidate_id
WHERE cst.code IN ('A1', 'I1')
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4240</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_FE</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
candidate_fe AS (
	SELECT
		sc.person_ref candidate_id,
		sc.code fe_code,
		ROW_NUMBER() OVER(PARTITION BY sc.person_ref, sc.code ORDER BY sc.person_ref) rn
	FROM search_code sc
	JOIN candidate_type ct ON sc.person_ref = ct.person_ref AND rn = 1
	JOIN candidate_status cst ON ct.status = cst.code
	WHERE sc.person_ref IS NOT NULL
	AND sc.code_type = '1010'
	AND cst.code IN ('A1', 'I1')
),
funtional_expertise AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1010'
),
candidate_fe_sub_fe AS (
SELECT
	cfe.candidate_id,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN 'Part time'
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = '360 Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'Construction'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'Construction'
		WHEN TRIM(fe.description) = 'JIB' THEN 'Construction'
		WHEN TRIM(fe.description) = 'ECS' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Construction'
		WHEN TRIM(fe.description) = 'BUYER' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Construction'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'Construction'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'TRAINING' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Training'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Financial'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'OFFICE' THEN 'Office'
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Office'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Office'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Office'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Office'
	END fe,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN ''
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN ''
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountant'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Assistant Accountant'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Company Secretary'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Finance Manager'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Financial Accountant'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Financial Analyst'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Bookkeeper'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Financial Controller'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Finance Director'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Mgmt Accountant'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Auditor'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accounts Assistant'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Purchase Ledger Clerk'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Purchase Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Sales Ledger Clerk'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Sales Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Payroll Clerk'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Payroll Manager / Supervisor'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Credit Control Mgr / Sup'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Credit Controller'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Legal Cashier'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN ''
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Counterbalance Driver'
		WHEN TRIM(fe.description) = '360 Driver' THEN '360 Driver'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Wallpaper Hanger'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Tiler'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'SMSTS - Grst Aid'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'SSSTS - G'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'CSCS NVQ 3'
		WHEN TRIM(fe.description) = 'JIB' THEN 'JIB'
		WHEN TRIM(fe.description) = 'ECS' THEN 'ECS'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Carpenter'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Plumber'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Plasterer'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Labourer'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Painter'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Electrian'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Demo'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Site Manager'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Assistant Site Manager'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Improver'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Electrician'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Electricians Mate'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Plumbers Mate'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Pipe Fitter'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Pipe Fitters Mate'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Bricklayer'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Dryliner'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Ceiling Fixer'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Skilled Labourer'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Ganga'
		WHEN TRIM(fe.description) = 'BUYER' THEN ''
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Purchasing Admin'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Purchasing Manager'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Ground Worker'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Engineer'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Steel Fixer'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Welder'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'FLTD'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN ''
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Logistics Mgr / Sup'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Export Clerk'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Import Clerk'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Logistics Administrator'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Stock Controller'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Planner'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Fleet Coordinator / Admin'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Materials Planner'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN ''
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'Managing Director'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'Operations Mgr / Director'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General Manager'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN ''
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'HR Business Partner'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'HR Assistant'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'HR Administrator'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'HR Advisor'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'HR Director'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'HR Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Health &amp; Safety Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Health &amp; Safety Administrator'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Resourcing Manager'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Recruiter'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'HR Comps &amp; Bens'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Employee Relations Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Shared Services Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Shared Services Advisor'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Shared Services Admin'
		WHEN TRIM(fe.description) = 'TRAINING' THEN ''
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training Admin'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training Assistant'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training Consultant'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training Co-ordinator'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training Manager'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Trainer'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN ''
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'Technical Support'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT Development'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT Networks'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT Consultant'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'Systems Analyst'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT Management'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN ''
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Call Centre Manager'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Call Centre Team Leader'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Call Centre Assistant'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Cust Service Mgr'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Cust Services Supervi'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Cust Services Assis'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Cust Service Admin'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Dealership Service Advisor'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN ''
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial Advisor'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Pensions Administrator'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Underwriter'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN ''
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'SEO Manager'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'SEO Assistant'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Account Manager'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Brand Manager'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Event Admin'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Event Manager'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Merchandiser'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Marketing Administrator'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Marketing Co-ordinator'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Marketing Director'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Marketing Executive'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Marketing Manager'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'PR Consultant'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'PR Manager'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales Executive'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales Negotiator'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales Manager'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales Director'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales Support Admin'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Telesales Clerk'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Telesales Supervisor'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Online Marketing Manager'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Online Marketing Assistant'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'E-Commerce Manager'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'E-Commerce Assistant'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Website Assistant'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Web Developer'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Graphic Designer'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Photographer'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Videographer'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Internal Communications'
		WHEN TRIM(fe.description) = 'OFFICE' THEN ''
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Administrator'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Data Entry Clerk'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Data Entry Supervisor'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Facilities Manager'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Facilities Administrator'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Insurance Clerk'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office Junior'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office Manager'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Receptionist'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Senior Administrator'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Swtichboard Operator'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Analyst'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Audio Secretary'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Bi-Lingual Secretary'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Junior Secretary'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Legal Secretary'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Medical Secretary'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Personal Assistant'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'PA Secretary'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Operations Administrator'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Project Administrator'
	END sub_fe,
	CURRENT_TIMESTAMP insert_timestamp
FROM candidate_fe cfe
JOIN funtional_expertise fe ON cfe.fe_code = fe.code
WHERE cfe.rn = 1
AND fe.description IS NOT NULL
)

SELECT *
FROM candidate_fe_sub_fe
WHERE NULLIF(sub_fe, '') IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2288</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_FE_no_sub_FE 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
candidate_fe AS (
	SELECT
		sc.person_ref candidate_id,
		sc.code fe_code,
		ROW_NUMBER() OVER(PARTITION BY sc.person_ref, sc.code ORDER BY sc.person_ref) rn
	FROM search_code sc
	JOIN candidate_type ct ON sc.person_ref = ct.person_ref AND rn = 1
	JOIN candidate_status cst ON ct.status = cst.code
	WHERE sc.person_ref IS NOT NULL
	AND sc.code_type = '1010'
	AND cst.code IN ('A1', 'I1')
),
funtional_expertise AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1010'
),
candidate_fe_sub_fe AS (
SELECT
	cfe.candidate_id,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN 'Part time'
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = '360 Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'Construction'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'Construction'
		WHEN TRIM(fe.description) = 'JIB' THEN 'Construction'
		WHEN TRIM(fe.description) = 'ECS' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Construction'
		WHEN TRIM(fe.description) = 'BUYER' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Construction'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'Construction'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'TRAINING' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Training'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Financial'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'OFFICE' THEN 'Office'
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Office'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Office'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Office'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Office'
	END fe,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN ''
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN ''
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountant'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Assistant Accountant'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Company Secretary'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Finance Manager'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Financial Accountant'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Financial Analyst'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Bookkeeper'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Financial Controller'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Finance Director'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Mgmt Accountant'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Auditor'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accounts Assistant'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Purchase Ledger Clerk'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Purchase Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Sales Ledger Clerk'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Sales Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Payroll Clerk'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Payroll Manager / Supervisor'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Credit Control Mgr / Sup'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Credit Controller'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Legal Cashier'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN ''
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Counterbalance Driver'
		WHEN TRIM(fe.description) = '360 Driver' THEN '360 Driver'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Wallpaper Hanger'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Tiler'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'SMSTS - Grst Aid'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'SSSTS - G'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'CSCS NVQ 3'
		WHEN TRIM(fe.description) = 'JIB' THEN 'JIB'
		WHEN TRIM(fe.description) = 'ECS' THEN 'ECS'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Carpenter'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Plumber'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Plasterer'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Labourer'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Painter'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Electrian'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Demo'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Site Manager'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Assistant Site Manager'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Improver'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Electrician'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Electricians Mate'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Plumbers Mate'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Pipe Fitter'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Pipe Fitters Mate'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Bricklayer'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Dryliner'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Ceiling Fixer'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Skilled Labourer'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Ganga'
		WHEN TRIM(fe.description) = 'BUYER' THEN ''
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Purchasing Admin'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Purchasing Manager'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Ground Worker'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Engineer'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Steel Fixer'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Welder'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'FLTD'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN ''
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Logistics Mgr / Sup'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Export Clerk'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Import Clerk'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Logistics Administrator'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Stock Controller'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Planner'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Fleet Coordinator / Admin'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Materials Planner'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN ''
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'Managing Director'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'Operations Mgr / Director'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General Manager'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN ''
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'HR Business Partner'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'HR Assistant'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'HR Administrator'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'HR Advisor'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'HR Director'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'HR Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Health &amp; Safety Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Health &amp; Safety Administrator'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Resourcing Manager'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Recruiter'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'HR Comps &amp; Bens'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Employee Relations Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Shared Services Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Shared Services Advisor'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Shared Services Admin'
		WHEN TRIM(fe.description) = 'TRAINING' THEN ''
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training Admin'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training Assistant'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training Consultant'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training Co-ordinator'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training Manager'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Trainer'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN ''
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'Technical Support'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT Development'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT Networks'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT Consultant'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'Systems Analyst'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT Management'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN ''
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Call Centre Manager'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Call Centre Team Leader'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Call Centre Assistant'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Cust Service Mgr'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Cust Services Supervi'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Cust Services Assis'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Cust Service Admin'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Dealership Service Advisor'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN ''
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial Advisor'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Pensions Administrator'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Underwriter'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN ''
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'SEO Manager'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'SEO Assistant'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Account Manager'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Brand Manager'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Event Admin'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Event Manager'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Merchandiser'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Marketing Administrator'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Marketing Co-ordinator'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Marketing Director'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Marketing Executive'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Marketing Manager'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'PR Consultant'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'PR Manager'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales Executive'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales Negotiator'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales Manager'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales Director'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales Support Admin'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Telesales Clerk'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Telesales Supervisor'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Online Marketing Manager'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Online Marketing Assistant'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'E-Commerce Manager'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'E-Commerce Assistant'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Website Assistant'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Web Developer'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Graphic Designer'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Photographer'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Videographer'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Internal Communications'
		WHEN TRIM(fe.description) = 'OFFICE' THEN ''
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Administrator'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Data Entry Clerk'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Data Entry Supervisor'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Facilities Manager'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Facilities Administrator'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Insurance Clerk'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office Junior'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office Manager'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Receptionist'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Senior Administrator'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Swtichboard Operator'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Analyst'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Audio Secretary'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Bi-Lingual Secretary'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Junior Secretary'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Legal Secretary'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Medical Secretary'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Personal Assistant'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'PA Secretary'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Operations Administrator'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Project Administrator'
	END sub_fe,
	CURRENT_TIMESTAMP insert_timestamp
FROM candidate_fe cfe
JOIN funtional_expertise fe ON cfe.fe_code = fe.code
WHERE cfe.rn = 1
AND fe.description IS NOT NULL
)

SELECT *
FROM candidate_fe_sub_fe
WHERE NULLIF(sub_fe, '') IS NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2288</xloc>
      <yloc>560</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_activities</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
event_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '123'
),
contact_owner AS (
	SELECT
		person_ref,
		type,
		s.email_address
	FROM person_type pt
	LEFT JOIN staff s ON pt.person_type_ref = s.person_type_ref
	WHERE pt.type LIKE '%Z%'
	AND s.email_address LIKE '%@%'
),
candidate_activity AS (
	SELECT
	c.person_ref candidate_id,
	et.description activity_type,
	CONCAT_WS(
		E'\n',
		CASE WHEN NULLIF(et.description, '') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
		CONCAT('Author: ', p.last_name, ' ', p.first_name),
		CASE WHEN NULLIF(co.email_address, '') IS NOT NULL THEN CONCAT('Email: ', co.email_address) END,
		CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
		CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
	) AS content,
	CONCAT(e.event_date, ' ', e.event_time)::TIMESTAMP insert_timestamp,
	'comment' AS category,
	'candidate' AS type,
	-10 AS user_account_id,
	ROW_NUMBER() OVER(PARTITION BY c.person_ref, CONCAT_WS(
																												E'\n',
																												CASE WHEN NULLIF(et.description, 'nan') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
																												CONCAT('Author: ', p.last_name, ' ', p.first_name),
																												CASE WHEN NULLIF(co.email_address, 'nan') IS NOT NULL THEN CONCAT('Email: ', co.email_address) END,
																												CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
																												CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
																											) ORDER BY c.person_ref) AS rn

	FROM event e
	JOIN event_role er ON e.event_ref = er.event_ref
	JOIN candidate c ON er.person_ref = c.person_ref AND c.rn = 1
	JOIN candidate_status cs ON c.status = cs.code AND cs.code IN ('A1', 'I1')
	LEFT JOIN person p ON e.create_user = p.person_ref
	LEFT JOIN contact_owner co ON e.create_user = co.person_ref
	LEFT JOIN event_type et ON e.type = et.code
	WHERE NULLIF(c.person_ref, '') IS NOT NULL
	AND NULLIF(e.event_date, '') IS NOT NULL
)

SELECT *
FROM candidate_activity
WHERE rn = 1
AND activity_type IN (
'Drop to Client', 'Sick', 'Sales Lead', 'Sales lead - hot', 'Sales lead - normal', 'Client shutdown', 'Maternity/paternity leave', 'Working via another agency', 'Did not attend', 
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Activity', 'Referral - good', 'Referral - average', 'Referral - negative', 'Permanent offer', 'Position move to temporary job', 'Position move to contract', 'Position move to permanent position',
'Position move', 'Referral', 'Telephone call', 'Letter,Fax,Email', 'Mailshot', 'CV received', 'CV update', 'CV sent', 'Registration Interview', 'Interview 1 with client', 'Interview 2 with client',
'Interview 3 with client', 'Interview other', 'Canvass call', 'Meeting with client', 'Proposal submitted', 'Reference request', 'Invoice', 'Invoice for retainer', 'Invoice for shortlist',
'Invoice for completion', 'Temporary booking', 'Follow-up', 'Source', 'Debrief', 'Registration Interview', 'Candidate Call', 'Service Meeting', 'Staff Assessment', 'Sales Call', 'Marketing Call',
'Service Contact Call', 'Email Received', 'Text Message Received', 'Quick text', 'Email sent', 'Spec Cv Sent', 'Phone call made', 'Registration Interview', 'Contact call', 'Candidate call',
'Contact sales call', 'Candidate sales call', 'Target', 'Shortlist', 'Placement', 'Hitlist', 'Client Sales Call', 'Telephone Dial', 'Voicemail Call', 'Service Contact Call', 'Sales Contact Call', 
'Timesheet', 'PSL', 'Invite for Interview', 'Reject Candidate', 'Pay Advance Request', 'Profile requested P45', 'P45 auto-raised in back-office', 'P45 requested via website', 'Holiday',
'Shift booking', 'Process CV from email', 'Process vacancy from email', 'Process import from email')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2288</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_activity_type</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>SELECT 
	id, 
	REPLACE(REPLACE(activity_type, 'Telephone call', 'Telephone Call'), 'Candidate call', 'Candidate Call') activity_type,
	CURRENT_TIMESTAMP AS insert_timestamp
FROM activity
WHERE category = 'comment'
AND type = 'candidate'
AND user_account_id = -10
AND activity_type IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3696</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
parent_object_ref candidate_id,
CONCAT(parent_object_ref, '.', l.linkfile_ref, '.', file_extension) document_name,
file_extension,
parent_object_name,
l.displayname,
'CANDIDATE' entity_type,
'resume' document_type
FROM linkfile l
JOIN person p ON l.parent_object_ref = p.person_ref
WHERE parent_object_name = 'person'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2288</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_email_subscription</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
)
SELECT
	ct.person_ref candidate_id,
	CASE
		WHEN ct.do_not_mailshot = 'Y' THEN 0
		ELSE 1
	END email_subscribed,
	CURRENT_TIMESTAMP insert_timestamp
FROM candidate_type ct
JOIN candidate_status cst ON ct.status = cst.code
WHERE ct.rn = 1
AND cst.code IN ('A1', 'I1')
AND ct.do_not_mailshot = 'Y'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2320</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_industry 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
candidate_industry AS (
	SELECT
		sc.person_ref candidate_id,
		sc.code industry_code,
		ROW_NUMBER() OVER(PARTITION BY sc.person_ref, sc.code ORDER BY sc.person_ref) rn
	FROM search_code sc
	JOIN candidate_type ct ON sc.person_ref = ct.person_ref AND rn = 1
	JOIN candidate_status cst ON ct.status = cst.code
	WHERE sc.person_ref IS NOT NULL
	AND sc.code_type = '1005'
	AND cst.code IN ('A1', 'I1')
),
industry AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1005'
)
SELECT
	ci.candidate_id,
	CASE
		WHEN i.description = 'IT Services' THEN 'IT Services'
		WHEN i.description = 'Carpenter' THEN 'Carpenter'
		WHEN i.description = 'Painting' THEN 'Painting'
		WHEN i.description = 'Shopfitting' THEN 'Shopfitting'
		WHEN i.description = 'Civils' THEN 'Civils'
		WHEN i.description = 'Drylining' THEN 'Drylining'
		WHEN i.description = 'Interiors' THEN 'Interiors'
		WHEN i.description = 'Student Accommodation' THEN 'Student Accommodation'
		WHEN i.description = 'High End Apartments' THEN 'High End Apartments'
		WHEN i.description = 'BUSINESS SERVICES' THEN 'BUSINESS SERVICES'
		WHEN i.description = 'Business Services General' THEN 'Business Services General'
		WHEN i.description = 'Accountancy' THEN 'Accountancy'
		WHEN i.description = 'Consultancy' THEN 'Consultancy'
		WHEN i.description = 'Property/Estate Agency' THEN 'Property/Estate Agency'
		WHEN i.description = 'Recruitment' THEN 'Recruitment'
		WHEN i.description = 'Training' THEN 'Training'
		WHEN i.description = 'Solicitors' THEN 'Solicitors'
		WHEN i.description = 'Call Centre' THEN 'Call Centre'
		WHEN i.description = 'Payroll' THEN 'Payroll'
		WHEN i.description = 'Charities' THEN 'Charities'
		WHEN i.description = 'Agricultural' THEN 'Agricultural'
		WHEN i.description = 'Dental Products' THEN 'Dental Products'
		WHEN i.description = 'CONSTRUCTION' THEN 'CONSTRUCTION'
		WHEN i.description = 'Construction General' THEN 'Construction General'
		WHEN i.description = 'Building Construction' THEN 'Building Construction'
		WHEN i.description = 'Buidling Materials' THEN 'Buidling Materials'
		WHEN i.description = 'FOOD / FMCG / CONSUMER GOODS' THEN 'FOOD / FMCG / CONSUMER GOODS'
		WHEN i.description = 'Cosmetics, Toiletries' THEN 'Cosmetics, Toiletries'
		WHEN i.description = 'Food, Drink, Tobacco' THEN 'Food, Drink, Tobacco'
		WHEN i.description = 'Household Goods' THEN 'Household Goods'
		WHEN i.description = 'Office Products, Stationery' THEN 'Office Products, Stationery'
		WHEN i.description = 'Electronics' THEN 'Electronics'
		WHEN i.description = 'Packaging' THEN 'Packaging'
		WHEN i.description = 'DISTRIBUTION/WAREHOUSING' THEN 'DISTRIBUTION/WAREHOUSING'
		WHEN i.description = 'Distribution General' THEN 'Distribution General'
		WHEN i.description = 'Distribution Automotive' THEN 'Distribution Automotive'
		WHEN i.description = 'Logistics' THEN 'Logistics'
		WHEN i.description = 'Warehouse' THEN 'Warehouse'
		WHEN i.description = 'ENGINEERING' THEN 'ENGINEERING'
		WHEN i.description = 'Engineering General' THEN 'Engineering General'
		WHEN i.description = 'Civil Engineering' THEN 'Civil Engineering'
		WHEN i.description = 'Mechanical Engineering' THEN 'Mechanical Engineering'
		WHEN i.description = 'Rubber/Plastic/Rope' THEN 'Rubber/Plastic/Rope'
		WHEN i.description = 'Waste Management Services' THEN 'Waste Management Services'
		WHEN i.description = 'Electrical Engineering' THEN 'Electrical Engineering'
		WHEN i.description = 'Mechanical Handling' THEN 'Mechanical Handling'
		WHEN i.description = 'Precision Engineering' THEN 'Precision Engineering'
		WHEN i.description = 'MANUFACTURING' THEN 'MANUFACTURING'
		WHEN i.description = 'Manufacturing General' THEN 'Manufacturing General'
		WHEN i.description = 'Motor Manufacturing' THEN 'Motor Manufacturing'
		WHEN i.description = 'Clothing Manufacturing' THEN 'Clothing Manufacturing'
		WHEN i.description = 'Industrial Manufacturing' THEN 'Industrial Manufacturing'
		WHEN i.description = 'FINANCE' THEN 'FINANCE'
		WHEN i.description = 'Finance General' THEN 'Finance General'
		WHEN i.description = 'Banks / Building Society' THEN 'Banks / Building Society'
		WHEN i.description = 'Financial Services' THEN 'Financial Services'
		WHEN i.description = 'Insurance' THEN 'Insurance'
		WHEN i.description = 'IT &amp; COMMUNICATIONS' THEN 'IT &amp; COMMUNICATIONS'
		WHEN i.description = 'Communications General' THEN 'Communications General'
		WHEN i.description = 'IT General' THEN 'IT General'
		WHEN i.description = 'IT Software' THEN 'IT Software'
		WHEN i.description = 'IT Training' THEN 'IT Training'
		WHEN i.description = 'Telecommunications' THEN 'Telecommunications'
		WHEN i.description = 'CHEMICALS PRODUCTION' THEN 'CHEMICALS PRODUCTION'
		WHEN i.description = 'Chemicals General' THEN 'Chemicals General'
		WHEN i.description = 'Oil &amp; Petrochemicals' THEN 'Oil &amp; Petrochemicals'
		WHEN i.description = 'LEISURE' THEN 'LEISURE'
		WHEN i.description = 'Leisure General' THEN 'Leisure General'
		WHEN i.description = 'Breweries' THEN 'Breweries'
		WHEN i.description = 'Catering' THEN 'Catering'
		WHEN i.description = 'Entertainment' THEN 'Entertainment'
		WHEN i.description = 'Hotel' THEN 'Hotel'
		WHEN i.description = 'Travel' THEN 'Travel'
		WHEN i.description = 'MEDIA/MARKETING' THEN 'MEDIA/MARKETING'
		WHEN i.description = 'Media General' THEN 'Media General'
		WHEN i.description = 'Design Agency' THEN 'Design Agency'
		WHEN i.description = 'Journalism' THEN 'Journalism'
		WHEN i.description = 'Books' THEN 'Books'
		WHEN i.description = 'Newspapers' THEN 'Newspapers'
		WHEN i.description = 'Printing &amp; Publishing' THEN 'Printing &amp; Publishing'
		WHEN i.description = 'Advertising' THEN 'Advertising'
		WHEN i.description = 'Marketing' THEN 'Marketing'
		WHEN i.description = 'Telemarketing' THEN 'Telemarketing'
		WHEN i.description = 'PUBLIC SECTOR' THEN 'PUBLIC SECTOR'
		WHEN i.description = 'Public Sector General' THEN 'Public Sector General'
		WHEN i.description = 'NHS' THEN 'NHS'
		WHEN i.description = 'Medical' THEN 'Medical'
		WHEN i.description = 'Primary Care Trust' THEN 'Primary Care Trust'
		WHEN i.description = 'Central Government' THEN 'Central Government'
		WHEN i.description = 'Local Borough' THEN 'Local Borough'
		WHEN i.description = 'Police' THEN 'Police'
		WHEN i.description = 'Fire' THEN 'Fire'
		WHEN i.description = 'Health' THEN 'Health'
		WHEN i.description = 'Armed Forces' THEN 'Armed Forces'
		WHEN i.description = 'Education' THEN 'Education'
		WHEN i.description = 'Council' THEN 'Council'
		WHEN i.description = 'PHARMACEUTICALS' THEN 'PHARMACEUTICALS'
		WHEN i.description = 'Pharmaceuticals General' THEN 'Pharmaceuticals General'
		WHEN i.description = 'Pharmaceutical Equipment' THEN 'Pharmaceutical Equipment'
		WHEN i.description = 'RETAIL' THEN 'RETAIL'
		WHEN i.description = 'Retail General' THEN 'Retail General'
		WHEN i.description = 'Food Retail' THEN 'Food Retail'
		WHEN i.description = 'DIY Retail' THEN 'DIY Retail'
		WHEN i.description = 'Home Furnishings' THEN 'Home Furnishings'
		WHEN i.description = 'Large Multiples' THEN 'Large Multiples'
		WHEN i.description = 'Fashion' THEN 'Fashion'
		WHEN i.description = 'TRANSPORT' THEN 'TRANSPORT'
		WHEN i.description = 'Transport General' THEN 'Transport General'
		WHEN i.description = 'Automotive' THEN 'Automotive'
		WHEN i.description = 'Dealership' THEN 'Dealership'
		WHEN i.description = 'Marine Services' THEN 'Marine Services'
		WHEN i.description = 'Public Transport' THEN 'Public Transport'
		WHEN i.description = 'Road/Rail Haulage' THEN 'Road/Rail Haulage'
		WHEN i.description = 'Shipping' THEN 'Shipping'
		WHEN i.description = 'Aerospace' THEN 'Aerospace'
		WHEN i.description = 'Car Hire' THEN 'Car Hire'
		WHEN i.description = 'UTILITIES' THEN 'UTILITIES'
		WHEN i.description = 'Utilities General' THEN 'Utilities General'
		WHEN i.description = 'Gas &amp; Oil' THEN 'Gas &amp; Oil'
		WHEN i.description = 'Electricity' THEN 'Electricity'
		WHEN i.description = 'Water' THEN 'Water'
	END industry,
	CURRENT_TIMESTAMP insert_timestamp
FROM candidate_industry ci
JOIN industry i ON ci.industry_code = i.code
WHERE ci.rn = 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2304</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_location</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
check_dup_email AS (
	SELECT ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(email_address)) ORDER BY person_ref) rn_email,
	*
	FROM candidate_type
	WHERE rn = 1
	AND person_ref IS NOT NULL
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
candidate_location AS (
	SELECT 
		person_ref,
		CASE
			WHEN l.description = 'INTERNATIONAL' THEN 1
			WHEN l.description = 'Berlin' THEN 2
			WHEN l.description = 'Denmark' THEN 3
			WHEN l.description = 'Luxembourg' THEN 4
			WHEN l.description = 'NORTH WEST' THEN 5
			WHEN l.description = 'Manchester' THEN 6
			WHEN l.description = 'Oldham' THEN 7
			WHEN l.description = 'London' THEN 8
			WHEN l.description = 'Northampton' THEN 9
			WHEN l.description = 'Iceland' THEN 10
			WHEN l.description = 'Iver' THEN 11
			WHEN l.description = 'Dunstable' THEN 12
			WHEN l.description = 'Luton' THEN 13
			WHEN l.description = 'Milton Keynes' THEN 14
			WHEN l.description = 'Bedfordshire' THEN 15
			WHEN l.description = 'Luton' THEN 16
			WHEN l.description = 'Essex' THEN 17
			WHEN l.description = 'HERTFORDSHIRE' THEN 18
			WHEN l.description = 'Borehamwood' THEN 19
			WHEN l.description = 'Bushey' THEN 20
			WHEN l.description = 'Chorleywood' THEN 21
			WHEN l.description = 'Hatfield' THEN 22
			WHEN l.description = 'Hemel Hempstead' THEN 23
			WHEN l.description = 'Hitchin' THEN 24
			WHEN l.description = 'Maple Cross' THEN 25
			WHEN l.description = 'Rickmansworth' THEN 26
			WHEN l.description = 'St Albans' THEN 27
			WHEN l.description = 'Stevenage' THEN 28
			WHEN l.description = 'Watford' THEN 29
			WHEN l.description = 'Welwyn Garden City' THEN 30
			WHEN l.description = 'Kings Langley' THEN 31
			WHEN l.description = 'Chipperfield' THEN 32
			WHEN l.description = 'Bovingdon' THEN 33
			WHEN l.description = 'Berkhamstead' THEN 34
			WHEN l.description = 'Tring' THEN 35
			WHEN l.description = 'Redbourne' THEN 36
			WHEN l.description = 'Wembley' THEN 37
			WHEN l.description = 'Elstree' THEN 38
			WHEN l.description = 'Radlett' THEN 39
			WHEN l.description = 'Hertfordshire' THEN 40
			WHEN l.description = 'BUCKINGHAMSHIRE' THEN 41
			WHEN l.description = 'The Chalfonts' THEN 42
			WHEN l.description = 'Denham' THEN 43
			WHEN l.description = 'Gerrards Cross' THEN 44
			WHEN l.description = 'Stoke Poges' THEN 45
			WHEN l.description = 'High Wycombe' THEN 46
			WHEN l.description = 'Amersham' THEN 47
			WHEN l.description = 'Chesham' THEN 48
			WHEN l.description = 'Marlow' THEN 49
			WHEN l.description = 'Buckinghamshire' THEN 50
			WHEN l.description = 'MIDDLESEX' THEN 51
			WHEN l.description = 'Cowley' THEN 52
			WHEN l.description = 'Greenford' THEN 53
			WHEN l.description = 'Harefield' THEN 54
			WHEN l.description = 'Harmondsworth' THEN 55
			WHEN l.description = 'Harrow' THEN 56
			WHEN l.description = 'Hayes' THEN 57
			WHEN l.description = 'Heathrow' THEN 58
			WHEN l.description = 'Heston' THEN 59
			WHEN l.description = 'Hillingdon' THEN 60
			WHEN l.description = 'Ickenham' THEN 61
			WHEN l.description = 'Northolt' THEN 62
			WHEN l.description = 'Ruislip' THEN 63
			WHEN l.description = 'Southall' THEN 64
			WHEN l.description = 'Stanmore' THEN 65
			WHEN l.description = 'Stockley Park' THEN 66
			WHEN l.description = 'Uxbridge' THEN 67
			WHEN l.description = 'West Drayton' THEN 68
			WHEN l.description = 'Yiewsley' THEN 69
			WHEN l.description = 'Middlesex' THEN 70
			WHEN l.description = 'East Sussex' THEN 71
			WHEN l.description = 'Staines' THEN 72
			WHEN l.description = 'KENT' THEN 73
			WHEN l.description = 'Bromley' THEN 74
			WHEN l.description = 'Kent' THEN 75
			WHEN l.description = 'SURREY' THEN 76
			WHEN l.description = 'BERKSHIRE' THEN 77
			WHEN l.description = 'Colnbrook' THEN 78
			WHEN l.description = 'Langley' THEN 79
			WHEN l.description = 'Poyle' THEN 80
			WHEN l.description = 'Slough' THEN 81
			WHEN l.description = 'Berkshire' THEN 82
			WHEN l.description = 'Windsor' THEN 83
			WHEN l.description = 'OXFORDSHIRE' THEN 84
			WHEN l.description = 'Oxfordshire' THEN 85
			WHEN l.description = 'Banbury' THEN 86
			WHEN l.description = 'Bicester' THEN 87
			WHEN l.description = 'Thame' THEN 88
			WHEN l.description = 'Wiltshire' THEN 89
			WHEN l.description = 'LONDON' THEN 90
			WHEN l.description = 'City of London' THEN 91
			WHEN l.description = 'East London' THEN 92
			WHEN l.description = 'Stratford' THEN 93
			WHEN l.description = 'Docklands' THEN 94
			WHEN l.description = 'North London' THEN 95
			WHEN l.description = 'South London' THEN 96
			WHEN l.description = 'West London' THEN 97
			WHEN l.description = 'SOUTH EAST' THEN 98
			WHEN l.description = 'West Sussex' THEN 99
			WHEN l.description = 'Hampshire' THEN 100
			WHEN l.description = 'SOUTH WEST' THEN 101
			WHEN l.description = 'Bristol' THEN 102
			WHEN l.description = 'Avon' THEN 103
			WHEN l.description = 'Cornwall' THEN 104
			WHEN l.description = 'Dorset' THEN 105
			WHEN l.description = 'Devon' THEN 106
			WHEN l.description = 'Gloucestershire' THEN 107
			WHEN l.description = 'Somerset' THEN 108
			WHEN l.description = 'Cambridgeshire' THEN 109
			WHEN l.description = 'Norfolk' THEN 110
			WHEN l.description = 'Suffolk' THEN 111
			WHEN l.description = 'WEST MIDLANDS' THEN 112
			WHEN l.description = 'West Midlands' THEN 113
			WHEN l.description = 'Birmingham' THEN 114
			WHEN l.description = 'Solihull' THEN 115
			WHEN l.description = 'Dudley' THEN 116
			WHEN l.description = 'Herefordshire' THEN 117
			WHEN l.description = 'Worcestershire' THEN 118
			WHEN l.description = 'Staffordshire' THEN 119
			WHEN l.description = 'WARWICKSHIRE' THEN 120
			WHEN l.description = 'Atherstone' THEN 121
			WHEN l.description = 'Bedworth' THEN 122
			WHEN l.description = 'Coventry' THEN 123
			WHEN l.description = 'Kenilworth' THEN 124
			WHEN l.description = 'Leamington Spa' THEN 125
			WHEN l.description = 'Nuneaton' THEN 126
			WHEN l.description = 'Rugby' THEN 127
			WHEN l.description = 'Stratford Upon Avon' THEN 128
			WHEN l.description = 'Warwick' THEN 129
			WHEN l.description = 'Southam' THEN 130
			WHEN l.description = 'Warwickshire' THEN 131
			WHEN l.description = 'Lutterworth' THEN 132
			WHEN l.description = 'NORTH EAST' THEN 133
			WHEN l.description = 'NORTH YORKSHIRE' THEN 134
			WHEN l.description = 'North Yorkshire' THEN 135
			WHEN l.description = 'SOUTH YORKSHIRE' THEN 136
			WHEN l.description = 'South Yorkshire' THEN 137
			WHEN l.description = 'Sheffield' THEN 138
			WHEN l.description = 'Worksop' THEN 139
			WHEN l.description = 'Rotherham' THEN 140
			WHEN l.description = 'Mansfield' THEN 141
			WHEN l.description = 'Doncaster' THEN 142
			WHEN l.description = 'Derby' THEN 143
			WHEN l.description = 'Barnsley' THEN 144
			WHEN l.description = 'Chesterfield' THEN 145
			WHEN l.description = 'Dronfield' THEN 146
			WHEN l.description = 'Pontefract' THEN 147
			WHEN l.description = 'WEST YORKSHIRE' THEN 148
			WHEN l.description = 'Leeds' THEN 149
			WHEN l.description = 'EAST YORKSHIRE' THEN 150
			WHEN l.description = 'Goole' THEN 151
			WHEN l.description = 'Lincoln' THEN 152
			WHEN l.description = 'Grimsby' THEN 153
			WHEN l.description = 'Hull' THEN 154
			WHEN l.description = 'Scunthorpe' THEN 155
			WHEN l.description = 'SCOTLAND' THEN 156
			WHEN l.description = 'Aberdeen' THEN 157
			WHEN l.description = 'Dundee' THEN 158
			WHEN l.description = 'Edinburgh' THEN 159
			WHEN l.description = 'Fife' THEN 160
			WHEN l.description = 'Glasgow' THEN 161
			WHEN l.description = 'Kilmarnock' THEN 162
			WHEN l.description = 'Perth' THEN 163
			WHEN l.description = 'Sterling' THEN 164
			WHEN l.description = 'Scotland' THEN 165
			WHEN l.description = 'WALES' THEN 166
			WHEN l.description = 'Wales' THEN 167
			WHEN l.description = 'Cardiff' THEN 168
			WHEN l.description = 'Clywd' THEN 169
			WHEN l.description = 'Dyfed' THEN 170
			WHEN l.description = 'Gwynedd' THEN 171
			WHEN l.description = 'Gwent' THEN 172
			WHEN l.description = 'Mid Glamorgan' THEN 173
			WHEN l.description = 'South Glamorgan' THEN 174
			WHEN l.description = 'EAST MIDLANDS' THEN 175
			WHEN l.description = 'Leicestershire' THEN 176
			WHEN l.description = 'Hinckley' THEN 177
			WHEN l.description = 'Derby' THEN 178
			WHEN l.description = 'Nottingham' THEN 179
		END candidate_location,
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE person_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
concat_candidate_location AS (
	SELECT
		person_ref,
		string_agg(candidate_location::TEXT, ',') candidate_location
	FROM candidate_location
	WHERE rn = 1
	GROUP BY person_ref
)
------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
cde.person_ref AS candidate_id,
candidate_location,
'add_cand_info' additional_type,
1005 form_id,
11274 field_id,
'11274' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM check_dup_email cde
JOIN candidate_status cst ON cde.status = cst.code
JOIN concat_candidate_location cl ON cde.person_ref = cl.person_ref
WHERE cst.code IN ('A1', 'I1')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3152</xloc>
      <yloc>832</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_location_fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	11274 field_id,
	1005 form_id,
	ROW_NUMBER() OVER() field_value,
	description,
	ROW_NUMBER() OVER() + 400 id,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3200</xloc>
      <yloc>736</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_location_list</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description,
	'en' AS "language",
	ROW_NUMBER() OVER() + 400 id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER() + 400) AS language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3200</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2464</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2480</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2432</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_lookup 2 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2480</xloc>
      <yloc>1072</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4400</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_owner</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>WITH candidate_owner_json AS (
	SELECT 
		id AS candidate_id,
		json_array_elements(candidate_owner_json::json) AS owner_json
	FROM candidate
),
candidate_owner AS (
	SELECT 
		candidate_id,
		REPLACE((owner_json -> 'ownerId')::TEXT, '"', '')::INT AS owner_id,
		REPLACE((owner_json -> 'primary')::TEXT, '"', '') AS is_primary
	FROM candidate_owner_json
	WHERE NULLIF(REPLACE((owner_json -> 'ownerId')::TEXT, '"', ''), 'null') IS NOT NULL
),
old_owner AS (
	SELECT
		co.candidate_id,
		ua.id AS old_owner_id,
		ua.email AS old_email,
		CASE WHEN is_primary = 'false' THEN 'true' ELSE is_primary END is_primary,
		CASE
			WHEN ua.email = 'tammie.huntley@hamlinknight.co.uk' THEN 'thuntley@hamlinknight.co.uk'
			WHEN ua.email = 'Carolyn.wood@hutchinsonjonas.co.uk' THEN 'cwood@hamlinknight.co.uk'
			WHEN ua.email = 'charleigh.davies@hamlinknight.co.uk'THEN 'cdavies@hamlinknight.co.uk'
			WHEN ua.email = 'claire.dixon@hamlinknight.co.uk' THEN 'cdixon@hamlinknight.co.uk'
			WHEN ua.email = 'craig.barnes@hamlinknight.co.uk' THEN 'cbarnes@hamlinknight.co.uk'
			WHEN ua.email = 'David.McKernan@hamlinknight.co.uk' THEN 'dmckernan@hamlinknight.co.uk'
			WHEN ua.email = 'Emma.Herron@hamlinknight.co.uk' THEN 'eherron@hamlinknight.co.uk'
			WHEN ua.email = 'hannah.worswick@hamlinknight.co.uk' THEN 'hworswick@hamlinknight.co.uk'
			WHEN ua.email = 'Jenny@hutchinsonjonas.co.uk' THEN 'Jsimmons@hamlinknight.co.uk'
			WHEN ua.email = 'karen.balmer@hamlinknight.co.uk' THEN 'kbalmer@hamlinknight.co.uk'
			WHEN ua.email = 'kyp@hutchinsonjonas.co.uk' THEN 'Kadair@hamlinknight.co.uk'
			WHEN ua.email = 'lucy.mills@hamlinknight.co.uk' THEN 'lmills@hamlinknight.co.uk'
			WHEN ua.email = 'natalie.salvato@hamlinknight.co.uk' THEN 'nsalvato@hamlinknight.co.uk'
			WHEN ua.email = 'Paul.Berry@hamlinknight.co.uk' THEN 'pberry@hamlinknight.co.uk'
			WHEN ua.email = 'sam.waites@hamlinknight.co.uk' THEN 'swaites@hamlinknight.co.uk'
			WHEN ua.email = 'sarah.stone@hamlinknight.co.uk' THEN 'sstone@hamlinknight.co.uk'
			WHEN ua.email = 'stacey.evans@hamlinknight.co.uk' THEN 'sevans@hamlinknight.co.uk'
			WHEN ua.email = 'suky.rahim@hamlinknight.co.uk' THEN 'srahim@hamlinknight.co.uk'
			WHEN ua.email = 'tejinder.bath@hamlinknight.co.uk' THEN 'tbath@hamlinknight.co.uk'
			WHEN ua.email = 'tracey.rose@hamlinknight.co.uk' THEN 'trose@hamlinknight.co.uk'
			ELSE ua.email
		END AS new_email
	FROM candidate_owner co
	JOIN user_account ua ON co.owner_id = ua.id
-- 	WHERE ua.email IN (
-- 	'tammie.huntley@hamlinknight.co.uk',
-- 	'Carolyn.wood@hutchinsonjonas.co.uk',
-- 	'charleigh.davies@hamlinknight.co.uk',
-- 	'claire.dixon@hamlinknight.co.uk',
-- 	'craig.barnes@hamlinknight.co.uk',
-- 	'David.McKernan@hamlinknight.co.uk',
-- 	'Emma.Herron@hamlinknight.co.uk',
-- 	'hannah.worswick@hamlinknight.co.uk',
-- 	'Jenny@hutchinsonjonas.co.uk',
-- 	'karen.balmer@hamlinknight.co.uk',
-- 	'kyp@hutchinsonjonas.co.uk',
-- 	'lucy.mills@hamlinknight.co.uk',
-- 	'natalie.salvato@hamlinknight.co.uk',
-- 	'Paul.Berry@hamlinknight.co.uk',
-- 	'sam.waites@hamlinknight.co.uk',
-- 	'sarah.stone@hamlinknight.co.uk',
-- 	'stacey.evans@hamlinknight.co.uk',
-- 	'suky.rahim@hamlinknight.co.uk',
-- 	'tejinder.bath@hamlinknight.co.uk',
-- 	'tracey.rose@hamlinknight.co.uk'
-- 	)
)
SELECT
	candidate_id,
	CONCAT( '[',
	string_agg (
	CASE
		WHEN NULLIF(is_primary, '') IS NULL THEN CONCAT('{"ownerId":"', ua.id,'"}')
		ELSE CONCAT('{"ownerId":"', ua.id, '","primary":"', is_primary,'"}')
	END	, ','), ']') AS new_candidate_owner
FROM old_owner o
JOIN user_account ua ON o.new_email = ua.email
GROUP BY candidate_id</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>736</xloc>
      <yloc>1264</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_salary</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
check_dup_email AS (
	SELECT ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(email_address)) ORDER BY person_ref) rn_email,
	*
	FROM candidate_type
	WHERE rn = 1
	AND person_ref IS NOT NULL
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
income_mode AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '7'
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cde.person_ref AS candidate_id,
candidate_type,
im.description income_mode,
CASE
	WHEN im.description IN ('per hour', 'per week') THEN cde.income_required::INT
END desire_contract_rate,
CASE
	WHEN im.description = 'per month' THEN cde.income_required::INT * 12
	WHEN im.description = 'per annum' THEN cde.income_required::INT
END desire_salary,
CASE
	WHEN im.description = 'per month' THEN cde.income_required::INT
END month_salary,
CASE
	WHEN im.description = 'per month' THEN 2
	WHEN im.description = 'per annum' THEN 1
END salary_type

FROM check_dup_email cde
JOIN candidate_status cst ON cde.status = cst.code
LEFT JOIN income_mode im ON cde.income_mode = im.code
WHERE cst.code IN ('A1', 'I1')
AND NULLIF(cde.income_required, '0') IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2304</xloc>
      <yloc>1072</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_source_id</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>vc_candidate_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>candidate_source_id</name>
        <rename>vc_source_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2736</xloc>
      <yloc>768</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_activities</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH event_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '123'
),
company_owner AS (
	SELECT
		person_ref,
		type,
		s.email_address
	FROM person_type pt
	LEFT JOIN staff s ON pt.person_type_ref = s.person_type_ref
	WHERE pt.type LIKE '%Z%'
	AND s.email_address LIKE '%@%'
)
SELECT
e.organisation_ref company_id,
et.description AS activity_type,
CONCAT_WS(
	E'\n',
	CASE WHEN NULLIF(et.description, '') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
	CONCAT('Author: ', p.last_name, ' ', p.first_name),
	CASE WHEN NULLIF(co.email_address, '') IS NOT NULL THEN CONCAT('Email: ', co.email_address) END,
	CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
	CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
) AS content,
CONCAT(e.event_date, ' ', e.event_time)::TIMESTAMP insert_timestamp,
'comment' AS category,
'company' AS type,
-10 AS user_account_id

FROM event e
LEFT JOIN person p ON e.create_user = p.person_ref
LEFT JOIN company_owner co ON e.create_user = co.person_ref
LEFT JOIN event_type et ON e.type = et.code
WHERE NULLIF(e.organisation_ref, '') IS NOT NULL
AND NULLIF(e.event_date, '') IS NOT NULL
AND et.description IN ('Drop to Client', 'Sick', 'Sales Lead', 'Sales lead - hot', 'Sales lead - normal', 'Client shutdown', 'Maternity/paternity leave', 'Working via another agency', 'Did not attend', 
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Activity', 'Referral - good', 'Referral - average', 'Referral - negative', 'Permanent offer', 'Position move to temporary job', 'Position move to contract', 'Position move to permanent position',
'Position move', 'Referral', 'Telephone call', 'Letter,Fax,Email', 'Mailshot', 'CV received', 'CV update', 'CV sent', 'Registration Interview', 'Interview 1 with client', 'Interview 2 with client',
'Interview 3 with client', 'Interview other', 'Canvass call', 'Meeting with client', 'Proposal submitted', 'Reference request', 'Invoice', 'Invoice for retainer', 'Invoice for shortlist',
'Invoice for completion', 'Temporary booking', 'Follow-up', 'Source', 'Debrief', 'Registration Interview', 'Candidate Call', 'Service Meeting', 'Staff Assessment', 'Sales Call', 'Marketing Call',
'Service Contact Call', 'Email Received', 'Text Message Received', 'Quick text', 'Email sent', 'Spec Cv Sent', 'Phone call made', 'Registration Interview', 'Contact call', 'Candidate call',
'Contact sales call', 'Candidate sales call', 'Target', 'Shortlist', 'Placement', 'Hitlist', 'Client Sales Call', 'Telephone Dial', 'Voicemail Call', 'Service Contact Call', 'Sales Contact Call', 
'Timesheet', 'PSL', 'Invite for Interview', 'Reject Candidate', 'Pay Advance Request', 'Profile requested P45', 'P45 auto-raised in back-office', 'P45 requested via website', 'Holiday',
'Shift booking', 'Process CV from email', 'Process vacancy from email', 'Process import from email')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>136</xloc>
      <yloc>314</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_activity_type</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>SELECT 
	id, 
	REPLACE(REPLACE(activity_type, 'Telephone call', 'Telephone Call'), 'Candidate call', 'Candidate Call') activity_type,
	CURRENT_TIMESTAMP AS insert_timestamp
FROM activity
WHERE category = 'comment'
AND type = 'company'
AND user_account_id = -10
AND activity_type IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3696</xloc>
      <yloc>160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_address</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH main_company AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY name ORDER BY create_timestamp) rn
	FROM organisation
),
company_address AS (
	SELECT
		CASE 
			WHEN zipcode IS NOT NULL THEN ROW_NUMBER() OVER(PARTITION BY c.organisation_ref, zipcode ORDER BY CASE WHEN main_address = 'Y' THEN 1 ELSE 2 END, country) 
			ELSE 1
		END  AS rn,
		c.organisation_ref company_id,
		a.main_address,
		a.displayname location_name,
		a.post_town city,
		a.county_state state,
		a.zipcode,
		CASE
			WHEN a.country = 'United Kingdom' THEN 'GB'
			WHEN a.country = 'Ireland' THEN 'IE'
			WHEN a.country = 'New Zealand' THEN 'NZ'
		END AS country,
		CONCAT_WS(
			', ',
			CASE WHEN RIGHT(TRIM(a.address_line_1), 1) = ',' THEN LEFT(TRIM(a.address_line_1), LENGTH(TRIM(a.address_line_1)) - 1) ELSE TRIM(a.address_line_1) END, 
			CASE WHEN RIGHT(TRIM(a.address_line_2), 1) = ',' THEN LEFT(TRIM(a.address_line_2), LENGTH(TRIM(a.address_line_2)) - 1) ELSE TRIM(a.address_line_2) END,
			CASE WHEN RIGHT(TRIM(a.address_line_3), 1) = ',' THEN LEFT(TRIM(a.address_line_3), LENGTH(TRIM(a.address_line_3)) - 1) ELSE TRIM(a.address_line_3) END,
			a.post_town,
			a.county_state,
			a.country
		) AS address,
		SUBSTRING(SUBSTRING(a."WGS84" FROM STRPOS(a."WGS84", '(') + 1 FOR LENGTH(a."WGS84") - 8) FROM 1 FOR STRPOS(SUBSTRING(a."WGS84" FROM STRPOS(a."WGS84", '(') + 1 FOR LENGTH(a."WGS84") - 8), ' '))::FLOAT longitude,
		SUBSTRING(SUBSTRING(a."WGS84" FROM STRPOS(a."WGS84", '(') + 1 FOR LENGTH(a."WGS84") - 8) FROM STRPOS(SUBSTRING(a."WGS84" FROM STRPOS(a."WGS84", '(') + 1 FOR LENGTH(a."WGS84") - 8), ' '))::FLOAT latitude
	FROM main_company c
	LEFT JOIN address a ON c.organisation_ref = a.organisation_ref
	WHERE COALESCE(address_line_1, address_line_2, address_line_3, post_town, county_state, zipcode, country, "WGS84") IS NOT NULL
	ORDER BY company_id,
					CASE
						WHEN main_address = 'Y' THEN 1
						ELSE 2
					END
)

SELECT *
FROM company_address
WHERE rn = 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>208</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
parent_object_ref company_id,
CONCAT(parent_object_ref, '.', l.linkfile_ref, '.', file_extension) document_name,
file_extension,
parent_object_name,
l.displayname,
'COMPANY' entity_type,
'legal_document' document_type
FROM linkfile l
JOIN organisation o ON l.parent_object_ref = o.organisation_ref
WHERE parent_object_name = 'organisation'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_hotlist</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH company_hotlist AS (
	SELECT 'bronze' group_name 
	UNION
	SELECT 'SARA HIT LIST -COMPANIES' group_name 
	UNION
	SELECT 'KB=Traitor List (mixture of X Consultants)' group_name 
	UNION
	SELECT 'Bronze' group_name 
	UNION
	SELECT 'BD List' group_name 
	UNION
	SELECT 'KB (Prev HW list)' group_name 
	UNION
	SELECT 'TEMP TRAITOR 2016 CLIENTS' group_name 
	UNION
	SELECT 'A* KB list=Mar 19 = GOLD' group_name 
	UNION
	SELECT 'Traitor List (Was AL...now KB)' group_name 
	UNION
	SELECT 'KB (Watford location clients)' group_name 
	UNION
	SELECT 'Top 20' group_name 
	UNION
	SELECT 'silver(2)' group_name 
	UNION
	SELECT 'CHARLOTTE HIT LIST' group_name 
	UNION
	SELECT 'traitor' group_name 
	UNION
	SELECT 'Silver clients' group_name 
	UNION
	SELECT 'gold (2)' group_name 
	UNION
	SELECT 'EMMA HIT LIST' group_name 
	UNION
	SELECT 'gold clients' group_name
)

SELECT
	group_name,
	'en' AS "language",
	ROW_NUMBER() OVER() + 10000 id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER() + 10000) AS language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM company_hotlist </sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>128</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_hotlist 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH company_hotlist AS (
	SELECT 'bronze' group_name 
	UNION
	SELECT 'SARA HIT LIST -COMPANIES' group_name 
	UNION
	SELECT 'KB=Traitor List (mixture of X Consultants)' group_name 
	UNION
	SELECT 'Bronze' group_name 
	UNION
	SELECT 'BD List' group_name 
	UNION
	SELECT 'KB (Prev HW list)' group_name 
	UNION
	SELECT 'TEMP TRAITOR 2016 CLIENTS' group_name 
	UNION
	SELECT 'A* KB list=Mar 19 = GOLD' group_name 
	UNION
	SELECT 'Traitor List (Was AL...now KB)' group_name 
	UNION
	SELECT 'KB (Watford location clients)' group_name 
	UNION
	SELECT 'Top 20' group_name 
	UNION
	SELECT 'silver(2)' group_name 
	UNION
	SELECT 'CHARLOTTE HIT LIST' group_name 
	UNION
	SELECT 'traitor' group_name 
	UNION
	SELECT 'Silver clients' group_name 
	UNION
	SELECT 'gold (2)' group_name 
	UNION
	SELECT 'EMMA HIT LIST' group_name 
	UNION
	SELECT 'gold clients' group_name
)

SELECT
	11276 field_id,
	1006 form_id,
	ROW_NUMBER() OVER() field_value,
	group_name,
	ROW_NUMBER() OVER() + 10000 id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER() + 10000) AS title_language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM company_hotlist</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>960</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_hotlist 3</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH main_company AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY LOWER(TRIM(name)) ORDER BY create_timestamp) rn
	FROM organisation
),
hotlist AS (
	SELECT
	object_ref  AS company_id,
	CASE
		WHEN savelist_ref = '21250	' THEN 'HIT LIST COMPANIES'
		WHEN savelist_ref = '112054' THEN 'TEMP TRAITOR 2016 CLIENTS'
		WHEN savelist_ref = '116673' THEN 'CHARLOTTE HIT LIST'
		WHEN savelist_ref = '116247' THEN 'EMMA HIT LIST'
		WHEN savelist_ref = '116687' THEN 'SARA HIT LIST -COMPANIES'
		WHEN savelist_ref = '114237' THEN 'BD List'
		WHEN savelist_ref = '112848' THEN 'KB=Traitor List (mixture of X Consultants)'
		WHEN savelist_ref = '113228' THEN 'KB (Prev HW list)'
		WHEN savelist_ref = '115176' THEN 'KB (Watford location clients)'
		WHEN savelist_ref = '111341' THEN 'Traitor List (Was AL...now KB)'
		WHEN savelist_ref = '116711' THEN 'A* KB list=Mar 19 = GOLD'
		WHEN savelist_ref = '112129' THEN 'Top 20'
		WHEN savelist_ref = '112035' THEN 'bronze'
		WHEN savelist_ref = '112583' THEN 'Silver clients'
		WHEN savelist_ref = '112582' THEN 'gold clients'
		WHEN savelist_ref = '112625' THEN 'silver(2)'
		WHEN savelist_ref = '113519' THEN 'Bronze'
		WHEN savelist_ref = '113520' THEN 'gold (2)'
		WHEN savelist_ref = '112022' THEN 'traitor'
	END group_name
	FROM savelist_entry
	WHERE savelist_ref IN ('21250','112054','3310','116673','116247','116687','114237','112848','113228','115176','111341','116711','112129','112035',
													'112583','112582','112625','113519','113520','112022')
),
company_hotlist AS (
SELECT
	c.organisation_ref AS company_id,
	CASE
		WHEN ch.group_name = 'bronze' THEN '1'
		WHEN ch.group_name = 'SARA HIT LIST -COMPANIES' THEN '2'
		WHEN ch.group_name = 'KB=Traitor List (mixture of X Consultants)' THEN '3'
		WHEN ch.group_name = 'Top 20' THEN '4'
		WHEN ch.group_name = 'Silver clients' THEN '5'
		WHEN ch.group_name = 'BD List' THEN '6'
		WHEN ch.group_name = 'KB (Prev HW list)' THEN '7'
		WHEN ch.group_name = 'gold (2)' THEN '8'
		WHEN ch.group_name = 'silver(2)' THEN '9'
		WHEN ch.group_name = 'A* KB list=Mar 19 = GOLD' THEN '10'
		WHEN ch.group_name = 'Bronze' THEN '11'
		WHEN ch.group_name = 'Traitor List (Was AL...now KB)' THEN '12'
		WHEN ch.group_name = 'CHARLOTTE HIT LIST' THEN '13'
		WHEN ch.group_name = 'gold clients' THEN '14'
		WHEN ch.group_name = 'EMMA HIT LIST' THEN '15'
		WHEN ch.group_name = 'traitor' THEN '16'
		WHEN ch.group_name = 'KB (Watford location clients)' THEN '17'
		WHEN ch.group_name = 'TEMP TRAITOR 2016 CLIENTS' THEN '18'
	END hotlist
FROM main_company c
JOIN hotlist ch ON c.organisation_ref = ch.company_id
WHERE group_name IS NOT NULL
)
SELECT
company_id,
string_agg(hotlist, ',') hotlist,
'add_com_info' additional_type,
1006 form_id,
11276 field_id,
'11276' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM company_hotlist
GROUP BY company_id, additional_type, form_id, field_id, constraint_id, insert_timestamp</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>128</xloc>
      <yloc>1056</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_industry</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH company_industry AS (
	SELECT
		sc.organisation_ref company_id,
		sc.code industry_code,
		ROW_NUMBER() OVER(PARTITION BY sc.organisation_ref, sc.code ORDER BY sc.organisation_ref) rn
	FROM search_code sc
	JOIN organisation o ON sc.organisation_ref = o.organisation_ref
	WHERE sc.organisation_ref IS NOT NULL
	AND sc.code_type = '1005'
),
industry AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1005'
),
industry_mapping AS (
	SELECT
		ci.company_id,
		CASE
			WHEN i.description = 'IT Services' THEN 'IT Services'
			WHEN i.description = 'Carpenter' THEN 'Carpenter'
			WHEN i.description = 'Painting' THEN 'Painting'
			WHEN i.description = 'Shopfitting' THEN 'Shopfitting'
			WHEN i.description = 'Civils' THEN 'Civils'
			WHEN i.description = 'Drylining' THEN 'Drylining'
			WHEN i.description = 'Interiors' THEN 'Interiors'
			WHEN i.description = 'Student Accommodation' THEN 'Student Accommodation'
			WHEN i.description = 'High End Apartments' THEN 'High End Apartments'
			WHEN i.description = 'BUSINESS SERVICES' THEN 'BUSINESS SERVICES'
			WHEN i.description = 'Business Services General' THEN 'Business Services General'
			WHEN i.description = 'Accountancy' THEN 'Accountancy'
			WHEN i.description = 'Consultancy' THEN 'Consultancy'
			WHEN i.description = 'Property/Estate Agency' THEN 'Property/Estate Agency'
			WHEN i.description = 'Recruitment' THEN 'Recruitment'
			WHEN i.description = 'Training' THEN 'Training'
			WHEN i.description = 'Solicitors' THEN 'Solicitors'
			WHEN i.description = 'Call Centre' THEN 'Call Centre'
			WHEN i.description = 'Payroll' THEN 'Payroll'
			WHEN i.description = 'Charities' THEN 'Charities'
			WHEN i.description = 'Agricultural' THEN 'Agricultural'
			WHEN i.description = 'Dental Products' THEN 'Dental Products'
			WHEN i.description = 'CONSTRUCTION' THEN 'CONSTRUCTION'
			WHEN i.description = 'Construction General' THEN 'Construction General'
			WHEN i.description = 'Building Construction' THEN 'Building Construction'
			WHEN i.description = 'Buidling Materials' THEN 'Buidling Materials'
			WHEN i.description = 'FOOD / FMCG / CONSUMER GOODS' THEN 'FOOD / FMCG / CONSUMER GOODS'
			WHEN i.description = 'Cosmetics, Toiletries' THEN 'Cosmetics, Toiletries'
			WHEN i.description = 'Food, Drink, Tobacco' THEN 'Food, Drink, Tobacco'
			WHEN i.description = 'Household Goods' THEN 'Household Goods'
			WHEN i.description = 'Office Products, Stationery' THEN 'Office Products, Stationery'
			WHEN i.description = 'Electronics' THEN 'Electronics'
			WHEN i.description = 'Packaging' THEN 'Packaging'
			WHEN i.description = 'DISTRIBUTION/WAREHOUSING' THEN 'DISTRIBUTION/WAREHOUSING'
			WHEN i.description = 'Distribution General' THEN 'Distribution General'
			WHEN i.description = 'Distribution Automotive' THEN 'Distribution Automotive'
			WHEN i.description = 'Logistics' THEN 'Logistics'
			WHEN i.description = 'Warehouse' THEN 'Warehouse'
			WHEN i.description = 'ENGINEERING' THEN 'ENGINEERING'
			WHEN i.description = 'Engineering General' THEN 'Engineering General'
			WHEN i.description = 'Civil Engineering' THEN 'Civil Engineering'
			WHEN i.description = 'Mechanical Engineering' THEN 'Mechanical Engineering'
			WHEN i.description = 'Rubber/Plastic/Rope' THEN 'Rubber/Plastic/Rope'
			WHEN i.description = 'Waste Management Services' THEN 'Waste Management Services'
			WHEN i.description = 'Electrical Engineering' THEN 'Electrical Engineering'
			WHEN i.description = 'Mechanical Handling' THEN 'Mechanical Handling'
			WHEN i.description = 'Precision Engineering' THEN 'Precision Engineering'
			WHEN i.description = 'MANUFACTURING' THEN 'MANUFACTURING'
			WHEN i.description = 'Manufacturing General' THEN 'Manufacturing General'
			WHEN i.description = 'Motor Manufacturing' THEN 'Motor Manufacturing'
			WHEN i.description = 'Clothing Manufacturing' THEN 'Clothing Manufacturing'
			WHEN i.description = 'Industrial Manufacturing' THEN 'Industrial Manufacturing'
			WHEN i.description = 'FINANCE' THEN 'FINANCE'
			WHEN i.description = 'Finance General' THEN 'Finance General'
			WHEN i.description = 'Banks / Building Society' THEN 'Banks / Building Society'
			WHEN i.description = 'Financial Services' THEN 'Financial Services'
			WHEN i.description = 'Insurance' THEN 'Insurance'
			WHEN i.description = 'IT &amp; COMMUNICATIONS' THEN 'IT &amp; COMMUNICATIONS'
			WHEN i.description = 'Communications General' THEN 'Communications General'
			WHEN i.description = 'IT General' THEN 'IT General'
			WHEN i.description = 'IT Software' THEN 'IT Software'
			WHEN i.description = 'IT Training' THEN 'IT Training'
			WHEN i.description = 'Telecommunications' THEN 'Telecommunications'
			WHEN i.description = 'CHEMICALS PRODUCTION' THEN 'CHEMICALS PRODUCTION'
			WHEN i.description = 'Chemicals General' THEN 'Chemicals General'
			WHEN i.description = 'Oil &amp; Petrochemicals' THEN 'Oil &amp; Petrochemicals'
			WHEN i.description = 'LEISURE' THEN 'LEISURE'
			WHEN i.description = 'Leisure General' THEN 'Leisure General'
			WHEN i.description = 'Breweries' THEN 'Breweries'
			WHEN i.description = 'Catering' THEN 'Catering'
			WHEN i.description = 'Entertainment' THEN 'Entertainment'
			WHEN i.description = 'Hotel' THEN 'Hotel'
			WHEN i.description = 'Travel' THEN 'Travel'
			WHEN i.description = 'MEDIA/MARKETING' THEN 'MEDIA/MARKETING'
			WHEN i.description = 'Media General' THEN 'Media General'
			WHEN i.description = 'Design Agency' THEN 'Design Agency'
			WHEN i.description = 'Journalism' THEN 'Journalism'
			WHEN i.description = 'Books' THEN 'Books'
			WHEN i.description = 'Newspapers' THEN 'Newspapers'
			WHEN i.description = 'Printing &amp; Publishing' THEN 'Printing &amp; Publishing'
			WHEN i.description = 'Advertising' THEN 'Advertising'
			WHEN i.description = 'Marketing' THEN 'Marketing'
			WHEN i.description = 'Telemarketing' THEN 'Telemarketing'
			WHEN i.description = 'PUBLIC SECTOR' THEN 'PUBLIC SECTOR'
			WHEN i.description = 'Public Sector General' THEN 'Public Sector General'
			WHEN i.description = 'NHS' THEN 'NHS'
			WHEN i.description = 'Medical' THEN 'Medical'
			WHEN i.description = 'Primary Care Trust' THEN 'Primary Care Trust'
			WHEN i.description = 'Central Government' THEN 'Central Government'
			WHEN i.description = 'Local Borough' THEN 'Local Borough'
			WHEN i.description = 'Police' THEN 'Police'
			WHEN i.description = 'Fire' THEN 'Fire'
			WHEN i.description = 'Health' THEN 'Health'
			WHEN i.description = 'Armed Forces' THEN 'Armed Forces'
			WHEN i.description = 'Education' THEN 'Education'
			WHEN i.description = 'Council' THEN 'Council'
			WHEN i.description = 'PHARMACEUTICALS' THEN 'PHARMACEUTICALS'
			WHEN i.description = 'Pharmaceuticals General' THEN 'Pharmaceuticals General'
			WHEN i.description = 'Pharmaceutical Equipment' THEN 'Pharmaceutical Equipment'
			WHEN i.description = 'RETAIL' THEN 'RETAIL'
			WHEN i.description = 'Retail General' THEN 'Retail General'
			WHEN i.description = 'Food Retail' THEN 'Food Retail'
			WHEN i.description = 'DIY Retail' THEN 'DIY Retail'
			WHEN i.description = 'Home Furnishings' THEN 'Home Furnishings'
			WHEN i.description = 'Large Multiples' THEN 'Large Multiples'
			WHEN i.description = 'Fashion' THEN 'Fashion'
			WHEN i.description = 'TRANSPORT' THEN 'TRANSPORT'
			WHEN i.description = 'Transport General' THEN 'Transport General'
			WHEN i.description = 'Automotive' THEN 'Automotive'
			WHEN i.description = 'Dealership' THEN 'Dealership'
			WHEN i.description = 'Marine Services' THEN 'Marine Services'
			WHEN i.description = 'Public Transport' THEN 'Public Transport'
			WHEN i.description = 'Road/Rail Haulage' THEN 'Road/Rail Haulage'
			WHEN i.description = 'Shipping' THEN 'Shipping'
			WHEN i.description = 'Aerospace' THEN 'Aerospace'
			WHEN i.description = 'Car Hire' THEN 'Car Hire'
			WHEN i.description = 'UTILITIES' THEN 'UTILITIES'
			WHEN i.description = 'Utilities General' THEN 'Utilities General'
			WHEN i.description = 'Gas &amp; Oil' THEN 'Gas &amp; Oil'
			WHEN i.description = 'Electricity' THEN 'Electricity'
			WHEN i.description = 'Water' THEN 'Water'
		END industry
	FROM company_industry ci
	JOIN industry i ON ci.industry_code = i.code
	WHERE ci.rn = 1
)
SELECT DISTINCT industry,
CURRENT_TIMESTAMP insert_timestamp
FROM industry_mapping</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_industry 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH company_industry AS (
	SELECT
		sc.organisation_ref company_id,
		sc.code industry_code,
		ROW_NUMBER() OVER(PARTITION BY sc.organisation_ref, sc.code ORDER BY sc.organisation_ref) rn
	FROM search_code sc
	JOIN organisation o ON sc.organisation_ref = o.organisation_ref
	WHERE sc.organisation_ref IS NOT NULL
	AND sc.code_type = '1005'
),
industry AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1005'
)
SELECT
	ci.company_id,
	CASE
		WHEN i.description = 'IT Services' THEN 'IT Services'
		WHEN i.description = 'Carpenter' THEN 'Carpenter'
		WHEN i.description = 'Painting' THEN 'Painting'
		WHEN i.description = 'Shopfitting' THEN 'Shopfitting'
		WHEN i.description = 'Civils' THEN 'Civils'
		WHEN i.description = 'Drylining' THEN 'Drylining'
		WHEN i.description = 'Interiors' THEN 'Interiors'
		WHEN i.description = 'Student Accommodation' THEN 'Student Accommodation'
		WHEN i.description = 'High End Apartments' THEN 'High End Apartments'
		WHEN i.description = 'BUSINESS SERVICES' THEN 'BUSINESS SERVICES'
		WHEN i.description = 'Business Services General' THEN 'Business Services General'
		WHEN i.description = 'Accountancy' THEN 'Accountancy'
		WHEN i.description = 'Consultancy' THEN 'Consultancy'
		WHEN i.description = 'Property/Estate Agency' THEN 'Property/Estate Agency'
		WHEN i.description = 'Recruitment' THEN 'Recruitment'
		WHEN i.description = 'Training' THEN 'Training'
		WHEN i.description = 'Solicitors' THEN 'Solicitors'
		WHEN i.description = 'Call Centre' THEN 'Call Centre'
		WHEN i.description = 'Payroll' THEN 'Payroll'
		WHEN i.description = 'Charities' THEN 'Charities'
		WHEN i.description = 'Agricultural' THEN 'Agricultural'
		WHEN i.description = 'Dental Products' THEN 'Dental Products'
		WHEN i.description = 'CONSTRUCTION' THEN 'CONSTRUCTION'
		WHEN i.description = 'Construction General' THEN 'Construction General'
		WHEN i.description = 'Building Construction' THEN 'Building Construction'
		WHEN i.description = 'Buidling Materials' THEN 'Buidling Materials'
		WHEN i.description = 'FOOD / FMCG / CONSUMER GOODS' THEN 'FOOD / FMCG / CONSUMER GOODS'
		WHEN i.description = 'Cosmetics, Toiletries' THEN 'Cosmetics, Toiletries'
		WHEN i.description = 'Food, Drink, Tobacco' THEN 'Food, Drink, Tobacco'
		WHEN i.description = 'Household Goods' THEN 'Household Goods'
		WHEN i.description = 'Office Products, Stationery' THEN 'Office Products, Stationery'
		WHEN i.description = 'Electronics' THEN 'Electronics'
		WHEN i.description = 'Packaging' THEN 'Packaging'
		WHEN i.description = 'DISTRIBUTION/WAREHOUSING' THEN 'DISTRIBUTION/WAREHOUSING'
		WHEN i.description = 'Distribution General' THEN 'Distribution General'
		WHEN i.description = 'Distribution Automotive' THEN 'Distribution Automotive'
		WHEN i.description = 'Logistics' THEN 'Logistics'
		WHEN i.description = 'Warehouse' THEN 'Warehouse'
		WHEN i.description = 'ENGINEERING' THEN 'ENGINEERING'
		WHEN i.description = 'Engineering General' THEN 'Engineering General'
		WHEN i.description = 'Civil Engineering' THEN 'Civil Engineering'
		WHEN i.description = 'Mechanical Engineering' THEN 'Mechanical Engineering'
		WHEN i.description = 'Rubber/Plastic/Rope' THEN 'Rubber/Plastic/Rope'
		WHEN i.description = 'Waste Management Services' THEN 'Waste Management Services'
		WHEN i.description = 'Electrical Engineering' THEN 'Electrical Engineering'
		WHEN i.description = 'Mechanical Handling' THEN 'Mechanical Handling'
		WHEN i.description = 'Precision Engineering' THEN 'Precision Engineering'
		WHEN i.description = 'MANUFACTURING' THEN 'MANUFACTURING'
		WHEN i.description = 'Manufacturing General' THEN 'Manufacturing General'
		WHEN i.description = 'Motor Manufacturing' THEN 'Motor Manufacturing'
		WHEN i.description = 'Clothing Manufacturing' THEN 'Clothing Manufacturing'
		WHEN i.description = 'Industrial Manufacturing' THEN 'Industrial Manufacturing'
		WHEN i.description = 'FINANCE' THEN 'FINANCE'
		WHEN i.description = 'Finance General' THEN 'Finance General'
		WHEN i.description = 'Banks / Building Society' THEN 'Banks / Building Society'
		WHEN i.description = 'Financial Services' THEN 'Financial Services'
		WHEN i.description = 'Insurance' THEN 'Insurance'
		WHEN i.description = 'IT &amp; COMMUNICATIONS' THEN 'IT &amp; COMMUNICATIONS'
		WHEN i.description = 'Communications General' THEN 'Communications General'
		WHEN i.description = 'IT General' THEN 'IT General'
		WHEN i.description = 'IT Software' THEN 'IT Software'
		WHEN i.description = 'IT Training' THEN 'IT Training'
		WHEN i.description = 'Telecommunications' THEN 'Telecommunications'
		WHEN i.description = 'CHEMICALS PRODUCTION' THEN 'CHEMICALS PRODUCTION'
		WHEN i.description = 'Chemicals General' THEN 'Chemicals General'
		WHEN i.description = 'Oil &amp; Petrochemicals' THEN 'Oil &amp; Petrochemicals'
		WHEN i.description = 'LEISURE' THEN 'LEISURE'
		WHEN i.description = 'Leisure General' THEN 'Leisure General'
		WHEN i.description = 'Breweries' THEN 'Breweries'
		WHEN i.description = 'Catering' THEN 'Catering'
		WHEN i.description = 'Entertainment' THEN 'Entertainment'
		WHEN i.description = 'Hotel' THEN 'Hotel'
		WHEN i.description = 'Travel' THEN 'Travel'
		WHEN i.description = 'MEDIA/MARKETING' THEN 'MEDIA/MARKETING'
		WHEN i.description = 'Media General' THEN 'Media General'
		WHEN i.description = 'Design Agency' THEN 'Design Agency'
		WHEN i.description = 'Journalism' THEN 'Journalism'
		WHEN i.description = 'Books' THEN 'Books'
		WHEN i.description = 'Newspapers' THEN 'Newspapers'
		WHEN i.description = 'Printing &amp; Publishing' THEN 'Printing &amp; Publishing'
		WHEN i.description = 'Advertising' THEN 'Advertising'
		WHEN i.description = 'Marketing' THEN 'Marketing'
		WHEN i.description = 'Telemarketing' THEN 'Telemarketing'
		WHEN i.description = 'PUBLIC SECTOR' THEN 'PUBLIC SECTOR'
		WHEN i.description = 'Public Sector General' THEN 'Public Sector General'
		WHEN i.description = 'NHS' THEN 'NHS'
		WHEN i.description = 'Medical' THEN 'Medical'
		WHEN i.description = 'Primary Care Trust' THEN 'Primary Care Trust'
		WHEN i.description = 'Central Government' THEN 'Central Government'
		WHEN i.description = 'Local Borough' THEN 'Local Borough'
		WHEN i.description = 'Police' THEN 'Police'
		WHEN i.description = 'Fire' THEN 'Fire'
		WHEN i.description = 'Health' THEN 'Health'
		WHEN i.description = 'Armed Forces' THEN 'Armed Forces'
		WHEN i.description = 'Education' THEN 'Education'
		WHEN i.description = 'Council' THEN 'Council'
		WHEN i.description = 'PHARMACEUTICALS' THEN 'PHARMACEUTICALS'
		WHEN i.description = 'Pharmaceuticals General' THEN 'Pharmaceuticals General'
		WHEN i.description = 'Pharmaceutical Equipment' THEN 'Pharmaceutical Equipment'
		WHEN i.description = 'RETAIL' THEN 'RETAIL'
		WHEN i.description = 'Retail General' THEN 'Retail General'
		WHEN i.description = 'Food Retail' THEN 'Food Retail'
		WHEN i.description = 'DIY Retail' THEN 'DIY Retail'
		WHEN i.description = 'Home Furnishings' THEN 'Home Furnishings'
		WHEN i.description = 'Large Multiples' THEN 'Large Multiples'
		WHEN i.description = 'Fashion' THEN 'Fashion'
		WHEN i.description = 'TRANSPORT' THEN 'TRANSPORT'
		WHEN i.description = 'Transport General' THEN 'Transport General'
		WHEN i.description = 'Automotive' THEN 'Automotive'
		WHEN i.description = 'Dealership' THEN 'Dealership'
		WHEN i.description = 'Marine Services' THEN 'Marine Services'
		WHEN i.description = 'Public Transport' THEN 'Public Transport'
		WHEN i.description = 'Road/Rail Haulage' THEN 'Road/Rail Haulage'
		WHEN i.description = 'Shipping' THEN 'Shipping'
		WHEN i.description = 'Aerospace' THEN 'Aerospace'
		WHEN i.description = 'Car Hire' THEN 'Car Hire'
		WHEN i.description = 'UTILITIES' THEN 'UTILITIES'
		WHEN i.description = 'Utilities General' THEN 'Utilities General'
		WHEN i.description = 'Gas &amp; Oil' THEN 'Gas &amp; Oil'
		WHEN i.description = 'Electricity' THEN 'Electricity'
		WHEN i.description = 'Water' THEN 'Water'
	END industry,
CURRENT_TIMESTAMP insert_timestamp
FROM company_industry ci
JOIN industry i ON ci.industry_code = i.code
WHERE ci.rn = 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>240</xloc>
      <yloc>560</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_location</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH main_company AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY LOWER(TRIM(name)) ORDER BY create_timestamp) rn
	FROM organisation
),
company_location AS (
	SELECT 
		organisation_ref,
		CASE
			WHEN l.description = 'INTERNATIONAL' THEN 1
			WHEN l.description = 'Berlin' THEN 2
			WHEN l.description = 'Denmark' THEN 3
			WHEN l.description = 'Luxembourg' THEN 4
			WHEN l.description = 'NORTH WEST' THEN 5
			WHEN l.description = 'Manchester' THEN 6
			WHEN l.description = 'Oldham' THEN 7
			WHEN l.description = 'London' THEN 8
			WHEN l.description = 'Northampton' THEN 9
			WHEN l.description = 'Iceland' THEN 10
			WHEN l.description = 'Iver' THEN 11
			WHEN l.description = 'Dunstable' THEN 12
			WHEN l.description = 'Luton' THEN 13
			WHEN l.description = 'Milton Keynes' THEN 14
			WHEN l.description = 'Bedfordshire' THEN 15
			WHEN l.description = 'Luton' THEN 16
			WHEN l.description = 'Essex' THEN 17
			WHEN l.description = 'HERTFORDSHIRE' THEN 18
			WHEN l.description = 'Borehamwood' THEN 19
			WHEN l.description = 'Bushey' THEN 20
			WHEN l.description = 'Chorleywood' THEN 21
			WHEN l.description = 'Hatfield' THEN 22
			WHEN l.description = 'Hemel Hempstead' THEN 23
			WHEN l.description = 'Hitchin' THEN 24
			WHEN l.description = 'Maple Cross' THEN 25
			WHEN l.description = 'Rickmansworth' THEN 26
			WHEN l.description = 'St Albans' THEN 27
			WHEN l.description = 'Stevenage' THEN 28
			WHEN l.description = 'Watford' THEN 29
			WHEN l.description = 'Welwyn Garden City' THEN 30
			WHEN l.description = 'Kings Langley' THEN 31
			WHEN l.description = 'Chipperfield' THEN 32
			WHEN l.description = 'Bovingdon' THEN 33
			WHEN l.description = 'Berkhamstead' THEN 34
			WHEN l.description = 'Tring' THEN 35
			WHEN l.description = 'Redbourne' THEN 36
			WHEN l.description = 'Wembley' THEN 37
			WHEN l.description = 'Elstree' THEN 38
			WHEN l.description = 'Radlett' THEN 39
			WHEN l.description = 'Hertfordshire' THEN 40
			WHEN l.description = 'BUCKINGHAMSHIRE' THEN 41
			WHEN l.description = 'The Chalfonts' THEN 42
			WHEN l.description = 'Denham' THEN 43
			WHEN l.description = 'Gerrards Cross' THEN 44
			WHEN l.description = 'Stoke Poges' THEN 45
			WHEN l.description = 'High Wycombe' THEN 46
			WHEN l.description = 'Amersham' THEN 47
			WHEN l.description = 'Chesham' THEN 48
			WHEN l.description = 'Marlow' THEN 49
			WHEN l.description = 'Buckinghamshire' THEN 50
			WHEN l.description = 'MIDDLESEX' THEN 51
			WHEN l.description = 'Cowley' THEN 52
			WHEN l.description = 'Greenford' THEN 53
			WHEN l.description = 'Harefield' THEN 54
			WHEN l.description = 'Harmondsworth' THEN 55
			WHEN l.description = 'Harrow' THEN 56
			WHEN l.description = 'Hayes' THEN 57
			WHEN l.description = 'Heathrow' THEN 58
			WHEN l.description = 'Heston' THEN 59
			WHEN l.description = 'Hillingdon' THEN 60
			WHEN l.description = 'Ickenham' THEN 61
			WHEN l.description = 'Northolt' THEN 62
			WHEN l.description = 'Ruislip' THEN 63
			WHEN l.description = 'Southall' THEN 64
			WHEN l.description = 'Stanmore' THEN 65
			WHEN l.description = 'Stockley Park' THEN 66
			WHEN l.description = 'Uxbridge' THEN 67
			WHEN l.description = 'West Drayton' THEN 68
			WHEN l.description = 'Yiewsley' THEN 69
			WHEN l.description = 'Middlesex' THEN 70
			WHEN l.description = 'East Sussex' THEN 71
			WHEN l.description = 'Staines' THEN 72
			WHEN l.description = 'KENT' THEN 73
			WHEN l.description = 'Bromley' THEN 74
			WHEN l.description = 'Kent' THEN 75
			WHEN l.description = 'SURREY' THEN 76
			WHEN l.description = 'BERKSHIRE' THEN 77
			WHEN l.description = 'Colnbrook' THEN 78
			WHEN l.description = 'Langley' THEN 79
			WHEN l.description = 'Poyle' THEN 80
			WHEN l.description = 'Slough' THEN 81
			WHEN l.description = 'Berkshire' THEN 82
			WHEN l.description = 'Windsor' THEN 83
			WHEN l.description = 'OXFORDSHIRE' THEN 84
			WHEN l.description = 'Oxfordshire' THEN 85
			WHEN l.description = 'Banbury' THEN 86
			WHEN l.description = 'Bicester' THEN 87
			WHEN l.description = 'Thame' THEN 88
			WHEN l.description = 'Wiltshire' THEN 89
			WHEN l.description = 'LONDON' THEN 90
			WHEN l.description = 'City of London' THEN 91
			WHEN l.description = 'East London' THEN 92
			WHEN l.description = 'Stratford' THEN 93
			WHEN l.description = 'Docklands' THEN 94
			WHEN l.description = 'North London' THEN 95
			WHEN l.description = 'South London' THEN 96
			WHEN l.description = 'West London' THEN 97
			WHEN l.description = 'SOUTH EAST' THEN 98
			WHEN l.description = 'West Sussex' THEN 99
			WHEN l.description = 'Hampshire' THEN 100
			WHEN l.description = 'SOUTH WEST' THEN 101
			WHEN l.description = 'Bristol' THEN 102
			WHEN l.description = 'Avon' THEN 103
			WHEN l.description = 'Cornwall' THEN 104
			WHEN l.description = 'Dorset' THEN 105
			WHEN l.description = 'Devon' THEN 106
			WHEN l.description = 'Gloucestershire' THEN 107
			WHEN l.description = 'Somerset' THEN 108
			WHEN l.description = 'Cambridgeshire' THEN 109
			WHEN l.description = 'Norfolk' THEN 110
			WHEN l.description = 'Suffolk' THEN 111
			WHEN l.description = 'WEST MIDLANDS' THEN 112
			WHEN l.description = 'West Midlands' THEN 113
			WHEN l.description = 'Birmingham' THEN 114
			WHEN l.description = 'Solihull' THEN 115
			WHEN l.description = 'Dudley' THEN 116
			WHEN l.description = 'Herefordshire' THEN 117
			WHEN l.description = 'Worcestershire' THEN 118
			WHEN l.description = 'Staffordshire' THEN 119
			WHEN l.description = 'WARWICKSHIRE' THEN 120
			WHEN l.description = 'Atherstone' THEN 121
			WHEN l.description = 'Bedworth' THEN 122
			WHEN l.description = 'Coventry' THEN 123
			WHEN l.description = 'Kenilworth' THEN 124
			WHEN l.description = 'Leamington Spa' THEN 125
			WHEN l.description = 'Nuneaton' THEN 126
			WHEN l.description = 'Rugby' THEN 127
			WHEN l.description = 'Stratford Upon Avon' THEN 128
			WHEN l.description = 'Warwick' THEN 129
			WHEN l.description = 'Southam' THEN 130
			WHEN l.description = 'Warwickshire' THEN 131
			WHEN l.description = 'Lutterworth' THEN 132
			WHEN l.description = 'NORTH EAST' THEN 133
			WHEN l.description = 'NORTH YORKSHIRE' THEN 134
			WHEN l.description = 'North Yorkshire' THEN 135
			WHEN l.description = 'SOUTH YORKSHIRE' THEN 136
			WHEN l.description = 'South Yorkshire' THEN 137
			WHEN l.description = 'Sheffield' THEN 138
			WHEN l.description = 'Worksop' THEN 139
			WHEN l.description = 'Rotherham' THEN 140
			WHEN l.description = 'Mansfield' THEN 141
			WHEN l.description = 'Doncaster' THEN 142
			WHEN l.description = 'Derby' THEN 143
			WHEN l.description = 'Barnsley' THEN 144
			WHEN l.description = 'Chesterfield' THEN 145
			WHEN l.description = 'Dronfield' THEN 146
			WHEN l.description = 'Pontefract' THEN 147
			WHEN l.description = 'WEST YORKSHIRE' THEN 148
			WHEN l.description = 'Leeds' THEN 149
			WHEN l.description = 'EAST YORKSHIRE' THEN 150
			WHEN l.description = 'Goole' THEN 151
			WHEN l.description = 'Lincoln' THEN 152
			WHEN l.description = 'Grimsby' THEN 153
			WHEN l.description = 'Hull' THEN 154
			WHEN l.description = 'Scunthorpe' THEN 155
			WHEN l.description = 'SCOTLAND' THEN 156
			WHEN l.description = 'Aberdeen' THEN 157
			WHEN l.description = 'Dundee' THEN 158
			WHEN l.description = 'Edinburgh' THEN 159
			WHEN l.description = 'Fife' THEN 160
			WHEN l.description = 'Glasgow' THEN 161
			WHEN l.description = 'Kilmarnock' THEN 162
			WHEN l.description = 'Perth' THEN 163
			WHEN l.description = 'Sterling' THEN 164
			WHEN l.description = 'Scotland' THEN 165
			WHEN l.description = 'WALES' THEN 166
			WHEN l.description = 'Wales' THEN 167
			WHEN l.description = 'Cardiff' THEN 168
			WHEN l.description = 'Clywd' THEN 169
			WHEN l.description = 'Dyfed' THEN 170
			WHEN l.description = 'Gwynedd' THEN 171
			WHEN l.description = 'Gwent' THEN 172
			WHEN l.description = 'Mid Glamorgan' THEN 173
			WHEN l.description = 'South Glamorgan' THEN 174
			WHEN l.description = 'EAST MIDLANDS' THEN 175
			WHEN l.description = 'Leicestershire' THEN 176
			WHEN l.description = 'Hinckley' THEN 177
			WHEN l.description = 'Derby' THEN 178
			WHEN l.description = 'Nottingham' THEN 179
		END company_location,
		ROW_NUMBER() OVER(PARTITION BY organisation_ref, l.description ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE organisation_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
concat_company_location AS (
	SELECT
		organisation_ref,
		string_agg(company_location::TEXT, ',') company_location
	FROM company_location
	WHERE rn = 1
	GROUP BY organisation_ref
)
------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
c.organisation_ref AS company_id,
company_location,
'add_com_info' additional_type,
1006 form_id,
11271 field_id,
'11271' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM main_company c
JOIN concat_company_location cl ON c.organisation_ref = cl.organisation_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3168</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_location_fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	11271 field_id,
	1006 form_id,
	ROW_NUMBER() OVER() field_value,
	description,
	ROW_NUMBER() OVER() id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER()) AS title_language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3184</xloc>
      <yloc>160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_location_list</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description,
	'en' AS "language",
	ROW_NUMBER() OVER() id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER()) AS language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3168</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>395</xloc>
      <yloc>562</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>312</xloc>
      <yloc>314</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_owner</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>WITH old_owner AS (
	SELECT
		c.id AS company_id,
		ua.id AS old_owner_id,
		email AS old_email,
		CASE
			WHEN email = 'tammie.huntley@hamlinknight.co.uk' THEN 'thuntley@hamlinknight.co.uk'
			WHEN email = 'Carolyn.wood@hutchinsonjonas.co.uk' THEN 'cwood@hamlinknight.co.uk'
			WHEN email = 'charleigh.davies@hamlinknight.co.uk'THEN 'cdavies@hamlinknight.co.uk'
			WHEN email = 'claire.dixon@hamlinknight.co.uk' THEN 'cdixon@hamlinknight.co.uk'
			WHEN email = 'craig.barnes@hamlinknight.co.uk' THEN 'cbarnes@hamlinknight.co.uk'
			WHEN email = 'David.McKernan@hamlinknight.co.uk' THEN 'dmckernan@hamlinknight.co.uk'
			WHEN email = 'Emma.Herron@hamlinknight.co.uk' THEN 'eherron@hamlinknight.co.uk'
			WHEN email = 'hannah.worswick@hamlinknight.co.uk' THEN 'hworswick@hamlinknight.co.uk'
			WHEN email = 'Jenny@hutchinsonjonas.co.uk' THEN 'Jsimmons@hamlinknight.co.uk'
			WHEN email = 'karen.balmer@hamlinknight.co.uk' THEN 'kbalmer@hamlinknight.co.uk'
			WHEN email = 'kyp@hutchinsonjonas.co.uk' THEN 'Kadair@hamlinknight.co.uk'
			WHEN email = 'lucy.mills@hamlinknight.co.uk' THEN 'lmills@hamlinknight.co.uk'
			WHEN email = 'natalie.salvato@hamlinknight.co.uk' THEN 'nsalvato@hamlinknight.co.uk'
			WHEN email = 'Paul.Berry@hamlinknight.co.uk' THEN 'pberry@hamlinknight.co.uk'
			WHEN email = 'sam.waites@hamlinknight.co.uk' THEN 'swaites@hamlinknight.co.uk'
			WHEN email = 'sarah.stone@hamlinknight.co.uk' THEN 'sstone@hamlinknight.co.uk'
			WHEN email = 'stacey.evans@hamlinknight.co.uk' THEN 'sevans@hamlinknight.co.uk'
			WHEN email = 'suky.rahim@hamlinknight.co.uk' THEN 'srahim@hamlinknight.co.uk'
			WHEN email = 'tejinder.bath@hamlinknight.co.uk' THEN 'tbath@hamlinknight.co.uk'
			WHEN email = 'tracey.rose@hamlinknight.co.uk' THEN 'trose@hamlinknight.co.uk'
		END AS new_email
	FROM company c
	JOIN user_account ua ON c.company_owners = ua.id::TEXT
	WHERE email IN (
	'tammie.huntley@hamlinknight.co.uk',
	'Carolyn.wood@hutchinsonjonas.co.uk',
	'charleigh.davies@hamlinknight.co.uk',
	'claire.dixon@hamlinknight.co.uk',
	'craig.barnes@hamlinknight.co.uk',
	'David.McKernan@hamlinknight.co.uk',
	'Emma.Herron@hamlinknight.co.uk',
	'hannah.worswick@hamlinknight.co.uk',
	'Jenny@hutchinsonjonas.co.uk',
	'karen.balmer@hamlinknight.co.uk',
	'kyp@hutchinsonjonas.co.uk',
	'lucy.mills@hamlinknight.co.uk',
	'natalie.salvato@hamlinknight.co.uk',
	'Paul.Berry@hamlinknight.co.uk',
	'sam.waites@hamlinknight.co.uk',
	'sarah.stone@hamlinknight.co.uk',
	'stacey.evans@hamlinknight.co.uk',
	'suky.rahim@hamlinknight.co.uk',
	'tejinder.bath@hamlinknight.co.uk',
	'tracey.rose@hamlinknight.co.uk'
	)
)

SELECT
	company_id,
	old_owner_id,
	old_email,
	new_email
FROM old_owner o
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>736</xloc>
      <yloc>992</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_rating</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH main_company AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY LOWER(TRIM(name)) ORDER BY create_timestamp) rn
	FROM organisation
),
company_rating AS (
	SELECT organisation_ref,
	CASE
		WHEN l.description = 'Gold' THEN '1'
		WHEN l.description = 'Silver' THEN '2'
		WHEN l.description = 'Other' THEN '3'
		WHEN l.description = 'Mailer' THEN '4'
		WHEN l.description = 'Small business up to 50 emps' THEN '5'
		WHEN l.description = 'Medium business 50-100 emps' THEN '6'
		WHEN l.description = 'Large business 100+ emps' THEN '7'
		WHEN l.description = 'PSL' THEN '8'
		WHEN l.description = 'Public Sector' THEN '9'
		WHEN l.description = 'Competitor''s Client' THEN '10'
		WHEN l.description = 'Temp Traitor Client' THEN '11'
	END rating,
	ROW_NUMBER() OVER(PARTITION BY organisation_ref, l.description ORDER BY organisation_ref) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE organisation_ref IS NOT NULL
	AND sc.code_type = '1040'
),
combine_rating AS (
	SELECT
		organisation_ref,
		string_agg(rating, ',') rating
	FROM company_rating
	WHERE rn = 1
	GROUP BY organisation_ref
)

------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
c.organisation_ref AS company_id,
cr.rating,
'add_com_info' additional_type,
1006 form_id,
11268 field_id,
'11268' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM main_company c
JOIN combine_rating cr ON c.organisation_ref = cr.organisation_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>101</xloc>
      <yloc>771</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company_registration</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH main_company AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY LOWER(TRIM(name)) ORDER BY create_timestamp) rn
	FROM organisation
),
company_phone AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY organisation_ref ORDER BY CASE WHEN main_address = 'Y' THEN 1 ELSE 2 END) AS rn
	FROM address
),
linkedin_url AS (
	SELECT
		parent_object_ref,
		website_url
	FROM linksite
	WHERE parent_object_name = 'organisation'
	AND STRPOS(website_url, 'linkedin') > 0
),
responsible_team AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '2'
),
organisation_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '110'
),
company_owner AS (
	SELECT
		person_ref,
		type,
		s.email_address
	FROM person_type pt
	LEFT JOIN staff s ON pt.person_type_ref = s.person_type_ref
	WHERE pt.type LIKE '%Z%'
	AND s.email_address LIKE '%@%'
)

------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
c.organisation_ref company_id,
c.create_timestamp::TIMESTAMP

FROM main_company c
-- LEFT JOIN (SELECT person_ref, email_address FROM person WHERE email_address LIKE '%hamlinknight%') p ON c.responsible_user = p.person_ref
LEFT JOIN company_owner co ON c.responsible_user = co.person_ref
LEFT JOIN company_phone a ON c.organisation_ref = a.organisation_ref AND a.rn = 1
LEFT JOIN linkedin_url l ON c.organisation_ref = l.parent_object_ref
LEFT JOIN responsible_team rt ON c.responsible_team = rt.code
LEFT JOIN organisation_type ot ON c.type = ot.code</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_field_value_candidate</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_field_value</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>field_value</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3408</xloc>
      <yloc>736</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_field_value_company</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_field_value</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>field_value</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>title_language_code</column_name>
        <stream_name>title_language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3392</xloc>
      <yloc>160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_field_value_company 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_field_value</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>field_value</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>960</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_field_value_contact</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_field_value</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>field_value</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3440</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_field_value_job</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_field_value</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>field_value</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3424</xloc>
      <yloc>1056</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_language_candidate</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_language</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>translate</column_name>
        <stream_name>description</stream_name>
      </field>
      <field>
        <column_name>language</column_name>
        <stream_name>language</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>language_code</column_name>
        <stream_name>language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3408</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_language_company</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_language</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>translate</column_name>
        <stream_name>description</stream_name>
      </field>
      <field>
        <column_name>language</column_name>
        <stream_name>language</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>language_code</column_name>
        <stream_name>language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3368</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_language_company 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_language</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>translate</column_name>
        <stream_name>group_name</stream_name>
      </field>
      <field>
        <column_name>language</column_name>
        <stream_name>language</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>language_code</column_name>
        <stream_name>language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_language_contact</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_language</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>translate</column_name>
        <stream_name>description</stream_name>
      </field>
      <field>
        <column_name>language</column_name>
        <stream_name>language</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>language_code</column_name>
        <stream_name>language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3442</xloc>
      <yloc>360</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>configurable_form_language_job</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>configurable_form_language</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>translate</column_name>
        <stream_name>description</stream_name>
      </field>
      <field>
        <column_name>language</column_name>
        <stream_name>language</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>language_code</column_name>
        <stream_name>language_code</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3424</xloc>
      <yloc>976</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(contact_email)) ORDER BY CASE WHEN contact_status = '1' THEN 1 ELSE 2 END) rn_email
	FROM contact_record_status
	WHERE rn = 1
),
contact_distribution_list AS (
	SELECT 
		object_ref AS  contact_id,
		CASE
			WHEN savelist_ref IN ('115814', '111384', '112854') THEN 'thuntley@hamlinknight.co.uk'
			WHEN savelist_ref IN ('113916', '116598', '104120') THEN 'pberry@hamlinknight.co.uk'
			WHEN savelist_ref IN ('116736') THEN 'charlotte.clarke@hamlinknight.co.uk'
			WHEN savelist_ref IN ('115502', '116676', '115540') THEN 'sam.waites@hamlinknight.co.uk'
			WHEN savelist_ref IN ('116253') THEN 'Emma.Herron@hamlinknight.co.uk'
			WHEN savelist_ref IN ('116688') THEN 'sara.homer@hamlinknight.co.uk'
			WHEN savelist_ref IN ('114125', '115874', '114210', '116469', '116729') THEN 'cbarnes@hamlinknight.co.uk'
			WHEN savelist_ref IN ('112842') THEN 'suky.rahim@hamlinknight.co.uk'
		END AS consultant,
		CASE
			WHEN savelist_ref = '115814'	THEN 'IMMEDIATELY AVAILABLES'
			WHEN savelist_ref = '111384'	THEN 'HIT LIST CONTACTS'
			WHEN savelist_ref = '112854'	THEN 'PERM CANDIDATES -TAMS'
			WHEN savelist_ref = '113916'	THEN 'PERM CANDIDATES PB'
			WHEN savelist_ref = '116598'	THEN 'BEZZA TEMPS'
			WHEN savelist_ref = '104120'	THEN 'CONTACT LIST PAUL HIT LIST CONTACTS 2015'
			WHEN savelist_ref = '116736'	THEN 'Charlotte Contact List'
			WHEN savelist_ref = '115502'	THEN 'SAM HIT LIST'
			WHEN savelist_ref = '116676'	THEN 'leam/war/ken mailer'
			WHEN savelist_ref = '115540'	THEN 'mailer to HR &amp; OPS'
			WHEN savelist_ref = '116253'	THEN 'Contact Sales List'
			WHEN savelist_ref = '116688'	THEN 'Sara 2019 Hot List'
			WHEN savelist_ref = '114125'	THEN 'Available Temps'
			WHEN savelist_ref = '115874'	THEN 'Nat''s Candidates'
			WHEN savelist_ref = '114210'	THEN 'Available Perm'
			WHEN savelist_ref = '116469'	THEN 'Person Finder (Quick search results)'
			WHEN savelist_ref = '116729'	THEN 'NS Candidates'
			WHEN savelist_ref = '112842'	THEN 'temp log candidates'
		END AS group_name
	FROM savelist_entry
	WHERE savelist_ref IN ('115814', '111384', '112854', '113916', '116598', '104120', '116736', '115502', '116676', '115540', '116253', '116688', '114125', '115874', '114210', '116469', '116729', '112842')
)

------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
cc.person_ref contact_id,
cdl.consultant,
cdl.group_name,
CURRENT_TIMESTAMP insert_timestamp
FROM current_contact cc
JOIN person p ON cc.person_ref = p.person_ref
JOIN contact_distribution_list cdl ON cc.person_ref = cdl.contact_id
ORDER BY group_name</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4288</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_activities</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *
	FROM contact_record_status
	WHERE rn = 1
),
event_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '123'
),
contact_owner AS (
	SELECT
		person_ref,
		type,
		s.email_address
	FROM person_type pt
	LEFT JOIN staff s ON pt.person_type_ref = s.person_type_ref
	WHERE pt.type LIKE '%Z%'
	AND s.email_address LIKE '%@%'
),
contact_activity AS (
	SELECT
	c.person_ref contact_id,
	et.description activity_type,
	CONCAT_WS(
		E'\n',
		CASE WHEN NULLIF(et.description, '') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
		CONCAT('Author: ', p.last_name, ' ', p.first_name),
		CASE WHEN NULLIF(co.email_address, '') IS NOT NULL THEN CONCAT('Email: ', co.email_address) END,
		CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
		CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
	) AS content,
	CONCAT(e.event_date, ' ', e.event_time)::TIMESTAMP insert_timestamp,
	'comment' AS category,
	'contact' AS type,
	-10 AS user_account_id,
	ROW_NUMBER() OVER(PARTITION BY c.person_ref, CONCAT_WS(
																												E'\n',
																												CASE WHEN NULLIF(et.description, '') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
																												CONCAT('Author: ', p.last_name, ' ', p.first_name),
																												CASE WHEN NULLIF(co.email_address, '') IS NOT NULL THEN CONCAT('Email: ', co.email_address) END,
																												CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
																												CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
																											) ORDER BY c.person_ref) AS rn

	FROM event e
	JOIN event_role er ON e.event_ref = er.event_ref
	JOIN current_contact c ON er.person_ref = c.person_ref
	LEFT JOIN person p ON e.create_user = p.person_ref
	LEFT JOIN contact_owner co ON e.create_user = co.person_ref
	LEFT JOIN event_type et ON e.type = et.code
	WHERE NULLIF(c.person_ref, '') IS NOT NULL
	AND NULLIF(e.event_date, '') IS NOT NULL
)

SELECT *
FROM contact_activity
WHERE rn = 1
AND activity_type IN (
'Drop to Client', 'Sick', 'Sales Lead', 'Sales lead - hot', 'Sales lead - normal', 'Client shutdown', 'Maternity/paternity leave', 'Working via another agency', 'Did not attend', 
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Activity', 'Referral - good', 'Referral - average', 'Referral - negative', 'Permanent offer', 'Position move to temporary job', 'Position move to contract', 'Position move to permanent position',
'Position move', 'Referral', 'Telephone call', 'Letter,Fax,Email', 'Mailshot', 'CV received', 'CV update', 'CV sent', 'Registration Interview', 'Interview 1 with client', 'Interview 2 with client',
'Interview 3 with client', 'Interview other', 'Canvass call', 'Meeting with client', 'Proposal submitted', 'Reference request', 'Invoice', 'Invoice for retainer', 'Invoice for shortlist',
'Invoice for completion', 'Temporary booking', 'Follow-up', 'Source', 'Debrief', 'Registration Interview', 'Candidate Call', 'Service Meeting', 'Staff Assessment', 'Sales Call', 'Marketing Call',
'Service Contact Call', 'Email Received', 'Text Message Received', 'Quick text', 'Email sent', 'Spec Cv Sent', 'Phone call made', 'Registration Interview', 'Contact call', 'Candidate call',
'Contact sales call', 'Candidate sales call', 'Target', 'Shortlist', 'Placement', 'Hitlist', 'Client Sales Call', 'Telephone Dial', 'Voicemail Call', 'Service Contact Call', 'Sales Contact Call', 
'Timesheet', 'PSL', 'Invite for Interview', 'Reject Candidate', 'Pay Advance Request', 'Profile requested P45', 'P45 auto-raised in back-office', 'P45 requested via website', 'Holiday',
'Shift booking', 'Process CV from email', 'Process vacancy from email', 'Process import from email')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_activity_type</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>SELECT 
	id, 
	REPLACE(REPLACE(activity_type, 'Telephone call', 'Telephone Call'), 'Candidate call', 'Candidate Call') activity_type,
	CURRENT_TIMESTAMP AS insert_timestamp
FROM activity
WHERE category = 'comment'
AND type = 'contact'
AND user_account_id = -10
AND activity_type IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3696</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(contact_email)) ORDER BY CASE WHEN contact_status = '1' THEN 1 ELSE 2 END) rn_email
	FROM contact_record_status
	WHERE rn = 1
)
SELECT
parent_object_ref contact_id,
CONCAT(parent_object_ref, '.', l.linkfile_ref, '.', file_extension) document_name,
file_extension,
parent_object_name,
l.displayname,
'CONTACT' entity_type,
'documents' document_type
FROM linkfile l
JOIN current_contact cc ON l.parent_object_ref = cc.person_ref
JOIN person p ON cc.person_ref = p.person_ref
WHERE parent_object_name = 'contact'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>400</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_industry 2 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *
	FROM contact_record_status
	WHERE rn = 1
), 
contact_industry AS (
	SELECT
		sc.person_ref contact_id,
		sc.code industry_code,
		ROW_NUMBER() OVER(PARTITION BY sc.person_ref, sc.code ORDER BY sc.person_ref) rn
	FROM search_code sc
	JOIN current_contact cc ON sc.person_ref = cc.person_ref
	WHERE sc.person_ref IS NOT NULL
	AND sc.code_type = '1005'
),
industry AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1005'
)
SELECT
	ci.contact_id,
	CASE
		WHEN i.description = 'IT Services' THEN 'IT Services'
		WHEN i.description = 'Carpenter' THEN 'Carpenter'
		WHEN i.description = 'Painting' THEN 'Painting'
		WHEN i.description = 'Shopfitting' THEN 'Shopfitting'
		WHEN i.description = 'Civils' THEN 'Civils'
		WHEN i.description = 'Drylining' THEN 'Drylining'
		WHEN i.description = 'Interiors' THEN 'Interiors'
		WHEN i.description = 'Student Accommodation' THEN 'Student Accommodation'
		WHEN i.description = 'High End Apartments' THEN 'High End Apartments'
		WHEN i.description = 'BUSINESS SERVICES' THEN 'BUSINESS SERVICES'
		WHEN i.description = 'Business Services General' THEN 'Business Services General'
		WHEN i.description = 'Accountancy' THEN 'Accountancy'
		WHEN i.description = 'Consultancy' THEN 'Consultancy'
		WHEN i.description = 'Property/Estate Agency' THEN 'Property/Estate Agency'
		WHEN i.description = 'Recruitment' THEN 'Recruitment'
		WHEN i.description = 'Training' THEN 'Training'
		WHEN i.description = 'Solicitors' THEN 'Solicitors'
		WHEN i.description = 'Call Centre' THEN 'Call Centre'
		WHEN i.description = 'Payroll' THEN 'Payroll'
		WHEN i.description = 'Charities' THEN 'Charities'
		WHEN i.description = 'Agricultural' THEN 'Agricultural'
		WHEN i.description = 'Dental Products' THEN 'Dental Products'
		WHEN i.description = 'CONSTRUCTION' THEN 'CONSTRUCTION'
		WHEN i.description = 'Construction General' THEN 'Construction General'
		WHEN i.description = 'Building Construction' THEN 'Building Construction'
		WHEN i.description = 'Buidling Materials' THEN 'Buidling Materials'
		WHEN i.description = 'FOOD / FMCG / CONSUMER GOODS' THEN 'FOOD / FMCG / CONSUMER GOODS'
		WHEN i.description = 'Cosmetics, Toiletries' THEN 'Cosmetics, Toiletries'
		WHEN i.description = 'Food, Drink, Tobacco' THEN 'Food, Drink, Tobacco'
		WHEN i.description = 'Household Goods' THEN 'Household Goods'
		WHEN i.description = 'Office Products, Stationery' THEN 'Office Products, Stationery'
		WHEN i.description = 'Electronics' THEN 'Electronics'
		WHEN i.description = 'Packaging' THEN 'Packaging'
		WHEN i.description = 'DISTRIBUTION/WAREHOUSING' THEN 'DISTRIBUTION/WAREHOUSING'
		WHEN i.description = 'Distribution General' THEN 'Distribution General'
		WHEN i.description = 'Distribution Automotive' THEN 'Distribution Automotive'
		WHEN i.description = 'Logistics' THEN 'Logistics'
		WHEN i.description = 'Warehouse' THEN 'Warehouse'
		WHEN i.description = 'ENGINEERING' THEN 'ENGINEERING'
		WHEN i.description = 'Engineering General' THEN 'Engineering General'
		WHEN i.description = 'Civil Engineering' THEN 'Civil Engineering'
		WHEN i.description = 'Mechanical Engineering' THEN 'Mechanical Engineering'
		WHEN i.description = 'Rubber/Plastic/Rope' THEN 'Rubber/Plastic/Rope'
		WHEN i.description = 'Waste Management Services' THEN 'Waste Management Services'
		WHEN i.description = 'Electrical Engineering' THEN 'Electrical Engineering'
		WHEN i.description = 'Mechanical Handling' THEN 'Mechanical Handling'
		WHEN i.description = 'Precision Engineering' THEN 'Precision Engineering'
		WHEN i.description = 'MANUFACTURING' THEN 'MANUFACTURING'
		WHEN i.description = 'Manufacturing General' THEN 'Manufacturing General'
		WHEN i.description = 'Motor Manufacturing' THEN 'Motor Manufacturing'
		WHEN i.description = 'Clothing Manufacturing' THEN 'Clothing Manufacturing'
		WHEN i.description = 'Industrial Manufacturing' THEN 'Industrial Manufacturing'
		WHEN i.description = 'FINANCE' THEN 'FINANCE'
		WHEN i.description = 'Finance General' THEN 'Finance General'
		WHEN i.description = 'Banks / Building Society' THEN 'Banks / Building Society'
		WHEN i.description = 'Financial Services' THEN 'Financial Services'
		WHEN i.description = 'Insurance' THEN 'Insurance'
		WHEN i.description = 'IT &amp; COMMUNICATIONS' THEN 'IT &amp; COMMUNICATIONS'
		WHEN i.description = 'Communications General' THEN 'Communications General'
		WHEN i.description = 'IT General' THEN 'IT General'
		WHEN i.description = 'IT Software' THEN 'IT Software'
		WHEN i.description = 'IT Training' THEN 'IT Training'
		WHEN i.description = 'Telecommunications' THEN 'Telecommunications'
		WHEN i.description = 'CHEMICALS PRODUCTION' THEN 'CHEMICALS PRODUCTION'
		WHEN i.description = 'Chemicals General' THEN 'Chemicals General'
		WHEN i.description = 'Oil &amp; Petrochemicals' THEN 'Oil &amp; Petrochemicals'
		WHEN i.description = 'LEISURE' THEN 'LEISURE'
		WHEN i.description = 'Leisure General' THEN 'Leisure General'
		WHEN i.description = 'Breweries' THEN 'Breweries'
		WHEN i.description = 'Catering' THEN 'Catering'
		WHEN i.description = 'Entertainment' THEN 'Entertainment'
		WHEN i.description = 'Hotel' THEN 'Hotel'
		WHEN i.description = 'Travel' THEN 'Travel'
		WHEN i.description = 'MEDIA/MARKETING' THEN 'MEDIA/MARKETING'
		WHEN i.description = 'Media General' THEN 'Media General'
		WHEN i.description = 'Design Agency' THEN 'Design Agency'
		WHEN i.description = 'Journalism' THEN 'Journalism'
		WHEN i.description = 'Books' THEN 'Books'
		WHEN i.description = 'Newspapers' THEN 'Newspapers'
		WHEN i.description = 'Printing &amp; Publishing' THEN 'Printing &amp; Publishing'
		WHEN i.description = 'Advertising' THEN 'Advertising'
		WHEN i.description = 'Marketing' THEN 'Marketing'
		WHEN i.description = 'Telemarketing' THEN 'Telemarketing'
		WHEN i.description = 'PUBLIC SECTOR' THEN 'PUBLIC SECTOR'
		WHEN i.description = 'Public Sector General' THEN 'Public Sector General'
		WHEN i.description = 'NHS' THEN 'NHS'
		WHEN i.description = 'Medical' THEN 'Medical'
		WHEN i.description = 'Primary Care Trust' THEN 'Primary Care Trust'
		WHEN i.description = 'Central Government' THEN 'Central Government'
		WHEN i.description = 'Local Borough' THEN 'Local Borough'
		WHEN i.description = 'Police' THEN 'Police'
		WHEN i.description = 'Fire' THEN 'Fire'
		WHEN i.description = 'Health' THEN 'Health'
		WHEN i.description = 'Armed Forces' THEN 'Armed Forces'
		WHEN i.description = 'Education' THEN 'Education'
		WHEN i.description = 'Council' THEN 'Council'
		WHEN i.description = 'PHARMACEUTICALS' THEN 'PHARMACEUTICALS'
		WHEN i.description = 'Pharmaceuticals General' THEN 'Pharmaceuticals General'
		WHEN i.description = 'Pharmaceutical Equipment' THEN 'Pharmaceutical Equipment'
		WHEN i.description = 'RETAIL' THEN 'RETAIL'
		WHEN i.description = 'Retail General' THEN 'Retail General'
		WHEN i.description = 'Food Retail' THEN 'Food Retail'
		WHEN i.description = 'DIY Retail' THEN 'DIY Retail'
		WHEN i.description = 'Home Furnishings' THEN 'Home Furnishings'
		WHEN i.description = 'Large Multiples' THEN 'Large Multiples'
		WHEN i.description = 'Fashion' THEN 'Fashion'
		WHEN i.description = 'TRANSPORT' THEN 'TRANSPORT'
		WHEN i.description = 'Transport General' THEN 'Transport General'
		WHEN i.description = 'Automotive' THEN 'Automotive'
		WHEN i.description = 'Dealership' THEN 'Dealership'
		WHEN i.description = 'Marine Services' THEN 'Marine Services'
		WHEN i.description = 'Public Transport' THEN 'Public Transport'
		WHEN i.description = 'Road/Rail Haulage' THEN 'Road/Rail Haulage'
		WHEN i.description = 'Shipping' THEN 'Shipping'
		WHEN i.description = 'Aerospace' THEN 'Aerospace'
		WHEN i.description = 'Car Hire' THEN 'Car Hire'
		WHEN i.description = 'UTILITIES' THEN 'UTILITIES'
		WHEN i.description = 'Utilities General' THEN 'Utilities General'
		WHEN i.description = 'Gas &amp; Oil' THEN 'Gas &amp; Oil'
		WHEN i.description = 'Electricity' THEN 'Electricity'
		WHEN i.description = 'Water' THEN 'Water'
	END industry,
	CURRENT_TIMESTAMP insert_timestamp
FROM contact_industry ci
JOIN industry i ON ci.industry_code = i.code
WHERE ci.rn = 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_location</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(contact_email)) ORDER BY CASE WHEN contact_status = '1' THEN 1 ELSE 2 END) rn_email
	FROM contact_record_status
	WHERE rn = 1
),
contact_location AS (
	SELECT 
		person_ref,
		CASE
			WHEN l.description = 'INTERNATIONAL' THEN 1
			WHEN l.description = 'Berlin' THEN 2
			WHEN l.description = 'Denmark' THEN 3
			WHEN l.description = 'Luxembourg' THEN 4
			WHEN l.description = 'NORTH WEST' THEN 5
			WHEN l.description = 'Manchester' THEN 6
			WHEN l.description = 'Oldham' THEN 7
			WHEN l.description = 'London' THEN 8
			WHEN l.description = 'Northampton' THEN 9
			WHEN l.description = 'Iceland' THEN 10
			WHEN l.description = 'Iver' THEN 11
			WHEN l.description = 'Dunstable' THEN 12
			WHEN l.description = 'Luton' THEN 13
			WHEN l.description = 'Milton Keynes' THEN 14
			WHEN l.description = 'Bedfordshire' THEN 15
			WHEN l.description = 'Luton' THEN 16
			WHEN l.description = 'Essex' THEN 17
			WHEN l.description = 'HERTFORDSHIRE' THEN 18
			WHEN l.description = 'Borehamwood' THEN 19
			WHEN l.description = 'Bushey' THEN 20
			WHEN l.description = 'Chorleywood' THEN 21
			WHEN l.description = 'Hatfield' THEN 22
			WHEN l.description = 'Hemel Hempstead' THEN 23
			WHEN l.description = 'Hitchin' THEN 24
			WHEN l.description = 'Maple Cross' THEN 25
			WHEN l.description = 'Rickmansworth' THEN 26
			WHEN l.description = 'St Albans' THEN 27
			WHEN l.description = 'Stevenage' THEN 28
			WHEN l.description = 'Watford' THEN 29
			WHEN l.description = 'Welwyn Garden City' THEN 30
			WHEN l.description = 'Kings Langley' THEN 31
			WHEN l.description = 'Chipperfield' THEN 32
			WHEN l.description = 'Bovingdon' THEN 33
			WHEN l.description = 'Berkhamstead' THEN 34
			WHEN l.description = 'Tring' THEN 35
			WHEN l.description = 'Redbourne' THEN 36
			WHEN l.description = 'Wembley' THEN 37
			WHEN l.description = 'Elstree' THEN 38
			WHEN l.description = 'Radlett' THEN 39
			WHEN l.description = 'Hertfordshire' THEN 40
			WHEN l.description = 'BUCKINGHAMSHIRE' THEN 41
			WHEN l.description = 'The Chalfonts' THEN 42
			WHEN l.description = 'Denham' THEN 43
			WHEN l.description = 'Gerrards Cross' THEN 44
			WHEN l.description = 'Stoke Poges' THEN 45
			WHEN l.description = 'High Wycombe' THEN 46
			WHEN l.description = 'Amersham' THEN 47
			WHEN l.description = 'Chesham' THEN 48
			WHEN l.description = 'Marlow' THEN 49
			WHEN l.description = 'Buckinghamshire' THEN 50
			WHEN l.description = 'MIDDLESEX' THEN 51
			WHEN l.description = 'Cowley' THEN 52
			WHEN l.description = 'Greenford' THEN 53
			WHEN l.description = 'Harefield' THEN 54
			WHEN l.description = 'Harmondsworth' THEN 55
			WHEN l.description = 'Harrow' THEN 56
			WHEN l.description = 'Hayes' THEN 57
			WHEN l.description = 'Heathrow' THEN 58
			WHEN l.description = 'Heston' THEN 59
			WHEN l.description = 'Hillingdon' THEN 60
			WHEN l.description = 'Ickenham' THEN 61
			WHEN l.description = 'Northolt' THEN 62
			WHEN l.description = 'Ruislip' THEN 63
			WHEN l.description = 'Southall' THEN 64
			WHEN l.description = 'Stanmore' THEN 65
			WHEN l.description = 'Stockley Park' THEN 66
			WHEN l.description = 'Uxbridge' THEN 67
			WHEN l.description = 'West Drayton' THEN 68
			WHEN l.description = 'Yiewsley' THEN 69
			WHEN l.description = 'Middlesex' THEN 70
			WHEN l.description = 'East Sussex' THEN 71
			WHEN l.description = 'Staines' THEN 72
			WHEN l.description = 'KENT' THEN 73
			WHEN l.description = 'Bromley' THEN 74
			WHEN l.description = 'Kent' THEN 75
			WHEN l.description = 'SURREY' THEN 76
			WHEN l.description = 'BERKSHIRE' THEN 77
			WHEN l.description = 'Colnbrook' THEN 78
			WHEN l.description = 'Langley' THEN 79
			WHEN l.description = 'Poyle' THEN 80
			WHEN l.description = 'Slough' THEN 81
			WHEN l.description = 'Berkshire' THEN 82
			WHEN l.description = 'Windsor' THEN 83
			WHEN l.description = 'OXFORDSHIRE' THEN 84
			WHEN l.description = 'Oxfordshire' THEN 85
			WHEN l.description = 'Banbury' THEN 86
			WHEN l.description = 'Bicester' THEN 87
			WHEN l.description = 'Thame' THEN 88
			WHEN l.description = 'Wiltshire' THEN 89
			WHEN l.description = 'LONDON' THEN 90
			WHEN l.description = 'City of London' THEN 91
			WHEN l.description = 'East London' THEN 92
			WHEN l.description = 'Stratford' THEN 93
			WHEN l.description = 'Docklands' THEN 94
			WHEN l.description = 'North London' THEN 95
			WHEN l.description = 'South London' THEN 96
			WHEN l.description = 'West London' THEN 97
			WHEN l.description = 'SOUTH EAST' THEN 98
			WHEN l.description = 'West Sussex' THEN 99
			WHEN l.description = 'Hampshire' THEN 100
			WHEN l.description = 'SOUTH WEST' THEN 101
			WHEN l.description = 'Bristol' THEN 102
			WHEN l.description = 'Avon' THEN 103
			WHEN l.description = 'Cornwall' THEN 104
			WHEN l.description = 'Dorset' THEN 105
			WHEN l.description = 'Devon' THEN 106
			WHEN l.description = 'Gloucestershire' THEN 107
			WHEN l.description = 'Somerset' THEN 108
			WHEN l.description = 'Cambridgeshire' THEN 109
			WHEN l.description = 'Norfolk' THEN 110
			WHEN l.description = 'Suffolk' THEN 111
			WHEN l.description = 'WEST MIDLANDS' THEN 112
			WHEN l.description = 'West Midlands' THEN 113
			WHEN l.description = 'Birmingham' THEN 114
			WHEN l.description = 'Solihull' THEN 115
			WHEN l.description = 'Dudley' THEN 116
			WHEN l.description = 'Herefordshire' THEN 117
			WHEN l.description = 'Worcestershire' THEN 118
			WHEN l.description = 'Staffordshire' THEN 119
			WHEN l.description = 'WARWICKSHIRE' THEN 120
			WHEN l.description = 'Atherstone' THEN 121
			WHEN l.description = 'Bedworth' THEN 122
			WHEN l.description = 'Coventry' THEN 123
			WHEN l.description = 'Kenilworth' THEN 124
			WHEN l.description = 'Leamington Spa' THEN 125
			WHEN l.description = 'Nuneaton' THEN 126
			WHEN l.description = 'Rugby' THEN 127
			WHEN l.description = 'Stratford Upon Avon' THEN 128
			WHEN l.description = 'Warwick' THEN 129
			WHEN l.description = 'Southam' THEN 130
			WHEN l.description = 'Warwickshire' THEN 131
			WHEN l.description = 'Lutterworth' THEN 132
			WHEN l.description = 'NORTH EAST' THEN 133
			WHEN l.description = 'NORTH YORKSHIRE' THEN 134
			WHEN l.description = 'North Yorkshire' THEN 135
			WHEN l.description = 'SOUTH YORKSHIRE' THEN 136
			WHEN l.description = 'South Yorkshire' THEN 137
			WHEN l.description = 'Sheffield' THEN 138
			WHEN l.description = 'Worksop' THEN 139
			WHEN l.description = 'Rotherham' THEN 140
			WHEN l.description = 'Mansfield' THEN 141
			WHEN l.description = 'Doncaster' THEN 142
			WHEN l.description = 'Derby' THEN 143
			WHEN l.description = 'Barnsley' THEN 144
			WHEN l.description = 'Chesterfield' THEN 145
			WHEN l.description = 'Dronfield' THEN 146
			WHEN l.description = 'Pontefract' THEN 147
			WHEN l.description = 'WEST YORKSHIRE' THEN 148
			WHEN l.description = 'Leeds' THEN 149
			WHEN l.description = 'EAST YORKSHIRE' THEN 150
			WHEN l.description = 'Goole' THEN 151
			WHEN l.description = 'Lincoln' THEN 152
			WHEN l.description = 'Grimsby' THEN 153
			WHEN l.description = 'Hull' THEN 154
			WHEN l.description = 'Scunthorpe' THEN 155
			WHEN l.description = 'SCOTLAND' THEN 156
			WHEN l.description = 'Aberdeen' THEN 157
			WHEN l.description = 'Dundee' THEN 158
			WHEN l.description = 'Edinburgh' THEN 159
			WHEN l.description = 'Fife' THEN 160
			WHEN l.description = 'Glasgow' THEN 161
			WHEN l.description = 'Kilmarnock' THEN 162
			WHEN l.description = 'Perth' THEN 163
			WHEN l.description = 'Sterling' THEN 164
			WHEN l.description = 'Scotland' THEN 165
			WHEN l.description = 'WALES' THEN 166
			WHEN l.description = 'Wales' THEN 167
			WHEN l.description = 'Cardiff' THEN 168
			WHEN l.description = 'Clywd' THEN 169
			WHEN l.description = 'Dyfed' THEN 170
			WHEN l.description = 'Gwynedd' THEN 171
			WHEN l.description = 'Gwent' THEN 172
			WHEN l.description = 'Mid Glamorgan' THEN 173
			WHEN l.description = 'South Glamorgan' THEN 174
			WHEN l.description = 'EAST MIDLANDS' THEN 175
			WHEN l.description = 'Leicestershire' THEN 176
			WHEN l.description = 'Hinckley' THEN 177
			WHEN l.description = 'Derby' THEN 178
			WHEN l.description = 'Nottingham' THEN 179
		END contact_location,
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE person_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
concat_contact_location AS (
	SELECT
		person_ref,
		string_agg(contact_location::TEXT, ',') contact_location
	FROM contact_location
	WHERE rn = 1
	GROUP BY person_ref
)
------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
cc.person_ref AS contact_id,
contact_location,
'add_con_info' additional_type,
1008 form_id,
11273 field_id,
'11273' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM current_contact cc
JOIN person p ON cc.person_ref = p.person_ref
JOIN concat_contact_location cl ON cc.person_ref = cl.person_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3184</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_location_fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	11273 field_id,
	1008 form_id,
	ROW_NUMBER() OVER() field_value,
	description,
	ROW_NUMBER() OVER() + 200 id,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3232</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_location_list</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description,
	'en' AS "language",
	ROW_NUMBER() OVER() + 200 id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER() + 200) AS language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3242</xloc>
      <yloc>360</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1015</xloc>
      <yloc>103</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>992</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup 3 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>992</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup 3 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4448</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_lookup 4</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contact_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1013</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_note</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(contact_email)) ORDER BY CASE WHEN contact_status = '1' THEN 1 ELSE 2 END) rn_email
	FROM contact_record_status
	WHERE rn = 1
),
contact_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '131'
),
department AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '299'
),
contact_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '135'
),
responsible_team AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '2'
),
contact_owner AS (
	SELECT
		person_ref,
		type,
		s.email_address
	FROM person_type pt
	LEFT JOIN staff s ON pt.person_type_ref = s.person_type_ref
	WHERE pt.type LIKE '%Z%'
	AND s.email_address LIKE '%@%'
),
contact_work_address AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY c.person_ref ORDER BY CASE WHEN main_address = 'Y' THEN 1 ELSE 2 END) rn,
		c.person_ref contact_id,
		a.main_address,
		a.displayname location_name,
		CONCAT_WS(
			', ',
			CASE WHEN RIGHT(TRIM(a.address_line_1), 1) = ',' THEN LEFT(TRIM(a.address_line_1), LENGTH(TRIM(a.address_line_1)) - 1) ELSE TRIM(a.address_line_1) END, 
			CASE WHEN RIGHT(TRIM(a.address_line_2), 1) = ',' THEN LEFT(TRIM(a.address_line_2), LENGTH(TRIM(a.address_line_2)) - 1) ELSE TRIM(a.address_line_2) END,
			CASE WHEN RIGHT(TRIM(a.address_line_3), 1) = ',' THEN LEFT(TRIM(a.address_line_3), LENGTH(TRIM(a.address_line_3)) - 1) ELSE TRIM(a.address_line_3) END,
			a.post_town,
			a.county_state,
			a.zipcode,
			a.country
		) AS address,
		a.telephone_number
		
	FROM current_contact c
	LEFT JOIN address a ON c.person_ref = a.person_ref
	WHERE COALESCE(address_line_1, address_line_2, address_line_3, post_town, county_state, zipcode, country) IS NOT NULL
	ORDER BY contact_id,
					CASE
						WHEN main_address = 'Y' THEN 1
						ELSE 2
					END
),
contact_location AS (
	SELECT 
		person_ref,
		l.description,
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE person_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
contact_languages AS (
	SELECT person_ref,
	string_agg(l.description, ', ') languages
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE person_ref IS NOT NULL
	AND sc.code_type = '1030'
	GROUP BY person_ref
),
client_rating AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1040'
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cc.person_ref contact_id,
CONCAT_WS(
	E'\n',
	CASE WHEN p.title IS NOT NULL THEN CONCAT('Title: ', CASE	
																													WHEN TRIM(p.title) = 'MRS' THEN 'Mrs'
																													WHEN TRIM(p.title) = 'MS' THEN 'Ms'
																													WHEN TRIM(p.title) = 'MIss' THEN 'Miss'
																													ELSE TRIM(p.title)
																											 END) END,
	CASE WHEN p.gender IS NOT NULL THEN CONCAT('Gender: ', CASE WHEN p.gender = 'M' THEN 'Male' WHEN p.gender = 'F' THEN 'Female' END) END,
	CASE WHEN COALESCE(cwa.location_name, cl.description) IS NOT NULL THEN CONCAT('Contact personal location: ', COALESCE(cwa.location_name, cl.description)) END,
	CASE WHEN cwa.address IS NOT NULL THEN CONCAT('Contact personal address: ', cwa.address) END,
	CASE WHEN ad.displayname IS NOT NULL THEN CONCAT('Contact work location: ', ad.displayname) END,
	CASE WHEN COALESCE(ad.address_line_1, ad.address_line_2, ad.address_line_3, ad.post_town, ad.county_state, ad.zipcode, ad.country) IS NOT NULL THEN
	CONCAT('Contact work address: ',
		CONCAT_WS(
				', ',
				CASE WHEN RIGHT(TRIM(ad.address_line_1), 1) = ',' THEN LEFT(TRIM(ad.address_line_1), LENGTH(TRIM(ad.address_line_1)) - 1) ELSE TRIM(ad.address_line_1) END, 
				CASE WHEN RIGHT(TRIM(ad.address_line_2), 1) = ',' THEN LEFT(TRIM(ad.address_line_2), LENGTH(TRIM(ad.address_line_2)) - 1) ELSE TRIM(ad.address_line_2) END,
				CASE WHEN RIGHT(TRIM(ad.address_line_3), 1) = ',' THEN LEFT(TRIM(ad.address_line_3), LENGTH(TRIM(ad.address_line_3)) - 1) ELSE TRIM(ad.address_line_3) END,
				ad.post_town,
				ad.county_state,
				ad.zipcode,
				ad.country
			)
	) END,
	CASE WHEN ct.description IS NOT NULL THEN CONCAT('Contact type: ', ct.description) END,
	CASE WHEN cs.description IS NOT NULL THEN CONCAT('Contact status: ', cs.description) END,	
	CASE WHEN p.z_last_contact_action IS NOT NULL THEN CONCAT('Last action: ', p.z_last_contact_action) END,
	CASE WHEN d.description IS NOT NULL THEN CONCAT('Department: ', d.description) END,
	CASE WHEN p2.displayname IS NOT NULL THEN CONCAT('Manager: ', p2.displayname) END,
	CASE WHEN cc.start_date IS NOT NULL THEN CONCAT('Start date: ', cc.start_date) END,
	CASE WHEN cc.end_date IS NOT NULL THEN CONCAT('End date: ', cc.end_date) END,
	CASE WHEN rt.description IS NOT NULL THEN CONCAT('Responsible team: ', rt.description) END,
	CASE WHEN cla.languages IS NOT NULL THEN CONCAT('Languages: ', cla.languages) END,
	CASE WHEN cc.notes IS NOT NULL THEN CONCAT('Note: ', cc.notes) END
) contact_note

FROM current_contact cc
JOIN person p ON cc.person_ref = p.person_ref
LEFT JOIN organisation o ON cc.organisation_ref = o.organisation_ref
LEFT JOIN contact_work_address cwa ON cc.person_ref = cwa.contact_id AND cwa.rn = 1
LEFT JOIN contact_location cl ON cc.person_ref = cl.person_ref AND cl.rn = 1
LEFT JOIN contact_owner co ON cc.responsible_user = co.person_ref
LEFT JOIN contact_type ct ON cc.type = ct.code
LEFT JOIN department d ON cc.department = d.code
LEFT JOIN person p2 ON cc.manager_person_ref = p2.person_ref
LEFT JOIN contact_status cs ON cc.contact_status = cs.code
LEFT JOIN responsible_team rt ON cc.responsible_team = rt.code
LEFT JOIN contact_languages cla ON cc.person_ref = cla.person_ref
LEFT JOIN address ad ON cc.address_ref = ad.address_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_other_fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		CASE
			WHEN email_address NOT LIKE '%@%' THEN NULL
			WHEN STRPOS(email_address, '''') = 1 AND RIGHT(email_address, 1) = '''' THEN LEFT(RIGHT(email_address, LENGTH(email_address) - 1), LENGTH(RIGHT(email_address, LENGTH(email_address) - 1)) - 1)
			ELSE email_address
		END AS contact_email,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *,
	ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(contact_email)) ORDER BY CASE WHEN contact_status = '1' THEN 1 ELSE 2 END) rn_email
	FROM contact_record_status
	WHERE rn = 1
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cc.person_ref contact_id,
CONCAT_WS( ', ', REGEXP_REPLACE(cc.mobile_telno, '[a-zA-Z!#$%&amp;*,-./:;&lt;=>?@[\]^_`{|}~]','','g'), REGEXP_REPLACE(p.mobile_telno, '[a-zA-Z!#$%&amp;*,-./:;&lt;=>?@[\]^_`{|}~]','','g')) mobile,
CASE
	WHEN STRPOS(p.email_address, '''') = 1 AND RIGHT(p.email_address, 1) = '''' THEN LEFT(RIGHT(p.email_address, LENGTH(p.email_address) - 1), LENGTH(RIGHT(p.email_address, LENGTH(p.email_address) - 1)) - 1)
	ELSE p.email_address
END AS personal_email


FROM current_contact cc
JOIN person p ON cc.person_ref = p.person_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>815</xloc>
      <yloc>103</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_owner</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>WITH old_owner AS (
	SELECT
		c.id AS contact_id,
		ua.id AS old_owner_id,
		ua.email AS old_email,
		CASE
			WHEN ua.email = 'tammie.huntley@hamlinknight.co.uk' THEN 'thuntley@hamlinknight.co.uk'
			WHEN ua.email = 'Carolyn.wood@hutchinsonjonas.co.uk' THEN 'cwood@hamlinknight.co.uk'
			WHEN ua.email = 'charleigh.davies@hamlinknight.co.uk'THEN 'cdavies@hamlinknight.co.uk'
			WHEN ua.email = 'claire.dixon@hamlinknight.co.uk' THEN 'cdixon@hamlinknight.co.uk'
			WHEN ua.email = 'craig.barnes@hamlinknight.co.uk' THEN 'cbarnes@hamlinknight.co.uk'
			WHEN ua.email = 'David.McKernan@hamlinknight.co.uk' THEN 'dmckernan@hamlinknight.co.uk'
			WHEN ua.email = 'Emma.Herron@hamlinknight.co.uk' THEN 'eherron@hamlinknight.co.uk'
			WHEN ua.email = 'hannah.worswick@hamlinknight.co.uk' THEN 'hworswick@hamlinknight.co.uk'
			WHEN ua.email = 'Jenny@hutchinsonjonas.co.uk' THEN 'Jsimmons@hamlinknight.co.uk'
			WHEN ua.email = 'karen.balmer@hamlinknight.co.uk' THEN 'kbalmer@hamlinknight.co.uk'
			WHEN ua.email = 'kyp@hutchinsonjonas.co.uk' THEN 'Kadair@hamlinknight.co.uk'
			WHEN ua.email = 'lucy.mills@hamlinknight.co.uk' THEN 'lmills@hamlinknight.co.uk'
			WHEN ua.email = 'natalie.salvato@hamlinknight.co.uk' THEN 'nsalvato@hamlinknight.co.uk'
			WHEN ua.email = 'Paul.Berry@hamlinknight.co.uk' THEN 'pberry@hamlinknight.co.uk'
			WHEN ua.email = 'sam.waites@hamlinknight.co.uk' THEN 'swaites@hamlinknight.co.uk'
			WHEN ua.email = 'sarah.stone@hamlinknight.co.uk' THEN 'sstone@hamlinknight.co.uk'
			WHEN ua.email = 'stacey.evans@hamlinknight.co.uk' THEN 'sevans@hamlinknight.co.uk'
			WHEN ua.email = 'suky.rahim@hamlinknight.co.uk' THEN 'srahim@hamlinknight.co.uk'
			WHEN ua.email = 'tejinder.bath@hamlinknight.co.uk' THEN 'tbath@hamlinknight.co.uk'
			WHEN ua.email = 'tracey.rose@hamlinknight.co.uk' THEN 'trose@hamlinknight.co.uk'
		END AS new_email
	FROM contact c
	JOIN user_account ua ON NULLIF(REGEXP_REPLACE(c.contact_owners, '[a-zA-Z!#$%&amp;*,-./:;&lt;=>?@[\]^_`{|}"~]','','g'), '') = ua.id::TEXT
	WHERE ua.email IN (
	'tammie.huntley@hamlinknight.co.uk',
	'Carolyn.wood@hutchinsonjonas.co.uk',
	'charleigh.davies@hamlinknight.co.uk',
	'claire.dixon@hamlinknight.co.uk',
	'craig.barnes@hamlinknight.co.uk',
	'David.McKernan@hamlinknight.co.uk',
	'Emma.Herron@hamlinknight.co.uk',
	'hannah.worswick@hamlinknight.co.uk',
	'Jenny@hutchinsonjonas.co.uk',
	'karen.balmer@hamlinknight.co.uk',
	'kyp@hutchinsonjonas.co.uk',
	'lucy.mills@hamlinknight.co.uk',
	'natalie.salvato@hamlinknight.co.uk',
	'Paul.Berry@hamlinknight.co.uk',
	'sam.waites@hamlinknight.co.uk',
	'sarah.stone@hamlinknight.co.uk',
	'stacey.evans@hamlinknight.co.uk',
	'suky.rahim@hamlinknight.co.uk',
	'tejinder.bath@hamlinknight.co.uk',
	'tracey.rose@hamlinknight.co.uk'
	)
)

SELECT
	contact_id,
	old_owner_id,
	old_email,
	new_email,
	CONCAT('["', ua.id, '"]') AS new_owner_id
FROM old_owner o
JOIN user_account ua ON o.new_email = ua.email</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>736</xloc>
      <yloc>1088</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact_switch_board</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH contact_record_status AS (
	SELECT
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
		p.*
	FROM position p
	LEFT JOIN lookup l ON p.record_status = l.code
	WHERE code_type = '132'
	AND NULLIF(person_ref, '0') IS NOT NULL
),
current_contact AS (
	SELECT *
	FROM contact_record_status
	WHERE rn = 1
),
contact_location AS (
	SELECT 
		person_ref,
		l.description,
		ROW_NUMBER() OVER(PARTITION BY person_ref ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE person_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
switch_board AS (
	SELECT 
		organisation_ref,
		telephone_number switch_board,
-- 		REGEXP_REPLACE(telephone_number, '[a-zA-Z!#$%&amp;*,-./:;&lt;=>?@[\]^_`{|}~]','','g') switch_board,
		ROW_NUMBER() OVER(PARTITION BY organisation_ref ORDER BY CASE WHEN main_address = 'Y' THEN 1 ELSE 2 END) AS rn
	FROM address
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cc.person_ref contact_id,
sb.switch_board
FROM current_contact cc
JOIN person p ON cc.person_ref = p.person_ref
LEFT JOIN switch_board sb ON cc.organisation_ref = sb.organisation_ref AND sb.rn = 1
WHERE sb.switch_board IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>813</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>distribution_list</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT 'Available Perm' AS group_name, 'cbarnes@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'BEZZA TEMPS' AS group_name, 'pberry@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'Charlotte Contact List' AS group_name, 'charlotte.clarke@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'CONTACT LIST PAUL HIT LIST CONTACTS 2015' AS group_name, 'pberry@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'Contact Sales List' AS group_name, 'Emma.Herron@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'HIT LIST CONTACTS' AS group_name, 'thuntley@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'IMMEDIATELY AVAILABLES' AS group_name, 'thuntley@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'leam/war/ken mailer' AS group_name, 'sam.waites@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'mailer to HR &amp; OPS' AS group_name, 'sam.waites@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'Nat''s Candidates' AS group_name, 'cbarnes@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'NS Candidates' AS group_name, 'cbarnes@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'PERM CANDIDATES -TAMS' AS group_name, 'thuntley@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'PERM CANDIDATES PB' AS group_name, 'pberry@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'SAM HIT LIST' AS group_name, 'sam.waites@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission 
UNION
SELECT 'Sara 2019 Hot List' AS group_name, 'sara.homer@hamlinknight.co.uk' AS consultant, CURRENT_TIMESTAMP AS insert_timestamp, 2 share_permission</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4384</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>fe_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>functional_expertise</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>functional_expertise</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>fe_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2752</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>fe_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>functional_expertise</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>fe</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>fe_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2656</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>fe_lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>functional_expertise</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>fe</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>fe_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1760</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>gdpr</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
check_dup_email AS (
	SELECT ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(email_address)) ORDER BY person_ref) rn_email,
	*
	FROM candidate_type
	WHERE rn = 1
	AND person_ref IS NOT NULL
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cst.code,
cst.description,
cde.person_ref AS candidate_id,
cde.first_name,
cde.last_name,
1 explicit_consent,
3 exercise_right,
1 request_through,
CURRENT_TIMESTAMP request_through_date,
5 obtained_through,
CURRENT_TIMESTAMP obtained_through_date,
1 expire,
'2024-05-01 00:00:00'::TIMESTAMP expire_date,
-10 obtained_by,
1 portal_status,
CURRENT_TIMESTAMP insert_timestamp

FROM check_dup_email cde
JOIN candidate_status cst ON cde.status = cst.code
WHERE cst.code = 'A1'
-- WHERE cst.code IN ('A1', 'I1')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2304</xloc>
      <yloc>960</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>industry 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_industry_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>395</xloc>
      <yloc>434</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>industry 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_industry_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>industry 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_industry_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2560</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>industry 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_industry_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1712</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_activity_type</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>label_detail</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>label_name</column_name>
        <stream_name>event_type</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>background_color</column_name>
        <stream_name>background_color</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3968</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_FE 2 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>candidate_functional_expertise</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>functional_expertise_id</column_name>
        <stream_name>fe_id</stream_name>
      </field>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>sub_functional_expertise_id</column_name>
        <stream_name>sub_fe_id</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2960</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_activities</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>activity_type</column_name>
        <stream_name>activity_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2656</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_ativity_type</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity_label</table>
    <commit>100</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>label_id</column_name>
        <stream_name>label_id</stream_name>
      </field>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4032</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_document</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>bulk_upload_document_mapping</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>entity_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>file_name</column_name>
        <stream_name>document_name</stream_name>
      </field>
      <field>
        <column_name>entity_type</column_name>
        <stream_name>entity_type</stream_name>
      </field>
      <field>
        <column_name>document_type</column_name>
        <stream_name>document_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2656</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_document 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>email_subscription</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>subscribed</column_name>
        <stream_name>email_subscribed</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>email</column_name>
        <stream_name>email</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2688</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_gdpr</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>candidate_gdpr_compliance</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>explicit_consent</column_name>
        <stream_name>explicit_consent</stream_name>
      </field>
      <field>
        <column_name>exercise_right</column_name>
        <stream_name>exercise_right</stream_name>
      </field>
      <field>
        <column_name>request_through</column_name>
        <stream_name>request_through</stream_name>
      </field>
      <field>
        <column_name>request_through_date</column_name>
        <stream_name>request_through_date</stream_name>
      </field>
      <field>
        <column_name>obtained_through</column_name>
        <stream_name>obtained_through</stream_name>
      </field>
      <field>
        <column_name>obtained_through_date</column_name>
        <stream_name>obtained_through_date</stream_name>
      </field>
      <field>
        <column_name>expire</column_name>
        <stream_name>expire</stream_name>
      </field>
      <field>
        <column_name>expire_date</column_name>
        <stream_name>expire_date</stream_name>
      </field>
      <field>
        <column_name>obtained_by</column_name>
        <stream_name>obtained_by</stream_name>
      </field>
      <field>
        <column_name>portal_status</column_name>
        <stream_name>portal_status</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2704</xloc>
      <yloc>960</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_location</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>candidate_location</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3488</xloc>
      <yloc>832</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_candidate_no_sub_FE</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>candidate_functional_expertise</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>functional_expertise_id</column_name>
        <stream_name>fe_id</stream_name>
      </field>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2976</xloc>
      <yloc>576</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_activity</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>company_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>activity_type</column_name>
        <stream_name>activity_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>504</xloc>
      <yloc>314</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_address</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>company_location</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>company_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>location_name</column_name>
        <stream_name>location_name</stream_name>
      </field>
      <field>
        <column_name>city</column_name>
        <stream_name>city</stream_name>
      </field>
      <field>
        <column_name>state</column_name>
        <stream_name>state</stream_name>
      </field>
      <field>
        <column_name>post_code</column_name>
        <stream_name>zipcode</stream_name>
      </field>
      <field>
        <column_name>country</column_name>
        <stream_name>country</stream_name>
      </field>
      <field>
        <column_name>address</column_name>
        <stream_name>address</stream_name>
      </field>
      <field>
        <column_name>longitude</column_name>
        <stream_name>longitude</stream_name>
      </field>
      <field>
        <column_name>latitude</column_name>
        <stream_name>latitude</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>480</xloc>
      <yloc>208</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_ativity_type</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity_label</table>
    <commit>100</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>label_id</column_name>
        <stream_name>label_id</stream_name>
      </field>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4032</xloc>
      <yloc>160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_document</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>bulk_upload_document_mapping</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>entity_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>file_name</column_name>
        <stream_name>document_name</stream_name>
      </field>
      <field>
        <column_name>entity_type</column_name>
        <stream_name>entity_type</stream_name>
      </field>
      <field>
        <column_name>document_type</column_name>
        <stream_name>document_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>448</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_hotlist</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>hotlist</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>1056</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_location</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>company_location</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3504</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_company_rating</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_company_id</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>rating</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>453</xloc>
      <yloc>771</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_contact_activity</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>contact_id</column_name>
        <stream_name>actual_contact_id</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>activity_type</column_name>
        <stream_name>activity_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_contact_ativity_type</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity_label</table>
    <commit>100</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>label_id</column_name>
        <stream_name>label_id</stream_name>
      </field>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4032</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_contact_document</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>bulk_upload_document_mapping</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>entity_id</column_name>
        <stream_name>actual_contact_id</stream_name>
      </field>
      <field>
        <column_name>file_name</column_name>
        <stream_name>document_name</stream_name>
      </field>
      <field>
        <column_name>entity_type</column_name>
        <stream_name>entity_type</stream_name>
      </field>
      <field>
        <column_name>document_type</column_name>
        <stream_name>document_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>400</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_contact_location</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_contact_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>contact_location</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3520</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_distribution_list</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>contact_group</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>name</column_name>
        <stream_name>group_name</stream_name>
      </field>
      <field>
        <column_name>owner_id</column_name>
        <stream_name>consultant_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>share_permission</column_name>
        <stream_name>share_permission</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4720</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_distribution_list 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>contact_group_contact</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>contact_id</column_name>
        <stream_name>actual_contact_id</stream_name>
      </field>
      <field>
        <column_name>contact_group_id</column_name>
        <stream_name>group_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4864</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_FE</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>position_description_functional_expertise</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>functional_expertise_id</column_name>
        <stream_name>fe_id</stream_name>
      </field>
      <field>
        <column_name>position_id</column_name>
        <stream_name>actual_job_id</stream_name>
      </field>
      <field>
        <column_name>sub_functional_expertise_id</column_name>
        <stream_name>sub_fe_id</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2064</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_activities</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>position_id</column_name>
        <stream_name>actual_job_id</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>activity_type</column_name>
        <stream_name>activity_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1760</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_ativity_type</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>activity_label</table>
    <commit>100</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>label_id</column_name>
        <stream_name>label_id</stream_name>
      </field>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4032</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_document</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>bulk_upload_document_mapping</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>entity_id</column_name>
        <stream_name>actual_job_id</stream_name>
      </field>
      <field>
        <column_name>file_name</column_name>
        <stream_name>document_name</stream_name>
      </field>
      <field>
        <column_name>entity_type</column_name>
        <stream_name>entity_type</stream_name>
      </field>
      <field>
        <column_name>document_type</column_name>
        <stream_name>document_type</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1808</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_location</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_job_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>job_location</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3504</xloc>
      <yloc>1152</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_job_no_sub_FE</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>position_description_functional_expertise</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>functional_expertise_id</column_name>
        <stream_name>fe_id</stream_name>
      </field>
      <field>
        <column_name>position_id</column_name>
        <stream_name>actual_job_id</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2080</xloc>
      <yloc>592</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_rate_mode</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>additional_form_values</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>additional_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>field_value</column_name>
        <stream_name>income_mode_code</stream_name>
      </field>
      <field>
        <column_name>additional_type</column_name>
        <stream_name>additional_type</stream_name>
      </field>
      <field>
        <column_name>form_id</column_name>
        <stream_name>form_id</stream_name>
      </field>
      <field>
        <column_name>field_id</column_name>
        <stream_name>field_id</stream_name>
      </field>
      <field>
        <column_name>constraint_id</column_name>
        <stream_name>constraint_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2704</xloc>
      <yloc>1184</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_sub_FE</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>sub_functional_expertise</table>
      <key>
        <name>fe_id</name>
        <field>functional_expertise_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>sub_functional_expertise</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>sub_functional_expertise</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>functional_expertise_id</name>
        <rename>fe_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2928</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_talent_pool_group</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>candidate_group</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>name</column_name>
        <stream_name>group_name</stream_name>
      </field>
      <field>
        <column_name>owner_id</column_name>
        <stream_name>hoa</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>share_permission</column_name>
        <stream_name>share_permission</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4624</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_talent_pool_group 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <schema>public</schema>
    <table>candidate_group_candidate</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>candidate_group_id</column_name>
        <stream_name>group_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4816</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_udate_candidate_industry 2 2</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>candidate_industry</table>
      <key>
        <name>actual_candidate_id</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>actual_industry_id</name>
        <field>vertical_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>vertical_id</name>
        <rename>actual_industry_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>candidate_id</name>
        <rename>actual_candidate_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2704</xloc>
      <yloc>288</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_udate_company_industry</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>company_industry</table>
      <key>
        <name>actual_company_id</name>
        <field>company_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>actual_industry_id</name>
        <field>industry_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>industry_id</name>
        <rename>actual_industry_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>company_id</name>
        <rename>actual_company_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_udate_contact_industry 2</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact_industry</table>
      <key>
        <name>actual_contact_id</name>
        <field>contact_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>actual_industry_id</name>
        <field>industry_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>industry_id</name>
        <rename>actual_industry_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
      <value>
        <name>contact_id</name>
        <rename>actual_contact_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1264</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_update_compensation</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>compensation</table>
      <key>
        <name>actual_job_id</name>
        <field>position_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>annual_salary_from</name>
        <rename>salary_from</rename>
        <update>Y</update>
      </value>
      <value>
        <name>annual_salary_to</name>
        <rename>salary_to</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1904</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>insert_update_job_industry</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <key>
        <name>actual_job_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>vertical_id</name>
        <rename>actual_industry_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1856</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_FE</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH job_fe AS (
	SELECT
		sc.opportunity_ref job_id,
		sc.code fe_code,
		ROW_NUMBER() OVER(PARTITION BY sc.opportunity_ref, sc.code ORDER BY sc.opportunity_ref) rn
	FROM search_code sc
	JOIN opportunity o ON sc.opportunity_ref = o.opportunity_ref
	WHERE sc.opportunity_ref IS NOT NULL
	AND sc.code_type = '1010'
),
funtional_expertise AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1010'
),
job_fe_sub_fe AS (
SELECT
	jfe.job_id,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN 'Part time'
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = '360 Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'Construction'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'Construction'
		WHEN TRIM(fe.description) = 'JIB' THEN 'Construction'
		WHEN TRIM(fe.description) = 'ECS' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Construction'
		WHEN TRIM(fe.description) = 'BUYER' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Construction'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'Construction'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'TRAINING' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Training'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Financial'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'OFFICE' THEN 'Office'
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Office'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Office'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Office'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Office'
	END fe,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN ''
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN ''
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountant'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Assistant Accountant'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Company Secretary'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Finance Manager'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Financial Accountant'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Financial Analyst'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Bookkeeper'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Financial Controller'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Finance Director'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Mgmt Accountant'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Auditor'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accounts Assistant'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Purchase Ledger Clerk'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Purchase Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Sales Ledger Clerk'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Sales Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Payroll Clerk'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Payroll Manager / Supervisor'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Credit Control Mgr / Sup'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Credit Controller'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Legal Cashier'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN ''
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Counterbalance Driver'
		WHEN TRIM(fe.description) = '360 Driver' THEN '360 Driver'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Wallpaper Hanger'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Tiler'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'SMSTS - Grst Aid'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'SSSTS - G'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'CSCS NVQ 3'
		WHEN TRIM(fe.description) = 'JIB' THEN 'JIB'
		WHEN TRIM(fe.description) = 'ECS' THEN 'ECS'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Carpenter'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Plumber'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Plasterer'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Labourer'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Painter'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Electrian'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Demo'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Site Manager'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Assistant Site Manager'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Improver'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Electrician'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Electricians Mate'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Plumbers Mate'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Pipe Fitter'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Pipe Fitters Mate'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Bricklayer'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Dryliner'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Ceiling Fixer'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Skilled Labourer'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Ganga'
		WHEN TRIM(fe.description) = 'BUYER' THEN ''
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Purchasing Admin'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Purchasing Manager'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Ground Worker'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Engineer'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Steel Fixer'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Welder'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'FLTD'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN ''
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Logistics Mgr / Sup'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Export Clerk'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Import Clerk'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Logistics Administrator'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Stock Controller'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Planner'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Fleet Coordinator / Admin'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Materials Planner'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN ''
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'Managing Director'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'Operations Mgr / Director'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General Manager'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN ''
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'HR Business Partner'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'HR Assistant'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'HR Administrator'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'HR Advisor'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'HR Director'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'HR Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Health &amp; Safety Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Health &amp; Safety Administrator'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Resourcing Manager'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Recruiter'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'HR Comps &amp; Bens'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Employee Relations Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Shared Services Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Shared Services Advisor'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Shared Services Admin'
		WHEN TRIM(fe.description) = 'TRAINING' THEN ''
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training Admin'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training Assistant'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training Consultant'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training Co-ordinator'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training Manager'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Trainer'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN ''
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'Technical Support'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT Development'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT Networks'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT Consultant'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'Systems Analyst'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT Management'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN ''
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Call Centre Manager'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Call Centre Team Leader'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Call Centre Assistant'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Cust Service Mgr'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Cust Services Supervi'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Cust Services Assis'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Cust Service Admin'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Dealership Service Advisor'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN ''
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial Advisor'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Pensions Administrator'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Underwriter'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN ''
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'SEO Manager'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'SEO Assistant'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Account Manager'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Brand Manager'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Event Admin'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Event Manager'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Merchandiser'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Marketing Administrator'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Marketing Co-ordinator'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Marketing Director'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Marketing Executive'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Marketing Manager'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'PR Consultant'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'PR Manager'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales Executive'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales Negotiator'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales Manager'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales Director'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales Support Admin'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Telesales Clerk'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Telesales Supervisor'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Online Marketing Manager'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Online Marketing Assistant'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'E-Commerce Manager'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'E-Commerce Assistant'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Website Assistant'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Web Developer'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Graphic Designer'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Photographer'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Videographer'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Internal Communications'
		WHEN TRIM(fe.description) = 'OFFICE' THEN ''
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Administrator'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Data Entry Clerk'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Data Entry Supervisor'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Facilities Manager'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Facilities Administrator'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Insurance Clerk'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office Junior'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office Manager'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Receptionist'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Senior Administrator'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Swtichboard Operator'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Analyst'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Audio Secretary'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Bi-Lingual Secretary'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Junior Secretary'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Legal Secretary'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Medical Secretary'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Personal Assistant'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'PA Secretary'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Operations Administrator'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Project Administrator'
	END sub_fe,
	CURRENT_TIMESTAMP insert_timestamp
FROM job_fe jfe
JOIN funtional_expertise fe ON jfe.fe_code = fe.code
WHERE jfe.rn = 1
AND fe.description IS NOT NULL
)

SELECT *
FROM job_fe_sub_fe
WHERE NULLIF(sub_fe, '') IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_FE_no_sub_FE</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH job_fe AS (
	SELECT
		sc.opportunity_ref job_id,
		sc.code fe_code,
		ROW_NUMBER() OVER(PARTITION BY sc.opportunity_ref, sc.code ORDER BY sc.opportunity_ref) rn
	FROM search_code sc
	JOIN opportunity o ON sc.opportunity_ref = o.opportunity_ref
	WHERE sc.opportunity_ref IS NOT NULL
	AND sc.code_type = '1010'
),
funtional_expertise AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1010'
),
job_fe_sub_fe AS (
SELECT
	jfe.job_id,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN 'Part time'
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Accountancy / Finance'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = '360 Driver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'Construction'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'Construction'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'Construction'
		WHEN TRIM(fe.description) = 'JIB' THEN 'Construction'
		WHEN TRIM(fe.description) = 'ECS' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Construction'
		WHEN TRIM(fe.description) = 'BUYER' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Construction'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Construction'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'Construction'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Transport/Logistics'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General (Mgr)'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Human Resources'
		WHEN TRIM(fe.description) = 'TRAINING' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Training'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'IT'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Customer Services'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Financial'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Financial'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Sales &amp; Marketing'
		WHEN TRIM(fe.description) = 'OFFICE' THEN 'Office'
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Office'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Office'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Office'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'Office'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Office'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Office'
	END fe,
	CASE
		WHEN TRIM(fe.description) = 'Part Time' THEN ''
		WHEN TRIM(fe.description) = 'ACCOUNTANCY / FINANCE' THEN ''
		WHEN TRIM(fe.description) = 'Accountant' THEN 'Accountant'
		WHEN TRIM(fe.description) = 'Assistant Accountant' THEN 'Assistant Accountant'
		WHEN TRIM(fe.description) = 'Company Secretary' THEN 'Company Secretary'
		WHEN TRIM(fe.description) = 'Finance Manager' THEN 'Finance Manager'
		WHEN TRIM(fe.description) = 'Financial Accountant' THEN 'Financial Accountant'
		WHEN TRIM(fe.description) = 'Financial Analyst' THEN 'Financial Analyst'
		WHEN TRIM(fe.description) = 'Bookkeeper' THEN 'Bookkeeper'
		WHEN TRIM(fe.description) = 'Financial Controller' THEN 'Financial Controller'
		WHEN TRIM(fe.description) = 'Finance Director' THEN 'Finance Director'
		WHEN TRIM(fe.description) = 'Mgmt Accountant' THEN 'Mgmt Accountant'
		WHEN TRIM(fe.description) = 'Auditor' THEN 'Auditor'
		WHEN TRIM(fe.description) = 'Accounts Assistant' THEN 'Accounts Assistant'
		WHEN TRIM(fe.description) = 'Purchase Ledger Clerk' THEN 'Purchase Ledger Clerk'
		WHEN TRIM(fe.description) = 'Purchase Ledger Sup / Mgr' THEN 'Purchase Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Sales Ledger Clerk' THEN 'Sales Ledger Clerk'
		WHEN TRIM(fe.description) = 'Sales Ledger Sup / Mgr' THEN 'Sales Ledger Sup / Mgr'
		WHEN TRIM(fe.description) = 'Payroll Clerk' THEN 'Payroll Clerk'
		WHEN TRIM(fe.description) = 'Payroll Manager / Supervisor' THEN 'Payroll Manager / Supervisor'
		WHEN TRIM(fe.description) = 'Credit Control Mgr / Sup' THEN 'Credit Control Mgr / Sup'
		WHEN TRIM(fe.description) = 'Credit Controller' THEN 'Credit Controller'
		WHEN TRIM(fe.description) = 'Legal Cashier' THEN 'Legal Cashier'
		WHEN TRIM(fe.description) = 'CONSTRUCTION' THEN ''
		WHEN TRIM(fe.description) = 'Counterbalance Driver' THEN 'Counterbalance Driver'
		WHEN TRIM(fe.description) = '360 Driver' THEN '360 Driver'
		WHEN TRIM(fe.description) = 'Wallpaper Hanger' THEN 'Wallpaper Hanger'
		WHEN TRIM(fe.description) = 'Tiler' THEN 'Tiler'
		WHEN TRIM(fe.description) = 'SMSTS - Grst Aid' THEN 'SMSTS - Grst Aid'
		WHEN TRIM(fe.description) = 'SSSTS - G' THEN 'SSSTS - G'
		WHEN TRIM(fe.description) = 'CSCS NVQ 3' THEN 'CSCS NVQ 3'
		WHEN TRIM(fe.description) = 'JIB' THEN 'JIB'
		WHEN TRIM(fe.description) = 'ECS' THEN 'ECS'
		WHEN TRIM(fe.description) = 'Carpenter' THEN 'Carpenter'
		WHEN TRIM(fe.description) = 'Plumber' THEN 'Plumber'
		WHEN TRIM(fe.description) = 'Plasterer' THEN 'Plasterer'
		WHEN TRIM(fe.description) = 'Labourer' THEN 'Labourer'
		WHEN TRIM(fe.description) = 'Painter' THEN 'Painter'
		WHEN TRIM(fe.description) = 'Electrian' THEN 'Electrian'
		WHEN TRIM(fe.description) = 'Demo' THEN 'Demo'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Site Manager' THEN 'Site Manager'
		WHEN TRIM(fe.description) = 'Assistant Site Manager' THEN 'Assistant Site Manager'
		WHEN TRIM(fe.description) = 'Improver' THEN 'Improver'
		WHEN TRIM(fe.description) = 'Electrician' THEN 'Electrician'
		WHEN TRIM(fe.description) = 'Electricians Mate' THEN 'Electricians Mate'
		WHEN TRIM(fe.description) = 'Plumbers Mate' THEN 'Plumbers Mate'
		WHEN TRIM(fe.description) = 'Pipe Fitter' THEN 'Pipe Fitter'
		WHEN TRIM(fe.description) = 'Pipe Fitters Mate' THEN 'Pipe Fitters Mate'
		WHEN TRIM(fe.description) = 'Bricklayer' THEN 'Bricklayer'
		WHEN TRIM(fe.description) = 'Dryliner' THEN 'Dryliner'
		WHEN TRIM(fe.description) = 'Ceiling Fixer' THEN 'Ceiling Fixer'
		WHEN TRIM(fe.description) = 'Skilled Labourer' THEN 'Skilled Labourer'
		WHEN TRIM(fe.description) = 'Ganga' THEN 'Ganga'
		WHEN TRIM(fe.description) = 'BUYER' THEN ''
		WHEN TRIM(fe.description) = 'Purchasing Admin' THEN 'Purchasing Admin'
		WHEN TRIM(fe.description) = 'Buyer' THEN 'Buyer'
		WHEN TRIM(fe.description) = 'Purchasing Manager' THEN 'Purchasing Manager'
		WHEN TRIM(fe.description) = 'Ground Worker' THEN 'Ground Worker'
		WHEN TRIM(fe.description) = 'Engineer' THEN 'Engineer'
		WHEN TRIM(fe.description) = 'Steel Fixer' THEN 'Steel Fixer'
		WHEN TRIM(fe.description) = 'Welder' THEN 'Welder'
		WHEN TRIM(fe.description) = 'FLTD' THEN 'FLTD'
		WHEN TRIM(fe.description) = 'TRANSPORT/LOGISTICS' THEN ''
		WHEN TRIM(fe.description) = 'Logistics Mgr / Sup' THEN 'Logistics Mgr / Sup'
		WHEN TRIM(fe.description) = 'Export Clerk' THEN 'Export Clerk'
		WHEN TRIM(fe.description) = 'Import Clerk' THEN 'Import Clerk'
		WHEN TRIM(fe.description) = 'Logistics Administrator' THEN 'Logistics Administrator'
		WHEN TRIM(fe.description) = 'Stock Controller' THEN 'Stock Controller'
		WHEN TRIM(fe.description) = 'Planner' THEN 'Planner'
		WHEN TRIM(fe.description) = 'Fleet Coordinator / Admin' THEN 'Fleet Coordinator / Admin'
		WHEN TRIM(fe.description) = 'Materials Planner' THEN 'Materials Planner'
		WHEN TRIM(fe.description) = 'GENERAL (MGR)' THEN ''
		WHEN TRIM(fe.description) = 'Managing Director' THEN 'Managing Director'
		WHEN TRIM(fe.description) = 'Operations Mgr / Director' THEN 'Operations Mgr / Director'
		WHEN TRIM(fe.description) = 'General Manager' THEN 'General Manager'
		WHEN TRIM(fe.description) = 'HUMAN RESOURCES' THEN ''
		WHEN TRIM(fe.description) = 'HR Business Partner' THEN 'HR Business Partner'
		WHEN TRIM(fe.description) = 'HR Assistant' THEN 'HR Assistant'
		WHEN TRIM(fe.description) = 'HR Administrator' THEN 'HR Administrator'
		WHEN TRIM(fe.description) = 'HR Advisor' THEN 'HR Advisor'
		WHEN TRIM(fe.description) = 'HR Director' THEN 'HR Director'
		WHEN TRIM(fe.description) = 'HR Manager' THEN 'HR Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Manager' THEN 'Health &amp; Safety Manager'
		WHEN TRIM(fe.description) = 'Health &amp; Safety Administrator' THEN 'Health &amp; Safety Administrator'
		WHEN TRIM(fe.description) = 'Resourcing Manager' THEN 'Resourcing Manager'
		WHEN TRIM(fe.description) = 'Recruiter' THEN 'Recruiter'
		WHEN TRIM(fe.description) = 'HR Comps &amp; Bens' THEN 'HR Comps &amp; Bens'
		WHEN TRIM(fe.description) = 'Employee Relations Mgr' THEN 'Employee Relations Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Mgr' THEN 'Shared Services Mgr'
		WHEN TRIM(fe.description) = 'Shared Services Advisor' THEN 'Shared Services Advisor'
		WHEN TRIM(fe.description) = 'Shared Services Admin' THEN 'Shared Services Admin'
		WHEN TRIM(fe.description) = 'TRAINING' THEN ''
		WHEN TRIM(fe.description) = 'Training Admin' THEN 'Training Admin'
		WHEN TRIM(fe.description) = 'Training Assistant' THEN 'Training Assistant'
		WHEN TRIM(fe.description) = 'Training Consultant' THEN 'Training Consultant'
		WHEN TRIM(fe.description) = 'Training Co-ordinator' THEN 'Training Co-ordinator'
		WHEN TRIM(fe.description) = 'Training Manager' THEN 'Training Manager'
		WHEN TRIM(fe.description) = 'Trainer' THEN 'Trainer'
		WHEN TRIM(fe.description) = 'INDUSTRIAL' THEN ''
		WHEN TRIM(fe.description) = 'IT' THEN 'IT'
		WHEN TRIM(fe.description) = 'Technical Support' THEN 'Technical Support'
		WHEN TRIM(fe.description) = 'IT Development' THEN 'IT Development'
		WHEN TRIM(fe.description) = 'IT Networks' THEN 'IT Networks'
		WHEN TRIM(fe.description) = 'IT Consultant' THEN 'IT Consultant'
		WHEN TRIM(fe.description) = 'Systems Analyst' THEN 'Systems Analyst'
		WHEN TRIM(fe.description) = 'IT Management' THEN 'IT Management'
		WHEN TRIM(fe.description) = 'CUSTOMER SERVICES' THEN ''
		WHEN TRIM(fe.description) = 'Call Centre Manager' THEN 'Call Centre Manager'
		WHEN TRIM(fe.description) = 'Call Centre Team Leader' THEN 'Call Centre Team Leader'
		WHEN TRIM(fe.description) = 'Call Centre Assistant' THEN 'Call Centre Assistant'
		WHEN TRIM(fe.description) = 'Cust Service Mgr' THEN 'Cust Service Mgr'
		WHEN TRIM(fe.description) = 'Cust Services Supervi' THEN 'Cust Services Supervi'
		WHEN TRIM(fe.description) = 'Cust Services Assis' THEN 'Cust Services Assis'
		WHEN TRIM(fe.description) = 'Cust Service Admin' THEN 'Cust Service Admin'
		WHEN TRIM(fe.description) = 'Dealership Service Advisor' THEN 'Dealership Service Advisor'
		WHEN TRIM(fe.description) = 'FINANCIAL' THEN ''
		WHEN TRIM(fe.description) = 'Financial Advisor' THEN 'Financial Advisor'
		WHEN TRIM(fe.description) = 'Pensions Administrator' THEN 'Pensions Administrator'
		WHEN TRIM(fe.description) = 'Underwriter' THEN 'Underwriter'
		WHEN TRIM(fe.description) = 'SALES &amp; MARKETING' THEN ''
		WHEN TRIM(fe.description) = 'SEO Manager' THEN 'SEO Manager'
		WHEN TRIM(fe.description) = 'SEO Assistant' THEN 'SEO Assistant'
		WHEN TRIM(fe.description) = 'Account Manager' THEN 'Account Manager'
		WHEN TRIM(fe.description) = 'Brand Manager' THEN 'Brand Manager'
		WHEN TRIM(fe.description) = 'Event Admin' THEN 'Event Admin'
		WHEN TRIM(fe.description) = 'Event Manager' THEN 'Event Manager'
		WHEN TRIM(fe.description) = 'Merchandiser' THEN 'Merchandiser'
		WHEN TRIM(fe.description) = 'Marketing Administrator' THEN 'Marketing Administrator'
		WHEN TRIM(fe.description) = 'Marketing Co-ordinator' THEN 'Marketing Co-ordinator'
		WHEN TRIM(fe.description) = 'Marketing Director' THEN 'Marketing Director'
		WHEN TRIM(fe.description) = 'Marketing Executive' THEN 'Marketing Executive'
		WHEN TRIM(fe.description) = 'Marketing Manager' THEN 'Marketing Manager'
		WHEN TRIM(fe.description) = 'PR Consultant' THEN 'PR Consultant'
		WHEN TRIM(fe.description) = 'PR Manager' THEN 'PR Manager'
		WHEN TRIM(fe.description) = 'Sales Executive' THEN 'Sales Executive'
		WHEN TRIM(fe.description) = 'Sales Negotiator' THEN 'Sales Negotiator'
		WHEN TRIM(fe.description) = 'Sales Manager' THEN 'Sales Manager'
		WHEN TRIM(fe.description) = 'Sales Director' THEN 'Sales Director'
		WHEN TRIM(fe.description) = 'Sales Support Admin' THEN 'Sales Support Admin'
		WHEN TRIM(fe.description) = 'Telesales Clerk' THEN 'Telesales Clerk'
		WHEN TRIM(fe.description) = 'Telesales Supervisor' THEN 'Telesales Supervisor'
		WHEN TRIM(fe.description) = 'Online Marketing Manager' THEN 'Online Marketing Manager'
		WHEN TRIM(fe.description) = 'Online Marketing Assistant' THEN 'Online Marketing Assistant'
		WHEN TRIM(fe.description) = 'E-Commerce Manager' THEN 'E-Commerce Manager'
		WHEN TRIM(fe.description) = 'E-Commerce Assistant' THEN 'E-Commerce Assistant'
		WHEN TRIM(fe.description) = 'Website Assistant' THEN 'Website Assistant'
		WHEN TRIM(fe.description) = 'Web Developer' THEN 'Web Developer'
		WHEN TRIM(fe.description) = 'Graphic Designer' THEN 'Graphic Designer'
		WHEN TRIM(fe.description) = 'Photographer' THEN 'Photographer'
		WHEN TRIM(fe.description) = 'Videographer' THEN 'Videographer'
		WHEN TRIM(fe.description) = 'Internal Communications' THEN 'Internal Communications'
		WHEN TRIM(fe.description) = 'OFFICE' THEN ''
		WHEN TRIM(fe.description) = 'Administrator' THEN 'Administrator'
		WHEN TRIM(fe.description) = 'Data Entry Clerk' THEN 'Data Entry Clerk'
		WHEN TRIM(fe.description) = 'Data Entry Supervisor' THEN 'Data Entry Supervisor'
		WHEN TRIM(fe.description) = 'Facilities Manager' THEN 'Facilities Manager'
		WHEN TRIM(fe.description) = 'Facilities Administrator' THEN 'Facilities Administrator'
		WHEN TRIM(fe.description) = 'Insurance Clerk' THEN 'Insurance Clerk'
		WHEN TRIM(fe.description) = 'Office Junior' THEN 'Office Junior'
		WHEN TRIM(fe.description) = 'Office Manager' THEN 'Office Manager'
		WHEN TRIM(fe.description) = 'Receptionist' THEN 'Receptionist'
		WHEN TRIM(fe.description) = 'Senior Administrator' THEN 'Senior Administrator'
		WHEN TRIM(fe.description) = 'Swtichboard Operator' THEN 'Swtichboard Operator'
		WHEN TRIM(fe.description) = 'Analyst' THEN 'Analyst'
		WHEN TRIM(fe.description) = 'Audio Secretary' THEN 'Audio Secretary'
		WHEN TRIM(fe.description) = 'Bi-Lingual Secretary' THEN 'Bi-Lingual Secretary'
		WHEN TRIM(fe.description) = 'Junior Secretary' THEN 'Junior Secretary'
		WHEN TRIM(fe.description) = 'Legal Secretary' THEN 'Legal Secretary'
		WHEN TRIM(fe.description) = 'Medical Secretary' THEN 'Medical Secretary'
		WHEN TRIM(fe.description) = 'Personal Assistant' THEN 'Personal Assistant'
		WHEN TRIM(fe.description) = 'PA Secretary' THEN 'PA Secretary'
		WHEN TRIM(fe.description) = 'Operations Administrator' THEN 'Operations Administrator'
		WHEN TRIM(fe.description) = 'Project Manager' THEN 'Project Manager'
		WHEN TRIM(fe.description) = 'Project Administrator' THEN 'Project Administrator'
	END sub_fe,
	CURRENT_TIMESTAMP insert_timestamp
FROM job_fe jfe
JOIN funtional_expertise fe ON jfe.fe_code = fe.code
WHERE jfe.rn = 1
AND fe.description IS NOT NULL
)

SELECT *
FROM job_fe_sub_fe
WHERE NULLIF(sub_fe, '') IS NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>576</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_activities</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH event_type AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '123'
)
SELECT
e.opportunity_ref job_id,
et.description activity_type,
CONCAT_WS(
	E'\n',
	CASE WHEN NULLIF(et.description, '') IS NOT NULL THEN CONCAT('Event type: ', et.description) END,
	CONCAT('Author: ', p.last_name, ' ', p.first_name),
	CASE WHEN NULLIF(p.email_address, '') IS NOT NULL THEN CONCAT('Email: ', p.email_address) END,
	CASE WHEN NULLIF(e.subject, '') IS NOT NULL THEN CONCAT('Subject: ', e.subject) END,
	CASE WHEN NULLIF(e.notes, '') IS NOT NULL THEN CONCAT('Activity notes: ', E'\n', e.notes) END
) AS content,
CONCAT(e.event_date, ' ', e.event_time)::TIMESTAMP insert_timestamp,
'comment' AS category,
'job' AS type,
-10 AS user_account_id

FROM event e
LEFT JOIN person p ON e.create_user = p.person_ref
LEFT JOIN event_type et ON e.type = et.code
WHERE NULLIF(e.opportunity_ref::TEXT, '') IS NOT NULL
AND NULLIF(e.event_date, '') IS NOT NULL
AND et.description IN (
'Drop to Client', 'Sick', 'Sales Lead', 'Sales lead - hot', 'Sales lead - normal', 'Client shutdown', 'Maternity/paternity leave', 'Working via another agency', 'Did not attend', 
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Day 1 info request to contact', 'Work history request to candidate', 'Day 1 rights sent to candidate', 'Basic work conditions request to contact', 'Basic work conditions sent to candidate',
'Activity', 'Referral - good', 'Referral - average', 'Referral - negative', 'Permanent offer', 'Position move to temporary job', 'Position move to contract', 'Position move to permanent position',
'Position move', 'Referral', 'Telephone call', 'Letter,Fax,Email', 'Mailshot', 'CV received', 'CV update', 'CV sent', 'Registration Interview', 'Interview 1 with client', 'Interview 2 with client',
'Interview 3 with client', 'Interview other', 'Canvass call', 'Meeting with client', 'Proposal submitted', 'Reference request', 'Invoice', 'Invoice for retainer', 'Invoice for shortlist',
'Invoice for completion', 'Temporary booking', 'Follow-up', 'Source', 'Debrief', 'Registration Interview', 'Candidate Call', 'Service Meeting', 'Staff Assessment', 'Sales Call', 'Marketing Call',
'Service Contact Call', 'Email Received', 'Text Message Received', 'Quick text', 'Email sent', 'Spec Cv Sent', 'Phone call made', 'Registration Interview', 'Contact call', 'Candidate call',
'Contact sales call', 'Candidate sales call', 'Target', 'Shortlist', 'Placement', 'Hitlist', 'Client Sales Call', 'Telephone Dial', 'Voicemail Call', 'Service Contact Call', 'Sales Contact Call', 
'Timesheet', 'PSL', 'Invite for Interview', 'Reject Candidate', 'Pay Advance Request', 'Profile requested P45', 'P45 auto-raised in back-office', 'P45 requested via website', 'Holiday',
'Shift booking', 'Process CV from email', 'Process vacancy from email', 'Process import from email')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_activity_type</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>SELECT 
	id, 
	REPLACE(REPLACE(activity_type, 'Telephone call', 'Telephone Call'), 'Candidate call', 'Candidate Call') activity_type,
	CURRENT_TIMESTAMP AS insert_timestamp
FROM activity
WHERE category = 'comment'
AND type = 'job'
AND user_account_id = -10
AND activity_type IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3696</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_compensation</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
o.opportunity_ref AS job_id,
pv.lower_income::INT salary_from,
pv.upper_income::INT salary_to

FROM opportunity o
LEFT JOIN permanent_vac pv ON o.opportunity_ref = pv.opportunity_ref
LEFT JOIN temporary_vac tv ON o.opportunity_ref = tv.opportunity_ref
WHERE COALESCE(pv.lower_income, pv.upper_income) IS NOT NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1504</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
parent_object_ref job_id,
CONCAT(parent_object_ref, '.', l.linkfile_ref, '.', file_extension) document_name,
file_extension,
parent_object_name,
l.displayname,
'POSITION' entity_type,
'documents' document_type
FROM linkfile l
JOIN opportunity o ON l.parent_object_ref = o.opportunity_ref
WHERE parent_object_name = 'opportunity'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_industry</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH job_industry AS (
	SELECT
		sc.opportunity_ref job_id,
		sc.code industry_code,
		ROW_NUMBER() OVER(PARTITION BY sc.opportunity_ref ORDER BY sc.search_code_ref) rn
	FROM search_code sc
	JOIN opportunity o ON sc.opportunity_ref = o.opportunity_ref
	WHERE sc.opportunity_ref IS NOT NULL
	AND sc.code_type = '1005'
),
industry AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '1005'
)
SELECT
	ci.job_id,
	CASE
		WHEN i.description = 'IT Services' THEN 'IT Services'
		WHEN i.description = 'Carpenter' THEN 'Carpenter'
		WHEN i.description = 'Painting' THEN 'Painting'
		WHEN i.description = 'Shopfitting' THEN 'Shopfitting'
		WHEN i.description = 'Civils' THEN 'Civils'
		WHEN i.description = 'Drylining' THEN 'Drylining'
		WHEN i.description = 'Interiors' THEN 'Interiors'
		WHEN i.description = 'Student Accommodation' THEN 'Student Accommodation'
		WHEN i.description = 'High End Apartments' THEN 'High End Apartments'
		WHEN i.description = 'BUSINESS SERVICES' THEN 'BUSINESS SERVICES'
		WHEN i.description = 'Business Services General' THEN 'Business Services General'
		WHEN i.description = 'Accountancy' THEN 'Accountancy'
		WHEN i.description = 'Consultancy' THEN 'Consultancy'
		WHEN i.description = 'Property/Estate Agency' THEN 'Property/Estate Agency'
		WHEN i.description = 'Recruitment' THEN 'Recruitment'
		WHEN i.description = 'Training' THEN 'Training'
		WHEN i.description = 'Solicitors' THEN 'Solicitors'
		WHEN i.description = 'Call Centre' THEN 'Call Centre'
		WHEN i.description = 'Payroll' THEN 'Payroll'
		WHEN i.description = 'Charities' THEN 'Charities'
		WHEN i.description = 'Agricultural' THEN 'Agricultural'
		WHEN i.description = 'Dental Products' THEN 'Dental Products'
		WHEN i.description = 'CONSTRUCTION' THEN 'CONSTRUCTION'
		WHEN i.description = 'Construction General' THEN 'Construction General'
		WHEN i.description = 'Building Construction' THEN 'Building Construction'
		WHEN i.description = 'Buidling Materials' THEN 'Buidling Materials'
		WHEN i.description = 'FOOD / FMCG / CONSUMER GOODS' THEN 'FOOD / FMCG / CONSUMER GOODS'
		WHEN i.description = 'Cosmetics, Toiletries' THEN 'Cosmetics, Toiletries'
		WHEN i.description = 'Food, Drink, Tobacco' THEN 'Food, Drink, Tobacco'
		WHEN i.description = 'Household Goods' THEN 'Household Goods'
		WHEN i.description = 'Office Products, Stationery' THEN 'Office Products, Stationery'
		WHEN i.description = 'Electronics' THEN 'Electronics'
		WHEN i.description = 'Packaging' THEN 'Packaging'
		WHEN i.description = 'DISTRIBUTION/WAREHOUSING' THEN 'DISTRIBUTION/WAREHOUSING'
		WHEN i.description = 'Distribution General' THEN 'Distribution General'
		WHEN i.description = 'Distribution Automotive' THEN 'Distribution Automotive'
		WHEN i.description = 'Logistics' THEN 'Logistics'
		WHEN i.description = 'Warehouse' THEN 'Warehouse'
		WHEN i.description = 'ENGINEERING' THEN 'ENGINEERING'
		WHEN i.description = 'Engineering General' THEN 'Engineering General'
		WHEN i.description = 'Civil Engineering' THEN 'Civil Engineering'
		WHEN i.description = 'Mechanical Engineering' THEN 'Mechanical Engineering'
		WHEN i.description = 'Rubber/Plastic/Rope' THEN 'Rubber/Plastic/Rope'
		WHEN i.description = 'Waste Management Services' THEN 'Waste Management Services'
		WHEN i.description = 'Electrical Engineering' THEN 'Electrical Engineering'
		WHEN i.description = 'Mechanical Handling' THEN 'Mechanical Handling'
		WHEN i.description = 'Precision Engineering' THEN 'Precision Engineering'
		WHEN i.description = 'MANUFACTURING' THEN 'MANUFACTURING'
		WHEN i.description = 'Manufacturing General' THEN 'Manufacturing General'
		WHEN i.description = 'Motor Manufacturing' THEN 'Motor Manufacturing'
		WHEN i.description = 'Clothing Manufacturing' THEN 'Clothing Manufacturing'
		WHEN i.description = 'Industrial Manufacturing' THEN 'Industrial Manufacturing'
		WHEN i.description = 'FINANCE' THEN 'FINANCE'
		WHEN i.description = 'Finance General' THEN 'Finance General'
		WHEN i.description = 'Banks / Building Society' THEN 'Banks / Building Society'
		WHEN i.description = 'Financial Services' THEN 'Financial Services'
		WHEN i.description = 'Insurance' THEN 'Insurance'
		WHEN i.description = 'IT &amp; COMMUNICATIONS' THEN 'IT &amp; COMMUNICATIONS'
		WHEN i.description = 'Communications General' THEN 'Communications General'
		WHEN i.description = 'IT General' THEN 'IT General'
		WHEN i.description = 'IT Software' THEN 'IT Software'
		WHEN i.description = 'IT Training' THEN 'IT Training'
		WHEN i.description = 'Telecommunications' THEN 'Telecommunications'
		WHEN i.description = 'CHEMICALS PRODUCTION' THEN 'CHEMICALS PRODUCTION'
		WHEN i.description = 'Chemicals General' THEN 'Chemicals General'
		WHEN i.description = 'Oil &amp; Petrochemicals' THEN 'Oil &amp; Petrochemicals'
		WHEN i.description = 'LEISURE' THEN 'LEISURE'
		WHEN i.description = 'Leisure General' THEN 'Leisure General'
		WHEN i.description = 'Breweries' THEN 'Breweries'
		WHEN i.description = 'Catering' THEN 'Catering'
		WHEN i.description = 'Entertainment' THEN 'Entertainment'
		WHEN i.description = 'Hotel' THEN 'Hotel'
		WHEN i.description = 'Travel' THEN 'Travel'
		WHEN i.description = 'MEDIA/MARKETING' THEN 'MEDIA/MARKETING'
		WHEN i.description = 'Media General' THEN 'Media General'
		WHEN i.description = 'Design Agency' THEN 'Design Agency'
		WHEN i.description = 'Journalism' THEN 'Journalism'
		WHEN i.description = 'Books' THEN 'Books'
		WHEN i.description = 'Newspapers' THEN 'Newspapers'
		WHEN i.description = 'Printing &amp; Publishing' THEN 'Printing &amp; Publishing'
		WHEN i.description = 'Advertising' THEN 'Advertising'
		WHEN i.description = 'Marketing' THEN 'Marketing'
		WHEN i.description = 'Telemarketing' THEN 'Telemarketing'
		WHEN i.description = 'PUBLIC SECTOR' THEN 'PUBLIC SECTOR'
		WHEN i.description = 'Public Sector General' THEN 'Public Sector General'
		WHEN i.description = 'NHS' THEN 'NHS'
		WHEN i.description = 'Medical' THEN 'Medical'
		WHEN i.description = 'Primary Care Trust' THEN 'Primary Care Trust'
		WHEN i.description = 'Central Government' THEN 'Central Government'
		WHEN i.description = 'Local Borough' THEN 'Local Borough'
		WHEN i.description = 'Police' THEN 'Police'
		WHEN i.description = 'Fire' THEN 'Fire'
		WHEN i.description = 'Health' THEN 'Health'
		WHEN i.description = 'Armed Forces' THEN 'Armed Forces'
		WHEN i.description = 'Education' THEN 'Education'
		WHEN i.description = 'Council' THEN 'Council'
		WHEN i.description = 'PHARMACEUTICALS' THEN 'PHARMACEUTICALS'
		WHEN i.description = 'Pharmaceuticals General' THEN 'Pharmaceuticals General'
		WHEN i.description = 'Pharmaceutical Equipment' THEN 'Pharmaceutical Equipment'
		WHEN i.description = 'RETAIL' THEN 'RETAIL'
		WHEN i.description = 'Retail General' THEN 'Retail General'
		WHEN i.description = 'Food Retail' THEN 'Food Retail'
		WHEN i.description = 'DIY Retail' THEN 'DIY Retail'
		WHEN i.description = 'Home Furnishings' THEN 'Home Furnishings'
		WHEN i.description = 'Large Multiples' THEN 'Large Multiples'
		WHEN i.description = 'Fashion' THEN 'Fashion'
		WHEN i.description = 'TRANSPORT' THEN 'TRANSPORT'
		WHEN i.description = 'Transport General' THEN 'Transport General'
		WHEN i.description = 'Automotive' THEN 'Automotive'
		WHEN i.description = 'Dealership' THEN 'Dealership'
		WHEN i.description = 'Marine Services' THEN 'Marine Services'
		WHEN i.description = 'Public Transport' THEN 'Public Transport'
		WHEN i.description = 'Road/Rail Haulage' THEN 'Road/Rail Haulage'
		WHEN i.description = 'Shipping' THEN 'Shipping'
		WHEN i.description = 'Aerospace' THEN 'Aerospace'
		WHEN i.description = 'Car Hire' THEN 'Car Hire'
		WHEN i.description = 'UTILITIES' THEN 'UTILITIES'
		WHEN i.description = 'Utilities General' THEN 'Utilities General'
		WHEN i.description = 'Gas &amp; Oil' THEN 'Gas &amp; Oil'
		WHEN i.description = 'Electricity' THEN 'Electricity'
		WHEN i.description = 'Water' THEN 'Water'
	END industry,
	CURRENT_TIMESTAMP insert_timestamp
FROM job_industry ci
JOIN industry i ON ci.industry_code = i.code
WHERE ci.rn = 1</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1344</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_location</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH job_location AS (
	SELECT 
		opportunity_ref,
		CASE
			WHEN l.description = 'INTERNATIONAL' THEN 1
			WHEN l.description = 'Berlin' THEN 2
			WHEN l.description = 'Denmark' THEN 3
			WHEN l.description = 'Luxembourg' THEN 4
			WHEN l.description = 'NORTH WEST' THEN 5
			WHEN l.description = 'Manchester' THEN 6
			WHEN l.description = 'Oldham' THEN 7
			WHEN l.description = 'London' THEN 8
			WHEN l.description = 'Northampton' THEN 9
			WHEN l.description = 'Iceland' THEN 10
			WHEN l.description = 'Iver' THEN 11
			WHEN l.description = 'Dunstable' THEN 12
			WHEN l.description = 'Luton' THEN 13
			WHEN l.description = 'Milton Keynes' THEN 14
			WHEN l.description = 'Bedfordshire' THEN 15
			WHEN l.description = 'Luton' THEN 16
			WHEN l.description = 'Essex' THEN 17
			WHEN l.description = 'HERTFORDSHIRE' THEN 18
			WHEN l.description = 'Borehamwood' THEN 19
			WHEN l.description = 'Bushey' THEN 20
			WHEN l.description = 'Chorleywood' THEN 21
			WHEN l.description = 'Hatfield' THEN 22
			WHEN l.description = 'Hemel Hempstead' THEN 23
			WHEN l.description = 'Hitchin' THEN 24
			WHEN l.description = 'Maple Cross' THEN 25
			WHEN l.description = 'Rickmansworth' THEN 26
			WHEN l.description = 'St Albans' THEN 27
			WHEN l.description = 'Stevenage' THEN 28
			WHEN l.description = 'Watford' THEN 29
			WHEN l.description = 'Welwyn Garden City' THEN 30
			WHEN l.description = 'Kings Langley' THEN 31
			WHEN l.description = 'Chipperfield' THEN 32
			WHEN l.description = 'Bovingdon' THEN 33
			WHEN l.description = 'Berkhamstead' THEN 34
			WHEN l.description = 'Tring' THEN 35
			WHEN l.description = 'Redbourne' THEN 36
			WHEN l.description = 'Wembley' THEN 37
			WHEN l.description = 'Elstree' THEN 38
			WHEN l.description = 'Radlett' THEN 39
			WHEN l.description = 'Hertfordshire' THEN 40
			WHEN l.description = 'BUCKINGHAMSHIRE' THEN 41
			WHEN l.description = 'The Chalfonts' THEN 42
			WHEN l.description = 'Denham' THEN 43
			WHEN l.description = 'Gerrards Cross' THEN 44
			WHEN l.description = 'Stoke Poges' THEN 45
			WHEN l.description = 'High Wycombe' THEN 46
			WHEN l.description = 'Amersham' THEN 47
			WHEN l.description = 'Chesham' THEN 48
			WHEN l.description = 'Marlow' THEN 49
			WHEN l.description = 'Buckinghamshire' THEN 50
			WHEN l.description = 'MIDDLESEX' THEN 51
			WHEN l.description = 'Cowley' THEN 52
			WHEN l.description = 'Greenford' THEN 53
			WHEN l.description = 'Harefield' THEN 54
			WHEN l.description = 'Harmondsworth' THEN 55
			WHEN l.description = 'Harrow' THEN 56
			WHEN l.description = 'Hayes' THEN 57
			WHEN l.description = 'Heathrow' THEN 58
			WHEN l.description = 'Heston' THEN 59
			WHEN l.description = 'Hillingdon' THEN 60
			WHEN l.description = 'Ickenham' THEN 61
			WHEN l.description = 'Northolt' THEN 62
			WHEN l.description = 'Ruislip' THEN 63
			WHEN l.description = 'Southall' THEN 64
			WHEN l.description = 'Stanmore' THEN 65
			WHEN l.description = 'Stockley Park' THEN 66
			WHEN l.description = 'Uxbridge' THEN 67
			WHEN l.description = 'West Drayton' THEN 68
			WHEN l.description = 'Yiewsley' THEN 69
			WHEN l.description = 'Middlesex' THEN 70
			WHEN l.description = 'East Sussex' THEN 71
			WHEN l.description = 'Staines' THEN 72
			WHEN l.description = 'KENT' THEN 73
			WHEN l.description = 'Bromley' THEN 74
			WHEN l.description = 'Kent' THEN 75
			WHEN l.description = 'SURREY' THEN 76
			WHEN l.description = 'BERKSHIRE' THEN 77
			WHEN l.description = 'Colnbrook' THEN 78
			WHEN l.description = 'Langley' THEN 79
			WHEN l.description = 'Poyle' THEN 80
			WHEN l.description = 'Slough' THEN 81
			WHEN l.description = 'Berkshire' THEN 82
			WHEN l.description = 'Windsor' THEN 83
			WHEN l.description = 'OXFORDSHIRE' THEN 84
			WHEN l.description = 'Oxfordshire' THEN 85
			WHEN l.description = 'Banbury' THEN 86
			WHEN l.description = 'Bicester' THEN 87
			WHEN l.description = 'Thame' THEN 88
			WHEN l.description = 'Wiltshire' THEN 89
			WHEN l.description = 'LONDON' THEN 90
			WHEN l.description = 'City of London' THEN 91
			WHEN l.description = 'East London' THEN 92
			WHEN l.description = 'Stratford' THEN 93
			WHEN l.description = 'Docklands' THEN 94
			WHEN l.description = 'North London' THEN 95
			WHEN l.description = 'South London' THEN 96
			WHEN l.description = 'West London' THEN 97
			WHEN l.description = 'SOUTH EAST' THEN 98
			WHEN l.description = 'West Sussex' THEN 99
			WHEN l.description = 'Hampshire' THEN 100
			WHEN l.description = 'SOUTH WEST' THEN 101
			WHEN l.description = 'Bristol' THEN 102
			WHEN l.description = 'Avon' THEN 103
			WHEN l.description = 'Cornwall' THEN 104
			WHEN l.description = 'Dorset' THEN 105
			WHEN l.description = 'Devon' THEN 106
			WHEN l.description = 'Gloucestershire' THEN 107
			WHEN l.description = 'Somerset' THEN 108
			WHEN l.description = 'Cambridgeshire' THEN 109
			WHEN l.description = 'Norfolk' THEN 110
			WHEN l.description = 'Suffolk' THEN 111
			WHEN l.description = 'WEST MIDLANDS' THEN 112
			WHEN l.description = 'West Midlands' THEN 113
			WHEN l.description = 'Birmingham' THEN 114
			WHEN l.description = 'Solihull' THEN 115
			WHEN l.description = 'Dudley' THEN 116
			WHEN l.description = 'Herefordshire' THEN 117
			WHEN l.description = 'Worcestershire' THEN 118
			WHEN l.description = 'Staffordshire' THEN 119
			WHEN l.description = 'WARWICKSHIRE' THEN 120
			WHEN l.description = 'Atherstone' THEN 121
			WHEN l.description = 'Bedworth' THEN 122
			WHEN l.description = 'Coventry' THEN 123
			WHEN l.description = 'Kenilworth' THEN 124
			WHEN l.description = 'Leamington Spa' THEN 125
			WHEN l.description = 'Nuneaton' THEN 126
			WHEN l.description = 'Rugby' THEN 127
			WHEN l.description = 'Stratford Upon Avon' THEN 128
			WHEN l.description = 'Warwick' THEN 129
			WHEN l.description = 'Southam' THEN 130
			WHEN l.description = 'Warwickshire' THEN 131
			WHEN l.description = 'Lutterworth' THEN 132
			WHEN l.description = 'NORTH EAST' THEN 133
			WHEN l.description = 'NORTH YORKSHIRE' THEN 134
			WHEN l.description = 'North Yorkshire' THEN 135
			WHEN l.description = 'SOUTH YORKSHIRE' THEN 136
			WHEN l.description = 'South Yorkshire' THEN 137
			WHEN l.description = 'Sheffield' THEN 138
			WHEN l.description = 'Worksop' THEN 139
			WHEN l.description = 'Rotherham' THEN 140
			WHEN l.description = 'Mansfield' THEN 141
			WHEN l.description = 'Doncaster' THEN 142
			WHEN l.description = 'Derby' THEN 143
			WHEN l.description = 'Barnsley' THEN 144
			WHEN l.description = 'Chesterfield' THEN 145
			WHEN l.description = 'Dronfield' THEN 146
			WHEN l.description = 'Pontefract' THEN 147
			WHEN l.description = 'WEST YORKSHIRE' THEN 148
			WHEN l.description = 'Leeds' THEN 149
			WHEN l.description = 'EAST YORKSHIRE' THEN 150
			WHEN l.description = 'Goole' THEN 151
			WHEN l.description = 'Lincoln' THEN 152
			WHEN l.description = 'Grimsby' THEN 153
			WHEN l.description = 'Hull' THEN 154
			WHEN l.description = 'Scunthorpe' THEN 155
			WHEN l.description = 'SCOTLAND' THEN 156
			WHEN l.description = 'Aberdeen' THEN 157
			WHEN l.description = 'Dundee' THEN 158
			WHEN l.description = 'Edinburgh' THEN 159
			WHEN l.description = 'Fife' THEN 160
			WHEN l.description = 'Glasgow' THEN 161
			WHEN l.description = 'Kilmarnock' THEN 162
			WHEN l.description = 'Perth' THEN 163
			WHEN l.description = 'Sterling' THEN 164
			WHEN l.description = 'Scotland' THEN 165
			WHEN l.description = 'WALES' THEN 166
			WHEN l.description = 'Wales' THEN 167
			WHEN l.description = 'Cardiff' THEN 168
			WHEN l.description = 'Clywd' THEN 169
			WHEN l.description = 'Dyfed' THEN 170
			WHEN l.description = 'Gwynedd' THEN 171
			WHEN l.description = 'Gwent' THEN 172
			WHEN l.description = 'Mid Glamorgan' THEN 173
			WHEN l.description = 'South Glamorgan' THEN 174
			WHEN l.description = 'EAST MIDLANDS' THEN 175
			WHEN l.description = 'Leicestershire' THEN 176
			WHEN l.description = 'Hinckley' THEN 177
			WHEN l.description = 'Derby' THEN 178
			WHEN l.description = 'Nottingham' THEN 179
		END job_location,
		ROW_NUMBER() OVER(PARTITION BY opportunity_ref ORDER BY sc.update_timestamp DESC) rn
	FROM search_code sc
	LEFT JOIN lookup l ON sc.code_type = l.code_type AND sc.code = l.code
	WHERE opportunity_ref IS NOT NULL
	AND sc.code_type = '1020'
	AND l.description IS NOT NULL
),
concat_job_location AS (
	SELECT
		opportunity_ref,
		string_agg(job_location::TEXT, ',') job_location
	FROM job_location
	WHERE rn = 1
	GROUP BY opportunity_ref
)
------------------------------------------------- Main query --------------------------------------------------------------------------
SELECT
o.opportunity_ref AS job_id,
job_location,
'add_job_info' additional_type,
1007 form_id,
11275 field_id,
'11275' constraint_id,
CURRENT_TIMESTAMP insert_timestamp
FROM opportunity o
JOIN concat_job_location jl ON o.opportunity_ref = jl.opportunity_ref</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3168</xloc>
      <yloc>1152</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_location_fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	11275 field_id,
	1007 form_id,
	ROW_NUMBER() OVER() field_value,
	description,
	ROW_NUMBER() OVER() + 600 id,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3216</xloc>
      <yloc>1056</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_location_list</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT
	description,
	'en' AS "language",
	ROW_NUMBER() OVER() + 600 id,
	CONCAT('title_language_code_', ROW_NUMBER() OVER() + 600) AS language_code,
	CURRENT_TIMESTAMP insert_timestamp
FROM lookup 
WHERE code_type = '1020'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3216</xloc>
      <yloc>976</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1568</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1520</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_lookup 2 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>job_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_job_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1584</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>job_owner</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <sql>WITH old_owner AS (
	SELECT
		ac.position_id AS job_id,
		ua.id AS old_owner_id,
		ua.email AS old_email,
		CASE
			WHEN ua.email = 'tammie.huntley@hamlinknight.co.uk' THEN 'thuntley@hamlinknight.co.uk'
			WHEN ua.email = 'Carolyn.wood@hutchinsonjonas.co.uk' THEN 'cwood@hamlinknight.co.uk'
			WHEN ua.email = 'charleigh.davies@hamlinknight.co.uk'THEN 'cdavies@hamlinknight.co.uk'
			WHEN ua.email = 'claire.dixon@hamlinknight.co.uk' THEN 'cdixon@hamlinknight.co.uk'
			WHEN ua.email = 'craig.barnes@hamlinknight.co.uk' THEN 'cbarnes@hamlinknight.co.uk'
			WHEN ua.email = 'David.McKernan@hamlinknight.co.uk' THEN 'dmckernan@hamlinknight.co.uk'
			WHEN ua.email = 'Emma.Herron@hamlinknight.co.uk' THEN 'eherron@hamlinknight.co.uk'
			WHEN ua.email = 'hannah.worswick@hamlinknight.co.uk' THEN 'hworswick@hamlinknight.co.uk'
			WHEN ua.email = 'Jenny@hutchinsonjonas.co.uk' THEN 'Jsimmons@hamlinknight.co.uk'
			WHEN ua.email = 'karen.balmer@hamlinknight.co.uk' THEN 'kbalmer@hamlinknight.co.uk'
			WHEN ua.email = 'kyp@hutchinsonjonas.co.uk' THEN 'Kadair@hamlinknight.co.uk'
			WHEN ua.email = 'lucy.mills@hamlinknight.co.uk' THEN 'lmills@hamlinknight.co.uk'
			WHEN ua.email = 'natalie.salvato@hamlinknight.co.uk' THEN 'nsalvato@hamlinknight.co.uk'
			WHEN ua.email = 'Paul.Berry@hamlinknight.co.uk' THEN 'pberry@hamlinknight.co.uk'
			WHEN ua.email = 'sam.waites@hamlinknight.co.uk' THEN 'swaites@hamlinknight.co.uk'
			WHEN ua.email = 'sarah.stone@hamlinknight.co.uk' THEN 'sstone@hamlinknight.co.uk'
			WHEN ua.email = 'stacey.evans@hamlinknight.co.uk' THEN 'sevans@hamlinknight.co.uk'
			WHEN ua.email = 'suky.rahim@hamlinknight.co.uk' THEN 'srahim@hamlinknight.co.uk'
			WHEN ua.email = 'tejinder.bath@hamlinknight.co.uk' THEN 'tbath@hamlinknight.co.uk'
			WHEN ua.email = 'tracey.rose@hamlinknight.co.uk' THEN 'trose@hamlinknight.co.uk'
		END AS new_email
	FROM position_agency_consultant ac
	JOIN user_account ua ON ac.user_id = ua.id
	WHERE ua.email IN (
	'tammie.huntley@hamlinknight.co.uk',
	'Carolyn.wood@hutchinsonjonas.co.uk',
	'charleigh.davies@hamlinknight.co.uk',
	'claire.dixon@hamlinknight.co.uk',
	'craig.barnes@hamlinknight.co.uk',
	'David.McKernan@hamlinknight.co.uk',
	'Emma.Herron@hamlinknight.co.uk',
	'hannah.worswick@hamlinknight.co.uk',
	'Jenny@hutchinsonjonas.co.uk',
	'karen.balmer@hamlinknight.co.uk',
	'kyp@hutchinsonjonas.co.uk',
	'lucy.mills@hamlinknight.co.uk',
	'natalie.salvato@hamlinknight.co.uk',
	'Paul.Berry@hamlinknight.co.uk',
	'sam.waites@hamlinknight.co.uk',
	'sarah.stone@hamlinknight.co.uk',
	'stacey.evans@hamlinknight.co.uk',
	'suky.rahim@hamlinknight.co.uk',
	'tejinder.bath@hamlinknight.co.uk',
	'tracey.rose@hamlinknight.co.uk'
	)
)

SELECT
	job_id,
	old_owner_id,
	old_email,
	new_email
FROM old_owner o</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>736</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>label_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>label_detail</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>activity_type</name>
        <field>label_name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>label_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3856</xloc>
      <yloc>160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>label_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>label_detail</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>activity_type</name>
        <field>label_name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>label_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3856</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>label_lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>label_detail</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>activity_type</name>
        <field>label_name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>label_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3856</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>label_lookup 4</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>label_detail</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>activity_type</name>
        <field>label_name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>label_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3856</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup Candidate</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidate_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>vc_candidate_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2512</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup candidate_source</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate_source</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>source</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>vc_source_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2736</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>new_owner_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>new_email</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>new_owner_id</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>896</xloc>
      <yloc>992</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>new_owner_lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>new_email</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>new_owner_id</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>896</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>rate_mode</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH candidate_type AS (
	SELECT
	ROW_NUMBER() OVER(PARTITION BY pt.person_ref ORDER BY CASE WHEN l.code = 'C' THEN 1 ELSE 2 END) rn,
	p.*,
	c.*,
	pt.status,
	CASE
		WHEN pt.type = 'C' THEN 'PERMANENT'
		WHEN pt.type = 'A' THEN 'TEMPORARY'
	END AS candidate_type,
	pt.availability_confirmed,
	pt.status_reason
	FROM candidate c
	LEFT JOIN person_type pt ON c.person_type_ref = pt.person_type_ref
	JOIN person p ON pt.person_ref = p.person_ref
	LEFT JOIN lookup l ON pt.type = l.code
	WHERE l.code_type = '104'
	AND l.code IN ('A', 'C')
),
check_dup_email AS (
	SELECT ROW_NUMBER() OVER(PARTITION BY TRIM(LOWER(email_address)) ORDER BY person_ref) rn_email,
	*
	FROM candidate_type
	WHERE rn = 1
	AND person_ref IS NOT NULL
),
candidate_status AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '105'
),
income_mode AS (
	SELECT
		code,
		description
	FROM lookup
	WHERE code_type = '7'
)

------------------------------------------------- Main query --------------------------------------------------------------------------

SELECT
cde.person_ref AS candidate_id,
candidate_type,
im.description income_mode,
CASE
	WHEN im.description = 'per hour' THEN 1
	WHEN im.description = 'per week' THEN 2
END income_mode_code,
'add_cand_info' additional_type,
1005 form_id,
11269 field_id,
'11269' constraint_id,
CURRENT_TIMESTAMP insert_timestamp

FROM check_dup_email cde
JOIN candidate_status cst ON cde.status = cst.code
LEFT JOIN income_mode im ON cde.income_mode = im.code
WHERE cst.code IN ('A1', 'I1')
AND NULLIF(cde.income_required, '0') IS NOT NULL
AND im.description IN ('per hour', 'per week')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2304</xloc>
      <yloc>1184</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>sub_FE</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>WITH sub_functional_expertise AS (
	SELECT 'Part time' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Accountant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Assistant Accountant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Company Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Finance Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Financial Accountant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Financial Analyst' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Bookkeeper' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Financial Controller' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Finance Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Mgmt Accountant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Auditor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Accounts Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Purchase Ledger Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Purchase Ledger Sup / Mgr' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Sales Ledger Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Sales Ledger Sup / Mgr' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Payroll Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Payroll Manager / Supervisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Credit Control Mgr / Sup' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Credit Controller' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Accountancy / Finance' AS functional_expertise, 'Legal Cashier' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Counterbalance Driver' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, '360 Driver' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Wallpaper Hanger' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Tiler' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'SMSTS - Grst Aid' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'SSSTS - G' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'CSCS NVQ 3' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'JIB' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'ECS' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Carpenter' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Plumber' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Plasterer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Labourer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Painter' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Electrian' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Demo' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Project Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Site Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Assistant Site Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Improver' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Electrician' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Electricians Mate' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Plumbers Mate' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Pipe Fitter' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Pipe Fitters Mate' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Bricklayer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Dryliner' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Ceiling Fixer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Skilled Labourer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Ganga' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Buyer' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Buyer' AS functional_expertise, 'Purchasing Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Buyer' AS functional_expertise, 'Buyer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Buyer' AS functional_expertise, 'Purchasing Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Ground Worker' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Engineer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Steel Fixer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'Welder' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Construction' AS functional_expertise, 'FLTD' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Logistics Mgr / Sup' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Export Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Import Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Logistics Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Stock Controller' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Planner' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Fleet Coordinator / Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Transport/Logistics' AS functional_expertise, 'Materials Planner' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'General (Mgr)' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'General (Mgr)' AS functional_expertise, 'Managing Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'General (Mgr)' AS functional_expertise, 'Operations Mgr / Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'General (Mgr)' AS functional_expertise, 'General Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Business Partner' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Advisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Health &amp; Safety Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Health &amp; Safety Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Resourcing Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Recruiter' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'HR Comps &amp; Bens' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Employee Relations Mgr' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Shared Services Mgr' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Shared Services Advisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Human Resources' AS functional_expertise, 'Shared Services Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Training Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Training Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Training Consultant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Training Co-ordinator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Training Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Training' AS functional_expertise, 'Trainer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'IT' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'Technical Support' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'IT Development' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'IT Networks' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'IT Consultant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'Systems Analyst' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'IT' AS functional_expertise, 'IT Management' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Call Centre Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Call Centre Team Leader' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Call Centre Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Cust Service Mgr' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Cust Services Supervi' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Cust Services Assis' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Cust Service Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Customer Services' AS functional_expertise, 'Dealership Service Advisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Financial' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Financial' AS functional_expertise, 'Financial Advisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Financial' AS functional_expertise, 'Pensions Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Financial' AS functional_expertise, 'Underwriter' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'SEO Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'SEO Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Account Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Brand Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Event Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Event Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Merchandiser' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Marketing Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Marketing Co-ordinator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Marketing Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Marketing Executive' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Marketing Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'PR Consultant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'PR Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Sales Executive' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Sales Negotiator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Sales Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Sales Director' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Sales Support Admin' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Telesales Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Telesales Supervisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Online Marketing Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Online Marketing Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'E-Commerce Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'E-Commerce Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Website Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Web Developer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Graphic Designer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Photographer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Videographer' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Sales &amp; Marketing' AS functional_expertise, 'Internal Communications' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, '' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Data Entry Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Data Entry Supervisor' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Facilities Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Facilities Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Insurance Clerk' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Office Junior' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Office Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Receptionist' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Senior Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Swtichboard Operator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Analyst' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Audio Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Bi-Lingual Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Junior Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Legal Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Medical Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Personal Assistant' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'PA Secretary' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Operations Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Project Manager' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
	UNION ALL
	SELECT 'Office' AS functional_expertise, 'Project Administrator' AS sub_functional_expertise, CURRENT_TIMESTAMP AS insert_timestamp
)

SELECT *, ROW_NUMBER() OVER() + 10000 AS id
FROM sub_functional_expertise
WHERE sub_functional_expertise &lt;&gt; ''</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2592</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>sub_fe_lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>sub_functional_expertise</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>fe_id</name>
        <field>functional_expertise_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>sub_fe</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>sub_fe_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2800</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>sub_fe_lookup 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>sub_functional_expertise</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>fe_id</name>
        <field>functional_expertise_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>sub_fe</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>sub_fe_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1904</xloc>
      <yloc>464</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>talent_pool_group</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>source</connection>
    <sql>SELECT 'Available Perm' AS group_name, 'cbarnes@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'Available Temps' AS group_name, 'cbarnes@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'BEZZA TEMPS' AS group_name, 'pberry@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'Charlotte Candidates' AS group_name, 'charlotte.clarke@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'IMMEDIATELY AVAILABLES' AS group_name, 'thuntley@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'Nat''s Candidates' AS group_name, 'cbarnes@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'NS Candidates' AS group_name, 'cbarnes@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'PERM CANDIDATES -TAMS' AS group_name, 'thuntley@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'PERM CANDIDATES PB' AS group_name, 'pberry@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'Person Finder (Quick search results)' AS group_name, 'cbarnes@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058  hoa
UNION
SELECT 'temp log candidates' AS group_name, 'suky.rahim@hamlinknight.co.uk' consultant, CURRENT_TIMESTAMP AS insert_timestamp, 3 AS share_permission, -10 user_admin, 29058 hoa</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4288</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>talent_pool_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate_group</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>group_name</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>user_admin</name>
        <field>owner_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>group_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4672</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>talent_pool_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact_group</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>group_name</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>consultant_id</name>
        <field>owner_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>group_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4720</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_candidate_owner</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>candidate_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>candidate_owner_json</name>
        <rename>new_candidate_owner</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>928</xloc>
      <yloc>1264</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_candidate_salary</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>actual_candidate_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>desire_salary</name>
        <rename>desire_salary</rename>
        <update>Y</update>
      </value>
      <value>
        <name>desired_contract_rate</name>
        <rename>desire_contract_rate</rename>
        <update>Y</update>
      </value>
      <value>
        <name>salary_type</name>
        <rename>salary_type</rename>
        <update>Y</update>
      </value>
      <value>
        <name>months_per_year</name>
        <rename>month_salary</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2672</xloc>
      <yloc>1072</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_company_owner</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <key>
        <name>company_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>company_owners</name>
        <rename>new_owner_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>992</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_company_registration</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <key>
        <name>company_id</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>insert_timestamp</name>
        <rename>create_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_contact_note</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>actual_contact_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>note</name>
        <rename>contact_note</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1216</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_contact_other_fields</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>actual_contact_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>mobile_phone</name>
        <rename>mobile</rename>
        <update>Y</update>
      </value>
      <value>
        <name>personal_email</name>
        <rename>personal_email</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1215</xloc>
      <yloc>103</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_contact_owner</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>contact_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>contact_owners</name>
        <rename>new_owner_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>928</xloc>
      <yloc>1088</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_contact_switchboard</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>actual_contact_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>switchboard_phone</name>
        <rename>switch_board</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1213</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update_job_owner</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>position_agency_consultant</table>
      <key>
        <name>job_id</name>
        <field>position_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>user_id</name>
        <rename>new_owner_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>user_account_lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>consultant</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>consultant_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4448</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>user_account_lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>consultant</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>consultant_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4544</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>user_account_lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>consultant</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>consultant_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4592</xloc>
      <yloc>736</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>user_account_lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>prod_db</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>user_account</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>consultant</name>
        <field>email</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>consultant_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>4544</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
