<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>ProductInjection</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2019/07/18 14:22:53.151</created_date>
    <modified_user>-</modified_user>
    <modified_date>2019/07/18 14:22:53.151</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>Contact extra information</note>
      <xloc>848</xloc>
      <yloc>176</yloc>
      <width>146</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Update company Main location</note>
      <xloc>48</xloc>
      <yloc>16</yloc>
      <width>177</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Contact CurrentLocation and WorkLocation</note>
      <xloc>1008</xloc>
      <yloc>256</yloc>
      <width>241</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Compensation Contract</note>
      <xloc>32</xloc>
      <yloc>272</yloc>
      <width>138</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Candidate Nick Name</note>
      <xloc>16</xloc>
      <yloc>384</yloc>
      <width>127</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Contact Comment</note>
      <xloc>21</xloc>
      <yloc>651</yloc>
      <width>110</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Job comment</note>
      <xloc>480</xloc>
      <yloc>656</yloc>
      <width>84</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Candidate Comment</note>
      <xloc>928</xloc>
      <yloc>656</yloc>
      <width>122</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>FileRename&amp;CreatedDate</note>
      <xloc>56</xloc>
      <yloc>985</yloc>
      <width>147</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Update PLACED status in jobApp
--PLACED status not supported via data import</note>
      <xloc>64</xloc>
      <yloc>1632</yloc>
      <width>259</width>
      <heigth>42</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Dummy offer already created for PERMANENT OFFERED status
Valid = 1 as default (no need to import)</note>
      <xloc>880</xloc>
      <yloc>1712</yloc>
      <width>341</width>
      <heigth>42</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>255</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Cancelled/ Client Cancelled placements will be marked as Rejected [Terminated Invoice]
This flow can be run mannually OR update cases in offer_person_info with End_date in the past</note>
      <xloc>1072</xloc>
      <yloc>1856</yloc>
      <width>510</width>
      <heigth>42</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>255</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Insert all offer / placement details (default value)</note>
      <xloc>1216</xloc>
      <yloc>2112</yloc>
      <width>265</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>255</backgroundcolorgreen>
      <backgroundcolorblue>0</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Update fee forecast / percentage due to differences in job compensation</note>
      <xloc>336</xloc>
      <yloc>2016</yloc>
      <width>392</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>255</backgroundcolorgreen>
      <backgroundcolorblue>128</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Company Industry</note>
      <xloc>895</xloc>
      <yloc>30</yloc>
      <width>108</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Candidate workhistory and note</note>
      <xloc>464</xloc>
      <yloc>16</yloc>
      <width>180</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Not run yet</note>
      <xloc>108</xloc>
      <yloc>144</yloc>
      <width>71</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Company RegDate</note>
      <xloc>448</xloc>
      <yloc>304</yloc>
      <width>110</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Update Primaryemail and WorkEmail</note>
      <xloc>352</xloc>
      <yloc>512</yloc>
      <width>204</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <connection>
    <name>FROM</name>
    <server>localhost</server>
    <type>MSSQL</type>
    <access>Native</access>
    <database>toro2</database>
    <port>1433</port>
    <username>sa</username>
    <password>Encrypted 2be98afc86aa7f2d5f94aea35e083b8df</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1433</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>TORO</name>
    <server>rdbm</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>tororecruitment.vincere.io</database>
    <port>5432</port>
    <username>nghiep</username>
    <password>Encrypted 2be98afc86aa7f2a98b15be23d79af6d4</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>BULLHORN Contact Info</from>
      <to>contact lookup 5</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 5</from>
      <to>Update contact info</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company industry</from>
      <to>lookup company</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup company</from>
      <to>lookup industry</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup industry</from>
      <to>VC company_industry</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Contact location 2</from>
      <to>contact lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>comp lookup 2 2</from>
      <to>company location lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup</from>
      <to>comp lookup 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input</from>
      <to>comp lookup 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Contact location 2</from>
      <to>Insert contact current location</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup</from>
      <to>contactlocation lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contactlocation lookup 2</from>
      <to>Update contact info 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>comp lookup 2 2 2</from>
      <to>Update contact info 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>company location lookup</from>
      <to>VC company_industry 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 2</from>
      <to>Database lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup</from>
      <to>Update contact info 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 2 2</from>
      <to>contact lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 2</from>
      <to>Update contact info 2 3 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>BH Contact Email Body</from>
      <to>contact lookup 6</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Contact Comment</from>
      <to>contact lookup 4</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 4</from>
      <to> Contact Comment</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 6</from>
      <to>Insert - Contact Comment 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>BULLHORN Job Comment</from>
      <to>Job lookup 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Job lookup 3</from>
      <to>Job activity</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Candidate Comment</from>
      <to>Database lookup 2 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 3</from>
      <to>candidate activities</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>BH Candidate Email Body</from>
      <to>Database lookup 2 3 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2 3 2</from>
      <to>candidate activities 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 3</from>
      <to>Database lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2</from>
      <to>Update</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 3 2</from>
      <to>Database lookup 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Database lookup 2</from>
      <to>Update 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Index Candidate Activity</from>
      <to>Candidate Activity Table</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Index Contact Activity</from>
      <to>Contact Activity Table</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Index Job Activity</from>
      <to>Job Activity Table</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Contact Document 2</from>
      <to>contact 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact 2 2</from>
      <to>candidate_document 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Extract job document</from>
      <to>lookup jobid</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup jobid</from>
      <to>update job_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Extract Candidate_Contact Documents</from>
      <to>lookup candidateid</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup candidateid</from>
      <to>update candidate_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Extract company document</from>
      <to>lookup companyid</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup company_legal_document</from>
      <to>update legal_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>lookup companyid</from>
      <to>lookup company_legal_document</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Candidate lookup</from>
      <to>Job lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Company lookup.com</from>
      <to>Contact lookup.con</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Concat Fields Client Name</from>
      <to>Insert offer personal Info</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Contact lookup.con</from>
      <to>Concat Fields Client Name</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Job lookup</from>
      <to>Position Candidate</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Job lookup</from>
      <to>Update App status</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Job lookup</from>
      <to>Update Placed date</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Job lookup</from>
      <to>Update job App status</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>JobApp From OFFERED Stage</from>
      <to>Candidate lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>JobApp PLACED status</from>
      <to>Candidate lookup</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Offer</from>
      <to>Company lookup.com</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Offer</from>
      <to>Update Invoice</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Offer</from>
      <to>Update Terminated Invoice</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Offer</from>
      <to>Update [Invoice]</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Position Candidate</from>
      <to>FeeForecast for placement details</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Position Candidate</from>
      <to>Offer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Position Candidate</from>
      <to>Update Offer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Position Candidate</from>
      <to>Update [Offer]</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Concat Fields Client Name</from>
      <to>Update 3</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>DB industry</from>
      <to>Insert new industry</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>comp lookup 2 2 2 2</from>
      <to>Update contact info 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 4</from>
      <to>comp lookup 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>comp lookup 2 2 2</from>
      <to>Table output</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 4 2</from>
      <to>contact lookup 2 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 2 2 2 2 2</from>
      <to>Update contact info 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 4 2 2</from>
      <to>contact lookup 2 2 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 2 2 2 2 2 2</from>
      <to>Update contact info 2 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Table input 4 2 2 2</from>
      <to>contact lookup 2 2 2 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>contact lookup 2 2 2 2 2 2 2</from>
      <to>Update contact info 2 2 2 2 2 2</to>
      <enabled>N</enabled>
    </hop>
  </order>
  <step>
    <name> Contact Comment</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>contact_id</column_name>
        <stream_name>actual_contactid</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>BH Candidate Email Body</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>/*
alter table BULLHORN1.BH_UserMessage add email_content_ nvarchar(max); 
alter table BULLHORN1.BH_UserMessage add tmp_decompressed nvarchar(max);
alter table BULLHORN1.BH_UserMessage add content_full nvarchar(max); 

select count(*) from tmp_emailbody
select count(*) from bullhorn1.bh_usermessage where email_content is null
select count(*) from bullhorn1.bh_usermessage where email_content is not null
select count(*) from bullhorn1.bh_usermessage where email_content is null and DATALENGTH(commentsCompressed) > 0

select top 10 * from bullhorn1.bh_usermessage where subject like 'RE: Interview Confirmation% Bain &amp; Company%'
select top 100 userMessageID, commentsCompressed, email_content, email_content_ from bullhorn1.bh_usermessage where userMessageID in (34750,55242,15187)
select top 100 userMessageID, email_content from bullhorn1.bh_usermessage where email_content is not null and userMessageID  > 289000
select top 100 userMessageID, email_content from bullhorn1.bh_usermessage where email_content is not null
select top 100 userMessageID, email_content from bullhorn1.BH_UserMessage where userMessageID in (1107448,1187690,1187691, 166320,49950,24748,21116,22785,35342,35370,35800, 852015, 856200,1011600) order by userMessageID
*/

-- EMAIL BODY

with EmailBody as 
(
        -- RECEIVER
        select --top 100 
                um.userMessageID --,um.sendingUserID
              , ca.candidateid --, ca.userid,ca.recruiteruserid,ca.firstname,ca.lastname,ca.companyname
              , um.externalFrom, um.externalTo, um.externalCC, um.externalBCC, um.SMTPSendDate --,convert(nvarchar(max),um.externalTo) as externalTo, convert(nvarchar(max),um.externalCC) as externalCC, convert(nvarchar(max),um.externalBCC) as externalBCC, um.SMTPSendDate
              , um.subject, um.email_content, um.comments --, convert(nvarchar(max),um.comments) as comments
              --,mr.userID,mr.folder,mr.recipientType, mr.email, mr.sendingUserID, mr.subjectSort, mr.externalFrom
              , umf.att --,umf.name, umf.directory
        -- select count(*) -- select top 2000 *
        from bullhorn1.BH_UserMessage um
        --left join INT_UncompressedMessages cont on cont.userMessageID = um.userMessageID
        left join bullhorn1.BH_MessageRecipient mr on mr.userMessageID = um.userMessageID
        --left join bullhorn1.BH_UserMessageFile umf on umf.userMessageID = um.userMessageID
        --left join (SELECT userMessageID, STUFF((SELECT ', ' + [dbo].[fn_ConvertHTMLToText](name) from bullhorn1.BH_UserMessageFile WHERE userMessageID = a.userMessageID order by name asc FOR XML PATH (''), TYPE).value('.', 'nvarchar(64)'), 1, 1, '') AS att FROM bullhorn1.BH_UserMessageFile AS a GROUP BY a.userMessageID ) umf on umf.userMessageID = um.userMessageID
        left join (SELECT userMessageID, STRING_AGG(cast(name as nvarchar(max)),',' ) WITHIN GROUP (ORDER BY name) att 
						from bullhorn1.BH_UserMessageFile
						GROUP BY userMessageID) umf on umf.userMessageID = um.userMessageID        
        left join bullhorn1.Candidate ca on ca.userid = mr.userid
        where mr.isDeleted = 0 and mr.isSpam = 0 and ca.userid is not null and ca.isdeleted &lt;&gt; 1 and ca.status &lt;&gt; 'Archive'
        --and um.userMessageID > 2110065
        --and um.userMessageID in (2110065)
        --and um.comments is not null and convert(varchar(max),um.comments) &lt;&gt; '' 
        --and ca.candidateid = 565        
        --and convert(nvarchar(max),um.externalCC) != '' and um.externalCC is not null and convert(nvarchar(max),um.externalBCC) != '' and um.externalBCC is not null
        --and um.SMTPSendDate > '2018-01-01'

UNION ALL
        -- SENDER
        select --top 100
                um.userMessageID --,um.sendingUserID
              , ca.candidateid --, ca.userid,ca.recruiteruserid,ca.firstname,ca.lastname,ca.companyname
              , um.externalFrom, um.externalTo, um.externalCC, um.externalBCC, um.SMTPSendDate --,convert(nvarchar(max),um.externalTo) as externalTo, convert(nvarchar(max),um.externalCC) as externalCC, convert(nvarchar(max),um.externalBCC) as externalBCC, um.SMTPSendDate
              , um.subject, um.email_content, um.comments --, convert(nvarchar(max),um.comments) as comments
              --,mr.userID,mr.folder,mr.recipientType, mr.email, mr.sendingUserID, mr.subjectSort, mr.externalFrom
              , umf.att --,umf.name, umf.directory
        -- select count(*)
        from bullhorn1.BH_UserMessage um
        --left join INT_UncompressedMessages cont on cont.userMessageID = um.userMessageID
        left join bullhorn1.BH_MessageRecipient mr on mr.userMessageID = um.userMessageID
        --left join bullhorn1.BH_UserMessageFile umf on umf.userMessageID = um.userMessageID
        --left join (SELECT userMessageID, STUFF((SELECT ', ' + name from bullhorn1.BH_UserMessageFile WHERE userMessageID = a.userMessageID order by name asc FOR XML PATH (''), TYPE).value('.', 'nvarchar(MAX)'), 1, 1, '') AS att FROM bullhorn1.BH_UserMessageFile AS a GROUP BY a.userMessageID ) umf on umf.userMessageID = um.userMessageID
        left join (SELECT userMessageID, STRING_AGG(cast(name as nvarchar(max)),',' ) WITHIN GROUP (ORDER BY name) att 
						from bullhorn1.BH_UserMessageFile
						GROUP BY userMessageID) umf on umf.userMessageID = um.userMessageID        
        left join bullhorn1.Candidate ca on ca.userid = um.sendingUserID
        where um.isSenderDeleted = 0 and ca.userid is not null and ca.isdeleted &lt;&gt; 1 and ca.status &lt;&gt; 'Archive'
        --and convert(nvarchar(max),um.comments) &lt;&gt; '' ) 
        --and ca.candidateid = 565
        --and um.SMTPSendDate > '2018-01-01'
        --and  um.userMessageID in (6212861, 6204234)

)

--select count(*) from EmailBody --357266
-- select top 100 * from EmailBody where candidateid between 124602 and 128601
/* select candidateid, concat('insert into position_candidate_feedback (candidate_id, user_account_id, feedback_timestamp, comment_body, feedback_score, insert_timestamp, contact_method, json_relate_info, related_status) values ( 
        (select id from candidate where external_id = ''',candidateid,'''), ',-10,', now(), ''',replace(concat('Date Created: ',convert(varchar,SMTPSendDate,120),char(10),'From: ',externalFrom,char(10),'To: ',externalTo,char(10),'CC: ',externalCC,char(10),'Subject: ',subject,char(10),char(10),'Content: ',comments),'''',''''''),''', 0, now(), 4, ''[]'', 1);') as EmailSQL
from EmailBody --where candidateid = 33
order by SMTPSendDate desc */

--select count(*) from EmailBody

select --top 10
          userMessageID
        --, userid, concat(firstname, ' ',lastname) as fullname, recruiteruserid, companyname, sendingUserID
        , concat('TRCD', candidateid) as candidateextid
        , -10 as 'user_account_id'
        , 'comment' as category
        , 'candidate' as type
        , coalesce(NULLIF(convert(varchar(20), SMTPSendDate, 120),''), CURRENT_TIMESTAMP) as 'insert_timestamp'
        , dbo.RemoveNullCharacters(
              [dbo].[udf_StripHTML]( --
			         REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE( REPLACE( 
                     REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE( REPLACE( 
                     REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE(
              replace(replace(replace(replace(replace(replace(
              stuff('*** EMAIL: ' + char(10)
                + coalesce('From: ' + NULLIF(convert(nvarchar(max),externalFrom), '') + char(10), '')
                + coalesce('To: ' + NULLIF(convert(nvarchar(max),externalTo), '') + char(10), '')
                + coalesce('CC: ' + NULLIF(convert(nvarchar(max),externalCC), '') + char(10), '')
                + coalesce('BCC: ' + NULLIF(convert(nvarchar(max),externalBCC), '') + char(10), '')
                + coalesce('Subject: ' + NULLIF(convert(nvarchar(max),subject), '') + char(10), '')
                + coalesce('Body: ' + NULLIF(email_content, '') + char(10), 'Body: ' + char(10))
                + coalesce('Attachments: ' + NULLIF(convert(nvarchar(max),att), '') + char(10), '')
				+ coalesce('Comments: ' + NULLIF(convert(nvarchar(max),comments), '') + char(10), '')
              , 1, 0, '')
              ,'Â',''),'Â·',''),'v\:* {behavior:url(#default#VML);}',''),'o\:* {behavior:url(#default#VML);}',''),'w\:* {behavior:url(#default#VML);}',''),'.shape {behavior:url(#default#VML);}','')
                     ,char(0x0000),'') ,char(0x0001),'') ,char(0x0002),'') ,char(0x0003),'') ,char(0x0004),'') 
                     ,char(0x0005),'') ,char(0x0006),'') ,char(0x0007),'') ,char(0x0008),'') ,char(0x000B),'') 
                     ,char(0x000C),'') ,char(0x000E),'') ,char(0x000F),'') ,char(0x0010),'') ,char(0x0011),'') 
                     ,char(0x0012),'') ,char(0x0013),'') ,char(0x0014),'') ,char(0x0015),'') ,char(0x0016),'') 
                     ,char(0x0017),'') ,char(0x0018),'') ,char(0x0019),'') ,char(0x001A),'') ,char(0x001B),'') 
                     ,char(0x001C),'') ,char(0x001D),'') ,char(0x001E),'') ,char(0x001F),'')
              )
         ) 
         as 'content'
from EmailBody --29594
order by candidateid
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>Y</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>BH Contact Email Body</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>
-- EMAIL BODY
---CREATE INSERT CANDIDATE_COMMENTS
with EmailBody as (
        --EMAIL OF CANDIDATE - RECEIVER
        select --top 100
                  ca.clientID, ca.userid
                , um.userMessageID,um.sendingUserID,um.subject, um.externalFrom
                , um.comments
                , um.email_content as email_content
                , convert(nvarchar(max),um.externalTo) as externalTo
				, convert(nvarchar(max),um.externalCC) as externalCC
				, convert(nvarchar(max),um.externalBCC) as externalBCC
				, um.SMTPSendDate
                , umf.att
        from bullhorn1.BH_UserMessage um
        left join bullhorn1.BH_MessageRecipient mr on mr.userMessageID = um.userMessageID
        --left join bullhorn1.BH_UserMessageFile umf on umf.userMessageID = um.userMessageID
        left join (SELECT userMessageID, STRING_AGG(cast(name as nvarchar(max)),',' ) WITHIN GROUP (ORDER BY name) att 
					from bullhorn1.BH_UserMessageFile GROUP BY userMessageID) umf on umf.userMessageID = um.userMessageID
        left join bullhorn1.BH_Client ca on ca.userid = mr.userid
        where mr.isDeleted = 0 and mr.isSpam = 0 and ca.userid is not null and ca.isdeleted &lt;&gt; 1 and ca.status &lt;&gt; 'Archive' --
 
UNION ALL
        --EMAIL OF CANDIDATE - SENDER
        select --top 100
                  ca.clientID, ca.userid
                , um.userMessageID,um.sendingUserID,um.subject,um.externalFrom
                , um.comments
                , um.email_content as email_content
                ,convert(nvarchar(max),um.externalTo) as externalTo
				, convert(nvarchar(max),um.externalCC) as externalCC
				, convert(nvarchar(max),um.externalBCC) as externalBCC
				, um.SMTPSendDate
                --mr.userID,mr.folder,mr.recipientType, mr.email, mr.sendingUserID, mr.subjectSort
                --,mr.userID,mr.folder,mr.recipientType, mr.email, mr.externalFrom
                , umf.att --,umf.name, umf.directory
        from bullhorn1.BH_UserMessage um
        left join bullhorn1.BH_MessageRecipient mr on mr.userMessageID = um.userMessageID
        --left join bullhorn1.BH_UserMessageFile umf on umf.userMessageID = um.userMessageID
        --left join (SELECT userMessageID, STUFF((SELECT ', ' + name from bullhorn1.BH_UserMessageFile WHERE userMessageID = a.userMessageID order by name asc FOR XML PATH (''), TYPE).value('.', 'nvarchar(MAX)'), 1, 1, '') AS att FROM bullhorn1.BH_UserMessageFile AS a GROUP BY a.userMessageID ) umf on umf.userMessageID = um.userMessageID
        left join (SELECT userMessageID, STRING_AGG(cast(name as nvarchar(max)),',' ) WITHIN GROUP (ORDER BY name) att 
					from bullhorn1.BH_UserMessageFile GROUP BY userMessageID) umf on umf.userMessageID = um.userMessageID
        left join bullhorn1.BH_Client ca on ca.userid = um.sendingUserID
        where um.isSenderDeleted = 0 and ca.userid is not null and ca.isdeleted &lt;&gt; 1 and ca.status &lt;&gt; 'Archive'
        --and convert(nvarchar(max),um.comments) &lt;&gt; ''
        --and ca.clientID in (4054)
)
/*
select top 10 clientID, smtpsenddate, count(*)
from EmailBody
group by clientID, smtpsenddate
having count(*) > 5
*/

/*, dup (clientID,SMTPSendDate,rn) as ( SELECT clientID, SMTPSendDate, rn = ROW_NUMBER() OVER (PARTITION BY clientID,SMTPSendDate ORDER BY clientID desc) FROM EmailBody )
select * from dup where clientID = 1074 and rn > 1--and cast(SMTPSendDate as varchar(max)) like '%28/01/2016%'*/

/* select * from EmailBody where candidateid = 33
candidateid between 124602 and 128601 
candidateid between 5 and 90000 -> 13388
candidateid between 90001 and 12000 -> 0
candidateid between 12000 and 122601 -> 45813
candidateid between 122602 and 124601 -> 21439
candidateid between 124602 and 128601 -> 25914

select candidateid, concat('insert into position_candidate_feedback (candidate_id, user_account_id, feedback_timestamp, comment_body, feedback_score, insert_timestamp, contact_method, json_relate_info, related_status) values ( 
        (select id from candidate where external_id = ''',candidateid,'''), ',-10,', now(), ''',replace(concat('Date Created: ',convert(varchar,SMTPSendDate,120),char(10),'From: ',externalFrom,char(10),'To: ',externalTo,char(10),'CC: ',externalCC,char(10),'Subject: ',subject,char(10),char(10),'Content: ',comments),'''',''''''),''', 0, now(), 4, ''[]'', 1);') as EmailSQL
from EmailBody --where candidateid = 33
order by SMTPSendDate desc
*/

--select userMessageID from EmailBody
--select count(*) from EmailBody where userMessageID not in (select userMessageID from bullhorn1.email_m_ID) --245396 
--select userMessageID into bullhorn1.email_m_ID_import from EmailBody where userMessageID not in (select userMessageID from bullhorn1.email_m_ID)

--select top 100 * from EmailBody --where candidateid = 33

select --top 200
          userMessageID
        , concat('TRCT',clientID) as ContactExtID
        , userid
        , -10 as 'user_account_id'
        , cast('4' as int) as 'contact_method'
        , coalesce(NULLIF(convert(varchar(20), SMTPSendDate, 120),''), CURRENT_TIMESTAMP) as 'insert_timestamp'
        , 'comment' as category
        , 'contact' as type
        , --dbo.RemoveNullCharacters( 
--			[bullhorn1].[fn_RemoveNonPrintableChars]  (
              [dbo].[udf_StripHTML](
              replace(replace(replace(replace(replace(replace(
              Stuff('EMAIL: ' + char(10)
                + Coalesce('From: ' + NULLIF(convert(nvarchar(max),externalFrom), '') + char(10), '')
                + Coalesce('To: ' + NULLIF(convert(nvarchar(max),externalTo), '') + char(10), '')
                + Coalesce('CC: ' + NULLIF(convert(nvarchar(max),externalCC), '') + char(10), '')
                + Coalesce('BCC: ' + NULLIF(convert(nvarchar(max),externalBCC), '') + char(10), '')
                + Coalesce('Subject: ' + NULLIF(convert(nvarchar(max),subject), '') + char(10), '')
                + Coalesce('Comments: ' + NULLIF(convert(nvarchar(max),comments), '') + char(10), '')
                + Coalesce('Attachments: ' + NULLIF(convert(nvarchar(max),att), '') + char(10), '')
				+ Coalesce('Body: ' + NULLIF(trim(convert(nvarchar(max),email_content)), '') + char(10), 'Body: ' + char(10))
              , 1, 0, '')
              ,'Â',''),'Â·',''),'v\:* {behavior:url(#default#VML);}',''),'o\:* {behavior:url(#default#VML);}',''),'w\:* {behavior:url(#default#VML);}',''),'.shape {behavior:url(#default#VML);}','')
              )
--			)
        -- )
         as 'content'
from EmailBody
</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>Y</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>BULLHORN Contact Info</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>--ALTER DATABASE [DatabaseName] SET COMPATIBILITY_LEVEL = 140
with
  mail1 (ID,email) as (
        select Cl.clientID, CONCAT_WS(',',  nullif(dbo.fn_RemoveNonASCIIChars(UC.email),''),nullif(dbo.fn_RemoveNonASCIIChars(UC.email2),''),nullif(dbo.fn_RemoveNonASCIIChars(UC.email3),'')) as email
         from bullhorn1.BH_Client Cl --where isPrimaryOwner = 1
         left join bullhorn1.BH_UserContact UC ON Cl.userID = UC.userID
         where (Cl.isdeleted &lt;&gt; 1 and Cl.status &lt;&gt; 'Archive') )
, mail2 (ID,email) as (SELECT ID, email.value as email FROM mail1 m CROSS APPLY STRING_SPLIT(m.email,',') AS email)
, mail3 (ID,email) as (SELECT ID, case when RIGHT(email, 1) = '.' then LEFT(email, LEN(email) - 1) when LEFT(email, 1) = '.' then RIGHT(email, LEN(email) - 1) else email end as email from mail2 WHERE email like '%_@_%.__%')
, mail4 (ID,email,rn) as ( SELECT ID, email = ltrim(rtrim(CONVERT(NVARCHAR(MAX), email))), r1 = ROW_NUMBER() OVER (PARTITION BY ID ORDER BY ID desc) FROM mail3 )
, e1 (ID,email) as (select ID, email from mail4 where rn = 1)
, ed (ID,email,rn) as (SELECT ID,email,ROW_NUMBER() OVER(PARTITION BY email ORDER BY ID DESC) AS rn FROM e1 )
, e2 (ID,email) as (select ID, email from mail4 where rn = 2)
, e3 (ID,email) as (select ID, email from mail4 where rn = 3)
--select * from ed

select 
	 concat('TRCT',Cl.clientID) as contactExtId
	, NULLIF(UC.Phone2, '') as 'home_phone'
	, UC.Mobile as 'mobile_phone'
	, Cl.division as 'department'
	, e2.email as 'personal_email'
    , cl.dateAdded as reg_date
	,uc.nickName as 'nickname'
from bullhorn1.BH_Client Cl --where isPrimaryOwner = 1
left join bullhorn1.BH_UserContact UC ON Cl.userID = UC.userID
left join e2 ON Cl.clientID = e2.ID -- candidate-email
where (Cl.isdeleted &lt;&gt; 1 and Cl.status &lt;&gt; 'Archive')</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>Y</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>BULLHORN Job Comment</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with comments as (
--        select a.jobPostingID
--                                , UC.dateAdded
--                                , concat_ws(char(10)
--                                        , '*** COMMENT:'
--                                        , coalesce('Created Date: ' + NULLIF(convert(varchar,uc.dateAdded,120), ''), NULL)
--                                        , coalesce('Author: ' + NULLIF(u.name, ''), NULL)
--                                        , coalesce('Action: ' + NULLIF(uc.action, ''), NULL)
--                                        , coalesce('Comments: ' + NULLIF(cast([bullhorn1].[fn_ConvertHTMLToText](uc.comments) as nvarchar(max)), ''), NULL)
--                                ) as [content]
--        from bullhorn1.BH_UserComment UC --where jobPostingID is not null
--        left join bullhorn1.BH_JobPosting a on a.jobPostingID = UC.jobPostingID
--        left join bullhorn1.BH_User U on U.userID = UC.commentingUserID
--        where a.jobPostingID is not null

--UNION ALL

	SELECT 
			a.jobPostingID
			, a.dateAdded
			, concat_ws(char(10), '*** APPOINTMENT: '
					, coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
					, coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) + coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID 
					, coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), ''), NULL) --jobPostingID
--					, coalesce('Communication Method: ' + NULLIF(convert(nvarchar(max), a.communicationMethod), ''), NULL)
					, coalesce('Owner: ' + NULLIF(coalesce(coalesce(nullif(UC3.FirstName,'') + ' ', NULL) + coalesce(nullif(UC3.LastName,'') + ' - ', NULL) + nullif(UC3.email,''), NULL), ''), NULL)
--					, coalesce('Lead: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL) + coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL)
					, coalesce('Date Begin: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
					, coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
--					, coalesce('Type: ' + NULLIF(convert(nvarchar(max),a.type), ''), NULL) --CA.activePlacements
--					, coalesce('Subject: ' + NULLIF(convert(nvarchar(max),a.subject), ''), NULL)
					--, coalesce('Reminder: ' + NULLIF(convert(nvarchar(max),a.notificationMinutes), ''), NULL)
--					, coalesce('Opportunity: ' + NULLIF(convert(nvarchar(max),j2.title), ''), NULL)					
--					, coalesce('File Name: ' + NULLIF(convert(nvarchar(max),af.name), ''), NULL)
					, coalesce(char(10) + 'Description: ' + [bullhorn1].[fn_ConvertHTMLToText](NULLIF(convert(nvarchar(max),a.description), '')), NULL)
					, COALESCE('Attendees: ' 
                                                           + COALESCE(coalesce('[Contact]' + NULLIF(CONCAT_WS(' ',nullif(UC1.FirstName,''),nullif(UC1.LastName,'')),''), NULL),NULL)
                                                           + COALESCE(' - ' + coalesce('[Candidate]' + NULLIF(CONCAT_WS(' ',nullif(UC2.FirstName,''),nullif(UC2.LastName,'')),''), NULL),NULL),NULL
					          )
                                         , coalesce('Location: ' + NULLIF(convert(nvarchar(max),a.location), ''), NULL)
				) as [content]
        from bullhorn1.View_Appointment a
        left join bullhorn1.View_AppointmentFile af on af.appointmentID = a.appointmentID
        left join bullhorn1.BH_Client Cl on Cl.userID = a.ClientUserID
        left join bullhorn1.BH_UserContact UC1 ON UC1.userID = Cl.userID
        left join bullhorn1.BH_UserContact UC2 ON UC2.userID = a.candidateUserID
        left join bullhorn1.BH_UserContact UC3 ON UC3.userID = a.userID
        left join bullhorn1.BH_UserContact UC4 ON UC4.userID = a.LeaduserID
        left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
        left join bullhorn1.BH_JobPosting j2 on j.jobPostingID = a.opportunityJobPostingID
        where j.jobPostingID is not null --23 rows
		 
UNION ALL

	SELECT ---top 20 
		j.jobPostingID as 'externalid'
		, a.dateAdded
				, concat_ws(char(10), '*** TASK: '
						, coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) + coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID 
--						, coalesce('Assigned To: ' + NULLIF(cast(a.childTaskOwners as nvarchar(max)), ''), NULL)
						, coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
--						, coalesce('Due Date And Time: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
						, coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
--						, coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), ''), NULL) --jobPostingID
						, coalesce('Reminder: ' + NULLIF(cast(a.notificationMinutes as nvarchar(max)), ''), NULL)
--						, coalesce('Opportunity: ' + NULLIF(cast(a.opportunityJobPostingID as nvarchar(max)), ''), NULL)
						, coalesce('Placement: ' + NULLIF(cast(a.placementID as nvarchar(max)), ''), NULL)
--						, coalesce('Priority: ' + NULLIF(cast(a.priority as nvarchar(max)), ''), NULL)
--						, coalesce('Recurrence Day Bits: ' + NULLIF(cast(a.recurrenceDayBits as varchar(max)), ''), NULL)
--						, coalesce('Recurrence Frequency: ' + NULLIF(cast(a.recurrenceFrequency as varchar(max)), ''), NULL)
--						, coalesce('Recurrence Max: ' + NULLIF(cast(a.recurrenceMax as varchar(max)), ''), NULL)
--						, coalesce('Recurrence Month Bits: ' + NULLIF(cast(a.recurrenceMonthBits as varchar(max)), ''), NULL)
--						, coalesce('Recurrence Style: ' + NULLIF(cast(a.recurrenceStyle as varchar(max)), ''), NULL)
--						, coalesce('Recurrence Type: ' + NULLIF(cast(a.recurrenceType as varchar(max)), ''), NULL)
--						, coalesce('Visibility: ' + NULLIF(cast(a.isPrivate as nvarchar(max)), ''), NULL)
						, coalesce('Subject: ' + NULLIF(cast(a.subject as nvarchar(max)), ''), NULL)
						, coalesce('Type: ' + NULLIF(cast(a.type as nvarchar(max)), ''), NULL)
						, coalesce('Owner: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL) + coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL) --a.userID
						, coalesce(char(10) + 'Description: ' + [bullhorn1].[fn_ConvertHTMLToText](NULLIF(convert(nvarchar(max),a.description), '')), NULL)
				) as [content] 
        from bullhorn1.View_Task a
        left join bullhorn1.BH_Client Cl on Cl.userID = a.ClientUserID
        left join bullhorn1.BH_UserContact UC1 ON Cl.userID = UC1.userID
        left join bullhorn1.BH_UserContact UC2 ON a.candidateUserID = UC2.userID
        left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
        left join bullhorn1.BH_UserContact UC3 ON a.leadUserID = UC3.userID
        left join bullhorn1.BH_UserContact UC4 ON a.userID = UC4.userID
        where j.jobPostingID is not null --5 rows

--UNION ALL
--        -- PLACEMENT
--        select 
--        PL.jobPostingID as 'externalid' 
--        , pl.dateadded 
--		, Stuff( '*** PLACEMENT: ' + char(10)
--              + coalesce('Billing Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL)  --pl.billingUserID
--			--+ coalesce('Bill Rate Information: ' + NULLIF(cast(pl.billRateInfoHeader as varchar(max)), '') + char(10), '')
--              + coalesce('Bill Rate: ' + NULLIF(cast(pl.clientBillRate as varchar(max)), '') + char(10), '')
--              + coalesce('Over-time Bill Rate: ' + NULLIF(cast(pl.clientOverTimeRate as varchar(max)), '') + char(10), '')
--              + coalesce('Comments: ' + NULLIF(cast(pl.comments as varchar(max)), '') + char(10), '')
--			--+ coalesce('Contract Employment Info: ' + NULLIF(cast(pl.contractInfoHeader as varchar(max)), '') + char(10), '')
--              + coalesce('Primary Timesheet Approver: ' + NULLIF(cast(pl.correlatedCustomText1 as varchar(max)), '') + char(10), '')
--              + coalesce('Secondary Timecard Approver: ' + NULLIF(cast(pl.correlatedCustomText2 as varchar(max)), '') + char(10), '')
--              + coalesce('Purchase Order Number: ' + NULLIF(cast(pl.correlatedCustomText3 as varchar(max)), '') + char(10), '')
--              + coalesce('Cost Center: ' + NULLIF(cast(pl.costCenter as varchar(max)), '') + char(10), '')
--              + coalesce('Insurance Reference: ' + NULLIF(cast(pl.customText1 as varchar(max)), '') + char(10), '')
--              + coalesce('Start Date: ' + NULLIF(convert(nvarchar(max),pl.dateBegin,120), '') + char(10), '')
--              + coalesce('Effective Date (Client): ' + NULLIF(convert(nvarchar(max),pl.dateClientEffective, 120), '') + char(10), '')
--              + coalesce('Effective Date: ' + NULLIF(convert(nvarchar(max),pl.dateEffective, 120), '') + char(10), '')
--              + coalesce('Scheduled End: ' + NULLIF(convert(nvarchar(max), pl.dateEnd, 120), '') + char(10), '')
--              + coalesce('Days Guaranteed: ' + NULLIF(cast(pl.daysGuaranteed as varchar(max)), '') + char(10), '')
--              + coalesce('Days Pro-Rated: ' + NULLIF(cast(pl.daysProRated as varchar(max)), '') + char(10), '')
--              + coalesce('Employment Type: ' + NULLIF(cast(pl.employmentType as varchar(max)), '') + char(10), '')
--              + coalesce('Placement Fee (%): ' + NULLIF(cast(pl.fee as varchar(max)), '') + char(10), '')
--			--+ coalesce('Placement Fee (Flat): ' + NULLIF(cast(pl.flatFee as varchar(max)), '') + char(10), '')
--              + coalesce('Hours of Operation: ' + NULLIF(cast(pl.hoursOfOperation as varchar(max)), '') + char(10), '')
--              + coalesce('Hours Per Day: ' + NULLIF(cast(pl.hoursPerDay as varchar(max)), '') + char(10), '')
--              + coalesce('Rate Entry Type: ' + NULLIF(cast(pl.isMultirate as varchar(max)), '') + char(10), '')
--			--+ coalesce('Mark-up %: ' + NULLIF(cast(pl.markUpPercentage as varchar(max)), '') + char(10), '')
--              + coalesce('Over-time Pay Rate: ' + NULLIF(cast(pl.overtimeRate as varchar(max)), '') + char(10), '')
--              + coalesce('Pay Rate: ' + NULLIF(cast(pl.payRate as varchar(max)), '') + char(10), '')
--			--+ coalesce('Pay Rate Information: ' + NULLIF(cast(pl.payRateInfoHeader as varchar(max)), '') + char(10), '')
--			--+ coalesce('Permanent Employment Info: ' + NULLIF(cast(pl.permanentInfoHeader as varchar(max)), '') + char(10), '')
--              + coalesce('Referral Fee Type: ' + NULLIF(cast(pl.referralFeeType as varchar(max)), '') + char(10), '')
--              + coalesce('Reporting to: ' + NULLIF(cast(pl.reportTo as varchar(max)), '') + char(10), '')
--              + coalesce('Salary: ' + NULLIF(cast(pl.salary as varchar(max)), '') + char(10), '')
--              + coalesce('Pay Unit: ' + NULLIF(cast(pl.salaryUnit as varchar(max)), '') + char(10), '')
--              + coalesce('Status: ' + NULLIF(cast(pl.status as varchar(max)), '') + char(10), '')
--        , 1, 0, '') as 'content'
--        from bullhorn1.BH_Placement PL --where PL.reportTo &lt;&gt; ''
--        left join bullhorn1.BH_UserContact UC1 ON UC1.userID = pl.billingUserID
--        left join (select candidateID, concat(FirstName,' ',LastName) as fullname, userid from bullhorn1.Candidate) C on C.userID = pl.userid --106 rows
)

select --top 100
                   concat('TRJ', jobPostingID) as JobExtId
                  , -10 as 'user_account_id'
                  , 'comment' as 'category'
                  , 'job' as 'type'
                  , dateAdded as 'insert_timestamp'
                  , content as 'content'
from comments where 'content' &lt;&gt; '' --170 rows</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Candidate Activity Table</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema/>
    <table>activity_candidate</table>
    <commit>100</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>candidate_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1200</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Candidate Comment</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with comments as (
        SELECT --top 1000
                  C.candidateID
                , C.fullname
                , UC.dateAdded
                , stuff('*** COMMENT: ' + char(10)
                        + coalesce('Action: ' + NULLIF(UC.action, '') + char(10), '') 
                        + coalesce('Created by: ' + NULLIF(U.name, '') + char(10), '')  
                        + coalesce('Comments: ' + NULLIF( 
                                  replace(replace(replace(replace(replace(replace([dbo].[udf_StripHTML](UC.comments) --[dbo].[fn_ConvertHTMLToText](
                                  ,'Â','')
                                  ,'Â·','')
                                  ,'v\:* {behavior:url(#default#VML);}','')
                                  ,'o\:* {behavior:url(#default#VML);}','')
                                  ,'w\:* {behavior:url(#default#VML);}','')
                                  ,'.shape {behavior:url(#default#VML);}','') , '') + char(10), '')
                        + coalesce('Date Added: ' + NULLIF(convert(varchar,UC.dateAdded,120), '') + char(10), '')
                        + coalesce('About Who: ' + NULLIF(C.fullname, '') + char(10), '')
                , 1, 0, '') as 'content'
        from bullhorn1.BH_UserComment UC
        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid, isPrimaryOwner from bullhorn1.Candidate) C on C.userID = UC.Userid
        left join bullhorn1.BH_User U on U.userID = UC.commentingUserID
        where C.candidateID is not null --44836 rows

--UNION ALL
--
--        SELECT --top 1000
--                  ch.candidateID ,C.fullname --,UC.Userid
--                , ch.dateAdded
--                , coalesce('*** HISTORY: ' + char(10)
--		           + 'Date Added: ' + convert(varchar, ch.dateAdded, 120) + char(10) 
--		           + 'Candidate History: ' + NULLIF(convert(nvarchar(max),ch.comments), ''), '') 
--		           as 'content'
--        from bullhorn1.BH_CandidateHistory CH
--        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid, isPrimaryOwner from bullhorn1.Candidate ) C on C.candidateID = CH.candidateID 
--        where C.candidateID is not null and ch.comments is not null --and C.isPrimaryOwner = 1 and cast(ch.comments as varchar(max)) &lt;&gt; '' 
--
--UNION ALL
--
--	SELECT --top 20 
--	C.candidateID ,C.fullname  --, a.candidateuserID, C.userID
--	, a.dateAdded
--	, concat_ws(char(10), '*** APPOINTMENT: '
--        , coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
--        , coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) + coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID 
--        , coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), '') + char(10), '') --jobPostingID
--        , coalesce('Communication Method: ' + NULLIF(convert(nvarchar(max),a.communicationMethod), '') + char(10), '')
--        , coalesce('Date Begin: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
--        , coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
--        , coalesce('Type: ' + NULLIF(convert(nvarchar(max),a.type), '') + char(10), '') --CA.activePlacements
--        , coalesce('Subject: ' + NULLIF(convert(nvarchar(max),a.subject), '') + char(10), '')
----        , coalesce('Reminder: ' + NULLIF(convert(nvarchar(max),a.notificationMinutes), '') + char(10), '')
--        , coalesce('Job: ' + NULLIF(convert(nvarchar(max),j.title), '') + char(10), '')
----        , coalesce('Opportunity: ' + NULLIF(convert(nvarchar(max),j2.title), '') + char(10), '')
--        , coalesce('Location: ' + NULLIF(convert(nvarchar(max),a.location), '') + char(10), '')
--        , coalesce('Owner: ' + NULLIF(coalesce(coalesce(nullif(UC3.FirstName,'') + ' ', NULL) + coalesce(nullif(UC3.LastName,'') + ' - ', NULL) + nullif(UC3.email,''), NULL), ''), NULL)
----        , coalesce('Lead: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL) + coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL)
----        , coalesce('File Name: ' + NULLIF(convert(nvarchar(max),af.name), '') + char(10), '')
--        , coalesce('Description: ' + NULLIF( convert(nvarchar(max),a.description), '') + char(10), '')
--        ) as 'content'
--        from bullhorn1.View_Appointment a
--        left join bullhorn1.View_AppointmentFile af on af.appointmentID = a.appointmentID
--        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid, isPrimaryOwner from bullhorn1.Candidate) C on C.userID = a.candidateuserID
--        left join bullhorn1.BH_UserContact UC1 ON UC1.userID = a.ClientuserID
--        left join bullhorn1.BH_UserContact UC2 ON UC2.userID = a.candidateUserID
--        left join bullhorn1.BH_UserContact UC3 ON UC3.userID = a.userID
--        left join bullhorn1.BH_UserContact UC4 ON UC4.userID = a.LeaduserID
--        left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
----        left join bullhorn1.BH_JobPosting j2 on j.jobPostingID = a.opportunityJobPostingID        
--        where C.candidateID is not null --C.isPrimaryOwner = 1 --2680 rows
--
UNION ALL

	SELECT --top 20 
	C.candidateID, C.fullname  --, a.candidateuserID, C.userID
	, a.dateAdded
	, concat_ws(char(10), '*** TASK: '
						, coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) 
												+ coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID 
						--, coalesce('Assigned To: ' + NULLIF(cast(a.childTaskOwners as nvarchar(max)), '') + char(10), '')
--						, coalesce('Assigned To: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL)
--												+ coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL) --a.userID
--						, coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL)
--												+ coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
--						, coalesce('Due Date And Time: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
--						, coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
						, coalesce('Description: ' + NULLIF(cast( a.description as nvarchar(max)), '') + char(10), '') --[dbo].[fn_ConvertHTMLToText](
						--, coalesce('Visibility: ' + NULLIF(cast(a.isPrivate as nvarchar(max)), '') + char(10), '')
--						, coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), '') + char(10), '') --jobPostingID
--						, coalesce('Lead: ' + NULLIF(cast( concat(UC3.FirstName,' ',UC3.LastName,'     ',UC3.email) as nvarchar(max)), '') + char(10), '') --a.leadUserID
--						, coalesce('Reminder: ' + NULLIF(cast(a.notificationMinutes as nvarchar(max)), '') + char(10), '')
--						, coalesce('Opportunity: ' + NULLIF(cast(j2.title as nvarchar(max)), '') + char(10), '') --a.opportunityJobPostingID 
						, coalesce('Placement: ' + NULLIF(cast(a.placementID as nvarchar(max)), '') + char(10), '')
--						, coalesce('Priority: ' + NULLIF(cast(a.priority as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Day Bits: ' + NULLIF(cast(a.recurrenceDayBits as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Frequency: ' + NULLIF(cast(a.recurrenceFrequency as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Max: ' + NULLIF(cast(a.recurrenceMax as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Month Bits: ' + NULLIF(cast(a.recurrenceMonthBits as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Style: ' + NULLIF(cast(a.recurrenceStyle as nvarchar(max)), '') + char(10), '')
--						, coalesce('Recurrence Type: ' + NULLIF(cast(a.recurrenceType as nvarchar(max)), '') + char(10), '')
						, coalesce('Subject: ' + NULLIF(cast(a.subject as nvarchar(max)), '') + char(10), '')
						, coalesce('Type: ' + NULLIF(cast(a.type as nvarchar(max)), '') + char(10), '')
						, coalesce('Owner: ' + NULLIF(cast( concat(UC4.FirstName,' ',UC4.LastName,'     ',UC4.email) as nvarchar(max)), '') + char(10), '') --a.userID
				) as 'content'       
        from bullhorn1.View_Task a
--        left join bullhorn1.BH_Client Cl on Cl.userID = a.ClientUserID
--        left join bullhorn1.BH_UserContact UC1 ON Cl.userID = UC1.userID
        left join bullhorn1.BH_UserContact UC2 ON a.candidateUserID = UC2.userID
--        left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
--        left join bullhorn1.BH_UserContact UC3 ON a.leadUserID = UC3.userID
        left join bullhorn1.BH_UserContact UC4 ON a.userID = UC4.userID
        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid, isPrimaryOwner from bullhorn1.Candidate) C on C.userID = a.candidateuserID 
--        left join bullhorn1.BH_JobPosting j2 on j2.jobPostingID = a.opportunityJobPostingID
        where C.candidateID is not null --C.isPrimaryOwner = 1 --


--UNION ALL
--       -- PLACEMENT
--		select 
--		C.candidateid, C.fullname
--		, pl.dateadded 
--		, stuff( '*** PLACEMENT: ' + char(10)
--              + coalesce('Billing Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL)
--										+ coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,'') + char(10), NULL), ''), NULL)  --pl.billingUserID
--			--+ coalesce('Bill Rate Information: ' + NULLIF(cast(pl.billRateInfoHeader as nvarchar(max)), '') + char(10), '')
--              + coalesce('Bill Rate: ' + NULLIF(cast(pl.clientBillRate as nvarchar(max)), '') + char(10), '')
--              + coalesce('Over-time Bill Rate: ' + NULLIF(cast(pl.clientOverTimeRate as nvarchar(max)), '') + char(10), '')
--              + coalesce('Comments: ' + NULLIF(cast(pl.comments as nvarchar(max)), '') + char(10), '')
--			--+ coalesce('Contract Employment Info: ' + NULLIF(cast(pl.contractInfoHeader as nvarchar(max)), '') + char(10), '')
--              + coalesce('Primary Timesheet Approver: ' + NULLIF(cast(pl.correlatedCustomText1 as nvarchar(max)), '') + char(10), '')
--              + coalesce('Secondary Timecard Approver: ' + NULLIF(cast(pl.correlatedCustomText2 as nvarchar(max)), '') + char(10), '')
--              + coalesce('Purchase Order Number: ' + NULLIF(cast(pl.correlatedCustomText3 as nvarchar(max)), '') + char(10), '')
--              + coalesce('Cost Center: ' + NULLIF(cast(pl.costCenter as nvarchar(max)), '') + char(10), '')
--              + coalesce('Insurance Reference: ' + NULLIF(cast(pl.customText1 as nvarchar(max)), '') + char(10), '')
--              + coalesce('Start Date: ' + NULLIF(convert(nvarchar(10), pl.dateBegin, 120), '') + char(10), '')
--              + coalesce('Effective Date (Client): ' + NULLIF(convert(nvarchar(10), pl.dateClientEffective, 120), '') + char(10), '')
--              + coalesce('Effective Date: ' + NULLIF(convert(nvarchar(10), pl.dateEffective, 120), '') + char(10), '')
--              + coalesce('Scheduled End: ' + NULLIF(convert(nvarchar(10), pl.dateEnd, 120), '') + char(10), '')
--              + coalesce('Days Guaranteed: ' + NULLIF(cast(pl.daysGuaranteed as nvarchar(max)), '') + char(10), '')
--              + coalesce('Days Pro-Rated: ' + NULLIF(cast(pl.daysProRated as nvarchar(max)), '') + char(10), '')
--              + coalesce('Employment Type: ' + NULLIF(cast(pl.employmentType as nvarchar(max)), '') + char(10), '')
--              + coalesce('Placement Fee (%): ' + NULLIF(cast(pl.fee as nvarchar(max)), '') + char(10), '')
--			--+ coalesce('Placement Fee (Flat): ' + NULLIF(cast(pl.flatFee as nvarchar(max)), '') + char(10), '')
--              + coalesce('Hours of Operation: ' + NULLIF(cast(pl.hoursOfOperation as nvarchar(max)), '') + char(10), '')
--              + coalesce('Hours Per Day: ' + NULLIF(cast(pl.hoursPerDay as nvarchar(max)), '') + char(10), '')
--              + coalesce('Rate Entry Type: ' + NULLIF(cast(pl.isMultirate as nvarchar(max)), '') + char(10), '')
--			--+ coalesce('Mark-up %: ' + NULLIF(cast(pl.markUpPercentage as nvarchar(max)), '') + char(10), '')
--              + coalesce('Over-time Pay Rate: ' + NULLIF(cast(pl.overtimeRate as nvarchar(max)), '') + char(10), '')
--              + coalesce('Pay Rate: ' + NULLIF(cast(pl.payRate as nvarchar(max)), '') + char(10), '')
--			--+ coalesce('Pay Rate Information: ' + NULLIF(cast(pl.payRateInfoHeader as nvarchar(max)), '') + char(10), '')
--			--+ coalesce('Permanent Employment Info: ' + NULLIF(cast(pl.permanentInfoHeader as nvarchar(max)), '') + char(10), '')
--              + coalesce('Referral Fee Type: ' + NULLIF(cast(pl.referralFeeType as nvarchar(max)), '') + char(10), '')
--              + coalesce('Reporting to: ' + NULLIF(cast(pl.reportTo as nvarchar(max)), '') + char(10), '')
--              + coalesce('Salary: ' + NULLIF(cast(pl.salary as nvarchar(max)), '') + char(10), '')
--              + coalesce('Pay Unit: ' + NULLIF(cast(pl.salaryUnit as nvarchar(max)), '') + char(10), '')
--              + coalesce('Status: ' + NULLIF(cast(pl.status as nvarchar(max)), '') + char(10), '')
--        , 1, 0, '') as 'content'
--        from bullhorn1.BH_Placement PL --where PL.reportTo &lt;&gt; ''
--        left join bullhorn1.BH_UserContact UC1 ON UC1.userID = pl.billingUserID
--        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid from bullhorn1.Candidate) C on C.userID = pl.userid

--UNION ALL
--       -- Job Submission
--			select 
--			C.candidateid, C.fullname
--			, jr.dateadded
--			, stuff('*** JOB SUBMISSION: ' + char(10)
--                 --coalesce('Appointments: ' + NULLIF(cast(jr.appointments as nvarchar(max)), '') + char(10), '')
--              + coalesce('Bill Rate: ' + NULLIF(cast(jr.billRate as nvarchar(max)), '') + char(10), '')
--              + coalesce('Comments: ' + NULLIF(cast(jr.comments as nvarchar(max)), '') + char(10), '')
--              + coalesce('Date Added: ' + NULLIF(convert(nvarchar(10), jr.dateAdded, 120), '') + char(10), '')
--              --+ coalesce('Date Last Modified: ' + NULLIF(cast(jr.dateLastModified as nvarchar(max)), '') + char(10), '')
--              + coalesce('Date Web Response: ' + NULLIF(cast(jr.dateWebResponse as nvarchar(max)), '') + char(10), '')
--              + coalesce('Job Order: ' + NULLIF(cast(j.title as nvarchar(max)), '') + char(10), '') --jr.jobPostingID
--              + coalesce('Latest Appointment: ' + NULLIF(cast(jr.latestAppointmentID as nvarchar(max)), '') + char(10), '')
--              + coalesce('Migrate GUID: ' + NULLIF(cast(jr.migrateGUID as nvarchar(max)), '') + char(10), '')
--              --+ coalesce('Owners: ' + NULLIF(cast(jr.owners as nvarchar(max)), '') + char(10), '')
--              + coalesce('Pay Rate: ' + NULLIF(cast(jr.payRate as nvarchar(max)), '') + char(10), '')
--              + coalesce('Salary: ' + NULLIF(cast(jr.salary as nvarchar(max)), '') + char(10), '')
--              + coalesce('Added By: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL)
--								+ coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,'') + char(10), NULL), ''), NULL) --jr.sendingUserID
--              + coalesce('Source: ' + NULLIF(cast(jr.source as nvarchar(max)), '') + char(10), '')
--              + coalesce('Status: ' + NULLIF(cast(jr.status as nvarchar(max)), '') + char(10), '')
--              --+ coalesce('Task: ' + NULLIF(cast(jr.tasks as nvarchar(max)), '') + char(10), '')
--              + coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL)
--										+ coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,'') + char(10), NULL), ''), NULL) --jr.userID 
--        , 1, 0, '') as note
--        from bullhorn1.View_JobResponse jr
--        left join bullhorn1.BH_UserContact UC1 ON UC1.userID = jr.userID
--        left join bullhorn1.BH_UserContact UC2 ON UC2.userID = jr.sendingUserID
--        left join bullhorn1.BH_JobPosting j on j.jobPostingID = jr.jobPostingID        
--        left join ( select candidateID, concat(FirstName,' ',LastName) as fullname, userid from bullhorn1.Candidate) C on C.userID = jr.userid
--        --where jr.userid &lt;&gt; jr.sendingUserID
)

select --top 100
                   concat('TRCD', candidateID) as candidateextid
                  , -10 as 'user_account_id'
                  , 'comment' as 'category'
                  , 'candidate' as 'type'
                  , dateAdded as 'insert_timestamp'
                  , [dbo].[udf_StripHTML](content) as content
from comments where content &lt;&gt; '' --55563
order by candidateID</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Candidate lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CandidateExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCandidateID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
      <value>
        <name>first_name</name>
        <rename>c.first_name</rename>
        <default/>
        <type>None</type>
      </value>
      <value>
        <name>last_name</name>
        <rename>c.last_name</rename>
        <default/>
        <type>None</type>
      </value>
      <value>
        <name>email</name>
        <rename>c.email</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>240</xloc>
      <yloc>1696</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Company lookup.com</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>pd.company_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>com.client_company_name</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>832</xloc>
      <yloc>2048</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Concat Fields Client Name</name>
    <type>ConcatFields</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator> </separator>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name>file</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>client_first_name</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>client_last_name</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <ConcatFields>
      <targetFieldName>client_contact_name</targetFieldName>
      <targetFieldLength>0</targetFieldLength>
      <removeSelectedFields>N</removeSelectedFields>
    </ConcatFields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>2160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Contact Activity Table</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity_contact</table>
    <commit>100</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>contact_id</column_name>
        <stream_name>contact_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>272</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Contact Comment</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with comments as (
       select 
                 cl.clientID as contact_id
               , uc.dateAdded
               , concat_ws(char(10)
                        , '*** NOTE:'
                        , coalesce('Action: ' + NULLIF(uc.action, ''), NULL)
                        , coalesce('Created by: ' + NULLIF(u.name, ''), NULL)
                        , coalesce('Comments: ' + NULLIF(cast(bullhorn1.fn_ConvertHTMLToText(uc.comments) as nvarchar(max)), ''), NULL)
                        , coalesce('Date Added: ' + NULLIF(convert(varchar,uc.dateAdded,120), ''), NULL)
                        , coalesce('About Who: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL)              
               ) as [content]
       from bullhorn1.BH_UserComment uc
       left join bullhorn1.BH_Client cl on cl.userID = uc.userID
       left join bullhorn1.BH_UserContact uc1 ON Cl.userID = uc1.userID
       left join bullhorn1.BH_User u on u.userID = uc.commentingUserID
       where cl.clientID is not null and (cl.isdeleted &lt;&gt; 1 and cl.status &lt;&gt; 'Archive')
UNION ALL

	select
                Cl.clientID as contact_id
              , a.dateAdded
              , concat_ws(char(10), '*** APPOINTMENT: '
					, coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
					, coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) + coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID
					, coalesce('Communication Method: ' + NULLIF(convert(nvarchar(max) ,a.communicationMethod), ''), NULL)
					, coalesce('Date Begin: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
					, coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
					, coalesce(char(10) + 'Description: ' + [bullhorn1].[fn_ConvertHTMLToText](NULLIF(convert(nvarchar(max),a.description), '')), NULL)
					, coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), ''), NULL) --jobPostingID
					, coalesce('Location: ' + NULLIF(convert(nvarchar(max),a.location), ''), NULL)
					, coalesce('Subject: ' + NULLIF(convert(nvarchar(max),a.subject), ''), NULL)
					, coalesce('Type: ' + NULLIF(convert(nvarchar(max),a.type), ''), NULL) --CA.activePlacements
					, coalesce('Owner: ' + NULLIF(coalesce(coalesce(nullif(UC3.FirstName,'') + ' ', NULL) + coalesce(nullif(UC3.LastName,'') + ' - ', NULL) + nullif(UC3.email,''), NULL), ''), NULL)
					, COALESCE('Attendees: ' 
                                                           + COALESCE(coalesce('[Contact]' + NULLIF(CONCAT_WS(' ',nullif(UC1.FirstName,''),nullif(UC1.LastName,'')),''), NULL),NULL)
                                                           + COALESCE(' - ' + coalesce('[Candidate]' + NULLIF(CONCAT_WS(' ',nullif(UC2.FirstName,''),nullif(UC2.LastName,'')),''), NULL),NULL),NULL
					          )
--					, coalesce('Lead: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL) + coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL)				
--					, coalesce('Reminder: ' + NULLIF(convert(nvarchar(max),a.notificationMinutes), ''), NULL)
--					, coalesce('Opportunity: ' + NULLIF(convert(nvarchar(max),j2.title), ''), NULL)					
--					, coalesce('File Name: ' + NULLIF(convert(nvarchar(max),af.name), ''), NULL)
					
				) as [content] 
       from bullhorn1.View_Appointment a
       left join bullhorn1.View_AppointmentFile af on af.appointmentID = a.appointmentID
       left join bullhorn1.BH_Client Cl on Cl.userID = a.ClientUserID
       left join bullhorn1.BH_UserContact UC1 ON UC1.userID = Cl.userID
       left join bullhorn1.BH_UserContact UC2 ON UC2.userID = a.candidateUserID
       left join bullhorn1.BH_UserContact UC3 ON UC3.userID = a.userID
       left join bullhorn1.BH_UserContact UC4 ON UC4.userID = a.LeaduserID
       left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
       left join bullhorn1.BH_JobPosting j2 on j.jobPostingID = a.opportunityJobPostingID
       where Cl.clientID is not null and (Cl.isdeleted &lt;&gt; 1 and Cl.status &lt;&gt; 'Archive')-- and uc1.userID=11693


UNION ALL

	select ---top 20 
                Cl.clientID as 'contact_id' --,concat(UC1.firstName,' ',UC1.lastName) as fullname
              , a.dateAdded
              , concat_ws(char(10), '*** TASK: '
                        , coalesce('Candidate: ' + NULLIF(coalesce(coalesce(nullif(UC2.FirstName,'') + ' ', NULL) + coalesce(nullif(UC2.LastName,'') + ' - ', NULL) + nullif(UC2.email,''), NULL), ''), NULL) --a.candidateUserID 
--                        , coalesce('Assigned To: ' + NULLIF(cast(a.childTaskOwners as nvarchar(max)), ''), NULL)
--                        , coalesce('Assigned To: ' + NULLIF(coalesce(coalesce(nullif(UC4.FirstName,'') + ' ', NULL) + coalesce(nullif(UC4.LastName,'') + ' - ', NULL) + nullif(UC4.email,''), NULL), ''), NULL) --a.userID
                        , coalesce('Contact: ' + NULLIF(coalesce(coalesce(nullif(UC1.FirstName,'') + ' ', NULL) + coalesce(nullif(UC1.LastName,'') + ' - ', NULL) + nullif(UC1.email,''), NULL), ''), NULL) --a.clientUserID 
                        , coalesce('Due Date And Time: ' + NULLIF(convert(nvarchar(max), a.dateBegin, 120), ''), NULL)
--                        , coalesce('Date End: ' + NULLIF(convert(nvarchar(max),a.dateEnd, 120), ''), NULL)
--                        , coalesce('Job: ' + NULLIF(cast(j.title as nvarchar(max)), ''), NULL) --jobPostingID
--                        , coalesce('Lead: ' + NULLIF(coalesce(coalesce(nullif(UC3.FirstName,'') + ' ', NULL) + coalesce(nullif(UC3.LastName,'') + ' - ', NULL) + nullif(UC3.email,''), NULL), ''), NULL) --a.leadUserID
--                        , coalesce('Reminder: ' + NULLIF(cast(a.notificationMinutes as nvarchar(max)), ''), NULL)
--                        , coalesce('Opportunity: ' + NULLIF(cast(a.opportunityJobPostingID as nvarchar(max)), ''), NULL)
--                        , coalesce('Placement: ' + NULLIF(cast(a.placementID as nvarchar(max)), ''), NULL)
--                        , coalesce('Priority: ' + NULLIF(cast(a.priority as nvarchar(max)), ''), NULL)
--                        , coalesce('Visibility: ' + NULLIF(cast(a.isPrivate as nvarchar(max)), ''), NULL)
--                        , coalesce('Subject: ' + NULLIF(cast(a.subject as nvarchar(max)), ''), NULL)
--                        , coalesce('Type: ' + NULLIF(cast(a.type as nvarchar(max)), ''), NULL)
--                        , coalesce(char(10) + 'Description: ' + [bullhorn1].[fn_ConvertHTMLToText](NULLIF(convert(nvarchar(max),a.description), '')), NULL)
                ) as [content] 
        from bullhorn1.View_Task a
        left join bullhorn1.BH_Client Cl on Cl.userID = a.ClientUserID
        left join bullhorn1.BH_UserContact UC1 ON Cl.userID = UC1.userID
        left join bullhorn1.BH_UserContact UC2 ON a.candidateUserID = UC2.userID
--        left join bullhorn1.BH_JobPosting j on j.jobPostingID = a.jobPostingID
--        left join bullhorn1.BH_UserContact UC3 ON a.leadUserID = UC3.userID
--        left join bullhorn1.BH_UserContact UC4 ON a.userID = UC4.userID
        where Cl.clientID is not null and (Cl.isdeleted &lt;&gt; 1 and Cl.status &lt;&gt; 'Archive')
)

select --top 100
                   concat('TRCT', contact_id) as ContactExtId
                  , -10 as user_account_id
                  , 'comment' as 'category'
                  , 'contact' as [type]
                  , dateAdded as insert_timestamp
                  , content
from comments
order by contact_id --3689</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>Y</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Contact Document 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>SELECT 'contact' as Category
, concat('TRCT',Cl.clientid) as ContactExtID
, concat(F.clientContactFileID, F.fileExtension) as UploadedName
, case when right(F.name, charindex('.', reverse(name))) = F.fileExtension then F.Name
	else concat(F.name, F.fileExtension) end as RealName
, F.dateadded as created
, 'document' as document_type
from bullhorn1.View_ClientContactFile F 
left join bullhorn1.BH_Client Cl on Cl.userid = F.clientcontactuserid 
where F.fileExtension in ('.pdf','.doc','.rtf','.xls','.xlsx','.docx','.png','.jpg','.jpeg','.gif','.bmp','.msg','.docx','.txt','.htm','.html') --18 rows</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Contact location 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with contactloc as (
        select clientID
		, cl.clientCorporationID
		, uc.address1
		, uc.address2
		, uc.city
		, uc.state
		, uc.zip
		, uc.countryID
		, tc.COUNTRY
		, tc.ABBREVIATION
		, row_number() over(partition by cl.clientCorporationID order by lower(concat(uc.address1, uc.address2, city, state, zip, tc.COUNTRY))) as rn
        from bullhorn1.BH_Client cl
        left join bullhorn1.BH_UserContact uc ON cl.userID = uc.userID
        left join tmp_country tc on tc.CODE = uc.countryID
        where 1=1
        and (uc.address1 &lt;&gt; '' or uc.address2 &lt;&gt; '')
)
--CONTACT LOCATION AS COMPANY LOCATION
select concat('TRCT', clientID) as ContactExtId
	, concat('TRCP', clientCorporationID) as CompanyExtId
	, left(concat_ws(', ', nullif(address1,''), nullif(address2,''), nullif(city,''), nullif(state,'')
			, nullif(zip,''), nullif(COUNTRY,'')),300) as locationName
	, left(concat_ws(', ', nullif(address1,''), nullif(address2,''), nullif(city,''), nullif(state,'')
			, nullif(zip,''), nullif(COUNTRY,'')),300) as locationAddress
	, city as city
	, state as [state]
	, zip as post_code
	, ABBREVIATION as country_code
	, COUNTRY as country
	, 'PERSONAL_ADDRESS' as location_type
	, getdate() as insert_timestamp
	, concat('TRCT', clientID) as note --combination of contact-company IDs
from contactloc
where 1=1
--and clientID =1305</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1040</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Contact lookup.con</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>pd.client_contact_id</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>first_name</name>
        <rename>client_first_name</rename>
        <default/>
        <type>String</type>
      </value>
      <value>
        <name>last_name</name>
        <rename>client_last_name</rename>
        <default/>
        <type>String</type>
      </value>
      <value>
        <name>department</name>
        <rename>client_department</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>832</xloc>
      <yloc>2160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>DB industry</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select DISTINCT ownerShip as industry
, getdate() as insert_timestamp
from bullhorn1.BH_ClientCorporation 
where nullif(ownerShip,'') is not null
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>positionexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCJobID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateid</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCandidateID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateextid</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Database lookup 2 3 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateextid</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_candidate_id</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1136</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Extract Candidate_Contact Documents</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>SELECT 'candidateUserID' as Category
		, concat('TRCD', c.candidateid) as CandidateExtID
		, concat(F.candidateFileID, F.fileExtension) as UploadedName
		, case when right(F.name, charindex('.', reverse(F.name))) = F.fileExtension then F.Name
		else concat(F.name, F.fileExtension) end as RealName
		, F.dateadded as created
		from bullhorn1.View_CandidateFile F 
		left join bullhorn1.Candidate C on C.userid = F.candidateuserid
		WHERE F.fileExtension in ('.pdf','.doc','.rtf','.xls','.xlsx','.docx','.png','.jpg','.jpeg','.gif','.bmp','.msg','.docx','.txt','.htm','.html')
		--and c.candidateid=15237
--select top 10 * from candidate
UNION

SELECT 'placementUserID'
	, concat('TRCD', c.candidateid) as CandidateExtID
	, concat(placementFileID, fileExtension) as UploadedName
	, case when right(F.name, charindex('.', reverse(F.name))) = F.fileExtension then F.Name
		else concat(F.name, F.fileExtension) end as RealName
		, F.dateadded as created
	from bullhorn1.View_PlacementFile F
	left join bullhorn1.Candidate C on C.userid = F.userid
	WHERE fileExtension in ('.pdf','.doc','.rtf','.xls','.xlsx','.docx','.png','.jpg','.jpeg','.gif','.bmp','.msg','.docx','.txt','.htm','.html')
	--and c.candidateid=15237</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1008</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Extract company document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>SELECT 'company' as category
, concat('TRCP',clientCorporationID) as CompanyExtID
, concat(F.clientCorporationFileID,F.fileExtension) as UploadedName
, case when right(F.name, charindex('.', reverse(name))) = F.fileExtension then F.Name
	else concat(F.name, F.fileExtension) end as RealName
, F.dateadded as created
from bullhorn1.BH_ClientCorporationFile F where F.fileExtension in ('.pdf','.doc','.rtf','.xls','.xlsx','.docx','.png','.jpg','.jpeg','.gif','.bmp','.msg','.docx','.txt','.htm','.html') --57 rows</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Extract job document</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>SELECT 'job' as Category
, concat('TRJ',jobPostingID) as JobExtID
, concat(jobPostingFileID, fileExtension) as UploadedName
, case when right(F.name, charindex('.', reverse(name))) = F.fileExtension then F.Name
	else concat(F.name, F.fileExtension) end as RealName
, F.dateadded as created
, 'job_description' as document_type 
from bullhorn1.View_JobPostingFile F
where fileExtension in ('.pdf','.doc','.rtf','.xls','.xlsx','.docx','.png','.jpg','.jpeg','.gif','.bmp','.msg','.docx','.txt','.htm','.html') --0 rows</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>FeeForecast for placement details</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>offer</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>use_quick_fee_forecast</name>
        <rename>use_quick_fee_forecast</rename>
      </value>
      <value>
        <name>percentage_of_annual_salary</name>
        <rename>percentage_of_annual_salary</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>1952</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Index Candidate Activity</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <sql>SELECT id
, candidate_id
, insert_timestamp
from activity
where candidate_id is not NULL and candidate_id > 0</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Index Contact Activity</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <sql>SELECT id
, contact_id
, insert_timestamp
from activity
where contact_id is not NULL and contact_id > 0</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Index Job Activity</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <sql>SELECT id
, position_id
, insert_timestamp
from activity
where position_id is not NULL and position_id > 0</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert - Contact Comment 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>contact_id</column_name>
        <stream_name>VCContactID</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert contact current location</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema/>
    <table>common_location</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>state</column_name>
        <stream_name>state</stream_name>
      </field>
      <field>
        <column_name>city</column_name>
        <stream_name>city</stream_name>
      </field>
      <field>
        <column_name>post_code</column_name>
        <stream_name>post_code</stream_name>
      </field>
      <field>
        <column_name>address</column_name>
        <stream_name>locationAddress</stream_name>
      </field>
      <field>
        <column_name>location_name</column_name>
        <stream_name>locationName</stream_name>
      </field>
      <field>
        <column_name>country_code</column_name>
        <stream_name>country_code</stream_name>
      </field>
      <field>
        <column_name>country</column_name>
        <stream_name>country</stream_name>
      </field>
      <field>
        <column_name>note</column_name>
        <stream_name>note</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1104</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert new industry</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>name</name>
        <rename>industry</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1152</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Insert offer personal Info</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>offer_personal_info</table>
      <key>
        <name>VCOfferID</name>
        <field>offer_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>offer_id</name>
        <rename>VCOfferID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>last_name</name>
        <rename>c.last_name</rename>
        <update>Y</update>
      </value>
      <value>
        <name>first_name</name>
        <rename>c.first_name</rename>
        <update>Y</update>
      </value>
      <value>
        <name>email</name>
        <rename>c.email</rename>
        <update>Y</update>
      </value>
      <value>
        <name>client_company_id</name>
        <rename>pd.company_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>client_company_name</name>
        <rename>com.client_company_name</rename>
        <update>Y</update>
      </value>
      <value>
        <name>client_contact_id</name>
        <rename>pd.client_contact_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>client_contact_name</name>
        <rename>client_contact_name</rename>
        <update>Y</update>
      </value>
      <value>
        <name>client_department</name>
        <rename>client_department</rename>
        <update>Y</update>
      </value>
      <value>
        <name>note</name>
        <rename>PlacementNote</rename>
        <update>Y</update>
      </value>
      <value>
        <name>tax_rate</name>
        <rename>tax_rate</rename>
        <update>Y</update>
      </value>
      <value>
        <name>export_data_to</name>
        <rename>export_data_to</rename>
        <update>Y</update>
      </value>
      <value>
        <name>net_total</name>
        <rename>net_total</rename>
        <update>Y</update>
      </value>
      <value>
        <name>invoice_total</name>
        <rename>invoice_total</rename>
        <update>Y</update>
      </value>
      <value>
        <name>start_date</name>
        <rename>StartDate</rename>
        <update>Y</update>
      </value>
      <value>
        <name>placed_date</name>
        <rename>PlacementDate</rename>
        <update>Y</update>
      </value>
      <value>
        <name>offer_date</name>
        <rename>PlacementDate</rename>
        <update>Y</update>
      </value>
      <value>
        <name>invoice_message</name>
        <rename>InvoiceNote</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1216</xloc>
      <yloc>2160</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Job Activity Table</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema/>
    <table>activity_job</table>
    <commit>100</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>activity_id</column_name>
        <stream_name>id</stream_name>
      </field>
      <field>
        <column_name>job_id</column_name>
        <stream_name>position_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>752</xloc>
      <yloc>864</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Job activity</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>position_id</column_name>
        <stream_name>actual_id</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>768</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Job lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>JobExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCJobID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
      <value>
        <name>company_id</name>
        <rename>pd.company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
      <value>
        <name>contact_id</name>
        <rename>pd.client_contact_id</rename>
        <default/>
        <type>Integer</type>
      </value>
      <value>
        <name>position_type</name>
        <rename>pd.position_type</rename>
        <default/>
        <type>None</type>
      </value>
      <value>
        <name>currency_type</name>
        <rename>pd.currency_type</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>432</xloc>
      <yloc>1696</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Job lookup 3</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>JobExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_id</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>JobApp From OFFERED Stage</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with ja as (
	select jr.jobPostingID
	, ca.candidateID
	, case when jp.employmentType is null then 301
		when JP.employmentType in ('Permanent','Opportunity','FT','Perm') then 301
		when JP.employmentType in ('Contract','Fixed Term','Temp','Temporary') then 302
		--when JP.employmentType in ('Temporary','Temp to Perm') then 303 --no more temp type
		else null end as JobType
	, case 
				when jr.status = '1st Interview' then 3
                when jr.status = '2nd Interview' then 4
                when jr.status = 'Candidate Rejected' then 1
                when jr.status = 'Client Rejected' then 2
                when jr.status = 'CV Sent' then 2
                when jr.status = 'Final Interview' then 4
                when jr.status = 'New Submission' then 1
                when jr.status = 'Offer Extended' then 5
                when jr.status = 'Offer Rejected' then 5
                when jr.status = 'Placed,Prescreen' then 6
                when jr.status = 'Shortlisted,Submitted' then 1
                else 0  
	end as stage
	, case when jr.status in ('Candidate Rejected', 'Client Rejected','Offer Rejected') then 'REJECTED'
		else NULL end as rejected
	, jr.status as substatus
	, jr.dateAdded
	, concat('JR', jr.jobResponseID) as referenceId --for updating placement purpose
	from bullhorn1.BH_JobResponse jr
	left join (select c.candidateID, c.userID as CandidateUserID, uc.userID, uc.name, uc.email as candidate_email
						from bullhorn1.Candidate c
						left join bullhorn1.BH_UserContact uc on c.userID = uc.userID) ca on ca.CandidateUserID = jr.userID
	left join bullhorn1.BH_JobPosting jp on jp.jobPostingID = jr.jobPostingID

	UNION ALL
--PLACEMENT
	select pl.jobPostingID
	, ca.candidateID
	, case when jp.employmentType is null then 301
		when JP.employmentType in ('Permanent','Opportunity','Perm','FT') then 301
		when JP.employmentType in ('Contract','Fixed Term','Temp','Temporary') then 302
		--when JP.employmentType in ('Temporary','Temp to Perm') then 303 --no more temp type
		else null end as JobType
	, 6 as stage
	, NULL as rejected
	, 'PLACED' as substatus
	, pl.dateAdded --can be used as placed date / offered date
	, concat('PL', pl.placementID) --for updating placement purpose
	from bullhorn1.BH_Placement pl
	left join (select c.candidateID, c.userID as CandidateUserID, uc.userID, uc.name, uc.email as candidate_email
						from bullhorn1.Candidate c
						left join bullhorn1.BH_UserContact uc on c.userID = uc.userID) ca on ca.CandidateUserID = pl.userID
	left join bullhorn1.BH_JobPosting jp on jp.jobPostingID = pl.jobPostingID
)

, higheststage as (select jobPostingID
		, candidateID
		, JobType
		, stage
		, rejected
		, substatus
		, dateAdded
		, row_number() over (partition by jobPostingID, candidateID order by stage desc, dateadded desc) as rn --highest stage first then latest date
		, referenceId
		from ja
		where stage > 0
)

select concat('TRJ', h.jobPostingID) as JobExtId
, concat('TRCD', candidateID) as CandidateExtId
, JobType as PlacedStage
, p.placementID
, p.dateBegin
, case 
		when Stage = 6 then 'OFFERED' --to be updated as PLACED afterward
		when Stage = 5 then 'OFFERED'
		when Stage = 4 then 'SECOND_INTERVIEW'
		when Stage = 3 then 'FIRST_INTERVIEW'
		when Stage = 2 then 'SENT'
		when Stage = 1 then 'SHORTLISTED'
		end as stage
, h.dateAdded
, case when rejected is not NULL then h.dateAdded
	else NULL end as rejected_date
, 0 as invoice_total
, dateBegin as StartDate
, dateClientEffective as PlacementDate --Placeme
, referenceId
, -10 as Latest_user_id
, getdate() as latest_update_date
, 3 as draft_offer --used to move OFFERED to PLACED in VC [offer]
, 2 as InvoiceStatus --used to update invoice status in VC [invoice] as 'active'
, 1 as renewal_index --default value in VC [invoice]
, 1 as renewal_flow_status
, 0 as tax_rate
, 'other' as export_data_to
, 0 as net_total
, 0 as other_invoice_items_totalntDate
, case when dateEffective is NULL then dateClientEffective
	else dateEffective end as PlacedDate--PlacedDate
, 1 as use_quick_fee_forecast
, case when fee = 0 then 100
	else fee * 100 end percentage_of_annual_salary --quick fee %
, coalesce(concat_ws(char(10)
--        , coalesce('Invoice Frequency: ' + nullif(convert(nvarchar(max),billingFrequency),''), NULL)
--	, coalesce('Invoicing Contact: ' + NULLIF(coalesce(coalesce(nullif(uc.FirstName,'') + ' ', NULL) + coalesce(nullif(uc.LastName,'') + ' - ', NULL) + nullif(uc.email,''), NULL), ''), NULL)
--	, coalesce('Invoice Rate: ' + nullif(convert(nvarchar(max),p.clientBillRate),''), NULL) --client charge rate | Charge Rate for contract
	, coalesce('Invoice Rate (Over-time): ' + nullif(convert(nvarchar(max),p.clientOvertimeRate),''), NULL)
	, coalesce('Comments: ' + nullif(convert(nvarchar(max),[bullhorn1].[fn_ConvertHTMLToText](comments)),''), NULL)
--	, coalesce('Start Date: ' + nullif(convert(nvarchar(max),p.dateBegin),''), NULL)
	, coalesce('Bill Effective Date (Client): ' + nullif(convert(nvarchar(max),p.dateClientEffective),''), NULL)
	, coalesce('Pay Effective Date (Candidate): ' + nullif(convert(nvarchar(max),p.dateEffective),''), NULL)
--	, coalesce('Scheduled End Date: ' + nullif(convert(nvarchar(max),p.dateEnd),''), NULL)
--	, coalesce('Employee Type: ' + nullif(p.employeeType,''), NULL)
--	, coalesce('Placement Fee (%): ' + nullif(convert(nvarchar(max),p.fee),''), NULL)
--	, coalesce('Mark-up %: ' + nullif(convert(nvarchar(max),jp.markupPercentage),''), NULL)
--	, coalesce('Pay Rate: ' + nullif(convert(nvarchar(max),p.payRate),''), NULL)
--	, coalesce('Salary: ' + nullif(convert(nvarchar(max),p.salary),''), NULL)
--	, coalesce('Referral Fee Type: ' + nullif(referralFeeType,''), NULL)
	), 'This offer/ placement details from data migration') as PlacementNote
, coalesce('Invoice Frequency: ' + nullif(convert(nvarchar(max),billingFrequency),''), NULL) as InvoiceNote,

        case when JobType=301 then p.salary else p.payRate end as Payrate,
		case when JobType=301 then p.salary*fee end as Perprofit,
--        jp.payRate as positioncontractPayrate,
        cast(case
                when p.salaryUnit='Per Hour' then '1'
                when p.salaryUnit='Per Day' then '2'
                when p.salaryUnit='Per Week' then '3'
                when p.salaryUnit='Per Month' then '4'         
                when p.salaryUnit='Per Annum' then '5'
                else null
        end as integer) as salaryUnit,
--        case
--                when jp.salaryUnit='Per Hour' then DATEDIFF(hour, dateBegin, p.dateEnd)
--                when jp.salaryUnit='Per Day' then DATEDIFF(day,dateBegin,p.dateEnd)
--                when jp.salaryUnit='Per Week' then DATEDIFF(week, dateBegin,p.dateEnd)
--                when jp.salaryUnit='Per Month' then DATEDIFF(month,dateBegin,p.dateEnd)       
--                when jp.salaryUnit='Per Annum' then DATEDIFF(year,dateBegin,p.dateEnd)
--                else null
--        end as contractlength,
        cast(case
                when p.salaryUnit='Per Hour' then '1'
                when p.salaryUnit='Per Day' then '2'           
                when p.salaryUnit='Per Week' then '3'
                when p.salaryUnit='Per Month' then '4'
                when p.salaryUnit='Per Annum' then '4'
                else null
        end as integer) as timeinterval,
        
        p.clientBillRate as Chargerate,
        p.clientBillRate-p.payRate as ProfitMargin,
        case when (p.payRate)&lt;&gt;0 and (p.payRate) is not null then (p.clientBillRate-p.payRate)/p.payRate*100  else 0 end  as markupPercentage,
        case when (p.clientBillRate)&lt;&gt;0 and (p.clientBillRate) is not null then (p.payRate*jp.markupPercentage)/(p.clientBillRate)*100  else 0 end as Margin
from higheststage h
left join bullhorn1.BH_Placement p on concat('PL',p.placementID) = h.referenceId
left join bullhorn1.BH_UserContact uc on p.billingUserID = uc.userID
left join bullhorn1.BH_JobPosting jp on jp.jobPostingID=h.jobPostingID
where rn = 1
and stage >= 5
and p.placementID is not NULL
--and candidateID=15250
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>1808</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>JobApp PLACED status</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with ja as (
	select jr.jobPostingID
	, ca.candidateID
	, case when jp.employmentType is null then 301
		when JP.employmentType in ('Permanent','Opportunity','FT','Perm') then 301
		when JP.employmentType in ('Contract','Fixed Term','Temp','Temporary') then 302
		--when JP.employmentType in ('Temporary','Temp to Perm') then 303 --no more temp type
		else null end as JobType
	, case 
				when jr.status = '1st Interview' then 3
                when jr.status = '2nd Interview' then 4
                when jr.status = 'Candidate Rejected' then 1
                when jr.status = 'Client Rejected' then 2
                when jr.status = 'CV Sent' then 2
                when jr.status = 'Final Interview' then 4
                when jr.status = 'New Submission' then 1
                when jr.status = 'Offer Extended' then 5
                when jr.status = 'Offer Rejected' then 5
                when jr.status = 'Placed,Prescreen' then 6
                when jr.status = 'Shortlisted,Submitted' then 1
                else 0  
	end as stage
	, case when jr.status in ('Candidate Rejected', 'Client Rejected','Offer Rejected') then 'REJECTED'
		else NULL end as rejected
	, jr.status as substatus
	, jr.dateAdded
	, concat('JR', jr.jobResponseID) as referenceId --for updating placement purpose
	from bullhorn1.BH_JobResponse jr
	left join (select c.candidateID, c.userID as CandidateUserID, uc.userID, uc.name, uc.email as candidate_email
						from bullhorn1.Candidate c
						left join bullhorn1.BH_UserContact uc on c.userID = uc.userID) ca on ca.CandidateUserID = jr.userID
	left join bullhorn1.BH_JobPosting jp on jp.jobPostingID = jr.jobPostingID

	UNION ALL
--PLACEMENT
	select pl.jobPostingID
	, ca.candidateID
	, case when jp.employmentType is null then 301
		when JP.employmentType in ('Permanent','Opportunity','FT','Perm') then 301
		when JP.employmentType in ('Contract','Fixed Term','Temp','Temporary') then 302
		--when JP.employmentType in ('Temporary','Temp to Perm') then 303 --no more temp type
		else null end as JobType
	, 6 as stage
	, NULL as rejected
	, 'PLACED' as substatus
	, pl.dateAdded --can be used as placed date / offered date
	, concat('PL', pl.placementID) --for updating placement purpose
	from bullhorn1.BH_Placement pl
	left join (select c.candidateID, c.userID as CandidateUserID, uc.userID, uc.name, uc.email as candidate_email
						from bullhorn1.Candidate c
						left join bullhorn1.BH_UserContact uc on c.userID = uc.userID) ca on ca.CandidateUserID = pl.userID
	left join bullhorn1.BH_JobPosting jp on jp.jobPostingID = pl.jobPostingID
	)

, higheststage as (select jobPostingID
		, candidateID
		, JobType
		, stage
		, rejected
		, substatus
		, dateAdded
		, row_number() over (partition by jobPostingID, candidateID order by stage desc, dateadded desc) as rn --highest stage first then latest date
		, referenceId
		from ja
		where stage > 0)

select concat('TRJ', jobPostingID) as JobExtId
, concat('TRCD', candidateID) as CandidateExtId
, JobType as PlacedStage
, case 
		when Stage = 6 then 'OFFERED' --to be updated as PLACED afterward
		when Stage = 5 then 'OFFERED'
		when Stage = 4 then 'SECOND_INTERVIEW'
		when Stage = 3 then 'FIRST_INTERVIEW'
		when Stage = 2 then 'SENT'
		when Stage = 1 then 'SHORTLISTED'
		end as stage
, dateAdded
, case when rejected is not NULL then dateAdded
	else NULL end as rejected_date
, referenceId
, 3 as draft_offer --used to move OFFERED to PLACED in VC [offer]
, 2 as InvoiceStatus --used to update invoice status in VC [invoice] as 'active'
, 1 as renewal_index --default value in VC [invoice]
, 1 as renewal_flow_status
from higheststage
where rn = 1
and stage = 6</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>64</xloc>
      <yloc>1696</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Offer</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>offer</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCOfferID</rename>
        <default/>
        <type>Integer</type>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <default/>
        <type>None</type>
      </value>
      <value>
        <name>valid</name>
        <rename>valid</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>832</xloc>
      <yloc>1952</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Position Candidate</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>position_candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>VCJobID</name>
        <field>position_description_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCCandidateID</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCJobAppID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>1808</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select --top 10
         concat('TRCP', CC.clientCorporationID) as 'CompanyExtId' 
        , trim(stuff( coalesce(' ' + nullif(CC.billingAddress1, ''), '') + coalesce(', ' + nullif(CC.billingAddress2, ''), '') 
                        + coalesce(', ' + nullif(CC.billingCity, ''), '') + coalesce(', ' + nullif(CC.billingState, ''), '') 
                        + coalesce(', ' + nullif(CC.billingZip, ''), '') + coalesce(', ' + nullif(tc.country, ''), '') , 1, 1, '') ) as 'company-locationAddress'  
        , trim(stuff( coalesce(' ' + nullif(CC.billingAddress1, ''), '') + coalesce(', ' + nullif(CC.billingAddress2, ''), '') 
                        + coalesce(', ' + nullif(CC.billingCity, ''), '') + coalesce(', ' + nullif(CC.billingState, ''), '') 
                        + coalesce(', ' + nullif(CC.billingZip, ''), '') + coalesce(', ' + nullif(tc.country, ''), '') , 1, 1, '') ) as 'company-locationName'  
		, 'Billing_Address' as location_type
        , CC.billingCity as 'companylocationCity'
        , CC.billingState as 'companylocationState'
        , CC.billingZip as 'companylocationZipCode'
        , tc.abbreviation as 'companylocationCountry'
        , CC.dateadded as 'registrationdate'
		, tc.country
from bullhorn1.BH_ClientCorporation CC
left join tmp_country tc ON CC.countryID = tc.code
where CC.status &lt;&gt; 'Archive';

/*select concat('TRCP', CC.clientCorporationID) as CompanyExtId
	, left(concat_ws(', ', nullif(billingAddress1,''), nullif(billingAddress2,''), nullif(cc.billingCity,''), nullif(cc.billingState,'')
			, nullif(cc.billingZip,''), nullif(tc.COUNTRY,'')),300) as locationName
	, left(concat_ws(', ', nullif(billingAddress1,''), nullif(billingAddress2,''), nullif(cc.billingCity,''), nullif(cc.billingState,'')
			, nullif(cc.billingZip,''), nullif(tc.COUNTRY,'')),300) as locationAddress
	, 'BILLING_ADDRESS' as location_type
	, getdate() as insert_timestamp
	, cc.billingState as [state]
	, cc.billingZip as post_code
	, cc.billingCity as city
from bullhorn1.BH_ClientCorporation cc
left join tmp_country tc ON CC.billingCountryID = tc.code
where billingAddress1 &lt;&gt; '' or billingAddress2 &lt;&gt; '' or billingCountryID &lt;&gt; '';*/</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with placementinfo as (
select  concat('TRJ',a.jobPostingID) as positionexternalId,
        a.markupPercentage*100 as markupPercentage,
        case when a.employmentType is null then 'PERMANENT'
	       when a.employmentType in ('Temporary','Fixed Term','Temp','Contract') then 'CONTRACT'
	       when a.employmentType in ('Opportunity','Permanent','FT,Perm') then 'PERMANENT'
	       else '' 
        end as positiontype,
        a.salary as positionactualSalary,
		a.payRate as positioncontractPayrate,
        case
                when a.salaryUnit='Per Hour' then '1'
                when a.salaryUnit='Per Day' then '2'
                when a.salaryUnit='Per Week' then '3'
                when a.salaryUnit='Per Month' then '4'         
                when a.salaryUnit='Per Annum' then '5'
                else null
        end as salaryUnit,
        case
                when a.salaryUnit='Per Hour' then '1'
                when a.salaryUnit='Per Day' then '2'           
                when a.salaryUnit='Per Week' then '3'
                when a.salaryUnit='Per Month' then '4'
                when a.salaryUnit='Per Annum' then '4'
                else null
        end as timeinterval,
        a.payRate*a.markupPercentage as ProfitMargin,
        a.payRate*a.markupPercentage+a.payRate as Chargerate,
        case when (a.payRate*a.markupPercentage+a.payRate)&lt;&gt;0 and  (a.payRate*a.markupPercentage+a.payRate) is not null then (a.payRate*a.markupPercentage)/(a.payRate*a.markupPercentage+a.payRate)*100  else 0 end as Margin
from bullhorn1.BH_JobPosting a 
where (a.isdeleted &lt;&gt; 1 and a.status &lt;&gt; 'Archive')
--and a.jobPostingID=67
) 
select positionexternalId,markupPercentage,positioncontractPayrate,cast(salaryUnit as integer) as salaryUnit,cast(timeinterval as integer) as timeinterval,ProfitMargin,Chargerate,Margin
from placementinfo 
where positiontype='CONTRACT'
--and salaryUnit='Per Annum'
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 2 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select
         concat('TRCD', c.candidateID) as candidateexternalId
	, nullif(c.nickName,'') as nickName
	, C.dayRate as desiredcontracrate
	, C.dayRateLow as contractrate
from bullhorn1.Candidate C 
where C.isdeleted &lt;&gt; 1 and C.status &lt;&gt; 'Archive'
--and c.nickName is not null
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 3</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with description as (
        select userid, [bullhorn1].[fn_ConvertHTMLToText](description) as description 
        from bullhorn1.BH_UserContact
), commentlist as ( --LATEST COMMENT
        SELECT userid, comments, dateAdded
			, r1 = ROW_NUMBER() OVER (PARTITION BY userid ORDER BY dateAdded desc)
		FROM bullhorn1.BH_UserComment 
), lastcomment as (
        select userid, comments, dateAdded
        from commentlist
        where r1=1
)
SELECT --top 100 
        CONCAT('TRCD',CA.candidateid) as candidateid
         , CONCAT_WS('&lt;br/>',
                coalesce('BH Candidate ID: ' + nullif(cast(CA.userID as varchar(max)), ''), NULL)
                , coalesce('General Comments: ' + nullif(convert(varchar(max),CA.comments), ''), NULL)
                , coalesce('Date available: ' + nullif(convert(nvarchar(10),ca.dateAvailable,120), ''), NULL)
                , coalesce('CV: ' + nullif(UC1.description, ''), NULL)
                , coalesce('Desired Hourly Rate: ' + nullif(cast(ca.hourlyRate as varchar(max)), ''), NULL)
                , coalesce('Current Hourly Rate: ' + nullif(cast(ca.hourlyRateLow as varchar(max)), ''), NULL)
                , coalesce('Latest Comment: ' + nullif(dbo.RemoveNullCharacters([bullhorn1].[fn_ConvertHTMLToText](lc.comments)), ''), NULL)
                , coalesce('Status: ' + nullif(convert(varchar(max),CA.Status), ''), NULL)
                ) as note
from bullhorn1.Candidate ca
left join lastcomment lc on lc.userid = CA.userid
left join description UC1 on UC1.userid = CA.userid
where isdeleted &lt;&gt; 1 and status &lt;&gt; 'Archive'
--and CA.candidateid=15462
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 3 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with history as (
       SELECT userId
         , STRING_AGG(
                     REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE( REPLACE( 
                     REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE( REPLACE( 
                     REPLACE( REPLACE( REPLACE( REPLACE( REPLACE(REPLACE( REPLACE( REPLACE( REPLACE( 
                            concat_ws('&lt;br/>'
                                        , coalesce('Client Corporation: ' + nullif(cast(clientCorporationID as nvarchar(max)), ''), NULL)
                                        , coalesce('Company Name: ' + nullif(cast(companyName as nvarchar(max)), ''), NULL)
                                        , coalesce('Date Added: ' + nullif(convert(nvarchar(10), dateAdded, 120), ''), NULL)
                                        , coalesce('Comments: ' + nullif(cast(comments as nvarchar(max)), ''), NULL)
                                        , coalesce('Salary Low: ' + nullif(cast(salary1 as nvarchar(max)), ''), NULL)
                                        , coalesce('Salary High: ' + nullif(cast(salary2 as nvarchar(max)), ''), NULL)
                                        , coalesce('Job Title: ' + nullif(cast(title as nvarchar(max)), ''), NULL)
                            )
                     ,char(0x0000),'') ,char(0x0001),'') ,char(0x0002),'') ,char(0x0003),'') ,char(0x0004),'') 
                     ,char(0x0005),'') ,char(0x0006),'') ,char(0x0007),'') ,char(0x0008),'') ,char(0x000B),'') 
                     ,char(0x000C),'') ,char(0x000E),'') ,char(0x000F),'') ,char(0x0010),'') ,char(0x0011),'') 
                     ,char(0x0012),'') ,char(0x0013),'') ,char(0x0014),'') ,char(0x0015),'') ,char(0x0016),'') 
                     ,char(0x0017),'') ,char(0x0018),'') ,char(0x0019),'') ,char(0x001A),'') ,char(0x001B),'') 
                     ,char(0x001C),'') ,char(0x001D),'') ,char(0x001E),'') ,char(0x001F),'') --as eh
       ,'&lt;br/>&lt;br/>') WITHIN GROUP (ORDER BY startDate desc, dateAdded desc) eh
       FROM bullhorn1.BH_userWorkHistory 
       GROUP BY userId
)
select --top 100 
	CONCAT('TRCD',C.candidateID) as candidateID,h.eh
from bullhorn1.Candidate C 
left join history h on C.userID=h.userID
where isdeleted &lt;&gt; 1 and status &lt;&gt; 'Archive'
and eh is not null
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 4</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select --top 10
         concat('TRCP', CC.clientCorporationID) as companyexternalId
        , CC.dateadded as registrationdate
from bullhorn1.BH_ClientCorporation CC
where CC.status &lt;&gt; 'Archive' </sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>592</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>candidate</table>
      <key>
        <name>VCCandidateID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>note</name>
        <rename>note</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>752</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>candidate</table>
      <key>
        <name>VCCandidateID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>experience</name>
        <rename>eh</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>752</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update 3</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>lookup table</table>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1216</xloc>
      <yloc>2240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update App status</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>position_candidate</table>
      <key>
        <name>VCJobID</name>
        <field>position_description_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCCandidateID</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>status</name>
        <rename>PlacedStage</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>1616</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update Invoice</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>invoice</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCOfferID</name>
        <field>offer_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>position_candidate_id</name>
        <rename>VCJobAppID</rename>
      </value>
      <value>
        <name>offer_id</name>
        <rename>VCOfferID</rename>
      </value>
      <value>
        <name>status</name>
        <rename>InvoiceStatus</rename>
      </value>
      <value>
        <name>renewal_index</name>
        <rename>renewal_index</rename>
      </value>
      <value>
        <name>renewal_flow_status</name>
        <rename>renewal_flow_status</rename>
      </value>
      <value>
        <name>valid</name>
        <rename>valid</rename>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1008</xloc>
      <yloc>1952</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update Offer</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>offer</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>draft_offer</name>
        <rename>draft_offer</rename>
      </value>
      <value>
        <name>position_type</name>
        <rename>pd.position_type</rename>
      </value>
      <value>
        <name>currency_type</name>
        <rename>pd.currency_type</rename>
      </value>
      <value>
        <name>margin_percent</name>
        <rename>Margin</rename>
      </value>
      <value>
        <name>markup_percent</name>
        <rename>markupPercentage</rename>
      </value>
      <value>
        <name>charge_rate</name>
        <rename>Chargerate</rename>
      </value>
      <value>
        <name>pay_rate</name>
        <rename>Payrate</rename>
      </value>
      <value>
        <name>contract_rate_type</name>
        <rename>timeinterval</rename>
      </value>
      <value>
        <name>contract_length_type</name>
        <rename>salaryUnit</rename>
      </value>
      <value>
        <name>profit</name>
        <rename>ProfitMargin</rename>
      </value>
      <value>
        <name>use_quick_fee_forecast</name>
        <rename>use_quick_fee_forecast</rename>
      </value>
      <value>
        <name>percentage_of_annual_salary</name>
        <rename>percentage_of_annual_salary</rename>
      </value>
      <value>
        <name>projected_profit</name>
        <rename>Perprofit</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>832</xloc>
      <yloc>1728</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update Placed date</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>position_candidate</table>
      <key>
        <name>VCJobID</name>
        <field>position_description_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCCandidateID</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>hire_date</name>
        <rename>PlacedDate</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>432</xloc>
      <yloc>1824</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update Terminated Invoice</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>invoice</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCOfferID</name>
        <field>offer_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>position_candidate_id</name>
        <rename>VCJobAppID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>offer_id</name>
        <rename>VCOfferID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>status</name>
        <rename>InvoiceStatus</rename>
        <update>Y</update>
      </value>
      <value>
        <name>renewal_index</name>
        <rename>renewal_index</rename>
        <update>Y</update>
      </value>
      <value>
        <name>renewal_flow_status</name>
        <rename>renewal_flow_status</rename>
        <update>Y</update>
      </value>
      <value>
        <name>valid</name>
        <rename>valid</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>2048</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update [Invoice]</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>invoice</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCOfferID</name>
        <field>offer_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>position_candidate_id</name>
        <rename>VCJobAppID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>offer_id</name>
        <rename>VCOfferID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>status</name>
        <rename>InvoiceStatus</rename>
        <update>Y</update>
      </value>
      <value>
        <name>renewal_index</name>
        <rename>renewal_index</rename>
        <update>Y</update>
      </value>
      <value>
        <name>renewal_flow_status</name>
        <rename>renewal_flow_status</rename>
        <update>Y</update>
      </value>
      <value>
        <name>valid</name>
        <rename>valid</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>992</xloc>
      <yloc>1856</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update [Offer]</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>offer</table>
      <key>
        <name>VCJobAppID</name>
        <field>position_candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>draft_offer</name>
        <rename>draft_offer</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>832</xloc>
      <yloc>1808</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>VCContactID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>mobile_phone</name>
        <rename>mobile_phone</rename>
      </value>
      <value>
        <name>home_phone</name>
        <rename>home_phone</rename>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>reg_date</rename>
      </value>
      <value>
        <name>department</name>
        <rename>department</rename>
      </value>
      <value>
        <name>personal_email</name>
        <rename>personal_email</rename>
      </value>
      <value>
        <name>nick_name</name>
        <rename>nickname</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1312</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>VCContactID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>current_location_id</name>
        <rename>VCAddressID</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1392</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>company_location</table>
      <key>
        <name>VCCompanyID</name>
        <field>company_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>address</name>
        <rename>company-locationAddress</rename>
      </value>
      <value>
        <name>location_name</name>
        <rename>company-locationName</rename>
      </value>
      <value>
        <name>city</name>
        <rename>companylocationCity</rename>
      </value>
      <value>
        <name>state</name>
        <rename>companylocationState</rename>
      </value>
      <value>
        <name>post_code</name>
        <rename>companylocationZipCode</rename>
      </value>
      <value>
        <name>country_code</name>
        <rename>companylocationCountry</rename>
      </value>
      <value>
        <name>country</name>
        <rename>country</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>288</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <key>
        <name>VCCompanyID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>insert_timestamp</name>
        <rename>registrationdate</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>800</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 3</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>compensation</table>
      <key>
        <name>VCJobID</name>
        <field>position_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>markup_percent</name>
        <rename>markupPercentage</rename>
      </value>
      <value>
        <name>pay_rate</name>
        <rename>positioncontractPayrate</rename>
      </value>
      <value>
        <name>contract_length_type</name>
        <rename>salaryUnit</rename>
      </value>
      <value>
        <name>contract_rate_type</name>
        <rename>timeinterval</rename>
      </value>
      <value>
        <name>profit</name>
        <rename>ProfitMargin</rename>
      </value>
      <value>
        <name>charge_rate</name>
        <rename>Chargerate</rename>
      </value>
      <value>
        <name>margin_percent</name>
        <rename>Margin</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>320</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 3 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>VCCandidateID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>nickname</name>
        <rename>nickName</rename>
      </value>
      <value>
        <name>contract_rate</name>
        <rename>contractrate</rename>
      </value>
      <value>
        <name>desired_contract_rate</name>
        <rename>desiredcontracrate</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>320</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update job App status</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>position_candidate</table>
      <key>
        <name>VCJobID</name>
        <field>position_description_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCCandidateID</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>status</name>
        <rename>PlacedStage</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>1696</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>VC company_industry</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>company_industry</table>
      <key>
        <name>final_industry_id</name>
        <field>industry_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>final_company_id</name>
        <field>company_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>industry_id</name>
        <rename>final_industry_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>company_id</name>
        <rename>final_company_id</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1376</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>VC company_industry 2</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>public</schema>
      <table>contact_location</table>
      <key>
        <name>VCContactID</name>
        <field>contact_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>VCAddressID</name>
        <field>company_location_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>contact_id</name>
        <rename>VCContactID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>company_location_id</name>
        <rename>VCAddressID</rename>
        <update>Y</update>
      </value>
      <value>
        <name>insert_timestamp</name>
        <rename>insert_timestamp</rename>
        <update>Y</update>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1616</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate activities</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1296</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate activities 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema>public</schema>
    <table>activity</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>contactid</partitioning_field>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>candidate_id</column_name>
        <stream_name>actual_candidate_id</stream_name>
      </field>
      <field>
        <column_name>user_account_id</column_name>
        <stream_name>user_account_id</stream_name>
      </field>
      <field>
        <column_name>insert_timestamp</column_name>
        <stream_name>insert_timestamp</stream_name>
      </field>
      <field>
        <column_name>content</column_name>
        <stream_name>content</stream_name>
      </field>
      <field>
        <column_name>type</column_name>
        <stream_name>type</stream_name>
      </field>
      <field>
        <column_name>category</column_name>
        <stream_name>category</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1296</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>candidate_document 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>candidate_document</table>
      <key>
        <name>final_contact_id</name>
        <field>contact_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>UploadedName</name>
        <field>uploaded_filename</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>uploaded_filename</name>
        <rename>RealName</rename>
      </value>
      <value>
        <name>created</name>
        <rename>created</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>comp lookup 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CompanyExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCompanyID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1312</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>comp lookup 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CompanyExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCompanyID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>comp lookup 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>companyexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCompanyID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>704</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company industry</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select CONCAT('TRCP',BH_ClientCorporation.clientCorporationID) as clientCorporationID, BH_ClientCorporation.ownerShip as industry
from bullhorn1.BH_ClientCorporation 
where nullif(ownerShip,'') is not null
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>company location lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company_location</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>VCCompanyID</name>
        <field>company_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCAddressID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1456</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>ContactExtID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>final_contact_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>192</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>ContactExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCContactID</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1168</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCandidateID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 4</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>ContactExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>actual_contactid</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>704</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 5</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contactExtId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCContactID</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1168</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 6</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>ContactExtID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCContactID</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>784</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contactlocation lookup 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>common_location</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>ContactExtId</name>
        <field>note</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCAddressID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup candidateid</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CandidateExtID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>candidateid</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup company</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>clientCorporationID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>final_company_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1152</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup company_legal_document</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>company_legal_document</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>companyid</name>
        <field>company_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>legal_doc_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>736</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup companyid</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>company</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CompanyExtID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>companyid</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup industry</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>vertical</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>industry</name>
        <field>name</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>final_industry_id</rename>
        <default/>
        <type>None</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1264</xloc>
      <yloc>112</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>lookup jobid</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>position_description</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>JobExtID</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>jobid</rename>
        <default/>
        <type>BigNumber</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update candidate_document</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>200</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>candidate_document</table>
      <key>
        <name>candidateid</name>
        <field>candidate_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>UploadedName</name>
        <field>uploaded_filename</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>uploaded_filename</name>
        <rename>RealName</rename>
      </value>
      <value>
        <name>created</name>
        <rename>created</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1360</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update job_document</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>10000</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>candidate_document</table>
      <key>
        <name>UploadedName</name>
        <field>uploaded_filename</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>jobid</name>
        <field>position_description_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>uploaded_filename</name>
        <rename>RealName</rename>
      </value>
      <value>
        <name>created</name>
        <rename>created</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>1040</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>update legal_document</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>1000</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema/>
      <table>candidate_document</table>
      <key>
        <name>UploadedName</name>
        <field>uploaded_filename</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>legal_doc_id</name>
        <field>legal_doc_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>uploaded_filename</name>
        <rename>RealName</rename>
      </value>
      <value>
        <name>created</name>
        <rename>created</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>896</xloc>
      <yloc>1168</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table output</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <schema/>
    <table>company_location</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
      <field>
        <column_name>address</column_name>
        <stream_name>company-locationAddress</stream_name>
      </field>
      <field>
        <column_name>location_name</column_name>
        <stream_name>company-locationName</stream_name>
      </field>
      <field>
        <column_name>city</column_name>
        <stream_name>companylocationCity</stream_name>
      </field>
      <field>
        <column_name>state</column_name>
        <stream_name>companylocationState</stream_name>
      </field>
      <field>
        <column_name>post_code</column_name>
        <stream_name>companylocationZipCode</stream_name>
      </field>
      <field>
        <column_name>country_code</column_name>
        <stream_name>companylocationCountry</stream_name>
      </field>
      <field>
        <column_name>country</column_name>
        <stream_name>country</stream_name>
      </field>
      <field>
        <column_name>company_id</column_name>
        <stream_name>VCCompanyID</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>288</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 4 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select 
         concat('TRCT',Cl.clientID) as contactexternalId,
        Cl.dateAdded as registrationdate
from bullhorn1.BH_Client Cl
where  (Cl.isdeleted &lt;&gt; 1 and Cl.status &lt;&gt; 'Archive')
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>592</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 2 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <key>
        <name>VCContactID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>insert_timestamp</name>
        <rename>registrationdate</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>800</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 2 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>contact</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>contactexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCContactID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>704</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 4 2 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>select concat('TRCD', c.candidateID) as candidateexternalId,
        C.dateAdded as registrationdate
from bullhorn1.Candidate C
where C.isdeleted &lt;&gt; 1 and C.status &lt;&gt; 'Archive'
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>592</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 2 2 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>VCCandidateID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>insert_timestamp</name>
        <rename>registrationdate</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>800</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 2 2 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCandidateID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>704</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Table input 4 2 2 2</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>FROM</connection>
    <sql>with mail1 (ID,email) as (
        select  C.candidateID,
                CONCAT_WS(',',  nullif(dbo.fn_RemoveNonASCIIChars(UC.email),''),nullif(dbo.fn_RemoveNonASCIIChars(UC.email2),''),nullif(dbo.fn_RemoveNonASCIIChars(UC.email3),'')) as email
                --CONCAT_WS(',',nullif(REPLACE(REPLACE(REPLACE(TRIM(':&lt;&gt;·%/()[]?&amp;;+' FROM REPLACE(REPLACE(UC.email,'"',''),'''','')),' ',''),'@.','@'),'.@','@'),''),
                --nullif(REPLACE(REPLACE(REPLACE(TRIM(':&lt;&gt;·%/()[]?&amp;;+' FROM REPLACE(REPLACE(UC.email2,'"',''),'''','')),' ',''),'@.','@'),'.@','@'),''),
                --nullif(REPLACE(REPLACE(REPLACE(TRIM(':&lt;&gt;·%/()[]?&amp;;+' FROM REPLACE(REPLACE(UC.email3,'"',''),'''','')),' ',''),'@.','@'),'.@','@'),'')) as email
        from bullhorn1.Candidate C
        left join bullhorn1.BH_UserContact UC ON C.userID = UC.userID --and C.isPrimaryOwner = 1
        where (C.isdeleted &lt;&gt; 1 and C.status &lt;&gt; 'Archive')
) , mail2 (ID,email) as (----SPLIT to take 1st value in string '...,...,...'
        SELECT ID, email.value as email 
        FROM mail1 m CROSS APPLY STRING_SPLIT(m.email,',') AS email
) , mail3 (ID,email) as (----Remove the . at the start and the end
        SELECT  ID, 
                case 
                        when RIGHT(email, 1) = '.' then LEFT(email, LEN(email) - 1) 
                        when LEFT(email, 1) = '.' then RIGHT(email, LEN(email) - 1) 
                        else email 
                end as email 
        from mail2 WHERE email like '%_@_%.__%'
) , mail4 (ID,email,rn) as (-----Check Duplicate email 
        SELECT ID, email = ltrim(rtrim(CONVERT(NVARCHAR(MAX), email))), r1 = ROW_NUMBER() OVER (PARTITION BY ID ORDER BY ID desc) 
        FROM mail3 
) , e1 (ID,email) as (-----pick the unique email-Primary email
        select ID, email 
        from mail4 where rn = 1
) , ed (ID,email,rn) as (-----Check duplicate email
        SELECT  ID, email,
                ROW_NUMBER() OVER(PARTITION BY email ORDER BY ID DESC) AS rn
        FROM e1
) , e2 (ID,email) as (----Take personal email
        select ID, email 
        from mail4 where rn = 2
) , e3 (ID,email) as (
        select ID, email 
        from mail4 where rn = 3
) , e4 as (
        select ID, email 
        from mail4 where rn = 4
)
--MAIN SCRIPT
select
         concat('TRCD', c.candidateID) as candidateexternalId
	, iif(ed.rn > 1,concat(ed.rn, '_', ed.email), iif(ed.email = '' or ed.email is null, concat('candidate_',cast(c.candidateID as varchar(max)),'@noemailaddress.co'),ed.email) ) as candidateemail
	, e2.email as candidateworkEmail
from bullhorn1.Candidate C --where C.isPrimaryOwner = 1
left join ed on ed.ID = C.candidateID --candidate-email-deduplication
left join e2 on e2.ID = C.candidateID --personal email
left join e3 on e3.ID = c.candidateID --work email
where C.isdeleted &lt;&gt; 1 and C.status &lt;&gt; 'Archive' --where C.isPrimaryOwner = 1 --24681 rows
;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>580</xloc>
      <yloc>542</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Update contact info 2 2 2 2 2 2</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <skip_lookup>N</skip_lookup>
    <commit>100</commit>
    <use_batch>N</use_batch>
    <error_ignored>Y</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <key>
        <name>VCCandidateID</name>
        <field>id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>email</name>
        <rename>candidateemail</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>788</xloc>
      <yloc>542</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>contact lookup 2 2 2 2 2 2 2</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TORO</connection>
    <cache>N</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>public</schema>
      <table>candidate</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>candidateexternalId</name>
        <field>external_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name/>
        <field>deleted_timestamp</field>
        <condition>IS NULL</condition>
        <name2/>
      </key>
      <value>
        <name>id</name>
        <rename>VCCandidateID</rename>
        <default/>
        <type>Number</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>692</xloc>
      <yloc>542</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
