<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>1_domo_export</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2020/10/21 14:19:39.640</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/10/21 14:19:39.640</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>Export format filename: [randstad_domo_job_export.csv]</note>
      <xloc>304</xloc>
      <yloc>96</yloc>
      <width>310</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Export format filename: [randstad_domo_candidate_export.csv]</note>
      <xloc>624</xloc>
      <yloc>224</yloc>
      <width>345</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Export format filename: [randstad_domo_company_export.csv]</note>
      <xloc>960</xloc>
      <yloc>352</yloc>
      <width>343</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Export format filename: [randstad_domo_goals_export.csv]</note>
      <xloc>1872</xloc>
      <yloc>608</yloc>
      <width>321</width>
      <heigth>26</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <connection>
    <name>from (prod)</name>
    <server>rdbm1</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>randstad.vincere.io</database>
    <port>5432</port>
    <username>dbapplication_user</username>
    <password>Encrypted 2be98afc819e8b9aebe11bd63cb8b9ae3</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>5432</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Job Export</from>
      <to>1-job-export</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Formula</from>
      <to>Microsoft Excel writer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>If field value is null</from>
      <to>Microsoft Excel writer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Row denormaliser</from>
      <to>Formula</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Row denormaliser</from>
      <to>If field value is null</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Row denormaliser</from>
      <to>Microsoft Excel writer</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>Row denormaliser</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>[PROD] Current week</from>
      <to>Sort rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>[REV] Last month time</from>
      <to>Sort rows</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Block this step until steps finish 3</from>
      <to>[PROD] Current week</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Block this step until steps finish 3</from>
      <to>[REV] Last month time</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>If field value is null</from>
      <to>4-goals-export</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>2-Candidate</from>
      <to>Block this step until steps finish</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Block this step until steps finish</from>
      <to>2-cand-export</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>3-Company</from>
      <to>Block this step until steps finish 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Block this step until steps finish 2</from>
      <to>3-comp-export</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>1-job-export</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <enclosure_forced>Y</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>UTF-8</encoding>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>N</create_parent_folder>
    <file>
      <name>${Internal.Entry.Current.Directory}/domo/sftp/randstad_domo_job_export</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>csv</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format>yyyy-MM-dd HH:mm:ss</date_time_format>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery/>
    </file>
    <fields>
      <field>
        <name>Job ID</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Brand</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Branch</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Job entry date</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Time to shortlist</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Time from shortlist to cv sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Rotting time (close if not focusing)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Job owner</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Close date / placement date</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Last activity date</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Re-open date (if applicable)</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>posted</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Posting date</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Forecast Fee amount (GP)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Job Fee amount (GP)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>240</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>2-Candidate</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>from (prod)</connection>
    <sql>with cand_brand as (select tgc.candidate_id
		--, tgc.team_group_id
		, string_agg(tg.name, ',') as brand
	from team_group_candidate tgc
	left join (select * from team_group where group_type = 'BRAND') tg on tg.id = tgc.team_group_id
	where team_group_id in (1125, 1124, 1123) --Professionals, 障がい者, CA
	group by tgc.candidate_id
	)
	
, cand_branch as (select b.record_id as candidate_id
		--, b.branch_id
		, string_agg(tg.name, ',') as branch
	from branch_record b
	left join (select * from team_group where group_type = 'BRANCH') tg on tg.id = b.branch_id
	where 1=1
	and record_type = 'candidate'
	group by b.record_id
	)
/*	
, job_app as (select id as job_app_id
	, pc.candidate_id
	, pc.position_description_id
	, pc.associated_date
	, pc.rejected_date
	, pc.sent_date
	, pc.hire_date booked_date --taken from position_candidate as actioned date
	, pc.offer_date
	, pc.interview1_date
	, pc.interview2_date
	, case when rejected_date is not null then DATE_PART('day', c.last_activity_date - pc.rejected_date)
			else 0 end as time_to_reject
	, coalesce(DATE_PART('day', current_timestamp - c.last_activity_date), 0) as rotting_time
	, case when sent_date is not null then DATE_PART('day', pc.sent_date - pc.associated_date)
			else 0 end as time_to_sent
	from position_candidate pc
	left join candidate_extension c on c.candidate_id = pc.candidate_id
	where 1=1
	--and pc.insert_timestamp > '2020-08-01'
	)
*/	
, job_app_latest as (select pc.candidate_id
		, max(status) max_status
		, max(pc.associated_date) max_associated_date
		, max(pc.rejected_date) max_rejected_date
		, max(pc.sent_date) max_sent_date
		, max(pc.hire_date) max_booked_date --taken from position_candidate as actioned date
		, max(pc.offer_date) max_offer_date
		, max(pc.interview1_date) max_interview1_date
		, max(pc.interview2_date) max_interview2_date
	from position_candidate pc
	group by pc.candidate_id)

, job_app as (select j.candidate_id
		, j.max_associated_date
		, j.max_rejected_date
		, j.max_sent_date
		, j.max_booked_date
		, j.max_offer_date
		, j.max_interview1_date
		, j.max_interview2_date
		, case when max_rejected_date is not null then DATE_PART('day', c.last_activity_date - j.max_rejected_date)
				else 0 end as time_to_reject
		, coalesce(DATE_PART('day', current_timestamp - c.last_activity_date), 0) as rotting_time
		, case when max_sent_date is not null then DATE_PART('day', j.max_sent_date - j.max_associated_date)
				else 0 end as time_to_sent
	from job_app_latest j
	join candidate_extension c on c.candidate_id = j.candidate_id
	) --select * from job_app

, cand_activity as (select ac.candidate_id
	, ac.activity_id
	, a.content as candidate_comment
	, ac.insert_timestamp
	, row_number() over(partition by ac.candidate_id order by ac.insert_timestamp desc) as rn
	from activity_candidate ac
	left join (select id, candidate_id, content from activity) a on a.id = ac.activity_id
	)

, placement_profit as (select o.id
	, pc.candidate_id
	, coalesce(o.projected_profit, 0) as placement_profit
	from offer o
	left join position_candidate pc on pc.id = o.position_candidate_id
	where 1=1
	and pc.status >= 300 --placements
	)
	
select 
	c.id::text as "Candidate ID"
	, cbr.brand as "Brand"
	, cbc.branch as "Branch"
	, to_char(c.insert_timestamp, 'YYYY-MM-DD') as "Candidate entry date (NCAD)"
	, coalesce(ja.time_to_sent, 0)::text as "Time to CV sent (CV''s sent)"
	--, coalesce(ja.time_to_reject, 0) as "Time to reject"
	, coalesce(ja.rotting_time, 0)::text as "Rotting time (status update)"
	, to_char(ja.max_booked_date, 'YYYY-MM-DD') as "Placement dates"
	, to_char(ja.max_offer_date, 'YYYY-MM-DD') as "Offer dates"
	, to_char(ja.max_interview1_date, 'YYYY-MM-DD') as "1st interview dates"
	, to_char(ja.max_interview2_date, 'YYYY-MM-DD') as "2nd+ interview dates"
	, cs.name as "Source"
	, ua.name as "Sourcer"
	, ca.candidate_comment as "Last activity comment"
	, to_char(coalesce(ce.last_activity_date, ca.insert_timestamp), 'YYYY-MM-DD') as "Last activity date"
	--, coalesce(pp.placement_profit, 0) as "Placed fee amount (GP)"
from candidate c
	join cand_brand cbr on cbr.candidate_id = c.id
	join cand_branch cbc on cbc.candidate_id = c.id
	left join job_app ja on ja.candidate_id = c.id
	left join candidate_source cs on cs.id = c.candidate_source_id
	left join user_account ua on ua.id = c.source_contact_id
	left join candidate_extension ce on ce.candidate_id = c.id
	left join (select * from cand_activity where rn=1) ca on ca.candidate_id = c.id --latest activity
	--left join placement_profit pp on pp.candidate_id = c.id
where 1=1
and c.deleted_timestamp is NULL
--and c.insert_timestamp::date = now()::date
--and c.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '6 days' --current week
order by c.id</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cached_row_meta_active>N</cached_row_meta_active>
    <row-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate ID</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate ID</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Branch</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Branch</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate entry date (NCAD)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate entry date (NCAD)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to CV sent (CV''s sent)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Time to CV sent (CV''s sent)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (status update)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Rotting time (status update)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Placement dates</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Placement dates</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Offer dates</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Offer dates</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>1st interview dates</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>1st interview dates</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>2nd+ interview dates</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>2nd+ interview dates</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Source</name>
        <length>400</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Source</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Sourcer</name>
        <length>200</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Sourcer</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity comment</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity comment</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
    </row-meta>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>2-cand-export</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <enclosure_forced>Y</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>UTF-8</encoding>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>N</create_parent_folder>
    <file>
      <name>${Internal.Entry.Current.Directory}/domo/sftp/randstad_domo_candidate_export</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>csv</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format>yyyy-MM-dd HH:mm:ss</date_time_format>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery/>
    </file>
    <fields>
      <field>
        <name>Candidate ID</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Brand</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Branch</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Candidate entry date (NCAD)</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Time to CV sent (CV''s sent)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Rotting time (status update)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Placement dates</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Offer dates</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>1st interview dates</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>2nd+ interview dates</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Source</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Sourcer</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Last activity comment</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Last activity date</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>3-Company</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>from (prod)</connection>
    <sql>with com_brand as (select tgc.company_id
	--, tgc.team_group_id
	, string_agg(tg.name, ',') as brand
	from team_group_company tgc
	left join (select * from team_group where group_type = 'BRAND') tg on tg.id = tgc.team_group_id
	where team_group_id in (1125, 1124, 1123) --Professionals, 障がい者, CA
	group by tgc.company_id
	)
	
, job_entry as (select company_id
	, min(insert_timestamp) as job_entry_date --get the oldest job entry date
	from position_description
	group by company_id
	)
	
, com_owner as (select id
	, unnest(string_to_array(company_owners, ','))::int as owner_id
	from company
	)
	
, com_owners as (select c.id
	, string_agg(ua.name,',') as com_owners
	from com_owner c
	left join user_account ua on ua.id = c.owner_id
	group by c.id
	) --select * from com_owners
	
, com_priority as (select company_id
	, case 
		when max(board) = 2 then 'Potential Clients'
		when max(board) = 3 then 'Primary Clients'
		when max(board) = 4 then 'Strategic Clients'
		else 'Companies' end as com_priority
	, min(insert_timestamp) as com_client_date --get the oldest date for contact
	from contact
	group by company_id
	) --select * from com_priority

/*	
, com_activity as (select company_id
	, max(insert_timestamp) as last_activity_comment
	from activity_company
	group by company_id
	)
*/

, com_activity as (select id
		, company_id
		, content
		, insert_timestamp
		from activity
		where id in (select max(activity_id) from activity_company
									group by company_id)
		)
	
, placement_profit as (select pd.company_id
	, sum(coalesce(o.projected_profit, 0))
	, round(sum(coalesce(o.projected_profit, 0)::int), 2) as placement_profit --sum up based on job
	from offer o
	left join position_candidate pc on pc.id = o.position_candidate_id
	left join position_description pd on pd.id = pc.position_description_id
	where 1=1
	and pc.status >= 300 --placements
	group by pd.company_id
	)

	
select 
	c.id::text as "Company ID"
	, cb.brand as "Brand"
	, to_char(c.insert_timestamp, 'YYYY-MM-DD') as "Company entry date"
	--, cp.com_client_date as "Became client date"
	, to_char(j.job_entry_date, 'YYYY-MM-DD') as "Time to first job entry"
	, coalesce(DATE_PART('day', current_timestamp - ce.last_activity_date), 0)::text as "Rotting time (time without contact)"
	, co.com_owners as "Client owner"
	, cp.com_priority as "Client relationship strength (primary, strategic, etc...)"
	--, ca.last_activity_comment as "Last comment"
	, ca.content as "Last comment"
	, to_char(coalesce(ce.last_activity_date, ca.insert_timestamp), 'YYYY-MM-DD') as "Last activity date"
	, coalesce(pp.placement_profit, 0)::text as "Total client fee amount (GP)"
from company c
	join com_brand cb on cb.company_id = c.id
	left join job_entry j on j.company_id = c.id
	left join company_extension ce on ce.company_id = c.id
	left join com_owners co on co.id = c.id
	left join com_priority cp on cp.company_id = c.id
	left join com_activity ca on ca.company_id = c.id
	left join placement_profit pp on pp.company_id = c.id
where 1=1
and c.deleted_timestamp is NULL
--and c.insert_timestamp > '2020-08-01'
--and c.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week
order by c.id desc</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cached_row_meta_active>N</cached_row_meta_active>
    <row-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate ID</name>
        <length>-1</length>
        <precision>0</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate ID</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Branch</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Branch</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate entry date (NCAD)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate entry date (NCAD)</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to CV sent (CV''s sent)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Time to CV sent (CV''s sent)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (status update)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Rotting time (status update)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Placement dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Placement dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Offer dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Offer dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>1st interview dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>1st interview dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>2nd+ interview dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>2nd+ interview dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Source</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Source</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Sourcer</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Sourcer</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity comment</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity comment</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity date</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Company ID</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Company ID</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand_1</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Company entry date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Company entry date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to first job entry</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Time to first job entry</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (time without contact)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Rotting time (time without contact)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Client owner</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Client owner</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Client relationship strength (primary, strategic, etc...)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Client relationship strength (primary, strategic, etc...)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last comment</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Last comment</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date_1</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Last activity date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Total client fee amount (GP)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Total client fee amount (GP)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
    </row-meta>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>576</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>3-comp-export</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <enclosure_forced>Y</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>UTF-8</encoding>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>N</create_parent_folder>
    <file>
      <name>${Internal.Entry.Current.Directory}/domo/sftp/randstad_domo_company_export</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>csv</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format>yyyy-MM-dd HH:mm:ss</date_time_format>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery/>
    </file>
    <fields>
      <field>
        <name>Company ID</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Brand</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Company entry date</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Time to first job entry</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Rotting time (time without contact)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Client owner</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Client relationship strength (primary, strategic, etc...)</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Last comment</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Last activity date</name>
        <type>String</type>
        <format>yyyy-MM-dd HH:mm:ss</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Total client fee amount (GP)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal>.</decimal>
        <group>,</group>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>912</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>4-goals-export</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator>,</separator>
    <enclosure>"</enclosure>
    <enclosure_forced>Y</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>UTF-8</encoding>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>N</create_parent_folder>
    <file>
      <name>${Internal.Entry.Current.Directory}/domo/sftp/randstad_domo_goals_export</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>csv</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format>yyyy-MM-dd HH:mm:ss</date_time_format>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery/>
    </file>
    <fields>
      <field>
        <name>Export Date</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Date From</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Date To</name>
        <type>String</type>
        <format>yyyy-MM-dd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Team</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>Consultant Name</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>NCADs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>1st Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Final Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Offers</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Placements</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Appointment Booked</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>ACON Met</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>ACON CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>ACON 1st Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>CA NCADs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>CA CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>CA 1st Interivews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Sales Calls</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>New Jobs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>BIlling Actuals (GP)</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - NCADs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - 1st Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Final Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Offers</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Placements</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Appointment Booked</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - ACON Met</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - ACON CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - ACON 1st Interviews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - CA NCADs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - CA CV's Sent</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - CA 1st Interivews</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Sales Calls</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - New Jobs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
      <field>
        <name>Target - Billing Targets</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>0</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1824</xloc>
      <yloc>608</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Block this step until steps finish</name>
    <type>BlockUntilStepsFinish</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <steps>
      <step>
        <name>1-job-export</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>416</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Block this step until steps finish 2</name>
    <type>BlockUntilStepsFinish</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <steps>
      <step>
        <name>2-cand-export</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>752</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Block this step until steps finish 3</name>
    <type>BlockUntilStepsFinish</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <steps>
      <step>
        <name>3-comp-export</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>912</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Formula</name>
    <type>Formula</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1680</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>If field value is null</name>
    <type>IfNull</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <replaceAllByValue>0</replaceAllByValue>
    <replaceAllMask/>
    <selectFields>Y</selectFields>
    <selectValuesType>N</selectValuesType>
    <setEmptyStringAll>N</setEmptyStringAll>
    <valuetypes>
      </valuetypes>
    <fields>
      <field>
        <name>NCADs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>1st Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Final Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Offers</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Placements</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Appointment Booked</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>ACON Met</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>ACON CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>ACON 1st Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>CA NCADs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>CA CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>CA 1st Interivews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Sales Calls</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>New Jobs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>BIlling Actuals (GP)</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - NCADs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - 1st Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Final Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Offers</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Placements</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Appointment Booked</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - ACON Met</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - ACON CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - ACON 1st Interviews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - CA NCADs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - CA CV's Sent</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - CA 1st Interivews</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Sales Calls</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - New Jobs</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>Target - Billing Targets</name>
        <value>0</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1680</xloc>
      <yloc>608</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Job Export</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>from (prod)</connection>
    <sql>with job_brand as (select t.position_id
	--, t.team_group_id
	, string_agg(tg.name,',') as brand
	from team_group_position t
	left join (select * from team_group where group_type = 'BRAND') tg on tg.id = t.team_group_id
	where team_group_id in (1125, 1124, 1123) --Professionals, 障がい者, CA
	group by t.position_id
	) --select * from job_brand where position_id = 249389
	
, job_branch as (select b.record_id as position_id
	--, b.branch_id
	, string_agg(tg.name, ',') as branch
	from branch_record b
	left join (select * from team_group where group_type = 'BRANCH') tg on tg.id = b.branch_id
	where 1=1
	and record_type = 'job'
	group by b.record_id
	)
	
, job_app as (select id as job_app_id
	, candidate_id
	, position_description_id
	, associated_date
	, sent_date
	, hire_date
	, case when associated_date is not null then DATE_PART('day', current_timestamp - associated_date)
		else 0 end as time_to_shortlist
	, case when sent_date is not null then DATE_PART('day', sent_date - associated_date)
		else 0 end as time_to_sent
	from position_candidate pc
	where 1=1
	--and insert_timestamp > '20208-08-01' --Filter date to limit the job app counts
	--and pc.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week
	) --select * from job_app

, last_activity as (select job_id
	, max(insert_timestamp) as last_activity_date
	from activity_job
	group by job_id)

, job_app_rotten as (select pc.id as job_app_id
	, pc.candidate_id
	, pc.position_description_id
	, pc.last_stage_date
	, ce.last_activity_date
	, DATE_PART('day', ce.last_activity_date - pc.last_stage_date) as rotten_days
	from position_candidate pc
	left join candidate_extension ce on ce.candidate_id = pc.candidate_id
	where 1=1
	--and pc.insert_timestamp > '20208-08-01'
	--and pc.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week
	) --select * from job_app_rotten

, job_owners as (select pac.position_id 
	, string_agg(u.name, ',') as job_owners
	from position_agency_consultant pac
	left join user_account u on u.id = pac.user_id
	group by pac.position_id 
	)

, job_reopen as (select position_id
	, max(insert_timestamp::date) as reopen_date --latest reopen date for job
	from activity
	where 1=1
	and "content" = 'This job has been re-opened'
	group by position_id
	)
	
, placement_profit as (select o.id
	, pc.position_description_id
	, coalesce(o.projected_profit, 0) as placement_profit --removing profit, if contract, projected_profit >= profit
	from offer o
	left join position_candidate pc on pc.id = o.position_candidate_id
	where 1=1
	and pc.status > 300 --placements
	)
	
select --count(*)
	pd.id::text as "Job ID"
	, jbr.brand as "Brand"
	, jbc.branch as "Branch"
	, to_char(pd.insert_timestamp, 'YYYY-MM-DD') as "Job entry date"
	, coalesce(ja.time_to_shortlist, 0)::text as "Time to shortlist"
	, coalesce(ja.time_to_sent, 0)::text as "Time from shortlist to cv sent"
	, coalesce(jar.rotten_days, 0)::text as "Rotting time (close if not focusing)"
	, jo.job_owners "Job owner"
	, to_char(coalesce(ja.hire_date, pd.head_count_close_date), 'YYYY-MM-DD') as "Close date / placement date"
	, to_char(coalesce(pe.last_activity_date, la.last_activity_date), 'YYYY-MM-DD') as "Last activity date"
	, to_char(jro.reopen_date, 'YYYY-MM-DD') as "Re-open date (if applicable)"
	, case when pd.published_date is not NULL then 'Yes'
			else 'No' end as Posted
	, to_char(pd.published_date, 'YYYY-MM-DD') as "Posting date"
	--, c.projected_profit * coalesce(pd.head_count, 1) as "Forecast Fee amount (GP)" -- from position_description
	, case when pd.position_type = 1 then coalesce(pd.forecast_annual_fee, 0)::text
		when pd.position_type > 1 then coalesce(c.projected_profit, 0)::text end as "Forecast Fee amount (GP)"
	, coalesce(pp.placement_profit, 0)::text as "Job Fee amount (GP)"
from position_description pd
join job_brand jbr on jbr.position_id = pd.id --unique
left join job_branch jbc on jbc.position_id = pd.id --unique
left join position_extension pe on pe.position_id = pd.id --unique
left join last_activity la on la.job_id = pd.id --unique
left join job_app ja on ja.position_description_id = pd.id --multiple
left join job_app_rotten jar on jar.job_app_id = ja.job_app_id --following by job_app_id instead 20201211
left join job_owners jo on jo.position_id = pd.id --unique
left join job_reopen jro on jro.position_id = pd.id --unique
left join placement_profit pp on pp.position_description_id = pd.id --multiple
left join compensation c on c.position_id = pd.id --added 20200928
where 1=1
--and pd.insert_timestamp > '2020-08-01' --filter date for created jobs
--and pd.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week
--and pd.insert_timestamp between date_trunc('month', current_timestamp) and date_trunc('month', current_timestamp) + interval '1 month' - '1 day'::interval --current month
--and pd.id = 249389
and pd.insert_timestamp::date >= '2019-01-01'
order by pd.id desc</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cached_row_meta_active>N</cached_row_meta_active>
    <row-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Job ID</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Job ID</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Branch</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Branch</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Job entry date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Job entry date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to shortlist</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Time to shortlist</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time from shortlist to cv sent</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Time from shortlist to cv sent</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (close if not focusing)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Rotting time (close if not focusing)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Job owner</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Job owner</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Close date / placement date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Close date / placement date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Last activity date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Re-open date (if applicable)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Re-open date (if applicable)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>posted</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>posted</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Posting date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Posting date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Forecast Fee amount (GP)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Forecast Fee amount (GP)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Job Fee amount (GP)</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>Job Export</origin>
        <comments>Job Fee amount (GP)</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
    </row-meta>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>80</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Microsoft Excel writer</name>
    <type>TypeExitExcelWriterStep</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <header>Y</header>
    <footer>N</footer>
    <makeSheetActive>Y</makeSheetActive>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <startingCell>A1</startingCell>
    <appendOmitHeader>N</appendOmitHeader>
    <appendOffset>0</appendOffset>
    <appendEmpty>0</appendEmpty>
    <rowWritingMethod>overwrite</rowWritingMethod>
    <forceFormulaRecalculation>N</forceFormulaRecalculation>
    <leaveExistingStylesUnchanged>N</leaveExistingStylesUnchanged>
    <appendLines>N</appendLines>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name>E:\DataMigration\Randstad\CustomWork\CustomReport\DOMO\Export\randstad_domo_goals_export</name>
      <extention>xlsx</extention>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>Y</add_date>
      <add_time>Y</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <sheetname>Sheet1</sheetname>
      <autosizecolums>N</autosizecolums>
      <stream_data>N</stream_data>
      <protect_sheet>N</protect_sheet>
      <password>Encrypted </password>
      <protected_by/>
      <splitevery>0</splitevery>
      <if_file_exists>new</if_file_exists>
      <if_sheet_exists>new</if_sheet_exists>
    </file>
    <template>
      <enabled>N</enabled>
      <sheet_enabled>N</sheet_enabled>
      <filename>template.xls</filename>
      <sheetname/>
      <hidden>N</hidden>
    </template>
    <fields>
      <field>
        <name>Date From</name>
        <type>Date</type>
        <format>yyyy-mm-dd</format>
        <title>Date From</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Date To</name>
        <type>Date</type>
        <format>yyyy-mm-dd</format>
        <title>Date To</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Team</name>
        <type>String</type>
        <format/>
        <title>Team</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Consultant Name</name>
        <type>String</type>
        <format/>
        <title>Consultant Name</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>NCADs</name>
        <type>Integer</type>
        <format/>
        <title>NCADs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>1st Interviews</name>
        <type>Integer</type>
        <format/>
        <title>1st Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Final Interviews</name>
        <type>Integer</type>
        <format/>
        <title>Final Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Offers</name>
        <type>Integer</type>
        <format/>
        <title>Offers</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Placements</name>
        <type>Integer</type>
        <format/>
        <title>Placements</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Appointment Booked</name>
        <type>Integer</type>
        <format/>
        <title>Appointment Booked</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>ACON Met</name>
        <type>Integer</type>
        <format/>
        <title>ACON Met</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>ACON CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>ACON CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>ACON 1st Interviews</name>
        <type>Integer</type>
        <format/>
        <title>ACON 1st Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>CA NCADs</name>
        <type>Integer</type>
        <format/>
        <title>CA NCADs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>CA CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>CA CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>CA 1st Interivews</name>
        <type>Integer</type>
        <format/>
        <title>CA 1st Interivews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Sales Calls</name>
        <type>Integer</type>
        <format/>
        <title>Sales Calls</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>New Jobs</name>
        <type>Integer</type>
        <format/>
        <title>New Jobs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>BIlling Actuals (GP)</name>
        <type>Integer</type>
        <format/>
        <title>BIlling Actuals (GP)</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - NCADs</name>
        <type>Integer</type>
        <format/>
        <title>Target - NCADs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>Target - CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - 1st Interviews</name>
        <type>Integer</type>
        <format/>
        <title>Target - 1st Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Final Interviews</name>
        <type>Integer</type>
        <format/>
        <title>Target - Final Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Offers</name>
        <type>Integer</type>
        <format/>
        <title>Target - Offers</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Placements</name>
        <type>Integer</type>
        <format/>
        <title>Target - Placements</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Appointment Booked</name>
        <type>Integer</type>
        <format/>
        <title>Target - Appointment Booked</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - ACON Met</name>
        <type>Integer</type>
        <format/>
        <title>Target - ACON Met</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - ACON CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>Target - ACON CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - ACON 1st Interviews</name>
        <type>Integer</type>
        <format/>
        <title>Target - ACON 1st Interviews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - CA NCADs</name>
        <type>Integer</type>
        <format/>
        <title>Target - CA NCADs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - CA CV's Sent</name>
        <type>Integer</type>
        <format/>
        <title>Target - CA CV's Sent</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - CA 1st Interivews</name>
        <type>Integer</type>
        <format/>
        <title>Target - CA 1st Interivews</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Sales Calls</name>
        <type>Integer</type>
        <format/>
        <title>Target - Sales Calls</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - New Jobs</name>
        <type>Integer</type>
        <format/>
        <title>Target - New Jobs</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
      <field>
        <name>Target - Billing Targets</name>
        <type>Integer</type>
        <format/>
        <title>Target - Billing Targets</title>
        <titleStyleCell/>
        <styleCell/>
        <commentField/>
        <commentAuthorField/>
        <formula>N</formula>
        <hyperlinkField/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1824</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Row denormaliser</name>
    <type>Denormaliser</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <key_field>kpi_name_final</key_field>
    <group>
      <field>
        <name>Consultant Name</name>
      </field>
      <field>
        <name>Date From</name>
      </field>
      <field>
        <name>Date To</name>
      </field>
      <field>
        <name>Team</name>
      </field>
    </group>
    <fields>
      <field>
        <field_name>actual</field_name>
        <key_value>NCAD</key_value>
        <target_name>NCADs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>CV Sent</key_value>
        <target_name>CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>1st Interview</key_value>
        <target_name>1st Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Final Interview</key_value>
        <target_name>Final Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Offers</key_value>
        <target_name>Offers</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Placements | Permanent</key_value>
        <target_name>Placements</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>ACON - Appointment Booked</key_value>
        <target_name>Appointment Booked</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>ACON - MET</key_value>
        <target_name>ACON Met</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>ACON - CV Sent</key_value>
        <target_name>ACON CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>ACON - 1st Interview</key_value>
        <target_name>ACON 1st Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>CA - NCAD</key_value>
        <target_name>CA NCADs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>CA - CV Sent</key_value>
        <target_name>CA CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>CA - 1st Interview</key_value>
        <target_name>CA 1st Interivews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Client Call</key_value>
        <target_name>Sales Calls</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Jobs | New</key_value>
        <target_name>New Jobs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>actual</field_name>
        <key_value>Placement Based Revenue</key_value>
        <target_name>BIlling Actuals (GP)</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>NCAD</key_value>
        <target_name>Target - NCADs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>CV Sent</key_value>
        <target_name>Target - CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>1st Interview</key_value>
        <target_name>Target - 1st Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Final Interview</key_value>
        <target_name>Target - Final Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Offers</key_value>
        <target_name>Target - Offers</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Placements | Permanent</key_value>
        <target_name>Target - Placements</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>ACON - Appointment Booked</key_value>
        <target_name>Target - Appointment Booked</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>ACON - MET</key_value>
        <target_name>Target - ACON Met</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>ACON - CV Sent</key_value>
        <target_name>Target - ACON CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>ACON - 1st Interview</key_value>
        <target_name>Target - ACON 1st Interviews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>CA - NCAD</key_value>
        <target_name>Target - CA NCADs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>CA - CV Sent</key_value>
        <target_name>Target - CA CV's Sent</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>CA - 1st Interview</key_value>
        <target_name>Target - CA 1st Interivews</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Client Call</key_value>
        <target_name>Target - Sales Calls</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Jobs | New</key_value>
        <target_name>Target - New Jobs</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
      <field>
        <field_name>target</field_name>
        <key_value>Placement Based Revenue</key_value>
        <target_name>Target - Billing Targets</target_name>
        <target_type>String</target_type>
        <target_format>#</target_format>
        <target_length>-1</target_length>
        <target_precision>-1</target_precision>
        <target_decimal_symbol/>
        <target_grouping_symbol/>
        <target_currency_symbol/>
        <target_null_string/>
        <target_aggregation_type>-</target_aggregation_type>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1536</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>Date From</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>Date To</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>Consultant Name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>Team</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1312</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>[PROD] Current week</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>from (prod)</connection>
    <sql>with consultant_team as (select tgu.user_id
		, string_agg(tg.name, ',') as team
	from team_group_user tgu
	left join (select * from team_group where group_type = 'TEAM') tg on tg.id = tgu.team_group_id
	where 1=1
	--and team_group_id in (1125, 1124, 1123) --Professionals, 障がい者, CA
	group by tgu.user_id
	)

, kpi_activated as (
	select id
	, kpi_name
	, coalesce(nullif(kln.alt_name, ''), kl.kpi_name) as kpi_name_final
	, seq
	, coalesce(activated, 0) as is_active
	, case when related_type = 1 then 'Candidate'
			when related_type = 2 then 'Contact'
			when related_type = 3 then 'Company'
			when related_type = 4 then 'Job'
			when related_type = 5 then 'Application'
			when related_type = 6 then 'Deal'
			when related_type = 7 then 'Job lead'
			else 'Other'
		end as entity
	, case when id in (57, 58, 59, 82) then 'fee'
		else 'action' end as kpi_type
	from kpi_library kl
	left join (select * from kpi_library_alt_name where language = 'en') kln on kln.kpi_library_id = kl.id
	where activated = 1 --activated kpi
	and related_type &lt;&gt; 6 --exclude 'Deal'
	order by kl.seq
)

, curency_code as (
	select c.key
	  , case when coalesce(ce.value, 0) = 0 THEN 1 ELSE 1/ce.value END::double precision as value
	from currencies c
	join currencies_exchange ce ON c.code = ce.code_to
	where ce.code_from = 'JPY'
)

--TARGERTS
, targets as (select ka.user_account_id as consultant_key
			, ka.kpi_library_id as kpi_lib_key
			, ka.time_frame
			, ka.target_score
			, ka.start_date as org_start_date
			, ka.end_date as org_end_date
			, case when ka.end_date is NULL then date_trunc('week', current_timestamp)
					else ka.start_date end as start_date
			, case when ka.end_date is NULL then date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week end date
					else ka.end_date end as end_date
		--, coalesce(ka.end_date, ka.start_date + '1 month'::interval) as end_date --added 1 month if end_date is NULL | remove this line
			, case when kpi_type = 'fee' then round((ka.target_score * coalesce(cc.value, 1))::integer, 1)
					else ka.target_score end as target
			, kpi_type
			, ua.name
			, row_number() over(partition by ka.user_account_id, ka.kpi_library_id order by ka.start_date, ka.end_date) as rn
		from kpi_assignment ka
				join user_account ua on ka.user_account_id = ua.id
				join kpi_activated k on k.id = ka.kpi_library_id
				left join curency_code cc on cc.key = ka.currency_type
		where ua.id &lt;&gt; -10 
		and ua.deleted_timestamp is null
		and ka.target_score is not NULL
		--and ua.id = 28983 --checking 1 consultant
		--and ka.end_date is not NULL --filter with end_date
		--and ka.end_date >= now() --only valid timeframe
		and (ka.end_date is NULL or (ka.start_date between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval)) --current week view
		and ka.time_frame = 1 --week view
		order by k.kpi_type, ka.user_account_id
		) 	
		--select * from targets where kpi_lib_key = 34 order by consultant_key, kpi_lib_key		
		--select * from targets where consultant_key = 28984 order by consultant_key, kpi_lib_key

/*
select *
from user_account
where name = 'Chihiro Tochisako'
*/

, cand_owner as (select id as candidate_id
			, (json_array_elements(candidate_owner_json::json)->>'ownerId')::int as candidate_owner_id
	from candidate 
	where candidate_owner_json is not null)

, tmp_candidate_owner as (select candidate_id
	, string_agg(ua.name, ',' order by ua.id) as candidate_owners
	from cand_owner co
	left join user_account ua on ua.id = co.candidate_owner_id
	where 1=1
	and ua.deleted_timestamp is NULL
	group by candidate_id
	) --select * from tmp_candidate_owner

, tmp_job_owner as (select pac.position_id AS job_id
	, pac.user_id ::int AS user_id
	, coalesce ((1/tmp_1.no_job_owner) * 100, 100) AS shared
	from position_agency_consultant pac
	left join (select position_id, count(user_id) as no_job_owner
				from position_agency_consultant pac
				group by position_id) tmp_1 on pac.position_id = tmp_1.position_id
	)

--ACTUAL ACTIONS
, kca as (select unnest(string_to_array(kpi_related_lib, ','))::int as kpi_lib_key
				, kca.candidate_id
				, coalesce(kca.position_id, aj.job_id) as position_id
				, coalesce(kca.contact_id, acon.contact_id) as contact_id
				, coalesce(kca.company_id, ac.company_id) as company_id
				, kca.user_account_id
				, kca.insert_timestamp		
				, kca.comment_id
				, kca.id as comment_action_id
			from kpi_comment_action kca
			left join activity a on (a.id = kca.comment_id or a.id =  kca.task_id)
			left join activity_job as aj on aj.activity_id = kca.comment_id
			left join activity_company as ac on ac.activity_id = kca.comment_id
			left join activity_contact as acon on acon.activity_id = kca.comment_id
			where kpi_related_lib is not null
			and kpi_related_lib &lt;&gt; ''
			and kca.insert_timestamp between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval --current week view
			)

, actual_actions as (select consultant_key
			, kpi_lib_key
			, count(distinct comment_action_id) as actual
			--, date_key
			--, shortlisted_key
			--, comment_action_id
			--, candidate_key
			--, job_key
			--, contact_key
			--, company_key
		from
			(select kca.user_account_id as consultant_key
				, kpi_lib_key
				--, kpi_related_lib
				, fu_convert_time_zone(kca.insert_timestamp, '', ua.timezone) AS date_key
				, coalesce(kca.candidate_id, -1) as candidate_key
				, coalesce(kca.position_id, -1) as job_key
				, coalesce(kca.contact_id, -1) as contact_key
				, coalesce(kca.company_id, -1) as company_key
				, coalesce(pd.position_category, 3) as position_category
			, pc.shortlisted_user_id as shortlisted_key
			, kca.comment_action_id
			from kca
			join user_account ua ON kca.user_account_id = ua.ID
			left join position_description as pd on pd.id = kca.position_id
			left join position_candidate AS pc ON pc.position_description_id = kca.position_id AND pc.candidate_id = kca.candidate_id
			where ua.id &lt;&gt; -10 
			and ua.deleted_timestamp is null
			and kca.user_account_id IS NOT NULL
			and kpi_lib_key in (select id from kpi_activated where kpi_type &lt;&gt; 'fee')
			) as b
		group by consultant_key, kpi_lib_key
		) --select * from actual_actions where consultant_key = 29099 and kpi_lib_key = 77 --check actual actions

--TMP TABLES
, user_currency_timezone as
	(
		SELECT upper(c.code) as currency_type
		, timezone 
		FROM user_account ua 
		JOIN currencies c on ua.currency_type = c.key
		WHERE ua.id = -10
		LIMIT 1
	)
	
, tmp_ce_user AS 
	(-- convert rate of all currencies into admin currency setting
		SELECT c.key AS key_from
		       , CASE WHEN COALESCE(ce.value, 0) = 0 THEN 1 ELSE 1/ce.value END::DOUBLE PRECISION AS value 
			   , c.code
		  FROM currencies c 
		  INNER JOIN currencies_exchange ce ON c.code = ce.code_to
		  INNER JOIN user_currency_timezone uc on uc.currency_type = ce.code_from
	)
	
, tmp_user_status as
	(	
		SELECT ua.id as consultant_id
		, ua.name as consultant_name
		, case when ua.locked_user = 0 then 'Active'
		when ua.locked_user = 1 then 'Inactive'
		else 'Other' end as consultant_status
	    , array_to_string(array_agg(tg_team.name), ','::text)  AS team_name
	    , array_to_string(array_agg(tg_brand.name), ','::text)  AS brand_name
	    , array_to_string(array_agg(tg_branch.name), ','::text)  AS branch_name
		FROM user_account ua
		LEFT JOIN team_group_user tgu ON tgu.user_id = ua.id
		LEFT JOIN team_group tg_team ON tg_team.id = tgu.team_group_id AND tg_team.group_type::text = 'TEAM'::TEXT
		LEFT JOIN team_group tg_brand ON tg_brand.id = tgu.team_group_id AND tg_brand.group_type::text = 'BRAND'::TEXT
		LEFT JOIN team_group tg_branch ON tg_branch.id = tgu.team_group_id AND tg_branch.group_type::text = 'BRANCH'::text
		WHERE ua.system_admin = 0 
		AND ua.deleted_timestamp IS NULL 
		GROUP BY ua.id
	)
	
, tmp_company_owner as
	(
		SELECT c.id AS company_id
		, c.name AS company_name
		, (((SELECT array_to_string(array_agg(user_account.name), ','::text) AS array_to_string
        FROM user_account
        WHERE user_account.deleted_timestamp IS NULL AND (user_account.id = ANY (c.company_owner_ids)))))::character varying(200) AS company_owners
     FROM company c
	)

, tmp_contact_owner as
	(
		SELECT c.id AS contact_id
		, c.contact_owner_ids
		, concat_ws(' ', coalesce(c.first_name || ' ', ''), coalesce(c.middle_name || ' ', ''), coalesce(c.last_name || ' ', '')) AS contact_name
		, ((( SELECT array_to_string(array_agg(user_account.name), ', '::text) as array_to_string
          FROM user_account
          WHERE user_account.deleted_timestamp IS NULL AND (user_account.id = ANY (c.contact_owner_ids)))))::character varying(200) AS contact_owners
    FROM contact c
	)
	
--ACTUAL REVENUE
, tmp_placed as 
	(
		SELECT case when o.position_type = 1 THEN 57 ELSE 58 END AS kpi_lib_key
		, pc.position_description_id AS job_id
		, pd.name AS job_name
		, pc.id AS app_id
		, pc.candidate_id AS candidate_id
		, opi.first_name||' '|| opi.last_name as candidate_name
		, tcao.candidate_owners
		, o.id AS offer_id
		, CASE WHEN ors.user_id IS NOT NULL THEN ors.user_id ELSE tjo.user_id END AS consultant_id
		, CASE WHEN ors.user_id IS NOT NULL THEN ors.shared ELSE tjo.shared END AS shared
		, CASE 
			WHEN ors.user_id IS NOT NULL THEN coalesce(ors.amount * tmp_ce_user.value, 0) 
			WHEN tjo.user_id IS NOT NULL THEN coalesce(o.projected_profit * tjo.shared * tmp_ce_user.value, 0)
			ELSE 0 END AS fee
		, CASE WHEN ors.user_id IS NOT NULL THEN 'Profit Split' ELSE 'Job Owner' END AS fee_source
		, o.currency_type AS currency_type
		, o.position_type AS job_type
		, COALESCE(opi.placed_date, pc.hire_date, pc.placed_date ) AS action_date
		, opi.client_company_id AS company_id
		, opi.client_company_name AS company_name
		, tco.company_owners
		, opi.client_contact_id AS contact_id
		, opi.client_contact_name AS contact_name
		, tcono.contact_owners
		, DATE_TRUNC('WEEK', coalesce(opi.placed_date, pc.hire_date, pc.placed_date ))::DATE AS first_of_week
		,(DATE_TRUNC('WEEK', coalesce(opi.placed_date, pc.hire_date, pc.placed_date )) + interval '1 week' - interval '1 day')::DATE AS last_of_week
		, extract(WEEK from coalesce(opi.placed_date, pc.hire_date, pc.placed_date)) AS week_name
		from offer o
		left join offer_revenue_split ors ON o.id = ors.offer_id 
		left join position_candidate pc ON  o.position_candidate_id = pc.id 
		left join tmp_ce_user ON o.currency_type = tmp_ce_user.key_from
		left join offer_personal_info opi ON o.id = opi.offer_id
		left join tmp_candidate_owner tcao ON tcao.candidate_id = pc.candidate_id
		left join tmp_job_owner tjo ON tjo.job_id = pc.position_description_id  AND ors.user_id IS NULL
		left join tmp_company_owner tco ON tco.company_id =  opi.client_company_id
		left join tmp_contact_owner tcono ON tcono.contact_id = opi.client_contact_id
		left join candidate c ON c.id = pc.candidate_id 
		left join position_description pd ON pd.id = pc.position_description_id 
		where pc.status >= 300 AND pc.status &lt; 400
		--AND COALESCE(opi.placed_date, pc.hire_date, pc.placed_date) >= (DATE_TRUNC('MONTH', NOW()- INTERVAL '12 months'))
		and coalesce(opi.placed_date, pc.hire_date, pc.placed_date) between date_trunc('week', current_timestamp) and date_trunc('week', current_timestamp) + interval '1 week' - interval '1 day' --current week view
		and c.deleted_timestamp IS null
	) --select * from tmp_placed

, actual_fee as (
	select consultant_id
		, kpi_lib_key
		, sum(fee) as actual_fee
	from tmp_placed
	group by consultant_id, kpi_lib_key
	) ---select * from actual_fee


--COMBINE ACTUAL ACTIONS AND FEES
, actual as (select *
	, 'action' as actual_type
	from actual_actions
	
	UNION ALL
	select *
	, 'fee' as actual_type
	from actual_fee
	) --select * from actual where consultant_key = 29634
	
--COMPARE TARGETS / ACTUAL
select to_char(current_timestamp, 'YYYY-MM-DD') as "Export Date"
	, to_char(t.start_date, 'YYYY-MM-DD') "Date From"
	, to_char(coalesce(t.end_date, date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval), 'YYYY-MM-DD') "Date To"
	, ct.team "Team"
	--, t.consultant_key
	, t.name "Consultant Name"
	--, t.kpi_lib_key
	, ka.kpi_name_final
	--, t.time_frame
	, t.target::text
	, coalesce(a.actual, 0)::text as actual
	, t.kpi_type
	from targets t
	left join actual a on t.consultant_key = a.consultant_key and t.kpi_lib_key = a.kpi_lib_key
	left join kpi_activated ka on ka.id = t.kpi_lib_key
	left join consultant_team ct on t.consultant_key = ct.user_id
	where 1=1
	and t.rn = 1 --if setting goals from next week
	--and ka.kpi_name_final = 'Placement Based Revenue' --check kpi name
	order by t.name, t.kpi_lib_key


/* AUDIT CHECK AND COMPARE WITH INTELLIGENCE
, a as (
	select t.start_date::date "Date From"
	, coalesce(t.end_date, date_trunc('week', current_timestamp) + interval '1 week' - '1 day'::interval)::date "Date To"
	, ct.team "Team"
	--, t.consultant_key
	, t.name "Consultant Name"
	--, t.kpi_lib_key
	, ka.kpi_name_final
	--, t.time_frame
	, t.target
	, coalesce(a.actual, 0) as actual
	, t.kpi_type
	from targets t
	left join actual a on t.consultant_key = a.consultant_key and t.kpi_lib_key = a.kpi_lib_key
	left join kpi_activated ka on ka.id = t.kpi_lib_key
	left join consultant_team ct on t.consultant_key = ct.user_id
	where 1=1
	and t.rn = 1 --if setting goals from next week
	--and ka.kpi_name_final = 'Placement Based Revenue' --check kpi name
	--order by t.name, kpi_lib_key
)

select kpi_name_final, count(kpi_name_final) count, sum(target) target, sum(actual) actual
from a
where kpi_name_final = 'Placement Based Revenue'
group by kpi_name_final
*/</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cached_row_meta_active>N</cached_row_meta_active>
    <row-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate ID</name>
        <length>-1</length>
        <precision>0</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate ID</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Branch</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Branch</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Candidate entry date (NCAD)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Candidate entry date (NCAD)</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to CV sent (CV''s sent)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Time to CV sent (CV''s sent)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (status update)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Rotting time (status update)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Placement dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Placement dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Offer dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Offer dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>1st interview dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>1st interview dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>2nd+ interview dates</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>2nd+ interview dates</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Source</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Source</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Sourcer</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Sourcer</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity comment</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity comment</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>2-Candidate</origin>
        <comments>Last activity date</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Company ID</name>
        <length>-1</length>
        <precision>0</precision>
        <origin>3-Company</origin>
        <comments>Company ID</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Brand_1</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Brand</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Company entry date</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Company entry date</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Time to first job entry</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Time to first job entry</comments>
        <conversion_Mask>yyyy-MM-dd HH:mm:ss</conversion_Mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Rotting time (time without contact)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Rotting time (time without contact)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Client owner</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Client owner</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Client relationship strength (primary, strategic, etc...)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Client relationship strength (primary, strategic, etc...)</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last comment</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Last comment</comments>
        <conversion_Mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Last activity date_1</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Last activity date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Total client fee amount (GP)</name>
        <length>-1</length>
        <precision>-1</precision>
        <origin>3-Company</origin>
        <comments>Total client fee amount (GP)</comments>
        <conversion_Mask>#</conversion_Mask>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>Y</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Export Date</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>Export Date</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Date From</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>Date From</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Date To</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>Date To</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Team</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>Team</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>Consultant Name</name>
        <length>200</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>Consultant Name</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>kpi_name_final</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>kpi_name_final</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>target</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>target</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>actual</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>actual</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
      <value-meta>
        <type>String</type>
        <storagetype>normal</storagetype>
        <name>kpi_type</name>
        <length>2147483647</length>
        <precision>-1</precision>
        <origin>[PROD] Current week</origin>
        <comments>kpi_type</comments>
        <conversion_Mask/>
        <decimal_symbol>.</decimal_symbol>
        <grouping_symbol>,</grouping_symbol>
        <currency_symbol/>
        <trim_type>none</trim_type>
        <case_insensitive>N</case_insensitive>
        <collator_disabled>Y</collator_disabled>
        <collator_strength>0</collator_strength>
        <sort_descending>N</sort_descending>
        <output_padding>N</output_padding>
        <date_format_lenient>N</date_format_lenient>
        <date_format_locale>en_US</date_format_locale>
        <date_format_timezone>UTC</date_format_timezone>
        <lenient_string_to_number>N</lenient_string_to_number>
      </value-meta>
    </row-meta>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1104</xloc>
      <yloc>608</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>[REV] Last month time</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection/>
    <sql>with consultant_team as (select tgu.user_id
		, string_agg(tg.name, ',') as team
	from team_group_user tgu
	left join (select * from team_group where group_type = 'TEAM') tg on tg.id = tgu.team_group_id
	where 1=1
	--and team_group_id in (1125, 1124, 1123) --Professionals, 障がい者, CA
	group by tgu.user_id
	)

, kpi_activated as (
	select id
	, kpi_name
	, coalesce(nullif(kln.alt_name, ''), kl.kpi_name) as kpi_name_final
	, seq
	, coalesce(activated, 0) as is_active
	, case when related_type = 1 then 'Candidate'
			when related_type = 2 then 'Contact'
			when related_type = 3 then 'Company'
			when related_type = 4 then 'Job'
			when related_type = 5 then 'Application'
			when related_type = 6 then 'Deal'
			when related_type = 7 then 'Job lead'
			else 'Other'
		end as entity
	, case when id in (57, 58, 59, 82) then 'fee'
		else 'action' end as kpi_type
	from kpi_library kl
	left join (select * from kpi_library_alt_name where language = 'en') kln on kln.kpi_library_id = kl.id
	where activated = 1 --activated kpi
	and related_type &lt;&gt; 6 --exclude 'Deal'
	and id in (74, 5, 7, 73, 76, 1, 3, 75, 78, 22, 24, 77, 80, 18, 20, 79
	,35 ,37 ,70 ,72 ,69 ,71 ,17 ,61 ,86 ,85 ,34 ,88 ,87 ,60 ,39 ,40 ,81 ,41 
	,63 ,45 ,46 ,47 ,48 ,49 ,50 ,51 ,84 ,52 ,53 ,54 ,55 ,56 ,82 ,57 ,59 ,58 ,64 ,65
	,89 ,90 ,91 ,92 ,93, 94, 95, 57, 58, 59, 82)
	order by kl.seq
)

, curency_code as (
	select c.key
	  , case when coalesce(ce.value, 0) = 0 THEN 1 ELSE 1/ce.value END::double precision as value
	from currencies c
	join currencies_exchange ce ON c.code = ce.code_to
	where ce.code_from = 'JPY'
)

--TARGERTS
, targets as (select ka.user_account_id as consultant_key
			, ka.kpi_library_id as kpi_lib_key
			, ka.time_frame
			, ka.target_score
			, ka.start_date as start_date
			, ka.end_date as end_date	
			--, coalesce(ka.end_date, ka.start_date + '1 month'::interval) as end_date --added 1 month if end_date is NULL | remove this line
			, case when kpi_type = 'fee' then round((ka.target_score * coalesce(cc.value, 1))::integer, 1)
					else ka.target_score end as target
			, kpi_type
			, ua.name
		from kpi_assignment ka
				join user_account ua on ka.user_account_id = ua.id
				join kpi_activated k on k.id = ka.kpi_library_id
				left join curency_code cc on cc.key = ka.currency_type
		where ua.id &lt;&gt; -10 
		and ua.deleted_timestamp is null
		and ka.target_score is not NULL
		--and ua.id = 28983 --checking 1 consultant
		--and ka.end_date is not NULL --filter with end_date
		--and ka.end_date >= now() --only valid timeframe
		and ka.start_date between date_trunc('week', '2020-10-02'::date) and date_trunc('week', '2020-10-02'::date) + interval '1 week' - '1 day'::interval --current week view
		and ka.time_frame = 1 --week view
		order by k.kpi_type, ka.user_account_id
		) --select * from targets

, cand_owner as (select id as candidate_id
			, (json_array_elements(candidate_owner_json::json)->>'ownerId')::int as candidate_owner_key
	from candidate
	where candidate_owner_json is not null)


, job_owner as (select pac.position_id
		, user_id
		, name as job_owner
		, total_job_owner
		--, row_number() over	(partition by pac.position_id order by name asc) as row_num
	from position_agency_consultant pac
	left join (select position_id, count (user_id) as total_job_owner 
				from position_agency_consultant 
				group by position_id) as c on pac.position_id = c.position_id
	left join user_account ua on pac.user_id = ua.id)


--ACTUAL ACTIONS
, kca as (select unnest(string_to_array(kpi_related_lib, ','))::int as kpi_lib_key
				, kca.candidate_id
				, coalesce(kca.position_id, aj.job_id) as position_id
				, coalesce(kca.contact_id, acon.contact_id) as contact_id
				, coalesce(kca.company_id, ac.company_id) as company_id
				, kca.user_account_id
				, kca.insert_timestamp		
				, kca.comment_id
				, kca.id as comment_action_id
			from kpi_comment_action kca
			left join activity a on (a.id = kca.comment_id or a.id =  kca.task_id)
			left join activity_job as aj on aj.activity_id = kca.comment_id
			left join activity_company as ac on ac.activity_id = kca.comment_id
			left join activity_contact as acon on acon.activity_id = kca.comment_id
			where kpi_related_lib is not null
			and kpi_related_lib &lt;&gt; ''
			and kca.insert_timestamp between date_trunc('week', '2020-10-02'::date) and date_trunc('week', '2020-10-02'::date) + interval '1 week' - '1 day'::interval --current week view
			)

, actual_actions as (select consultant_key
			, kpi_lib_key
			, count(distinct comment_action_id) as actual
			--, date_key
			--, shortlisted_key
			--, comment_action_id
			--, candidate_key
			--, job_key
			--, contact_key
			--, company_key
		from
			(select kca.user_account_id as consultant_key
				, kpi_lib_key
				--, kpi_related_lib
				, fu_convert_time_zone(kca.insert_timestamp, '', ua.timezone) AS date_key
				, coalesce(kca.candidate_id, -1) as candidate_key
				, coalesce(kca.position_id, -1) as job_key
				, coalesce(kca.contact_id, -1) as contact_key
				, coalesce(kca.company_id, -1) as company_key
				, coalesce(pd.position_category, 3) as position_category
			, pc.shortlisted_user_id as shortlisted_key
			, kca.comment_action_id
			from kca
			join user_account ua ON kca.user_account_id = ua.ID
			left join position_description as pd on pd.id = kca.position_id
			left join position_candidate AS pc ON pc.position_description_id = kca.position_id AND pc.candidate_id = kca.candidate_id
			where ua.id &lt;&gt; -10 
			and ua.deleted_timestamp is null
			and kca.user_account_id IS NOT NULL
			and kpi_lib_key in 
				(5, 1, 22, 18, 35, 37, 70, 72, 69, 71, 17, 61, 34, 60, 39, 40, 41, 63, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 64, 65
				, 7, 73, 3, 75, 24, 77, 20, 79, 42, 43, 85, 87, 89 ,90 ,91 ,92 ,93, 94, 95)
			) as b
		group by consultant_key, kpi_lib_key
		) --select * from actual_actions where consultant_key = 29099 and kpi_lib_key = 77 --check actual actions
	
--ACTUAL REVENUE
, tmp_1_rev as (
	select o.position_candidate_id as pcid
	  , ors.amount * cc.value AS pc_amount_1 
	  , ors.user_id as consultant_key_1
	  , ors.offer_id
	from offer_revenue_split ors
	join offer o ON ors.offer_id = o.id
	left join curency_code cc ON o.currency_type = cc.key
	where 1=1
) 
, tmp_a as (select position_id, count(distinct user_id) as cnt from position_agency_consultant group by position_id)

, tmp_b as (
	select pc.id as pcid
	  , pac.user_id as consultant_key_1
	  , pc.shortlisted_user_id as shortlisted_key_1
	from position_candidate pc
	inner join position_agency_consultant pac ON pc.position_description_id = pac.position_id
	WHERE pc.id NOT IN (SELECT pcid from tmp_1_rev)
) 
, tmp_other_item as (
	select o.position_candidate_id as pcid
	  , sum(oii.item_quantity * oii.item_charge) as other_invoice
	from offer_invoice_item oii
	inner join offer o ON oii.offer_id = o.id
	group by o.position_candidate_id
)
, pd_account_temp AS
( 
	SELECT pac.position_id
	  , COALESCE(array_to_string(array_agg(ua.name), '', ''::text), ''''::text) AS agency_consultant_names
	FROM position_agency_consultant pac 
	INNER JOIN user_account ua ON pac.user_id = ua.id
	WHERE ua.deleted_timestamp is null
	GROUP BY position_id
)
, tmp_1_pro as (		
		SELECT * 
		FROM 
		(	SELECT tmp.pcid, tmp.position_id, cid, pc_timestamp, status
				, (projected_profit + COALESCE(tmp_other_item.other_invoice, 0))* cc.value / tmp_a.cnt AS pc_amount_1
				, gross_annual_salary * cc.value AS gross_annual_salary
				, pay_rate * cc.value AS pay_rate
				, projected_charge_rate * cc.value AS projected_charge_rate
				, fee_model_type, position_type, head_count, date_key
				, tmp.position_category
				, tmp.shortlisted_key_1
				, tmp.id
			FROM 
			(	SELECT pc.id AS pcid
				  , pc.position_description_id AS position_id
				  , pc.candidate_id AS cid
				  , pc.shortlisted_user_id as shortlisted_key_1
					, CASE	
						WHEN pc.status >= 300 AND pc.status &lt;= 303 AND COALESCE(opi.placed_date, pc.hire_date) IS NOT NULL THEN COALESCE(opi.placed_date, pc.hire_date) 	 			
						ELSE pc.associated_date END AS pc_timestamp
				  , 300 as status
					, o.projected_profit AS o_projected_profit, o.currency_type AS o_currency_type
					, CASE 
						WHEN o.projected_profit IS NOT NULL THEN o.projected_profit			
						WHEN comp.projected_profit IS NOT NULL THEN comp.projected_profit 
						ELSE 0 
					END AS projected_profit
					, CASE 
						WHEN o.gross_annual_salary IS NOT NULL THEN o.gross_annual_salary			
						WHEN comp.gross_annual_salary IS NOT NULL THEN comp.gross_annual_salary 
						ELSE 0 
					END AS gross_annual_salary
					, CASE
						WHEN o.pay_rate IS NOT NULL THEN o.pay_rate			
						WHEN comp.pay_rate IS NOT NULL THEN comp.pay_rate 
						ELSE 0 
					END AS pay_rate
					, CASE 
						WHEN  o.projected_charge_rate IS NOT NULL THEN o.projected_charge_rate			
						WHEN comp.projected_charge_rate IS NOT NULL THEN comp.projected_charge_rate 
						ELSE 0 
					END AS projected_charge_rate
					, CASE 
						WHEN o.currency_type IS NOT NULL THEN o.currency_type 
						WHEN comp.currency_type IS NOT NULL THEN comp.currency_type		
					END AS currency_type 
					, comp_m.fee_model_type
					, COALESCE(o.position_type, pd.position_type) as position_type
					, pd.head_count
					, COALESCE(opi.placed_date, pc.hire_date, opi.offer_date, pc.offer_date, pc.associated_date) date_key
					, pd.position_category
					, o.id
				FROM position_candidate pc
				LEFT JOIN compensation comp ON pc.position_description_id = comp.position_id		
				LEFT JOIN compensation_fee_model comp_m ON comp_m.compensation_id = comp.id
				JOIN pd_account_temp pat ON pc.position_description_id = pat.position_id
				JOIN position_description pd ON pc.position_description_id = pd.id
				JOIN candidate c ON c.id = pc.candidate_id
				LEFT JOIN offer o ON pc.id = o.position_candidate_id
				LEFT OUTER JOIN offer_personal_info opi ON o.id = opi.offer_id
				WHERE pc.status > 200 AND pc.status &lt;= 303
					AND c.deleted_timestamp IS NULL 
					AND pc.rejected_date IS NULL
					AND pd.floated_job = 0	
					AND ((comp.projected_profit >= 0 AND comp.currency_type IS NOT NULL) OR (o.projected_profit >= 0 AND o.currency_type IS NOT NULL))
					AND (pc.id IN (select distinct pcid from tmp_1_rev) OR pc.id NOT IN (SELECT position_candidate_id from offer))
			) tmp 
			LEFT JOIN curency_code cc ON tmp.currency_type = cc.key
			LEFT JOIN tmp_a ON tmp_a.position_id = tmp.position_id
			LEFT JOIN tmp_other_item ON tmp_other_item.pcid = tmp.pcid
		) tmp2 		
)
, tmp_1 as (
	select tmp_1_pro.pcid
		, tmp_1_pro.position_id
		, tmp_1_pro.cid
		, tmp_1_pro.pc_timestamp
		, tmp_1_pro.status
		, tmp_1_pro.pc_amount_1
		, tmp_1_pro.gross_annual_salary
		, tmp_1_pro.pay_rate
		, tmp_1_pro.projected_charge_rate
		, tmp_1_pro.fee_model_type
		, tmp_1_pro.position_type
		, tmp_1_pro.head_count
		, tmp_1_pro.date_key
		, tmp_1_pro.position_category
		, tmp_1_pro.id
		, coalesce(tmp_1_rev.pc_amount_1, 0) as pc_amount --https://hrboss.atlassian.net/browse/DATA-1053
		, coalesce(tmp_1_rev.consultant_key_1, tmp_b.consultant_key_1, -1000) as consultant_key
		, coalesce(tmp_1_pro.shortlisted_key_1, tmp_b.shortlisted_key_1, -1) as shortlisted_key
	from tmp_1_pro 
	left outer join tmp_1_rev ON tmp_1_pro.pcid = tmp_1_rev.pcid and tmp_1_pro.id = tmp_1_rev.offer_id
	left outer join tmp_b ON tmp_1_pro.pcid = tmp_b.pcid
	where 1=1
	and tmp_1_pro.date_key between date_trunc('week', '2020-10-02'::date) and date_trunc('week', '2020-10-02'::date) + interval '1 week' - '1 day'::interval --current week view
)
, tmp_3 as (select *
		, rank() over (partition by position_id order by status desc, pc_amount desc ) as ord	
	from tmp_1
)
, tmp_4 as (
	select tmp_3.position_id as job_key
	    , cid as candidate_key
		, pc_amount as actual 
		, CASE WHEN fee_model_type = 3 THEN 59
			WHEN position_type = 1 THEN 57 --NFI / Fees | Permanent
			ELSE 58 --NFI / Margin | Contract &amp; Temporary
		END as kpi_lib_key
		, tmp_3.consultant_key
		, tmp_3.shortlisted_key
		, date_key
		, tmp_3.position_category
		, tmp_3.id as offer_id
		, pcid
		, pc_amount
	from tmp_3
	INNER JOIN user_account ua ON tmp_3.consultant_key = ua.ID
	--https://hrboss.atlassian.net/browse/DATA-1029
	--where pc_amount > 0
)

, actual_fee as (
	select consultant_key
		, kpi_lib_key
		, sum(actual) as actual_fee
	from tmp_4
	group by consultant_key, kpi_lib_key
	)
	
--COMBINE ACTUAL ACTIONS AND FEES
, actual as (select *
	, 'action' as actual_type
	from actual_actions
	
	UNION ALL
	select *
	, 'fee' as actual_type
	from actual_fee
	)
	
--COMPARE TARGETS / ACTUAL
select t.start_date::date "Date From"
, t.end_date::date "Date To"
, ct.team "Team"
--, t.consultant_key
, t.name "Consultant Name"
--, t.kpi_lib_key
, ka.kpi_name_final
--, t.time_frame
, t.target
, coalesce(a.actual, 0) as actual
, t.kpi_type
from targets t
left join actual a on t.consultant_key = a.consultant_key and t.kpi_lib_key = a.kpi_lib_key
left join kpi_activated ka on ka.id = t.kpi_lib_key
left join consultant_team ct on t.consultant_key = ct.user_id
where 1=1
--and ka.kpi_name_final = 'CA - CV Sent' --check kpi name
order by t.name, t.kpi_lib_key</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cached_row_meta_active>N</cached_row_meta_active>
    <row-meta/>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1104</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
